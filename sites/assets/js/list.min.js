(function(){"use strict";frappe.templates.listing='<div class="frappe-list">  <div class="list-filters" style="display: none;">  </div>   <div style="margin-bottom:9px" class="list-toolbar-wrapper hide">   <div class="list-toolbar btn-group" style="display:inline-block; margin-right: 10px;">   </div>  </div>     <div style="clear:both"></div>  <div class="no-result text-center" style="display: none;">   {%= no_result_message %}  </div>  <div class="result">   <div class="list-headers"></div>         <div class="list-loading text-center">          {%= frappe.messages.get_waiting_message(__("Loading") + "..." ) %}         </div>   <div class="result-list"></div>  </div>  <div class="list-paging-area">   <div class="row">    <div class="col-xs-6">     <div class="btn-group btn-group-paging">      <button type="button" class="btn btn-default btn-sm btn-info" data-value="20">20</button>      <button type="button" class="btn btn-default btn-sm" data-value="100">100</button>      <button type="button" class="btn btn-default btn-sm" data-value="500">500</button>     </div>    </div>    <div class="col-xs-6 text-right">     <button class="btn btn-default btn-more btn-sm">{%= _more %}...</button>    </div>   </div>  </div> </div> ',frappe.has_indicator=function(e){return!!frappe.model.is_submittable(e)||(!(!(frappe.listview_settings[e]||{}).get_indicator&&!frappe.workflow.get_state_fieldname(e))||!(!frappe.meta.has_field(e,"enabled")&&!frappe.meta.has_field(e,"disabled")))},frappe.get_indicator=function(e,t){if(e.__unsaved)return[__("Not Saved"),"orange"];t||(t=e.doctype);var n=frappe.workflow.workflows[t],i=!n||n.override_status,r=frappe.listview_settings[t]||{},a=frappe.model.is_submittable(t),s=frappe.workflow.get_state_fieldname(t);if(s&&!i){var o=e[s];if(o){var l="";if(locals["Workflow State"][o]&&locals["Workflow State"][o].style)l={Success:"green",Warning:"orange",Danger:"red",Primary:"blue",Inverse:"black",Info:"light-blue"}[locals["Workflow State"][o].style];return l||(l="gray"),[__(o),l,s+",=,"+o]}}if(a&&0==e.docstatus&&!r.has_indicator_for_draft)return[__("Draft"),"red","docstatus,=,0"];if(a&&2==e.docstatus&&!r.has_indicator_for_cancelled)return[__("Cancelled"),"red","docstatus,=,2"];if(r.get_indicator){var d=r.get_indicator(e);if(d)return d}return a&&1==e.docstatus?[__("Submitted"),"blue","docstatus,=,1"]:e.status?[__(e.status),frappe.utils.guess_colour(e.status)]:frappe.meta.has_field(t,"enabled")?e.enabled?[__("Enabled"),"blue","enabled,=,1"]:[__("Disabled"),"gray","enabled,=,0"]:frappe.meta.has_field(t,"disabled")?e.disabled?[__("Disabled"),"gray","disabled,=,1"]:[__("Enabled"),"blue","disabled,=,0"]:void 0},frappe.ui.Filter=class{constructor(e){$.extend(this,e),null!==this.value&&void 0!==this.value||(this.value=""),this.utils=frappe.ui.filter_utils,this.set_conditions(),this.set_conditions_from_config(),this.make()}set_conditions(){var e;this.conditions=[["=",__("Equals")],["!=",__("Not Equals")],["like",__("Like")],["not like",__("Not Like")],["in",__("In")],["not in",__("Not In")],["is",__("Is")],[">",">"],["<","<"],[">=",">="],["<=","<="],["Between",__("Between")],["Timespan",__("Timespan")]],this.nested_set_conditions=[["descendants of",__("Descendants Of")],["not descendants of",__("Not Descendants Of")],["ancestors of",__("Ancestors Of")],["not ancestors of",__("Not Ancestors Of")]],(e=this.conditions).push.apply(e,this.nested_set_conditions),this.invalid_condition_map={Date:["like","not like"],Datetime:["like","not like"],Data:["Between","Timespan"],Select:["like","not like","Between","Timespan"],Link:["Between","Timespan",">","<",">=","<="],Currency:["Between","Timespan"],Color:["Between","Timespan"],Check:this.conditions.map((function(e){return e[0]})).filter((function(e){return"="!==e}))}}set_conditions_from_config(){if(frappe.boot.additional_filters_config){this.filters_config=frappe.boot.additional_filters_config;for(var e=0,t=Object.keys(this.filters_config);e<t.length;e+=1){var n=t[e],i=this.filters_config[n];this.conditions.push([n,__(i.label)]);for(var r=0,a=Object.keys(this.invalid_condition_map);r<a.length;r+=1){var s=a[r];i.valid_for_fieldtypes.includes(s)||this.invalid_condition_map[s].push(n)}}}}make(){this.filter_edit_area=$(frappe.render_template("edit_filter",{conditions:this.conditions})),this.parent&&this.filter_edit_area.appendTo(this.parent.find(".filter-edit-area")),this.make_select(),this.set_events(),this.setup()}make_select(){var e=this;this.fieldselect=new frappe.ui.FieldSelect({parent:this.filter_edit_area.find(".fieldname-select-area"),doctype:this.parent_doctype,filter_fields:this.filter_fields,input_class:"input-xs",select:function(t,n){e.set_field(t,n)}}),this.fieldname&&this.fieldselect.set_value(this.doctype,this.fieldname)}set_events(){var e=this;this.filter_edit_area.find("span.remove-filter").on("click",(function(){e.remove(),e.on_change()})),this.filter_edit_area.find(".condition").change((function(){if(e.field){var t=e.get_condition(),n=null;["in","like","not in","not like"].includes(t)?(n="Data",e.add_condition_help(t)):e.filter_edit_area.find(".filter-description").empty(),["Select","MultiSelect"].includes(e.field.df.fieldtype)&&["in","not in"].includes(t)&&(n="MultiSelect"),e.set_field(e.field.df.parent,e.field.df.fieldname,n,t)}}))}setup(){var e=this.fieldname||"name";return this.set_values(this.doctype,e,this.condition,this.value)}setup_state(e){var t=this,n=Promise.resolve();e?this.filter_edit_area.addClass("new-filter"):n=this.update_filter_tag(),this.hidden&&n.then((function(){return t.$filter_tag.hide()}))}freeze(){this.update_filter_tag()}update_filter_tag(){var e=this;return this._filter_value_set?this._filter_value_set.then((function(){e.$filter_tag?e.set_filter_button_text():e.make_tag(),e.filter_edit_area.hide()})):Promise.resolve()}remove(){this.filter_edit_area.remove(),this.field=null}set_values(e,t,n,i){if(!1!==this.set_field(e,t))return"Check"===this.field.df.original_type&&(i=1==i?"Yes":"No"),n&&this.set_condition(n,!0),this._filter_value_set=Promise.resolve(),["in","not in"].includes(n)&&Array.isArray(i)&&(i=i.join(",")),Array.isArray(i)?this._filter_value_set=this.field.set_value(i):void 0===i&&null===i||(this._filter_value_set=this.field.set_value((i+"").trim())),this._filter_value_set}set_field(e,t,n,i){var r=this,a={};if(this.field)for(var s in this.field.df)a[s]=this.field.df[s];var o=(this.fieldselect.fields_by_name[e]||{})[t];if(!o)return console.warn("Field "+t+" is not selectable."),this.remove(),!1;var l=copy_dict(o);l.read_only=0,l.hidden=0,l.is_filter=!0,delete l.hidden_due_to_dependency;var d=i||this.utils.get_default_condition(l);if(this.set_condition(d),this.utils.set_fieldtype(l,n,this.get_condition()),!this.field||a.fieldname!=t||l.fieldtype!=a.fieldtype||l.parent!=a.parent||l.options!=a.options)if(this.fieldselect.selected_doctype=e,this.fieldselect.selected_fieldname=t,this.filters_config&&this.filters_config[i]&&this.filters_config[i].valid_for_fieldtypes.includes(l.fieldtype)){var c={};if(this.filters_config[i].depends_on){var u=this.filters_config[i].depends_on,p=this.filter_list.get_filter_value(t);c[u]=p}frappe.xcall(this.filters_config[i].get_field,c).then((function(e){l.fieldtype=e.fieldtype,l.options=e.options,l.fieldname=t,r.make_field(l,a.fieldtype)}))}else this.make_field(l,a.fieldtype)}make_field(e,t){var n=this.field?this.field.get_value():null;this.hide_invalid_conditions(e.fieldtype,e.original_type),this.toggle_nested_set_conditions(e);var i=this.filter_edit_area.find(".filter-field").empty().get(0);e.input_class="input-xs";var r=frappe.ui.form.make_control({df:e,parent:i,only_input:!0});r.refresh(),this.field=r,n&&r.fieldtype===t&&this.field.set_value(n),this.bind_filter_field_events()}bind_filter_field_events(){var e=this;this.field.$input.on("focusout",(function(){return e.on_change()})),$(this.field.wrapper).find(":input").keydown((function(t){13==t.which&&"MultiSelect"!==e.field.df.fieldtype&&e.on_change()}))}get_value(){return[this.fieldselect.selected_doctype,this.field.df.fieldname,this.get_condition(),this.get_selected_value(),this.hidden]}get_selected_value(){return this.utils.get_selected_value(this.field,this.get_condition())}add_condition_help(e){var t=["in","not in"].includes(e)?__("values separated by commas"):__("use % as wildcard");this.filter_edit_area.find(".filter-description").html(t)}get_condition(){return this.filter_edit_area.find(".condition").val()}set_condition(e,t){void 0===t&&(t=!1);var n=this.filter_edit_area.find(".condition");n.val(e),t&&n.change()}make_tag(){this.field&&(this.$filter_tag=this.get_filter_tag_element().insertAfter(this.parent.find(".active-tag-filters .clear-filters")),this.set_filter_button_text(),this.bind_tag())}bind_tag(){var e=this;this.$filter_tag.find(".remove-filter").on("click",this.remove.bind(this));var t=this.$filter_tag.find(".toggle-filter");t.on("click",(function(){t.closest(".tag-filters-area").find(".filter-edit-area").show(),e.filter_edit_area.toggle()}))}set_filter_button_text(){this.$filter_tag.find(".toggle-filter").html(this.get_filter_button_text())}get_filter_button_text(){var e=this.utils.get_formatted_value(this.field,this.get_selected_value());return __(this.field.df.label)+" "+__(this.get_condition())+" "+__(e)}get_filter_tag_element(){return $('<div class="filter-tag btn-group">\n\t\t\t<button class="btn btn-default btn-xs toggle-filter"\n\t\t\t\ttitle="'+__("Edit Filter")+'">\n\t\t\t</button>\n\t\t\t<button class="btn btn-default btn-xs remove-filter"\n\t\t\t\ttitle="'+__("Remove Filter")+'">\n\t\t\t\t'+frappe.utils.icon("close")+"\n\t\t\t</button>\n\t\t</div>")}hide_invalid_conditions(e,t){for(var n=this.invalid_condition_map[t]||this.invalid_condition_map[e]||[],i=0,r=this.conditions;i<r.length;i+=1){var a=r[i];this.filter_edit_area.find('.condition option[value="'+a[0]+'"]').toggle(!n.includes(a[0]))}}toggle_nested_set_conditions(e){var t=this,n="Link"===e.fieldtype&&frappe.boot.nested_set_doctypes.includes(e.options);this.nested_set_conditions.forEach((function(e){t.filter_edit_area.find('.condition option[value="'+e[0]+'"]').toggle(n)}))}},frappe.ui.filter_utils={get_formatted_value:function(e,t){return"docstatus"===e.df.fieldname?t={0:"Draft",1:"Submitted",2:"Cancelled"}[t]||t:"Check"===e.df.original_type&&(t={0:"No",1:"Yes"}[cint(t)]),frappe.format(t,e.df,{only_value:1})},get_selected_value:function(e,t){if(e){var n=e.get_value();return"string"==typeof n&&(n=strip(n)),"is"!=t||n||(n=e.df.options[0].value),"Check"==e.df.original_type&&(n="Yes"==n?1:0),-1!==t.indexOf("like","not like")?!n||n.startsWith("%")||n.endsWith("%")||(n="%"+n+"%"):in_list(["in","not in"],t)&&n&&(n=n.split(",").map((function(e){return strip(e)}))),"%"===n&&(n=""),n}},get_default_condition:function(e){return"Data"==e.fieldtype?"like":"Date"==e.fieldtype||"Datetime"==e.fieldtype?"Between":"="},set_fieldtype:function(e,t,n){e.original_type?e.fieldtype=e.original_type:e.original_type=e.fieldtype,e.description="",e.reqd=0,e.ignore_link_validation=!0,t?e.fieldtype=t:("docstatus"==e.fieldname?(e.fieldtype="Select",e.options=[{value:0,label:__("Draft")},{value:1,label:__("Submitted")},{value:2,label:__("Cancelled")}]):"Check"==e.fieldtype?(e.fieldtype="Select",e.options="No\nYes"):(-1!=["Text","Small Text","Text Editor","Code","Tag","Comments","Dynamic Link","Read Only","Assign","Color"].indexOf(e.fieldtype)||"Link"==e.fieldtype&&-1==["=","!=","descendants of","ancestors of","not descendants of","not ancestors of"].indexOf(n))&&(e.fieldtype="Data"),"Data"===e.fieldtype&&"email"===(e.options||"").toLowerCase()&&(e.options=null),"Between"!=n||"Date"!=e.fieldtype&&"Datetime"!=e.fieldtype||(e.fieldtype="DateRange"),"Timespan"==n&&["Date","Datetime","DateRange","Select"].includes(e.fieldtype)&&(e.fieldtype="Select",e.options=this.get_timespan_options(["Last","Yesterday","Today","Tomorrow","This","Next"])),"is"===n&&(e.fieldtype="Select",e.options=[{label:__("Set",null,"Filters"),value:"set"},{label:__("Not Set"),value:"not set"}]))},get_timespan_options:function(e){var t={Last:[{label:__("Last Week"),value:"last week"},{label:__("Last Month"),value:"last month"},{label:__("Last Quarter"),value:"last quarter"},{label:__("Last 6 months"),value:"last 6 months"},{label:__("Last Year"),value:"last year"}],This:[{label:__("This Week"),value:"this week"},{label:__("This Month"),value:"this month"},{label:__("This Quarter"),value:"this quarter"},{label:__("This Year"),value:"this year"}],Next:[{label:__("Next Week"),value:"next week"},{label:__("Next Month"),value:"next month"},{label:__("Next Quarter"),value:"next quarter"},{label:__("Next 6 months"),value:"next 6 months"},{label:__("Next Year"),value:"next year"}]},n=[];return e.forEach((function(e){t[e]?t[e].forEach((function(e){n.push(e)})):n.push({label:__(e),value:""+e.toLowerCase()})})),n}},frappe.ui.FilterGroup=class{constructor(e){$.extend(this,e),this.filters=[],window.fltr=this,this.filter_button?this.make_popover():(this.wrapper=this.parent,this.wrapper.append(this.get_filter_area_template()),this.set_filter_events())}make_popover(){this.init_filter_popover(),this.set_popover_events()}init_filter_popover(){this.filter_button.popover({content:this.get_filter_area_template(),template:'\n\t\t\t\t<div class="filter-popover popover">\n\t\t\t\t\t<div class="arrow"></div>\n\t\t\t\t\t<div class="popover-body popover-content">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t',html:!0,trigger:"manual",container:"body",placement:"bottom",offset:"-100px 0"})}toggle_empty_filters(e){this.wrapper&&this.wrapper.find(".empty-filters").toggle(e)}set_popover_events(){var e=this;$(document.body).on("click",(function(t){if(e.wrapper&&e.wrapper.is(":visible")){var n=$(t.target).is(".datepicker--cell")||0!==$(t.target).closest(".datepicker--nav-title").length||0!==$(t.target).parents(".datepicker--nav-action").length;0!==$(t.target).parents(".filter-popover").length||0!==$(t.target).parents(".filter-box").length||0!==e.filter_button.find($(t.target)).length||$(t.target).is(e.filter_button)||n||e.wrapper&&e.filter_button.popover("hide")}})),this.filter_button.on("click",(function(){e.filter_button.popover("toggle")})),this.filter_button.on("shown.bs.popover",(function(){var t=e.filters&&e.filters.length>0;e.wrapper||(e.wrapper=$(".filter-popover"),t&&(e.toggle_empty_filters(!1),e.add_filters_to_popover(e.filters)),e.set_filter_events()),e.toggle_empty_filters(!1),!t&&e.add_filter(e.doctype,"name")})),this.filter_button.on("hidden.bs.popover",(function(){e.apply()})),frappe.router.on("change",(function(){e.wrapper&&e.wrapper.is(":visible")&&e.filter_button.popover("hide")}))}add_filters_to_popover(e){var t=this;e.forEach((function(e){e.parent=t.wrapper,e.field=null,e.make()}))}apply(){this.update_filters(),this.on_change()}update_filter_button(){var e=this.filters.length>0,t=e?this.filters.length>1?__("{0} filters",[this.filters.length]):__("{0} filter",[this.filters.length]):__("Filter");this.filter_button.toggleClass("btn-default",!e).toggleClass("btn-primary-light",e),this.filter_button.find(".filter-icon").toggleClass("active",e),this.filter_button.find(".button-label").html(t)}set_filter_events(){var e=this;this.wrapper.find(".add-filter").on("click",(function(){e.toggle_empty_filters(!1),e.add_filter(e.doctype,"name")})),this.wrapper.find(".clear-filters").on("click",(function(){e.toggle_empty_filters(!0),e.clear_filters(),e.on_change()})),this.wrapper.find(".apply-filters").on("click",(function(){e.filter_button.popover("hide")}))}add_filters(e){for(var t=this,n=[],i=function(){var e=a[r];n.push((function(){var n;return(n=t).add_filter.apply(n,e)}))},r=0,a=e;r<a.length;r+=1)i();return frappe.run_serially(n).then((function(){return t.update_filters()}))}add_filter(e,t,n,i,r){if(!t)return Promise.resolve();if(!this.validate_args(e,t))return!1;var a=arguments.length<2;if(a&&this.wrapper.find(".new-filter:visible").length)return Promise.resolve();var s=[e,t,n,i,r],o=this.push_new_filter(s,a);return o&&o.then?o:Promise.resolve()}validate_args(e,t){return!(e&&t&&!frappe.meta.has_field(e,t)&&!frappe.model.std_fields_list.includes(t))||(frappe.msgprint({message:__("Invalid filter: {0}",[t.bold()]),indicator:"red"}),!1)}push_new_filter(e){var t;if(!this.filter_exists(e)){var n=(t=this)._push_new_filter.apply(t,e);return n&&n.value?n._filter_value_set:void 0}}_push_new_filter(e,t,n,i,r){var a=this;void 0===r&&(r=!1);var s={parent:this.wrapper,parent_doctype:this.doctype,doctype:e,fieldname:t,condition:n,value:i,hidden:r,index:this.filters.length+1,on_change:function(e){e&&a.update_filters(),a.on_change()},filter_items:function(e,t){return!a.filter_exists([e,t])},filter_list:this.base_list||this},o=new frappe.ui.Filter(s);return this.filters.push(o),o}get_filter_value(e){return(this.filters.find((function(t){return t.fieldname==e}))||{}).value}filter_exists(e){var t=!1;return this.filters.filter((function(e){return e.field})).map((function(n){var i=n.get_value();if(2!==e.length){var r=e[3],a=frappe.utils.arrays_equal;(a(i.slice(0,4),e.slice(0,4))||Array.isArray(r)&&a(r,i[3]))&&(t=!0)}else t=e[0]===i[0]&&e[1]===i[1]})),t}get_filters(){return this.filters.filter((function(e){return e.field})).map((function(e){return e.get_value()}))}update_filters(){var e=function(e){return![void 0,null].includes(e.get_selected_value())};this.filters.map((function(t){return!e(t)&&t.remove()})),this.filters=this.filters.filter((function(t){return e(t)&&t.field})),this.update_filter_button(),0===this.filters.length&&this.toggle_empty_filters(!0)}clear_filters(){this.filters.map((function(e){return e.remove(!0)})),this.filters=[]}get_filter(e){return this.filters.filter((function(t){return t.field&&t.field.df.fieldname==e}))[0]}get_filter_area_template(){return $('\n\t\t\t<div class="filter-area">\n\t\t\t\t<div class="filter-edit-area">\n\t\t\t\t\t<div class="text-muted empty-filters text-center">\n\t\t\t\t\t\t'+__("No filters selected")+'\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<hr class="divider"></hr>\n\t\t\t\t<div class="filter-action-buttons">\n\t\t\t\t\t<button class="text-muted add-filter btn btn-xs">\n\t\t\t\t\t\t+ '+__("Add a Filter")+'\n\t\t\t\t\t</button>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<button class="btn btn-secondary-dark btn-xs clear-filters">\n\t\t\t\t\t\t\t'+__("Clear Filters")+"\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t"+(this.filter_button?'<button class="btn btn-primary btn-xs apply-filters">\n\t\t\t\t\t\t\t\t'+__("Apply Filters")+"\n\t\t\t\t\t\t\t</button>":"")+"\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>")}get_filters_as_object(){return this.get_filters().reduce((function(e,t){var n;return Object.assign(e,((n={})[t[1]]=[t[2],t[3]],n))}),{})}add_filters_to_filter_group(e){var t=this;e.forEach((function(e){t.add_filter(e[0],e[1],e[2],e[3])}))}add(e,t){var n=this;if(void 0===t&&(t=!0),!e||Array.isArray(e)&&0===e.length)return Promise.resolve();"string"==typeof e[0]&&(e=[Array.from(arguments)]);e=e.filter((function(e){return!n.exists(e)}));var i=this.set_standard_filter(e),r=i.non_standard_filters;return i.promise.then((function(){return r.length>0&&n.filter_list.add_filters(r)})).then((function(){t&&n.list_view.refresh()}))}},frappe.ui.FieldSelect=Class.extend({init:function(e){var t=this,n=this;if($.extend(this,e),this.fields_by_name={},this.options=[],this.$input=$('<input class="form-control">').appendTo(this.parent).on("click",(function(){$(this).select()})),this.input_class&&this.$input.addClass(this.input_class),this.select_input=this.$input.get(0),this.awesomplete=new Awesomplete(this.select_input,{minChars:0,maxItems:99,autoFirst:!0,list:n.options,item:function(e){return $(repl('<li class="filter-field-select"><p>%(label)s</p></li>',e)).data("item.autocomplete",e).get(0)}}),this.$input.on("awesomplete-select",(function(e){var t=e.originalEvent.text.value,i=n.awesomplete.get_item(t);n.selected_doctype=i.doctype,n.selected_fieldname=i.fieldname,n.select&&n.select(i.doctype,i.fieldname)})),this.$input.on("awesomplete-selectcomplete",(function(e){var t=e.originalEvent.text.value,i=n.awesomplete.get_item(t);n.$input.val(i.label)})),this.$input.on("awesomplete-open",(function(){var e=t.$input.parents(".modal-dialog")[0];e&&$(e).removeClass("modal-dialog-scrollable")})),this.$input.on("awesomplete-close",(function(){var e=t.$input.parents(".modal-dialog")[0];e&&$(e).addClass("modal-dialog-scrollable")})),this.filter_fields)for(var i in this.filter_fields)this.add_field_option(this.filter_fields[i]);else this.build_options();this.set_value(this.doctype,"name")},get_value:function(){return this.selected_doctype?this.selected_doctype+"."+this.selected_fieldname:null},val:function(e){if(void 0===e)return this.get_value();this.set_value(e)},clear:function(){this.selected_doctype=null,this.selected_fieldname=null,this.$input.val("")},set_value:function(e,t){var n=this;if(this.clear(),e){if(-1!==e.indexOf(".")){var i=e.split(".");e=i[0],t=i[1]}$.each(this.options,(function(i,r){if(r.doctype===e&&r.fieldname===t)return n.selected_doctype=e,n.selected_fieldname=t,n.$input.val(r.label),!1}))}},build_options:function(){var e=this;e.table_fields=[];var t=$.map(frappe.model.std_fields,(function(t){var n={parent:e.doctype};return"name"==t.fieldname&&(n.options=e.doctype),$.extend(copy_dict(t),n)})),n=locals.DocType[e.doctype];n&&cint(n.istable)&&(t=t.concat([{fieldname:"parent",fieldtype:"Data",label:__("Parent"),parent:e.doctype}])),this.with_blank&&this.options.push({label:"",value:""});var i=t.concat(frappe.meta.docfield_list[e.doctype]);$.each(frappe.utils.sort(i,"label","string"),(function(t,n){frappe.perm.has_perm(e.doctype,n.permlevel,"read")&&!n.report_hide&&e.add_field_option(n)})),$.each(e.table_fields,(function(t,n){if(n.options){var i=[].concat(frappe.meta.docfield_list[n.options]);if("Table MultiSelect"===n.fieldtype){var r=frappe.meta.get_docfields(n.options).find((function(e){return"Link"===e.fieldtype}));i=r?[r]:[]}$.each(frappe.utils.sort(i,"label","string"),(function(t,n){frappe.perm.has_perm(e.doctype,n.permlevel,"read")&&!n.report_hide&&e.add_field_option(n)}))}}))},add_field_option:function(e){var t=this;if("docstatus"!=e.fieldname||frappe.model.is_submittable(t.doctype))if(frappe.model.table_fields.includes(e.fieldtype))t.table_fields.push(e);else{var n=null,i=null;t.doctype&&e.parent==t.doctype?(n=__(e.label),i=t.doctype):(n=__(e.label)+" ("+__(e.parent)+")",i=e.parent),-1!=frappe.model.no_value_type.indexOf(e.fieldtype)||t.fields_by_name[e.parent]&&t.fields_by_name[e.parent][e.fieldname]||(this.options.push({label:n,value:i+"."+e.fieldname,fieldname:e.fieldname,doctype:e.parent}),t.fields_by_name[e.parent]||(t.fields_by_name[e.parent]={}),t.fields_by_name[e.parent][e.fieldname]=e)}}}),frappe.templates.edit_filter='<div class="filter-box">  <div class="visible-xs flex justify-flex-end">   <span class="remove-filter">    {{ __("Remove") }}   </span>  </div>  <div class="list_filter row">   <div class="fieldname-select-area col-sm-4 ui-front form-group"></div>   <div class="col-sm-3 form-group">    <select class="condition form-control input-xs">     {% for condition in conditions %}     <option value="{{condition[0]}}">{{ condition[1] }}</option>     {% endfor %}    </select>   </div>   <div class="col-sm-4 form-group">    <div class="filter-field"></div>    <div class="text-muted small filter-description"></div>   </div>   <div class="col-sm-1 text-center hidden-xs">    <span class="remove-filter">     <svg class="icon icon-sm">      <use href="#icon-close" class="close"></use>     </svg>    </span>   </div>  </div> </div>',frappe.ui.Tags=class{constructor(e){var t=e.parent,n=e.placeholder,i=e.tagsList,r=e.onTagAdd,a=e.onTagRemove,s=e.onTagClick,o=e.onChange;this.tagsList=i||[],this.onTagAdd=r,this.onTagRemove=a,this.onTagClick=s,this.onChange=o,this.setup(t,n)}setup(e,t){this.$ul=e,this.$input=$('<input class="tags-input form-control"></input>'),this.$inputWrapper=this.get_list_element(this.$input),this.$placeholder=this.get_list_element($('<span class="tags-placeholder text-muted">'+t+"</span>")),this.$inputWrapper.appendTo(this.$ul),this.$placeholder.appendTo(this.$ul),this.deactivate(),this.bind(),this.boot()}bind(){var e=this,t=this,n=function(){var e=frappe.utils.xss_sanitise(t.$input.val());t.addTag(e),t.$input.val("")};this.$input.keypress((function(e){13!=e.which&&13!=e.keyCode||n()})),this.$input.focusout(n),this.$input.on("blur",(function(){e.deactivate()})),this.$placeholder.on("click",(function(){e.activate(),e.$input.focus()}))}boot(){this.addTags(this.tagsList)}activate(){this.$placeholder.hide(),this.$inputWrapper.show()}deactivate(){this.$inputWrapper.hide(),this.$placeholder.show()}addTag(e){if(e&&""!==e&&!this.tagsList.includes(e)){var t=this.get_tag(e);this.get_list_element(t,"form-tag-row").insertBefore(this.$inputWrapper),this.tagsList.push(e),this.onTagAdd&&this.onTagAdd(e)}}removeTag(e){e=frappe.utils.xss_sanitise(e),this.tagsList.includes(e)&&(this.tagsList.splice(this.tagsList.indexOf(e),1),this.onTagRemove&&this.onTagRemove(e))}addTags(e){e.map(this.addTag.bind(this))}clearTags(){this.$ul.find(".form-tag-row").remove(),this.tagsList=[]}get_list_element(e,t){void 0===t&&(t="");var n=$('<li class="'+t+'"></li>');return e.appendTo(n),n}get_tag(e){var t=this,n=frappe.get_data_pill(e,e,(function(e,n){t.removeTag(e),n.closest(".form-tag-row").remove()}));return this.onTagClick&&n.on("click",".pill-label",(function(){t.onTagClick(e)})),n}},frappe.ui.TagEditor=Class.extend({init:function(e){$.extend(this,e),this.setup_tags(),this.user_tags||(this.user_tags=""),this.initialized=!0,this.refresh(this.user_tags)},setup_tags:function(){var e=this;this.parent&&(this.wrapper=this.parent,this.wrapper.length&&(this.tags=new frappe.ui.Tags({parent:this.wrapper,placeholder:__("Add a tag ..."),onTagAdd:function(t){if(e.initialized&&!e.refreshing)return frappe.call({method:"frappe.desk.doctype.tag.tag.add_tag",args:e.get_args(t),callback:function(n){var i=e.user_tags?e.user_tags.split(","):[];i.push(t),e.user_tags=i.join(","),e.on_change&&e.on_change(e.user_tags),frappe.tags.utils.fetch_tags()}})},onTagRemove:function(t){if(!e.refreshing)return frappe.call({method:"frappe.desk.doctype.tag.tag.remove_tag",args:e.get_args(t),callback:function(n){var i=e.user_tags.split(",");i.splice(i.indexOf(t),1),e.user_tags=i.join(","),e.on_change&&e.on_change(e.user_tags),frappe.tags.utils.fetch_tags()}})}}),this.setup_awesomplete(),this.setup_complete=!0))},setup_awesomplete:function(){var e=this,t=this.wrapper.find("input.tags-input"),n=t.get(0);this.awesomplete=new Awesomplete(n,{minChars:0,maxItems:99,list:[]}),t.on("awesomplete-open",(function(e){t.attr("state","open")})),t.on("awesomplete-close",(function(e){t.attr("state","closed")})),t.on("input",(function(t){var n=t.target.value;frappe.call({method:"frappe.desk.doctype.tag.tag.get_tags",args:{doctype:e.frm.doctype,txt:n.toLowerCase()},callback:function(t){e.awesomplete.list=t.message}})})),t.on("focus",(function(e){"open"!=t.attr("state")&&t.trigger("input")}))},get_args:function(e){return{tag:e,dt:this.frm.doctype,dn:this.frm.docname}},refresh:function(e){var t=this;if(this.initialized&&this.setup_complete&&!this.refreshing){t.refreshing=!0;try{t.tags.clearTags(),e&&(t.user_tags=e,t.tags.addTags(e.split(",")))}catch(e){t.refreshing=!1,setTimeout((function(){t.refresh()}),100)}t.refreshing=!1}}}),frappe.ui.is_liked=function(e){return-1!==frappe.ui.get_liked_by(e).indexOf(frappe.session.user)},frappe.ui.get_liked_by=function(e){var t=e._liked_by;return t&&(t=JSON.parse(t)),t||[]},frappe.ui.toggle_like=function(e,t,n,i){var r=e.hasClass("not-liked")?"Yes":"No";e.css("pointer-events","none"),frappe.call({method:"frappe.desk.like.toggle_like",quiet:!0,args:{doctype:t,name:n,add:r},callback:function(a){if(e.css("pointer-events","auto"),!a.exc){var s=$('.like-action[data-name="'+n.replace(/"/g,'"')+'"][data-doctype="'+t.replace(/"/g,'"')+'"]');"Yes"===r?s.removeClass("not-liked").addClass("liked"):s.addClass("not-liked").removeClass("liked");var o=locals[t]&&locals[t][n];if(o){var l=JSON.parse(o._liked_by||"[]"),d=l.indexOf(frappe.session.user);"Yes"===r?-1===d&&l.push(frappe.session.user):-1!==d&&(l=l.slice(0,d).concat(l.slice(d+1))),o._liked_by=JSON.stringify(l)}i&&i()}}})},frappe.ui.click_toggle_like=function(){var e=$(this),t=e.siblings(".likes-count"),n=e.hasClass("not-liked"),i=e.attr("data-doctype"),r=e.attr("data-name");return frappe.ui.toggle_like(e,i,r,(function(){n?t.text(cint(t.text())+1):t.text(cint(t.text())-1)})),!1},frappe.ui.setup_like_popover=function(e,t,n){void 0===n&&(n=!0),frappe.dom.is_touchscreen()||e.on("mouseover",t,(function(){var e=$(this);e.popover({animation:!0,placement:"bottom",trigger:"manual",template:'<div class="liked-by-popover popover">\n\t\t\t\t<div class="arrow"></div>\n\t\t\t\t<div class="popover-body popover-content"></div>\n\t\t\t</div>',content:function(){var t=e.parents(".liked-by").attr("data-liked-by");t=t?decodeURI(t):"[]",t=JSON.parse(t);var i=frappe.session.user;if(n&&(e.parents(".liked-by").find(".not-liked").length?-1!==t.indexOf(i)&&t.splice(t.indexOf(i),1):-1===t.indexOf(i)&&t.push(i)),!t.length)return"";var r=$('<ul class="list-unstyled"></ul>');return t.forEach((function(e){r.append("\n\t\t\t\t\t\t<li data-user="+e+">"+frappe.avatar(e,"avatar-xs")+"\n\t\t\t\t\t\t\t<span>"+frappe.user.full_name(e)+"</span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t")})),r.children("li").click((function(t){var n=t.currentTarget.dataset.user;e.popover("hide"),frappe.set_route("/app/user-profile/"+n)})),r},html:!0,container:"body"}),e.popover("show"),$(".popover").on("mouseleave",(function(){e.popover("hide")})),e.on("mouseout",(function(){setTimeout((function(){$(".popover:hover").length||e.popover("hide")}),100)}))}))},frappe.templates.liked_by='<ul class="list-unstyled liked-by-popover">  {% for (var i in liked_by) { var liked_by_user = liked_by[i]; %}   <li>    {%= frappe.avatar(liked_by_user) %}    <span>{%= frappe.user.full_name(liked_by_user) %}</span>   </li>  {% } %} </ul> ',frappe.templates.print_template='<!DOCTYPE html> <html lang="en"> <head>  <meta charset="utf-8">  <meta http-equiv="X-UA-Compatible" content="IE=edge">  <meta name="viewport" content="width=device-width, initial-scale=1">  <meta name="description" content="">  <meta name="author" content="">  <title>{{ title }}</title>  <link href="{{ base_url }}/assets/css/printview.css" rel="stylesheet">  <style>   {{ print_css }}  </style> </head> <body>  <div class="print-format-gutter">   {% if print_settings.repeat_header_footer %}    <div id="footer-html" class="visible-pdf">     {% if print_settings.letter_head && print_settings.letter_head.footer %}      <div class="letter-head-footer">       {{ print_settings.letter_head.footer }}      </div>     {% endif %}     <p class="text-center small page-number visible-pdf">      {{ __("Page {0} of {1}", [`<span class="page"></span>`, `<span class="topage"></span>`]) }}     </p>    </div>   {% endif %}    <div class="print-format {% if landscape %} landscape {% endif %}"     {% if columns.length > 20 %}      style="font-size: 4.0pt"     {% endif %}    >    {% if print_settings.letter_head %}    <div {% if print_settings.repeat_header_footer %} id="header-html" class="hidden-pdf" {% endif %}>     <div class="letter-head">{{ print_settings.letter_head.header }}</div>    </div>    {% endif %}    {{ content }}   </div>  </div> </body> </html>',frappe.provide("frappe.views"),frappe.views.BaseList=class{constructor(e){Object.assign(this,e)}show(){var e=this;frappe.run_serially([function(){return e.init()},function(){return e.before_refresh()},function(){return e.refresh()}])}init(){var e=this;if(this.init_promise)return this.init_promise;var t=[this.setup_defaults,this.set_stats,this.setup_fields,this.setup_page,this.setup_side_bar,this.setup_main_section,this.setup_view,this.setup_view_menu].map((function(t){return t.bind(e)}));return this.init_promise=frappe.run_serially(t),this.init_promise}setup_defaults(){var e=this;this.page_name=frappe.get_route_str(),this.page_title=this.page_title||frappe.router.doctype_layout||__(this.doctype),this.meta=frappe.get_meta(this.doctype),this.settings=frappe.listview_settings[this.doctype]||{},this.user_settings=frappe.get_user_settings(this.doctype),this.start=0,this.page_length=20,this.data=[],this.method="frappe.desk.reportview.get",this.can_create=frappe.model.can_create(this.doctype),this.can_write=frappe.model.can_write(this.doctype),this.fields=[],this.filters=[],this.nested_set_conditions=["descendants of","not descendants of","ancestors of","not ancestors of"],this.sort_by="modified",this.sort_order="desc",this.primary_action=null,this.secondary_action=null,this.menu_items=[{label:__("Refresh"),action:function(){return e.refresh()},class:"visible-xs"}]}setup_fields(){this.set_fields(),this.build_fields()}set_fields(){var e=this;[].concat(frappe.model.std_fields_list,this.meta.title_field).forEach((function(t){return e._add_field(t)}))}get_fields_in_list_view(){var e=this;return this.meta.fields.filter((function(t){return frappe.model.is_value_type(t.fieldtype)&&t.in_list_view&&frappe.perm.has_perm(e.doctype,t.permlevel,"read")||"Currency"===t.fieldtype&&t.options&&!t.options.includes(":")||"status"===t.fieldname}))}build_fields(){var e=this;this.fields=this.fields.map((function(t){return"string"==typeof t&&(t=[t,e.doctype]),t})),this.fields=this.fields.filter(Boolean),this.fields=this.fields.uniqBy((function(e){return e[0]+e[1]}))}_add_field(e,t){if(e){if(t||(t=this.doctype),"object"==typeof e){var n=e;e=n.fieldname,t=n.parent}this.fields||(this.fields=[]),(frappe.model.std_fields_list.includes(e)||frappe.meta.has_field(t,e)||"_seen"===e)&&this.fields.push([e,t])}}set_stats(){this.stats=["_user_tags"],this.workflow_state_fieldname=frappe.workflow.get_state_fieldname(this.doctype),this.workflow_state_fieldname&&(frappe.workflow.workflows[this.doctype].override_status||this._add_field(this.workflow_state_fieldname),this.stats.push(this.workflow_state_fieldname))}setup_page(){this.page=this.parent.page,this.$page=$(this.parent),this.page.main.addClass("frappe-card"),this.page.page_form.removeClass("row").addClass("flex"),this.hide_page_form&&this.page.page_form.hide(),this.hide_sidebar&&this.$page.addClass("no-list-sidebar"),this.setup_page_head()}setup_page_head(){this.set_title(),this.set_menu_items(),this.set_breadcrumbs()}set_title(){this.page.set_title(this.page_title)}setup_view_menu(){var e={Image:"image-view",List:"list",Report:"small-file",Calendar:"calendar",Gantt:"gantt",Kanban:"kanban",Dashboard:"dashboard",Map:"map"};frappe.boot.desk_settings.view_switcher&&(this.views_menu=this.page.add_custom_button_group(__("{0} View",[__(this.view_name)]),e[this.view_name]||"list"),this.views_list=new frappe.views.ListViewSelect({doctype:this.doctype,parent:this.views_menu,page:this.page,list_view:this,sidebar:this.list_sidebar,icon_map:e}))}set_default_secondary_action(){var e=this;if(this.secondary_action){var t=this.page.set_secondary_action(this.secondary_action.label,this.secondary_action.action,this.secondary_action.icon);this.secondary_action.icon?this.secondary_action.label||t.addClass("visible-xs"):t.addClass("hidden-xs")}else this.refresh_button=this.page.add_action_icon("refresh",(function(){e.refresh()}))}set_menu_items(){var e=this;this.set_default_secondary_action(),this.menu_items&&this.menu_items.map((function(t){if(!t.condition||!1!==t.condition()){var n=e.page.add_menu_item(t.label,t.action,t.standard,t.shortcut);t.class&&n&&n.addClass(t.class)}}))}set_breadcrumbs(){frappe.breadcrumbs.add(this.meta.module,this.doctype)}setup_side_bar(){!this.hide_sidebar&&frappe.boot.desk_settings.list_sidebar&&(this.list_sidebar=new frappe.views.ListSidebar({doctype:this.doctype,stats:this.stats,parent:this.$page.find(".layout-side-section"),page:this.page,list_view:this}))}toggle_side_bar(e){var t=e||JSON.parse(localStorage.show_sidebar||"true");t=!t,localStorage.show_sidebar=t,this.show_or_hide_sidebar(),$(document.body).trigger("toggleListSidebar")}show_or_hide_sidebar(){var e=JSON.parse(localStorage.show_sidebar||"true");$(document.body).toggleClass("no-list-sidebar",!e)}setup_main_section(){var e=this;return frappe.run_serially([this.setup_list_wrapper,this.show_or_hide_sidebar,this.setup_filter_area,this.setup_sort_selector,this.setup_result_area,this.setup_no_result_area,this.setup_freeze_area,this.setup_paging_area].map((function(t){return t.bind(e)})))}setup_list_wrapper(){this.$frappe_list=$('<div class="frappe-list">').appendTo(this.page.main)}setup_filter_area(){if(!this.hide_filters)return this.filter_area=new FilterArea(this),this.filters&&this.filters.length>0?this.filter_area.set(this.filters):void 0}setup_sort_selector(){this.hide_sort_selector||(this.sort_selector=new frappe.ui.SortSelector({parent:this.$filter_section,doctype:this.doctype,args:{sort_by:this.sort_by,sort_order:this.sort_order},onchange:this.on_sort_change.bind(this)}))}on_sort_change(){this.refresh()}setup_result_area(){this.$result=$('<div class="result">'),this.$frappe_list.append(this.$result)}setup_no_result_area(){this.$no_result=$('\n\t\t\t<div class="no-result text-muted flex justify-center align-center">\n\t\t\t\t'+this.get_no_result_message()+"\n\t\t\t</div>\n\t\t").hide(),this.$frappe_list.append(this.$no_result)}setup_freeze_area(){this.$freeze=$('<div class="freeze"></div>').hide(),this.$frappe_list.append(this.$freeze)}get_no_result_message(){return __("Nothing to show")}setup_paging_area(){var e=this;this.$paging_area=$('<div class="list-paging-area level">\n\t\t\t\t<div class="level-left">\n\t\t\t\t\t<div class="btn-group">\n\t\t\t\t\t\t'+[20,100,500].map((function(e){return'\n\t\t\t\t\t\t\t<button type="button" class="btn btn-default btn-sm btn-paging"\n\t\t\t\t\t\t\t\tdata-value="'+e+'">\n\t\t\t\t\t\t\t\t'+e+"\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t"})).join("")+'\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="level-right">\n\t\t\t\t\t<button class="btn btn-default btn-more btn-sm">\n\t\t\t\t\t\t'+__("Load More")+"\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>").hide(),this.$frappe_list.append(this.$paging_area),this.$paging_area.find('.btn-paging[data-value="'+this.page_length+'"]').addClass("btn-info"),this.$paging_area.on("click",".btn-paging, .btn-more",(function(t){var n=$(t.currentTarget);n.is(".btn-paging")?(e.$paging_area.find(".btn-paging").removeClass("btn-info"),n.addClass("btn-info"),e.start=0,e.page_length=n.data().value):n.is(".btn-more")&&(e.start=e.start+e.page_length),e.refresh()}))}get_fields(){return this.fields.map((function(e){return frappe.model.get_full_column_name(e[0],e[1])}))}setup_view(){}get_filter_value(e){var t=this.get_filters_for_args().filter((function(t){return t[1]==e}))[0];if(t)return{like:t[3].replace(/^%?|%$/g,""),"not set":null}[t[2]]||t[3]}get_filters_for_args(){var e=this;return this.filter_area?this.filter_area.get().filter((function(t){return!e.nested_set_conditions.includes(t[2])})).map((function(e){return e.slice(0,4)})):[]}get_or_filters_for_args(){var e=this,t=this.filter_area?this.filter_area.get().filter((function(t){return e.nested_set_conditions.includes(t[2])})).map((function(e){return e.slice(0,4)})):[],n=t.length?t.map((function(e){var t=e.slice();return t.splice(2,1,"="),t})):[];return t.length?t.concat(n):[]}get_args(){return{doctype:this.doctype,fields:this.get_fields(),filters:this.get_filters_for_args(),or_filters:this.get_or_filters_for_args(),order_by:this.sort_selector&&this.sort_selector.get_sql_string(),start:this.start,page_length:this.page_length,view:this.view}}get_call_args(){var e=this.get_args();return{method:this.method,args:e,freeze:this.freeze_on_refresh||!1,freeze_message:this.freeze_message||__("Loading")+"..."}}before_refresh(){}refresh(){var e=this;return this.freeze(!0),frappe.call(this.get_call_args()).then((function(t){e.prepare_data(t),e.toggle_result_area(),e.before_render(),e.render(),e.after_render(),e.freeze(!1),e.settings.refresh&&e.settings.refresh(e)}))}prepare_data(e){var t=e.message||{};t=Array.isArray(t)?t:frappe.utils.dict(t.keys,t.values),0===this.start?this.data=t:this.data=this.data.concat(t),this.data=this.data.uniqBy((function(e){return e.name}))}freeze(){}before_render(){}after_render(){}render(){}on_filter_change(){}toggle_result_area(){this.$result.toggle(this.data.length>0),this.$paging_area.toggle(this.data.length>0),this.$no_result.toggle(0==this.data.length);var e=this.start+this.page_length<=this.data.length;this.$paging_area.find(".btn-more").toggle(e)}call_for_selected_items(e,t){var n=this;void 0===t&&(t={}),t.names=this.get_checked_items(!0),frappe.call({method:e,args:t,freeze:!0,callback:function(e){e.exc||n.refresh()}})}};class FilterArea{constructor(e){this.list_view=e,this.list_view.page.page_form.append('<div class="standard-filter-section flex"></div>');var t=this.list_view.hide_page_form?this.list_view.page.custom_actions:this.list_view.page.page_form;this.list_view.$filter_section=$('<div class="filter-section flex">').appendTo(t),this.$filter_list_wrapper=this.list_view.$filter_section,this.trigger_refresh=!0,this.setup()}setup(){this.list_view.hide_page_form||this.make_standard_filters(),this.make_filter_list()}get(){var e=this.filter_list.get_filters(),t=this.get_standard_filters();return e.concat(t).uniqBy(JSON.stringify)}set(e){var t=this;return this.trigger_refresh=!1,this.add(e,!1).then((function(){t.trigger_refresh=!0,t.filter_list.update_filter_button()}))}add(e,t){var n=this;if(void 0===t&&(t=!0),!e||Array.isArray(e)&&0===e.length)return Promise.resolve();"string"==typeof e[0]&&(e=[Array.from(arguments)]);e=e.filter((function(e){return!n.exists(e)}));var i=this.set_standard_filter(e),r=i.non_standard_filters;return i.promise.then((function(){return r.length>0&&n.filter_list.add_filters(r)})).then((function(){t&&n.list_view.refresh()}))}refresh_list_view(){this.trigger_refresh&&(this.list_view.start=0,this.list_view.refresh(),this.list_view.on_filter_change())}exists(e){var t=!1,n=this.list_view.page.fields_dict;"="===e[2]&&e[1]in n&&(n[e[1]].get_value()&&(t=!0));return t||(t=this.filter_list.filter_exists(e)),t}set_standard_filter(e){if(0===e.length)return{non_standard_filters:[],promise:Promise.resolve()};var t=this.list_view.page.fields_dict;return e.reduce((function(e,n){n[0];var i=n[1],r=n[2],a=n[3];return e.promise=e.promise||Promise.resolve(),e.non_standard_filters=e.non_standard_filters||[],!t[i]||"="!==r&&"like"!==r&&"descendants of"!==r?e.non_standard_filters.push(n):e.promise=e.promise.then((function(){return t[i].set_value(a)})),e}),{})}remove_filters(e){var t=this;e.map((function(e){t.remove(e[1])}))}remove(e){var t=this.list_view.page.fields_dict;e in t&&t[e].set_value("");var n=this.filter_list.get_filter(e);return n&&n.remove(),this.filter_list.apply(),Promise.resolve()}clear(e){var t=this;void 0===e&&(e=!0),e||(this.trigger_refresh=!1),this.filter_list.clear_filters();var n=[],i=this.list_view.page.fields_dict,r=function(e){var i=t.list_view.page.fields_dict[e];n.push((function(){return i.set_value("")}))};for(var a in i)r(a);return frappe.run_serially(n).then((function(){t.trigger_refresh=!0}))}make_standard_filters(){var e=this;this.standard_filters_wrapper=this.list_view.page.page_form.find(".standard-filter-section");var t=this.list_view&&this.list_view.doctype?this.list_view.doctype:null,n=[{fieldtype:"Data",label:__("Name"),condition:"like",fieldname:"name",onchange:function(){return e.refresh_list_view()}}];this.list_view.custom_filter_configs&&(this.list_view.custom_filter_configs.forEach((function(t){t.onchange=function(){return e.refresh_list_view()}})),n=n.concat(this.list_view.custom_filter_configs));var i=this.list_view.meta.fields,r=this.list_view.meta.title_field,a=i.filter((function(e){return e.fieldname===r||e.in_standard_filter&&frappe.model.is_value_type(e.fieldtype)}));(n=n.concat(a.map((function(e){return"Link"===e.fieldtype&&frappe.boot.nested_set_doctypes.includes(e.options)?Object.assign(e,{condition:"descendants of"}):e})).map((function(n){var i=n.options,r=n.condition||"=",a=n.fieldtype;["Text","Small Text","Text Editor","HTML Editor","Data","Code","Read Only"].includes(a)&&(a="Data",r="like"),"Select"==n.fieldtype&&n.options&&(i=n.options.split("\n")).length>0&&""!=i[0]&&(i.unshift(""),i=i.join("\n"));var s="Link"===a?frappe.defaults.get_user_default(i):null;return["__default","__global"].includes(s)&&(s=null),{fieldtype:a,label:__(n.label,null,t),context:t,options:i,fieldname:n.fieldname,condition:r,default:s,onchange:function(){return e.refresh_list_view()},ignore_link_validation:"Dynamic Link"===a,is_filter:1}})))).map((function(t){e.list_view.page.add_field(t,e.standard_filters_wrapper)}))}get_standard_filters(){var e=[],t=this.list_view.page.fields_dict;for(var n in t){var i=t[n],r=i.get_value();r&&("like"!==i.df.condition||r.includes("%")||(r="%"+r+"%"),e.push([this.list_view.doctype,i.df.fieldname,i.df.condition||"=",r]))}return e}make_filter_list(){var e=this;$('<div class="filter-selector">\n\t\t\t<button class="btn btn-default btn-sm filter-button">\n\t\t\t\t<span class="filter-icon">\n\t\t\t\t\t'+frappe.utils.icon("filter")+'\n\t\t\t\t</span>\n\t\t\t\t<span class="button-label hidden-xs">\n\t\t\t\t\t'+__("Filter")+"\n\t\t\t\t<span>\n\t\t\t</button>\n\t\t</div>").appendTo(this.$filter_list_wrapper),this.filter_button=this.$filter_list_wrapper.find(".filter-button"),this.filter_list=new frappe.ui.FilterGroup({base_list:this.list_view,parent:this.$filter_list_wrapper,doctype:this.list_view.doctype,filter_button:this.filter_button,default_filters:[],on_change:function(){return e.refresh_list_view()}})}is_being_edited(){return this.filter_list&&this.filter_list.wrapper&&this.filter_list.wrapper.find(".filter-box:visible").length>0}}frappe.views.view_modes=["List","Report","Dashboard","Gantt","Kanban","Calendar","Image","Inbox","Tree","Map"],frappe.views.is_valid=function(e){return frappe.views.view_modes.includes(e)};class BulkOperations{constructor(e){var t=e.doctype;t||frappe.throw(__("Doctype required")),this.doctype=t}print(e){var t=this,n=frappe.model.get_doc(":Print Settings","Print Settings"),i=cint(n.allow_print_for_draft),r=frappe.model.is_submittable(this.doctype),a=cint(n.allow_print_for_cancelled),s=e.filter((function(e){return!r||1===e.docstatus||a&&2==e.docstatus||i&&0==e.docstatus||frappe.user.has_role("Administrator")})).map((function(e){return e.name}));if(e.filter((function(e){return!s.includes(e.name)})).length>0)frappe.msgprint(__("You selected Draft or Cancelled documents"));else if(s.length>0){var o=new frappe.ui.Dialog({title:__("Print Documents"),fields:[{fieldtype:"Check",label:__("With Letterhead"),fieldname:"with_letterhead"},{fieldtype:"Select",label:__("Print Format"),fieldname:"print_sel",options:frappe.meta.get_print_formats(this.doctype)}]});o.set_primary_action(__("Print"),(function(e){if(e){var n=frappe.get_meta(t.doctype).default_print_format,i=e.with_letterhead?1:0,r=e.print_sel?e.print_sel:n,a=JSON.stringify(s);window.open("/api/method/frappe.utils.print_format.download_multi_pdf?doctype="+encodeURIComponent(t.doctype)+"&name="+encodeURIComponent(a)+"&format="+encodeURIComponent(r)+"&no_letterhead="+(i?"0":"1"))||frappe.msgprint(__("Please enable pop-ups"))}})),o.show()}else frappe.msgprint(__("Select atleast 1 record for printing"))}delete(e,t){void 0===t&&(t=null),frappe.call({method:"frappe.desk.reportview.delete_items",freeze:!0,args:{items:e,doctype:this.doctype}}).then((function(n){var i=n.message;i||(i=[]),i.length&&!n._server_messages&&frappe.throw(__("Cannot delete {0}",[i.map((function(e){return e.bold()})).join(", ")])),i.length<e.length&&(frappe.utils.play_sound("delete"),t&&t())}))}assign(e,t){if(e.length>0){var n=new frappe.ui.form.AssignToDialog({obj:this,method:"frappe.desk.form.assign_to.add_multiple",doctype:this.doctype,docname:e,bulk_assign:!0,re_assign:!0,callback:t});n.dialog.clear(),n.dialog.show()}else frappe.msgprint(__("Select records for assignment"))}apply_assignment_rule(e,t){e.length>0&&frappe.call("frappe.automation.doctype.assignment_rule.assignment_rule.bulk_apply",{doctype:this.doctype,docnames:e}).then((function(){return t()}))}submit_or_cancel(e,t,n){void 0===t&&(t="submit"),void 0===n&&(n=null),t=t.toLowerCase(),frappe.call({method:"frappe.desk.doctype.bulk_update.bulk_update.submit_cancel_or_update_docs",args:{doctype:this.doctype,action:t,docnames:e}}).then((function(i){var r=i.message;r||(r=[]),r.length&&!i._server_messages&&frappe.throw(__("Cannot {0} {1}",[t,r.map((function(e){return e.bold()})).join(", ")])),r.length<e.length&&(frappe.utils.play_sound(t),n&&n())}))}edit(e,t,n){var i=this,r=Object.keys(t).map((function(e){return{label:__(e),value:e}})),a=/status/i,s=Object.keys(t).find((function(e){return a.test(e)})),o=new frappe.ui.Dialog({title:__("Edit"),fields:[{fieldtype:"Select",options:r.sort((function(e,t){var n=e.label.toUpperCase(),i=t.label.toUpperCase();return n<i?-1:n>i?1:0})),default:s,label:__("Field"),fieldname:"field",reqd:1,onchange:function(){l(o)}},{fieldtype:"Data",label:__("Value"),fieldname:"value",reqd:1}],primary_action:function(r){var a,s=r.value,l=t[o.get_value("field")].fieldname;o.disable_primary_action(),frappe.call({method:"frappe.desk.doctype.bulk_update.bulk_update.submit_cancel_or_update_docs",args:{doctype:i.doctype,freeze:!0,docnames:e,action:"update",data:(a={},a[l]=s,a)}}).then((function(e){var t=e.message||[];t.length&&!e._server_messages&&(o.enable_primary_action(),frappe.throw(__("Cannot update {0}",[t.map((function(e){return e.bold?e.bold():e})).join(", ")]))),n(),o.hide(),frappe.msgprint(__("Updated successfully"))}))},primary_action_label:__("Update")});function l(e){var n=Object.assign({},t[e.get_value("field")]);if(n.label.match(a)&&"Select"===n.fieldtype&&!n.default){var i=[];"string"==typeof n.options&&(i=n.options.split("\n")),n.default=i[0]||i[1]}n.label=__("Value"),n.reqd=1,delete n.depends_on,e.replace_field("value",n)}s&&l(o),o.refresh(),o.show()}add_tags(e,t){var n=this,i=new frappe.ui.Dialog({title:__("Add Tags"),fields:[{fieldtype:"MultiSelectPills",fieldname:"tags",label:__("Tags"),reqd:!0,get_data:function(e){return frappe.db.get_link_options("Tag",e)}}],primary_action_label:__("Add"),primary_action:function(){var r=i.get_values();r&&r.tags&&(i.set_message("Adding Tags..."),frappe.call({method:"frappe.desk.doctype.tag.tag.add_tags",args:{tags:r.tags,dt:n.doctype,docs:e},callback:function(){i.hide(),t()}}))}});i.show()}}class ListSettings{constructor(e){var t=this,n=e.listview,i=e.doctype,r=e.meta,a=e.settings;i||frappe.throw("DocType required"),this.listview=n,this.doctype=i,this.meta=r,this.settings=a,this.dialog=null,this.fields=this.settings&&this.settings.fields?JSON.parse(this.settings.fields):[],this.subject_field=null,frappe.model.with_doctype("List View Settings",(function(){t.make(),t.get_listview_fields(r),t.setup_fields(),t.setup_remove_fields(),t.add_new_fields(),t.show_dialog()}))}make(){var e=this,t=frappe.get_meta("List View Settings");e.dialog=new frappe.ui.Dialog({title:__("{0} Settings",[__(e.doctype)]),fields:t.fields}),e.dialog.set_values(e.settings),e.dialog.set_primary_action(__("Save"),(function(){var t=e.dialog.get_values();frappe.show_alert({message:__("Saving"),indicator:"green"}),frappe.call({method:"frappe.desk.doctype.list_view_settings.list_view_settings.save_listview_settings",args:{doctype:e.doctype,listview_settings:t,removed_listview_fields:e.removed_fields||[]},callback:function(t){e.listview.refresh_columns(t.message.meta,t.message.listview_settings),e.dialog.hide()}})})),e.dialog.fields_dict.total_fields.df.onchange=function(){return e.refresh()}}refresh(){var e=this;e.setup_fields(),e.add_new_fields(),e.setup_remove_fields()}show_dialog(){var e=this;if(this.settings.fields||e.update_fields(),!e.dialog.get_value("total_fields")){var t=e.fields.length;(t<4||t>10)&&(t=4),e.dialog.set_value("total_fields",t)}e.dialog.show()}setup_fields(){var e=this,t=e.dialog.get_field("fields_html"),n=t.$wrapper[0],i="",r=e.dialog.get_values().total_fields||e.settings.total_fields;for(var a in e.fields){if(a==parseInt(r))break;var s=0==a?"":"sortable",o=0==a?"hide":"",l=0==a||"status_field"===e.fields[a].fieldname?"hide":"";i+='\n\t\t\t\t<div class="control-input flex align-center form-control fields_order '+s+'"\n\t\t\t\t\tstyle="display: block; margin-bottom: 5px;" data-fieldname="'+e.fields[a].fieldname+'"\n\t\t\t\t\tdata-label="'+e.fields[a].label+'" data-type="'+e.fields[a].type+'">\n\n\t\t\t\t\t<div class="row">\n\t\t\t\t\t\t<div class="col-md-1">\n\t\t\t\t\t\t\t<i class="fa fa-bars text-muted sortable-handle '+o+'" aria-hidden="true"></i>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="col-md-10" style="padding-left:0px;">\n\t\t\t\t\t\t\t'+__(e.fields[a].label)+'\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="col-md-1 '+l+'">\n\t\t\t\t\t\t\t<a class="text-muted remove-field" data-fieldname="'+e.fields[a].fieldname+'">\n\t\t\t\t\t\t\t\t<i class="fa fa-trash-o" aria-hidden="true"></i>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>'}t.html('\n\t\t\t<div class="form-group">\n\t\t\t\t<div class="clearfix">\n\t\t\t\t\t<label class="control-label" style="padding-right: 0px;">'+__("Fields")+'</label>\n\t\t\t\t</div>\n\t\t\t\t<div class="control-input-wrapper">\n\t\t\t\t'+i+'\n\t\t\t\t</div>\n\t\t\t\t<p class="help-box small text-muted hidden-xs">\n\t\t\t\t\t<a class="add-new-fields text-muted">\n\t\t\t\t\t\t'+__("+ Add / Remove Fields")+"\n\t\t\t\t\t</a>\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t"),new Sortable(n.getElementsByClassName("control-input-wrapper")[0],{handle:".sortable-handle",draggable:".sortable",onUpdate:function(){e.update_fields(),e.refresh()}})}add_new_fields(){var e=this;e.dialog.get_field("fields_html").$wrapper[0].getElementsByClassName("add-new-fields")[0].onclick=function(){return e.column_selector()}}setup_remove_fields(){for(var e=this,t=e.dialog.get_field("fields_html").$wrapper[0].getElementsByClassName("remove-field"),n=function(n){t.item(n).onclick=function(){return e.remove_fields(t.item(n).getAttribute("data-fieldname"))}},i=0;i<t.length;i++)n(i)}remove_fields(e){var t=this,n=t.fields.map((function(e){return e.fieldname}));for(var i in t.fields){if(t.fields[i].fieldname==e){t.fields.splice(i,1);break}}t.set_removed_fields(t.get_removed_listview_fields(t.fields.map((function(e){return e.fieldname})),n)),t.refresh(),t.update_fields()}update_fields(){var e=this,t=e.dialog.get_field("fields_html").$wrapper[0].getElementsByClassName("fields_order");e.fields=[];for(var n=0;n<t.length;n++)e.fields.push({fieldname:t.item(n).getAttribute("data-fieldname"),label:t.item(n).getAttribute("data-label")});e.dialog.set_value("fields",JSON.stringify(e.fields)),e.dialog.get_value("fields")}column_selector(){var e=this,t=new frappe.ui.Dialog({title:__("{0} Fields",[__(e.doctype)]),fields:[{label:__("Reset Fields"),fieldtype:"Button",fieldname:"reset_fields",click:function(){return e.reset_listview_fields(t)}},{label:__("Select Fields"),fieldtype:"MultiCheck",fieldname:"fields",options:e.get_doctype_fields(e.meta,e.fields.map((function(e){return e.fieldname}))),columns:2}]});t.set_primary_action(__("Save"),(function(){var n=t.get_values().fields;for(var i in e.set_removed_fields(e.get_removed_listview_fields(n,e.fields.map((function(e){return e.fieldname})))),e.fields=[],e.set_subject_field(e.meta),e.set_status_field(),n){var r=n[i];if(e.fields.length===parseInt(e.dialog.get_values().total_fields))break;if(r!=e.subject_field.fieldname){var a=frappe.meta.get_docfield(e.doctype,r);a&&e.fields.push({label:a.label,fieldname:a.fieldname})}}e.refresh(),e.dialog.set_value("fields",JSON.stringify(e.fields)),t.hide()})),t.show()}reset_listview_fields(e){var t=this;frappe.xcall("frappe.desk.doctype.list_view_settings.list_view_settings.get_default_listview_fields",{doctype:t.doctype}).then((function(n){e.get_field("fields").df.options=t.get_doctype_fields(t.meta,n),e.refresh()}))}get_listview_fields(e){var t=this;t.settings.fields?t.fields=JSON.parse(this.settings.fields):t.set_list_view_fields(e),t.fields.uniqBy((function(e){return e.fieldname}))}set_list_view_fields(e){var t=this;t.set_subject_field(e),t.set_status_field(),e.fields.forEach((function(e){e.in_list_view&&!in_list(frappe.model.no_value_type,e.fieldtype)&&t.subject_field.fieldname!=e.fieldname&&t.fields.push({label:e.label,fieldname:e.fieldname})}))}set_subject_field(e){var t=this;if(t.subject_field={label:__("Name"),fieldname:"name"},e.title_field){var n=frappe.meta.get_docfield(t.doctype,e.title_field.trim());t.subject_field={label:n.label,fieldname:n.fieldname}}t.fields.push(t.subject_field)}set_status_field(){frappe.has_indicator(this.doctype)&&this.fields.push({type:"Status",label:__("Status"),fieldname:"status_field"})}get_doctype_fields(e,t){var n=[];return e.fields.forEach((function(e){in_list(frappe.model.no_value_type,e.fieldtype)||n.push({label:e.label,value:e.fieldname,checked:in_list(t,e.fieldname)})})),n}get_removed_listview_fields(e,t){var n=[];return frappe.has_indicator(this.doctype)&&e.push("status_field"),t.forEach((function(t){in_list(e,t)||n.push(t)})),n}set_removed_fields(e){var t=this;t.removed_fields?t.removed_fields.concat(e):t.removed_fields=e}}frappe.provide("frappe.views"),frappe.views.ListView=class extends frappe.views.BaseList{static load_last_view(){var e=frappe.get_route()[1];if(1===frappe.router.get_sub_path_string().split("/").length){var t=frappe.get_user_settings(e).last_view;return!(!t||"list"==t.toLowerCase())&&(frappe.set_route("list",frappe.router.doctype_layout||e,frappe.views.is_valid(t)?t.toLowerCase():"list"),!0)}return!1}constructor(e){super(e),this.show()}has_permissions(){return frappe.perm.has_perm(this.doctype,0,"read")}show(){if(this.parent.disable_scroll_to_top=!0,!this.has_permissions())return frappe.set_route(""),void frappe.msgprint(__("Not permitted to view {0}",[__(this.doctype)]));super.show()}get view_name(){return"List"}get view_user_settings(){return this.user_settings[this.view_name]||{}}setup_defaults(){var e=this;if(super.setup_defaults(),this.view="List",this.sort_by=this.view_user_settings.sort_by||"modified",this.sort_order=this.view_user_settings.sort_order||"desc",this.view_user_settings.filters&&this.view_user_settings.filters.length){var t=this.view_user_settings.filters;this.filters=this.validate_filters(t)}else this.filters=(this.settings.filters||[]).map((function(t){return 3===t.length&&(t=[e.doctype,t[0],t[1],t[2]]),t}));if(this.menu_items=this.menu_items.concat(this.get_menu_items()),this.view_user_settings.filters&&this.view_user_settings.filters.length){var n=this.view_user_settings.filters;this.filters=this.validate_filters(n)}else this.filters=(this.settings.filters||[]).map((function(t){return 3===t.length&&(t=[e.doctype,t[0],t[1],t[2]]),t}));return"List"==this.view_name&&(this.toggle_paging=!0),this.patch_refresh_and_load_lib(),this.get_list_view_settings()}get_list_view_settings(){var e=this;return frappe.call("frappe.desk.listview.get_list_settings",{doctype:this.doctype}).then((function(t){return e.list_view_settings=t.message||{}}))}on_sort_change(e,t){this.sort_by=e,this.sort_order=t,super.on_sort_change()}validate_filters(e){var t=this.meta.fields.map((function(e){return e.fieldname}));return t=t.concat(frappe.model.std_fields_list),e.filter((function(e){return t.includes(e[1])})).uniqBy((function(e){return e[1]}))}setup_page(){this.parent.list_view=this,super.setup_page()}setup_page_head(){super.setup_page_head(),this.set_primary_action(),this.set_actions_menu_items()}set_actions_menu_items(){var e=this;this.actions_menu_items=this.get_actions_menu_items(),this.workflow_action_menu_items=this.get_workflow_action_menu_items(),this.workflow_action_items={},this.actions_menu_items.concat(this.workflow_action_menu_items).map((function(t){var n=e.page.add_actions_menu_item(t.label,t.action,t.standard);t.class&&n.addClass(t.class),t.is_workflow_action&&n&&(e.workflow_action_items[t.name]=n)}))}show_restricted_list_indicator_if_applicable(){var e=this,t=frappe.perm.get_match_rules(this.doctype);t.length&&(this.restricted_list=$('<button class="btn btn-xs restricted-button flex align-center">\n\t\t\t\t\t'+frappe.utils.icon("restriction","xs")+"\n\t\t\t\t</button>").click((function(){return e.show_restrictions(t)})).appendTo(this.page.page_form))}show_restrictions(e){void 0===e&&(e=[]),frappe.msgprint(frappe.render_template("list_view_permission_restrictions",{condition_list:e}),__("Restrictions"))}set_fields(){var e=this;[].concat(frappe.model.std_fields_list,this.get_fields_in_list_view(),[this.meta.title_field,this.meta.image_field],this.settings.add_fields||[],this.meta.track_seen?"_seen":null,this.sort_by,"enabled","disabled","color").forEach((function(t){return e._add_field(t)})),this.fields.forEach((function(t){var n=frappe.meta.get_docfield(t[1],t[0]);n&&"Currency"===n.fieldtype&&n.options&&!n.options.includes(":")&&e._add_field(n.options)}))}patch_refresh_and_load_lib(){var e=this;this.refresh=this.refresh.bind(this),this.refresh=frappe.utils.throttle(this.refresh,1e3),this.load_lib=new Promise((function(t){e.required_libs?frappe.require(e.required_libs,t):t()}));setInterval((function(){frappe.get_route_str()===e.page_name&&e.refresh()}),3e5)}set_primary_action(){var e=this;this.can_create?this.page.set_primary_action(__("Add")+" "+(frappe.router.doctype_layout||__(this.doctype)),(function(){e.settings.primary_action?e.settings.primary_action():e.make_new_doc()}),"add"):this.page.clear_primary_action()}make_new_doc(){var e=this.doctype,t={};this.filter_area.get().forEach((function(e){"="===e[2]&&frappe.model.is_non_std_field(e[1])&&(t[e[1]]=e[3])})),frappe.new_doc(e,t)}setup_view(){this.setup_columns(),this.render_header(),this.render_skeleton(),this.setup_events(),this.settings.onload&&this.settings.onload(this),this.show_restricted_list_indicator_if_applicable()}refresh_columns(e,t){this.meta=e,this.list_view_settings=t,this.setup_columns(),this.refresh(!0)}refresh(e){var t=this;void 0===e&&(e=!1),super.refresh().then((function(){t.render_header(e)}))}setup_freeze_area(){this.$freeze=$('<div class="freeze flex justify-center align-center text-muted">'+__("Loading")+"...</div>").hide(),this.$result.append(this.$freeze)}setup_columns(){var e=this;this.columns=[];var t=frappe.meta.get_docfield.bind(null,this.doctype);this.meta.title_field?this.columns.push({type:"Subject",df:t(this.meta.title_field)}):this.columns.push({type:"Subject",df:{label:__("Name"),fieldname:"name"}}),this.columns.push({type:"Tag"}),frappe.has_indicator(this.doctype)&&this.columns.push({type:"Status"});var n=this.get_fields_in_list_view();this.columns=this.columns.concat(n.filter((function(t){return(!frappe.has_indicator(e.doctype)||"status"!==t.fieldname)&&(!!t.in_list_view&&t.fieldname!==e.meta.title_field)})).map((function(e){return{type:"Field",df:e}}))),this.list_view_settings.fields&&(this.columns=this.reorder_listview_fields());var i=6;window.innerWidth<=1366?i=4:window.innerWidth>=1920&&(i=8),this.columns=this.columns.slice(0,this.list_view_settings.total_fields||i),this.settings.hide_name_column||"name"===this.meta.title_field||this.columns.push({type:"Field",df:{label:__("Name"),fieldname:"name"}})}reorder_listview_fields(){var e=[],t=JSON.parse(this.list_view_settings.fields);for(var n in e.push(this.columns[0]),e.push(this.columns[1]),this.columns.splice(0,2),t)for(var i in this.columns){var r=t[n],a=this.columns[i];if("Status"==a.type&&"status_field"==r.fieldname){e.push(a);break}if("Field"==a.type&&r.fieldname===a.df.fieldname){e.push(a);break}}return e}get_documentation_link(){return this.meta.documentation?'<a href="'+this.meta.documentation+'" target="blank" class="meta-description small text-muted">Need Help?</a>':""}get_no_result_message(){var e=this.get_documentation_link(),t=this.filter_area&&this.filter_area.get(),n=t&&t.length?__("No {0} found",[__(this.doctype)]):__("You haven't created a {0} yet",[__(this.doctype)]),i=t&&t.length?__("Create a new {0}",[__(this.doctype)]):__("Create your first {0}",[__(this.doctype)]);return'<div class="msg-box no-border">\n\t\t\t<div>\n\t\t\t\t<img src="'+(this.settings.empty_state_image||"/assets/frappe/images/ui-states/list-empty-state.svg")+'" alt="Generic Empty State" class="null-state">\n\t\t\t</div>\n\t\t\t<p>'+n+"</p>\n\t\t\t"+(this.can_create?'<p><button class="btn btn-primary btn-sm btn-new-doc hidden-xs">\n\t\t\t\t'+i+'\n\t\t\t</button> <button class="btn btn-primary btn-new-doc visible-xs">'+__("Create New")+"</button></p>":"")+"\n\t\t\t"+e+"\n\t\t</div>"}freeze(){this.list_view_settings&&!this.list_view_settings.disable_count&&this.$result.find(".list-count").html("<span>"+__("Refreshing")+"...</span>")}get_args(){var e=super.get_args();return Object.assign(e,{with_comment_count:!0})}before_refresh(){var e=this;return frappe.route_options&&this.filter_area&&(this.filters=this.parse_filters_from_route_options(),frappe.route_options=null,this.filters.length>0)?this.filter_area.clear(!1).then((function(){return e.filter_area.set(e.filters)})):Promise.resolve()}parse_filters_from_settings(){var e=this;return(this.settings.filters||[]).map((function(t){return 3===t.length&&(t=[e.doctype,t[0],t[1],t[2]]),t}))}toggle_result_area(){super.toggle_result_area(),this.toggle_actions_menu_button(this.$result.find(".list-row-check:checked").length>0)}toggle_actions_menu_button(e){e?(this.page.show_actions_menu(),this.page.clear_primary_action(),this.toggle_workflow_actions()):(this.page.hide_actions_menu(),this.set_primary_action())}render_header(e){void 0===e&&(e=!1),e&&this.$result.find(".list-row-head").remove(),0===this.$result.find(".list-row-head").length&&this.$result.prepend(this.get_header_html())}render_skeleton(){var e=this.get_list_row_html_skeleton('<div><input type="checkbox" /></div>');this.$result.append(e)}before_render(){this.settings.before_render&&this.settings.before_render(),frappe.model.user_settings.save(this.doctype,"last_view",this.view_name),this.save_view_user_settings({filters:this.filter_area&&this.filter_area.get(),sort_by:this.sort_selector&&this.sort_selector.sort_by,sort_order:this.sort_selector&&this.sort_selector.sort_order}),this.toggle_paging&&this.$paging_area.toggle(!1)}after_render(){this.$no_result.html('\n\t\t\t<div class="no-result text-muted flex justify-center align-center">\n\t\t\t\t'+this.get_no_result_message()+"\n\t\t\t</div>\n\t\t"),this.setup_new_doc_event(),this.list_sidebar&&this.list_sidebar.reload_stats(),this.toggle_paging&&this.$paging_area.toggle(!0)}render(){this.render_list(),this.on_row_checked(),this.render_count()}render_list(){var e=this;this.$result.find(".list-row-container").remove(),this.data.length>0&&this.$result.append(this.data.map((function(t,n){return t._idx=n,e.get_list_row_html(t)})).join(""))}render_count(){var e=this;this.list_view_settings.disable_count||this.get_count_str().then((function(t){e.$result.find(".list-count").html("<span>"+t+"</span>")}))}get_header_html(){if(this.columns){var e=this.columns[0].df,t='\n\t\t\t<input class="level-item list-check-all hidden-xs" type="checkbox" title="'+__("Select All")+'">\n\t\t\t<span class="level-item list-liked-by-me">\n\t\t\t\t<span title="'+__("Likes")+'">'+frappe.utils.icon("heart","sm","like-icon")+'</span>\n\t\t\t</span>\n\t\t\t<span class="level-item">'+__(e.label)+"</span>\n\t\t",n=this.columns.map((function(e){return'\n\t\t\t\t<div class="'+["list-row-col ellipsis","Subject"==e.type?"list-subject level":"hidden-xs","Tag"==e.type?"tag-col hide":"",frappe.model.is_numeric_field(e.df)?"text-right":""].join(" ")+'">\n\t\t\t\t\t'+("Subject"===e.type?t:"\n\t\t\t\t\t<span>"+__(e.df&&e.df.label||e.type)+"</span>")+"\n\t\t\t\t</div>\n\t\t\t"})).join("");return this.get_header_html_skeleton(n,'<span class="list-count"></span>')}}get_header_html_skeleton(e,t){return void 0===e&&(e=""),void 0===t&&(t=""),'\n\t\t\t<header class="level list-row list-row-head text-muted">\n\t\t\t\t<div class="level-left list-header-subject">\n\t\t\t\t\t'+e+'\n\t\t\t\t</div>\n\t\t\t\t<div class="level-left checkbox-actions">\n\t\t\t\t\t<div class="level list-subject">\n\t\t\t\t\t\t<input class="level-item list-check-all hidden-xs" type="checkbox" title="'+__("Select All")+'">\n\t\t\t\t\t\t<span class="level-item list-header-meta"></span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="level-right">\n\t\t\t\t\t'+t+"\n\t\t\t\t</div>\n\t\t\t</header>\n\t\t"}get_left_html(e){var t=this;return this.columns.map((function(n){return t.get_column_html(n,e)})).join("")}get_right_html(e){return this.get_meta_html(e)}get_list_row_html(e){return this.get_list_row_html_skeleton(this.get_left_html(e),this.get_right_html(e))}get_list_row_html_skeleton(e,t){return void 0===e&&(e=""),void 0===t&&(t=""),'\n\t\t\t<div class="list-row-container" tabindex="1">\n\t\t\t\t<div class="level list-row">\n\t\t\t\t\t<div class="level-left ellipsis">\n\t\t\t\t\t\t'+e+'\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="level-right text-muted ellipsis">\n\t\t\t\t\t\t'+t+"\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"}get_column_html(e,t){if("Status"===e.type)return'\n\t\t\t\t<div class="list-row-col hidden-xs ellipsis">\n\t\t\t\t\t'+this.get_indicator_html(t)+"\n\t\t\t\t</div>\n\t\t\t";if("Tag"===e.type)return'\n\t\t\t\t<div class="list-row-col tag-col '+(this.tags_shown?"":"hide")+' hidden-xs ellipsis">\n\t\t\t\t\t'+(t._user_tags?this.get_tags_html(t._user_tags,2):'<div class="tags-empty">-</div>')+"\n\t\t\t\t</div>\n\t\t\t";var n,i,r=e.df||{},a=r.label,s=r.fieldname,o=t[s]||"",l=["list-row-col ellipsis",{Subject:"list-subject level",Field:"hidden-xs"}[e.type],frappe.model.is_numeric_field(r)?"text-right":""].join(" "),d={Subject:this.get_subject_html(t),Field:(i="Text Editor"==r.fieldtype||r.fetch_from&&["Text","Small Text"].includes(r.fieldtype)?strip_html(o):"string"==typeof o?frappe.utils.escape_html(o):o,n="Image"===r.fieldtype?r.options?'<img src="'+t[r.options]+'" style="max-height: 30px; max-width: 100%;">':'<div class="missing-image small">\n\t\t\t\t\t\t'+frappe.utils.icon("restriction")+"\n\t\t\t\t\t</div>":"Select"===r.fieldtype?'<span class="filterable indicator-pill '+frappe.utils.guess_colour(i)+' ellipsis"\n\t\t\t\t\tdata-filter="'+s+",=,"+o+'">\n\t\t\t\t\t<span class="ellipsis"> '+__(i)+" </span>\n\t\t\t\t</span>":"Link"===r.fieldtype?'<a class="filterable ellipsis"\n\t\t\t\t\tdata-filter="'+s+",=,"+o+'">\n\t\t\t\t\t'+i+"\n\t\t\t\t</a>":["Text Editor","Text","Small Text","HTML Editor","Markdown Editor"].includes(r.fieldtype)?'<span class="ellipsis">\n\t\t\t\t\t'+i+"\n\t\t\t\t</span>":'<a class="filterable ellipsis"\n\t\t\t\t\tdata-filter="'+s+",=,"+frappe.utils.escape_html(o)+'">\n\t\t\t\t\t'+("Code"===r.fieldtype?o:"Percent"===r.fieldtype?'<div class="progress" style="margin: 0px;">\n\t\t\t\t\t\t<div class="progress-bar bg-success" role="progressbar"\n\t\t\t\t\t\t\taria-valuenow="'+o+'"\n\t\t\t\t\t\t\taria-valuemin="0" aria-valuemax="100" style="width: '+Math.round(o)+'%;">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>':frappe.format(o,r,null,t))+"\n\t\t\t\t</a>",'<span class="ellipsis"\n\t\t\t\ttitle="'+__(a)+": "+frappe.utils.escape_html(i)+'">\n\t\t\t\t'+n+"\n\t\t\t</span>")}[e.type];return this.settings.formatters&&this.settings.formatters[s]&&(d=this.settings.formatters[s](o,r,t)),'\n\t\t\t<div class="'+l+'">\n\t\t\t\t'+d+"\n\t\t\t</div>\n\t\t"}get_tags_html(e,t,n){void 0===n&&(n=!1);return e.split(",").slice(1,t+1).map((function(e){var t="",i="";if(e)return n&&(i="background-color: var("+(t=frappe.get_palette(e))[0]+"); color: var("+t[1]+")"),'<div class="tag-pill ellipsis" title="'+e+'" style="'+i+'">'+e+"</div>"})).join("")}get_meta_html(e){var t="",n=null;this.settings.button&&this.settings.button.show(e)&&(n='\n\t\t\t\t<span class="list-actions">\n\t\t\t\t\t<button class="btn btn-action btn-default btn-xs"\n\t\t\t\t\t\tdata-name="'+e.name+'" data-idx="'+e._idx+'"\n\t\t\t\t\t\ttitle="'+this.settings.button.get_description(e)+'">\n\t\t\t\t\t\t'+this.settings.button.get_label(e)+"\n\t\t\t\t\t</button>\n\t\t\t\t</span>\n\t\t\t");var i=comment_when(e.modified,!0),r='<div class="list-assignments">\n\t\t\t<span class="avatar avatar-small">\n\t\t\t<span class="avatar-empty"></span>\n\t\t</div>',a=JSON.parse(e._assign||"[]");return a.length&&(r='<div class="list-assignments">\n\t\t\t\t\t'+frappe.avatar_group(a,3,{filterable:!0})[0].outerHTML+"\n\t\t\t\t</div>"),t+='\n\t\t\t<div class="level-item list-row-activity hidden-xs">\n\t\t\t\t<div class="hidden-md hidden-xs">\n\t\t\t\t\t'+(n||r)+"\n\t\t\t\t</div>\n\t\t\t\t"+i+"\n\t\t\t\t"+('<span class="'+(e._comment_count?"":"text-extra-muted")+' comment-count">\n\t\t\t\t'+frappe.utils.icon("small-message")+"\n\t\t\t\t"+(e._comment_count>99?"99+":e._comment_count)+"\n\t\t\t</span>")+'\n\t\t\t</div>\n\t\t\t<div class="level-item visible-xs text-right">\n\t\t\t\t'+this.get_indicator_dot(e)+"\n\t\t\t</div>\n\t\t"}get_count_str(){var e=this,t=this.data.length,n=this.data.uniqBy((function(e){return e.name})).length;return frappe.db.count(this.doctype,{filters:this.get_filters_for_args()}).then((function(i){e.total_count=i||t;var r=__("{0} of {1}",[t,e.total_count]);return n!==t&&(r=__("{0} of {1} ({2} rows with children)",[n,e.total_count,t])),r}))}get_form_link(e){if(this.settings.get_form_link)return this.settings.get_form_link(e);var t=e.name.match(/[%'"\s]/)?encodeURIComponent(e.name):e.name;return"/app/"+frappe.router.slug(frappe.router.doctype_layout||this.doctype)+"/"+t}get_seen_class(e){return JSON.parse(e._seen||"[]").includes(frappe.session.user)?"":"bold"}get_like_html(e){var t=JSON.parse(e._liked_by||"[]");return'<span\n\t\t\tclass="like-action '+(t.includes(frappe.session.user)?"liked-by liked":"not-liked")+'"\n\t\t\tdata-name="'+e.name+'" data-doctype="'+this.doctype+'"\n\t\t\tdata-liked-by="'+(encodeURI(e._liked_by)||"[]")+'"\n\t\t\ttitle="'+t.map((function(e){return frappe.user_info(e).fullname})).join(", ")+'">\n\t\t\t'+frappe.utils.icon("heart","sm","like-icon")+'\n\t\t</span>\n\t\t<span class="likes-count">\n\t\t\t'+(t.length>99?__("99")+"+":__(t.length||""))+"\n\t\t</span>"}get_subject_html(e){var t=this.columns[0].df,n=e[t.fieldname];this.settings.formatters&&this.settings.formatters[t.fieldname]&&(n=(0,this.settings.formatters[t.fieldname])(n,t,e));n||(n=e.name);var i=strip_html(n.toString()),r=frappe.utils.escape_html(i),a=this.get_seen_class(e);return'\n\t\t\t<input class="level-item list-row-checkbox hidden-xs" type="checkbox" data-name="'+escape(e.name)+'">\n\t\t\t<span class="level-item" style="margin-bottom: 1px;">\n\t\t\t\t'+this.get_like_html(e)+'\n\t\t\t</span>\n\t\t\t<span class="level-item '+a+' ellipsis" title="'+r+'">\n\t\t\t\t<a class="ellipsis" href="'+this.get_form_link(e)+'" title="'+r+'" data-doctype="'+this.doctype+'" data-name="'+e.name+'">\n\t\t\t\t'+i+"\n\t\t\t\t</a>\n\t\t\t</span>\n\t\t"}get_indicator_html(e){var t=frappe.get_indicator(e,this.doctype);return t?'<span class="indicator-pill '+t[1]+" filterable ellipsis\"\n\t\t\t\tdata-filter='"+t[2]+'\'>\n\t\t\t\t<span class="ellipsis"> '+__(t[0])+"</span>\n\t\t\t<span>":""}get_indicator_dot(e){var t=frappe.get_indicator(e,this.doctype);return t?"<span class='indicator "+t[1]+"' title='"+__(t[0])+"'></span>":""}get_image_url(e){var t=e.image?e.image:e[this.meta.image_field];return window.cordova&&!frappe.utils.is_url(t)&&(t=frappe.base_url+t),t||null}setup_events(){this.setup_filterable(),this.setup_list_click(),this.setup_tag_event(),this.setup_new_doc_event(),this.setup_check_events(),this.setup_like(),this.setup_realtime_updates(),this.setup_action_handler(),this.setup_keyboard_navigation()}setup_keyboard_navigation(){var e=this,t=function(){$(document.activeElement).next().focus()},n=function(){$(document.activeElement).prev().focus()},i=function(e){e.find("input[type=checkbox]").click()},r=function(){return $(document.activeElement).is(".list-row-container")?$(document.activeElement):null},a=function(){return e.page.wrapper.is(":visible")},s=function(){return $(document.activeElement).is("input")},o=function(i){if(!a()||s())return!1;r()?"down"===i?t():n():e.$result.find(".list-row-container:first").focus()};frappe.ui.keys.add_shortcut({shortcut:"down",action:function(){return o("down")},description:__("Navigate list down"),page:this.page}),frappe.ui.keys.add_shortcut({shortcut:"up",action:function(){return o("up")},description:__("Navigate list up"),page:this.page}),frappe.ui.keys.add_shortcut({shortcut:"shift+down",action:function(){if(!a()||s())return!1;var e=r();i(e),t()},description:__("Select multiple list items"),page:this.page}),frappe.ui.keys.add_shortcut({shortcut:"shift+up",action:function(){if(!a()||s())return!1;var e=r();i(e),n()},description:__("Select multiple list items"),page:this.page}),frappe.ui.keys.add_shortcut({shortcut:"enter",action:function(){var e=r();return!!e&&(e.find("a[data-name]")[0].click(),!0)},description:__("Open list item"),page:this.page}),frappe.ui.keys.add_shortcut({shortcut:"space",action:function(){var e=r();return!!e&&(i(e),!0)},description:__("Select list item"),page:this.page})}setup_filterable(){var e=this;this.$result.on("click",".filterable",(function(t){if(!t.metaKey&&!t.ctrlKey){t.stopPropagation();var n=$(t.currentTarget).attr("data-filter").split("|").map((function(t){return"Today"===(t=t.split(","))[2]?t[2]=frappe.datetime.get_today():"User"==t[2]&&(t[2]=frappe.session.user),e.filter_area.remove(t[0]),[e.doctype,t[0],t[1],t.slice(2).join(",")]}));e.filter_area.add(n)}}))}setup_list_click(){var e=this;this.$result.on("click",".list-row, .image-view-header, .file-header",(function(t){var n=$(t.target);if(t.ctrlKey||t.metaKey&&!n.is("a")){var i=$(t.currentTarget).find(".list-row-checkbox");return i.prop("checked",!i.prop("checked")),t.preventDefault(),void e.on_row_checked()}if(n.hasClass("filterable")||n.hasClass("icon-heart")||n.is(":checkbox"))t.stopPropagation();else if(!n.is("a")){var r=$(t.currentTarget).find(".list-subject a").get(0);return r?(frappe.set_route(r.pathname),!1):void 0}}))}setup_action_handler(){var e=this;this.$result.on("click",".btn-action",(function(t){var n=$(t.currentTarget),i=e.data[n.attr("data-idx")];return e.settings.button.action(i),t.stopPropagation(),!1}))}setup_check_events(){var e=this;this.$result.on("change","input[type=checkbox]",(function(t){var n=$(t.currentTarget);if(n.is(".list-header-subject .list-check-all")){var i=e.$result.find(".checkbox-actions .list-check-all");i.prop("checked",n.prop("checked")),i.trigger("change")}else if(n.is(".checkbox-actions .list-check-all")){e.$result.find(".list-header-subject .list-check-all").prop("checked",n.prop("checked")),e.$result.find(".list-row-checkbox").prop("checked",n.prop("checked"))}else n.attr("data-parent")&&e.$result.find("."+n.attr("data-parent")).find(".list-row-checkbox").prop("checked",n.prop("checked"));e.on_row_checked()})),this.$result.on("click",".list-row-checkbox",(function(t){var n,i=$(t.currentTarget);if(t.shiftKey&&e.$checkbox_cursor&&!i.is(e.$checkbox_cursor)){var r=e.$checkbox_cursor.data().name,a=i.data().name,s=[e.data.findIndex((function(e){return e.name===r})),e.data.findIndex((function(e){return e.name===a}))],o=s[0],l=s[1];o>l&&(o=(n=[l,o])[0],l=n[1]);var d=e.data.slice(o+1,l).map((function(e){return e.name})).map((function(e){return'.list-row-checkbox[data-name="'+e+'"]'})).join(",");e.$result.find(d).prop("checked",!0)}e.$checkbox_cursor=i}))}setup_like(){var e=this;this.$result.on("click",".like-action",frappe.ui.click_toggle_like),this.$result.on("click",".list-liked-by-me",(function(t){var n=$(t.currentTarget);n.toggleClass("active"),n.hasClass("active")?e.filter_area.add(e.doctype,"_liked_by","like","%"+frappe.session.user+"%"):e.filter_area.remove("_liked_by")}))}setup_new_doc_event(){var e=this;this.$no_result.find(".btn-new-doc").click((function(){e.settings.primary_action?e.settings.primary_action():e.make_new_doc()}))}setup_tag_event(){var e=this;this.tags_shown=!1,this.list_sidebar&&this.list_sidebar.parent.on("click",".list-tag-preview",(function(){e.tags_shown=!e.tags_shown,e.toggle_tags()}))}setup_realtime_updates(){var e=this;this.list_view_settings&&this.list_view_settings.disable_auto_refresh||frappe.realtime.on("list_update",(function(t){if(!e.filter_area.is_being_edited()){var n=t.doctype,i=t.name;if(n===e.doctype){var r=e.get_call_args();r.args.filters.push([e.doctype,"name","=",i]),r.args.start=0,frappe.call(r).then((function(t){var n=t.message;if(n){var r=frappe.utils.dict(n.keys,n.values);if(!r||!r.length)return e.data=e.data.filter((function(e){return e.name!==i})),void e.render_list();var a=r[0],s=e.data.findIndex((function(e){return e.name===a.name}));-1===s?e.data.push(a):e.data[s]=a,e.data.sort((function(t,n){var i=t[e.sort_by]||"",r=n[e.sort_by]||"",a=0;return i>r&&(a=1),r>i&&(a=-1),"desc"===e.sort_order&&(a=-a),a})),e.toggle_result_area(),e.render_list(),e.$checks&&e.$checks.length&&e.set_rows_as_checked()}}))}}}))}set_rows_as_checked(){var e=this;$.each(this.$checks,(function(t,n){var i=$(n).attr("data-name");e.$result.find(".list-row-checkbox[data-name='"+i+"']").prop("checked",!0)})),this.on_row_checked()}on_row_checked(){this.$list_head_subject=this.$list_head_subject||this.$result.find("header .list-header-subject"),this.$checkbox_actions=this.$checkbox_actions||this.$result.find("header .checkbox-actions"),this.$checks=this.$result.find(".list-row-checkbox:checked"),this.$list_head_subject.toggle(0===this.$checks.length),this.$checkbox_actions.toggle(this.$checks.length>0),0===this.$checks.length?this.$list_head_subject.find(".list-check-all").prop("checked",!1):(this.$checkbox_actions.find(".list-header-meta").html(__("{0} items selected",[this.$checks.length])),this.$checkbox_actions.show(),this.$list_head_subject.hide()),this.toggle_actions_menu_button(this.$checks.length>0)}toggle_tags(){this.$result.find(".tag-col").toggleClass("hide");var e=this.tags_shown?__("Hide Tags"):__("Show Tags");this.list_sidebar.parent.find(".list-tag-preview").text(e)}get_checked_items(e){var t=Array.from(this.$checks||[]).map((function(e){return cstr(unescape($(e).data().name))}));return e?t:this.data.filter((function(e){return t.includes(e.name)}))}save_view_user_settings(e){return frappe.model.user_settings.save(this.doctype,this.view_name,e)}on_update(){}get_share_url(){var e=this.get_filters_for_args().map((function(e){return e[3]=encodeURIComponent(e[3]),"="===e[2]?e[1]+"="+e[3]:[e[1],"=",JSON.stringify([e[2],e[3]])].join("")})).join("&"),t=window.location.href;return e&&(t+="?"+e),t}share_url(){new frappe.ui.Dialog({title:__("Share URL"),fields:[{fieldtype:"Code",fieldname:"url",label:__("URL"),default:this.get_share_url(),read_only:1}]}).show()}get_menu_items(){var e=this,t=this.doctype,n=[];return frappe.model.can_import(t)&&n.push({label:__("Import"),action:function(){return frappe.set_route("list","data-import",{reference_doctype:t})},standard:!0}),frappe.model.can_set_user_permissions(t)&&n.push({label:__("User Permissions"),action:function(){return frappe.set_route("list","user-permission",{allow:t})},standard:!0}),frappe.user_roles.includes("System Manager")&&(n.push({label:__("Role Permissions Manager"),action:function(){return frappe.set_route("permission-manager",{doctype:t})},standard:!0}),n.push({label:__("Customize"),action:function(){e.meta&&(e.meta.custom?frappe.set_route("form","doctype",t):e.meta.custom||frappe.set_route("form","customize-form",{doc_type:t}))},standard:!0,shortcut:"Ctrl+J"})),n.push({label:__("Toggle Sidebar"),action:function(){return e.toggle_side_bar()},condition:function(){return!e.hide_sidebar},standard:!0,shortcut:"Ctrl+K"}),n.push({label:__("Share URL"),action:function(){return e.share_url()},standard:!0,shortcut:"Ctrl+L"}),frappe.user.has_role("System Manager")&&1===frappe.boot.developer_mode&&n.push({label:__("Edit DocType"),action:function(){return frappe.set_route("form","doctype",t)},standard:!0}),frappe.user.has_role("System Manager")&&n.push({label:__("List Settings"),action:function(){return e.show_list_settings()},standard:!0}),n}show_list_settings(){var e=this;frappe.model.with_doctype(this.doctype,(function(){new ListSettings({listview:e,doctype:e.doctype,settings:e.list_view_settings,meta:frappe.get_meta(e.doctype)})}))}get_workflow_action_menu_items(){var e=this,t=[];frappe.model.has_workflow(this.doctype)&&frappe.workflow.get_all_transition_actions(this.doctype).forEach((function(n){t.push({label:__(n),name:n,action:function(){frappe.xcall("frappe.model.workflow.bulk_workflow_approval",{docnames:e.get_checked_items(!0),doctype:e.doctype,action:n})},is_workflow_action:!0})}));return t}toggle_workflow_actions(){var e=this;if(frappe.model.has_workflow(this.doctype)){var t=this.get_checked_items();frappe.xcall("frappe.model.workflow.get_common_transition_actions",{docs:t,doctype:this.doctype}).then((function(t){Object.keys(e.workflow_action_items).forEach((function(n){e.workflow_action_items[n].toggle(t.includes(n))}))}))}}get_actions_menu_items(){var e=this,t=this.doctype,n=[],i=new BulkOperations({doctype:this.doctype}),r=function(e){return e.fieldname&&frappe.model.is_value_type(e)&&"Read Only"!==e.fieldtype&&!e.hidden&&!e.read_only};return function(e){return frappe.meta.get_docfields(e).some((function(e){return r(e)}))}(t)&&n.push({label:__("Edit"),action:function(){var n={};frappe.meta.get_docfields(t).forEach((function(e){r(e)&&(n[e.label]=Object.assign({},e))}));var a=e.get_checked_items(!0);i.edit(a,n,e.refresh)},standard:!0}),n.push({label:__("Assign To"),action:function(){return i.assign(e.get_checked_items(!0),e.refresh)},standard:!0}),n.push({label:__("Apply Assignment Rule"),action:function(){return i.apply_assignment_rule(e.get_checked_items(!0),e.refresh)},standard:!0}),n.push({label:__("Add Tags"),action:function(){return i.add_tags(e.get_checked_items(!0),e.refresh)},standard:!0}),frappe.model.can_print(t)&&n.push({label:__("Print"),action:function(){return i.print(e.get_checked_items())},standard:!0}),frappe.model.is_submittable(t)&&function(e){return frappe.perm.has_perm(e,0,"submit")}(t)&&!frappe.model.has_workflow(t)&&n.push({label:__("Submit"),action:function(){var t=e.get_checked_items(!0);t.length>0&&frappe.confirm(__("Submit {0} documents?",[t.length]),(function(){return i.submit_or_cancel(t,"submit",e.refresh)}))},standard:!0}),frappe.model.can_cancel(t)&&!frappe.model.has_workflow(t)&&n.push({label:__("Cancel"),action:function(){var t=e.get_checked_items(!0);t.length>0&&frappe.confirm(__("Cancel {0} documents?",[t.length]),(function(){return i.submit_or_cancel(t,"cancel",e.refresh)}))},standard:!0}),frappe.model.can_delete(t)&&n.push({label:__("Delete"),action:function(){var t=e.get_checked_items(!0).map((function(e){return e.toString()}));frappe.confirm(__("Delete {0} items permanently?",[t.length]),(function(){return i.delete(t,e.refresh)}))},standard:!0}),n}parse_filters_from_route_options(){var e=[];for(var t in frappe.route_options){var n=null,i=frappe.route_options[t],r=void 0;if($.isArray(i)&&i[0].startsWith("[")&&i[0].endsWith("]")){r=[];for(var a=0;a<i.length;a++)r.push(JSON.parse(i[a]))}else"string"==typeof i&&i.startsWith("[")&&i.endsWith("]")&&(i=JSON.parse(i));if(t.includes(".")&&(n=t.split(".")[0],t=t.split(".")[1]),n||(n=frappe.meta.get_doctype_for_field(this.doctype,t)),n)if(r)for(var s=0;s<r.length;s++)$.isArray(r[s])?e.push([n,t,r[s][0],r[s][1]]):e.push([n,t,"=",r[s]]);else $.isArray(i)?e.push([n,t,i[0],i[1]]):e.push([n,t,"=",i])}return e}static trigger_list_update(e){var t=e.doctype;if(t)if(frappe.provide("frappe.views.trees"),frappe.views.trees[t])frappe.views.trees[t].tree.refresh();else{var n=frappe.get_route_str(),i=frappe.views.list_view[n];i&&i.on_update(e)}}},$(document).on("save",(function(e,t){frappe.views.ListView.trigger_list_update(t)})),frappe.get_list_view=function(e){var t="List/"+e+"/List";return frappe.views.list_view[t]},frappe.provide("frappe.views.list_view"),window.cur_list=null,frappe.views.ListFactory=class extends frappe.views.Factory{make(e){var t=this,n=e[1];frappe.model.with_doctype(n,(function(){if(locals.DocType[n].issingle)frappe.set_re_route("Form",n);else{var i="File"!==n?frappe.utils.to_title_case(e[2]||"List"):"File",r=frappe.views[i+"View"];if(r||(r=frappe.views.ListView),r&&r.load_last_view&&r.load_last_view())return;frappe.provide("frappe.views.list_view."+n);var a=frappe.get_route_str();frappe.views.list_view[a]?frappe.container.change_to(a):frappe.views.list_view[a]=new r({doctype:n,parent:t.make_page(!0,a)}),t.set_cur_list()}}))}show(){this.re_route_to_view()||(this.set_module_breadcrumb(),super.show(),this.set_cur_list(),cur_list&&cur_list.show())}re_route_to_view(){var e=frappe.get_route(),t=e[1],n=frappe.route_history.slice(-2)[0];if("List"===e[0]&&2===e.length&&frappe.views.list_view[t])return!(!n||"List"!==n[0]||n[1]!==t)&&(window.history.go(-1),!0);var i="File"!==t?frappe.utils.to_title_case(e[2]||"List"):"File",r=frappe.views[i+"View"];r||(r=frappe.views.ListView),r&&r.load_last_view&&r.load_last_view()}set_module_breadcrumb(){if(frappe.route_history.length>1){var e=frappe.route_history[frappe.route_history.length-2];if("modules"===e[0]){var t=frappe.get_route()[1],n=e[1];frappe.module_links[n]&&frappe.module_links[n].includes(t)&&frappe.breadcrumbs.set_doctype_module(t,n)}}}set_cur_list(){var e=frappe.get_route(),t=frappe.get_route_str();cur_list=frappe.views.list_view[t],cur_list&&cur_list.doctype!==e[1]&&(window.cur_list=null)}},frappe.provide("frappe.views"),frappe.views.ListViewSelect=class{constructor(e){$.extend(this,e),this.set_current_view(),this.setup_views()}add_view_to_menu(e,t){this.page.add_custom_menu_item(this.parent,__(e),t,!0,null,this.icon_map[e]||"list").parent().attr("data-view",e)}set_current_view(){this.current_view="List";var e=frappe.get_route(),t=frappe.utils.to_title_case(e[2]||"");e.length>2&&frappe.views.view_modes.includes(t)&&(this.current_view=t,"Kanban"===this.current_view?this.kanban_board=e[3]:"Inbox"===this.current_view&&(this.email_account=e[3]))}set_route(e,t){var n=[this.slug(),"view",e];t&&n.push(t),frappe.set_route(n)}setup_views(){var e=this,t={List:{condition:!0,action:function(){return e.set_route("list")}},Report:{condition:!0,action:function(){return e.set_route("report")},current_view_handler:function(){var t=e.get_reports(),n={};frappe.get_route().length>3&&(n={label:__("Report Builder"),action:function(){return e.set_route("report")}}),e.setup_dropdown_in_sidebar("Report",t,n)}},Dashboard:{condition:!0,action:function(){return e.set_route("dashboard")}},Calendar:{condition:frappe.views.calendar[this.doctype],action:function(){return e.set_route("calendar")},current_view_handler:function(){e.get_calendars().then((function(t){e.setup_dropdown_in_sidebar("Calendar",t)}))}},Gantt:{condition:frappe.views.calendar[this.doctype],action:function(){return e.set_route("gantt")}},Inbox:{condition:"Communication"===this.doctype&&frappe.boot.email_accounts.length,action:function(){return e.set_route("inbox")},current_view_handler:function(){var t,n=e.get_email_accounts();has_common(frappe.user_roles,["System Manager","Administrator"])&&(t={label:__("New Email Account"),action:function(){return frappe.new_doc("Email Account")}}),e.setup_dropdown_in_sidebar("Inbox",n,t)}},Image:{condition:this.list_view.meta.image_field,action:function(){return e.set_route("image")}},Tree:{condition:frappe.treeview_settings[this.doctype]||frappe.get_meta(this.doctype).is_tree,action:function(){return e.set_route("tree")}},Kanban:{condition:!0,action:function(){return e.setup_kanban_boards()},current_view_handler:function(){frappe.views.KanbanView.get_kanbans(e.doctype).then((function(t){return e.setup_kanban_switcher(t)}))}},Map:{condition:this.list_view.meta.fields.filter((function(e){return"Geolocation"===e.fieldtype})).length,action:function(){return e.set_route("map")}}};frappe.views.view_modes.forEach((function(n){e.current_view!==n&&t[n].condition&&e.add_view_to_menu(n,t[n].action),e.current_view==n&&t[n].current_view_handler&&t[n].current_view_handler()}))}setup_dropdown_in_sidebar(e,t,n){if(this.sidebar){var i=this.sidebar.sidebar.find(".views-section");i.find(".sidebar-label").html(""+__(e));var r=i.find(".views-dropdown"),a=__("Select {0}",[__(e)]),s="";if(t&&t.length){var o=this.get_page_name();t.map((function(e){e.name.toLowerCase()==o.toLowerCase()?a=e.name:s+='<li><a class="dropdown-item" href="'+e.route+'">'+e.name+"</a></li>"}))}else s='<div class="empty-state">\n\t\t\t\t\t\t'+__("No {} Found",[__(e)])+"\n\t\t\t\t</div>";i.find(".selected-view").html(a),n&&(i.find(".sidebar-action a").html(n.label),i.find(".sidebar-action a").click((function(){return n.action()}))),r.html(s),i.removeClass("hide")}}setup_kanban_switcher(e){var t=this,n=this.page.add_custom_button_group(__("Select Kanban"),null,this.list_view.$filter_section);e.map((function(e){t.page.add_custom_menu_item(n,e.name,(function(){return t.set_route("kanban",e.name)}),!1)})),this.page.add_custom_menu_item(n,__("Create New Kanban Board"),(function(){return frappe.views.KanbanView.show_kanban_dialog(t.doctype)}),!0)}get_page_name(){return frappe.utils.to_title_case(frappe.get_route().slice(-1)[0]||"")}get_reports(){var e=this,t=[],n=[],i=function(i){i.map((function(i){if(!i.ref_doctype||i.ref_doctype==e.doctype){var r="Report Builder"===i.report_type?"/app/list/"+i.ref_doctype+"/report":"/app/query-report",a=i.route||r+"/"+(i.title||i.name);-1===t.indexOf(a)&&(t.push(a),n.push({name:i.title||i.name,route:a}))}}))};return this.list_view.settings.reports&&i(this.list_view.settings.reports),i(Object.values(frappe.boot.user.all_reports).sort((function(e,t){return e.title.localeCompare(t.title)}))||[]),n}setup_kanban_boards(){var e=frappe.model.user_settings[this.doctype].Kanban&&frappe.model.user_settings[this.doctype].Kanban.last_kanban_board;e?frappe.set_route("list",this.doctype,"kanban",e):frappe.views.KanbanView.show_kanban_dialog(this.doctype,!0)}get_calendars(){var e=this,t=this.doctype,n=[];return frappe.db.get_list("Calendar View",{filters:{reference_doctype:t}}).then((function(t){if(t&&Array.isArray(t)&&t.length)return frappe.views.calendar[e.doctype]&&n.push({name:"Default",route:"/app/"+e.slug()+"/view/calendar/default"}),t.map((function(t){n.push({name:t.name,route:"/app/"+e.slug()+"/view/calendar/"+t.name})})),n}))}get_email_accounts(){var e=[];return frappe.boot.email_accounts.forEach((function(t){var n="/app/communication/inbox/"+("All Accounts"==t.email_id?"All Accounts":t.email_account),i=["All Accounts","Sent Mail","Spam","Trash"].includes(t.email_id)?__(t.email_id):t.email_account;e.push({name:i,route:n})})),e}slug(){return frappe.router.slug(frappe.router.doctype_layout||this.doctype)}},frappe.provide("frappe.ui");class ListFilter{constructor(e){e.wrapper,e.doctype;Object.assign(this,arguments[0]),this.can_add_global=frappe.user.has_role(["System Manager","Administrator"]),this.filters=[],this.make(),this.bind(),this.refresh()}make(){this.wrapper.html('\n\t\t\t<li class="input-area"></li>\n\t\t\t<li class="sidebar-action">\n\t\t\t\t<a class="saved-filters-preview">'+__("Show Saved")+'</a>\n\t\t\t</li>\n\t\t\t<div class="saved-filters"></div>\n\t\t'),this.$input_area=this.wrapper.find(".input-area"),this.$list_filters=this.wrapper.find(".list-filters"),this.$saved_filters=this.wrapper.find(".saved-filters").hide(),this.saved_filters_hidden=!0,this.filter_input=frappe.ui.form.make_control({df:{fieldtype:"Data",placeholder:__("Filter Name"),input_class:"input-xs"},parent:this.$input_area,render_input:1}),this.is_global_input=frappe.ui.form.make_control({df:{fieldtype:"Check",label:__("Is Global")},parent:this.$input_area,render_input:1})}bind(){this.bind_save_filter(),this.bind_toggle_saved_filters(),this.bind_click_filter(),this.bind_remove_filter()}refresh(){var e=this;this.get_list_filters().then((function(){var t=e.filters.map((function(t){return e.filter_template(t)}));e.wrapper.find(".filter-pill").remove(),e.$saved_filters.append(t)})),this.is_global_input.toggle(!1),this.filter_input.set_description("")}filter_template(e){return'<div class="list-link filter-pill list-sidebar-button btn btn-default" data-name="'+e.name+'">\n\t\t\t<a class="ellipsis filter-name">'+e.filter_name+'</a>\n\t\t\t<a class="remove">'+frappe.utils.icon("close")+"</a>\n\t\t</div>"}bind_toggle_saved_filters(){var e=this;this.wrapper.find(".saved-filters-preview").click((function(){e.toggle_saved_filters(e.saved_filters_hidden)}))}toggle_saved_filters(e){this.$saved_filters.toggle(e);var t=e?__("Hide Saved"):__("Show Saved");this.wrapper.find(".saved-filters-preview").text(t),this.saved_filters_hidden=!this.saved_filters_hidden}bind_click_filter(){var e=this;this.wrapper.on("click",".filter-pill .filter-name",(function(t){var n=$(t.currentTarget).parent(".filter-pill");e.set_applied_filter(n);var i=n.attr("data-name");e.list_view.filter_area.clear().then((function(){e.list_view.filter_area.add(e.get_filters_values(i))}))}))}bind_remove_filter(){var e=this;this.wrapper.on("click",".filter-pill .remove",(function(t){var n=$(t.currentTarget).closest(".filter-pill"),i=n.attr("data-name"),r=e.get_filters_values(i);n.remove(),e.remove_filter(i).then((function(){return e.refresh()})),e.list_view.filter_area.remove_filters(r)}))}bind_save_filter(){var e=this;this.filter_input.$input.keydown(frappe.utils.debounce((function(t){var n=e.filter_input.get_value(),i=Boolean(n);if(t.which===frappe.ui.keyCode.ENTER){if(!i||e.filter_name_exists(n))return;e.filter_input.set_value(""),e.save_filter(n).then((function(){return e.refresh()})),e.toggle_saved_filters(!0)}else{var r=__("Press Enter to save");e.filter_name_exists(n)&&(r=__("Duplicate Filter Name")),e.filter_input.set_description(i?r:""),e.can_add_global&&e.is_global_input.toggle(i)}}),300))}save_filter(e){return frappe.db.insert({doctype:"List Filter",reference_doctype:this.list_view.doctype,filter_name:e,for_user:this.is_global_input.get_value()?"":frappe.session.user,filters:JSON.stringify(this.get_current_filters())})}remove_filter(e){if(e)return frappe.db.delete_doc("List Filter",e)}get_filters_values(e){var t=this.filters.find((function(t){return t.name===e}));return JSON.parse(t.filters||"[]")}get_current_filters(){return this.list_view.filter_area.get()}filter_name_exists(e){return(this.filters||[]).find((function(t){return t.filter_name===e}))}get_list_filters(){var e=this;return"Guest"===frappe.session.user?Promise.resolve():frappe.db.get_list("List Filter",{fields:["name","filter_name","for_user","filters"],filters:{reference_doctype:this.list_view.doctype},or_filters:[["for_user","=",frappe.session.user],["for_user","=",""]]}).then((function(t){e.filters=t||[]}))}set_applied_filter(e){this.$saved_filters.find(".btn-primary-light").toggleClass("btn-primary-light btn-default"),e.toggleClass("btn-default btn-primary-light")}}frappe.provide("frappe.views"),frappe.views.ListSidebar=class{constructor(e){$.extend(this,e),this.make()}make(){var e=this,t=frappe.render_template("list_sidebar",{doctype:this.doctype});this.sidebar=$('<div class="list-sidebar overlay-sidebar hidden-xs hidden-sm"></div>').html(t).appendTo(this.page.sidebar.empty()),this.setup_list_filter(),this.setup_list_group_by(),$(document).trigger("list_sidebar_setup"),this.list_view.list_view_settings&&this.list_view.list_view_settings.disable_sidebar_stats?this.sidebar.find(".sidebar-stat").remove():this.sidebar.find(".list-stats").on("click",(function(t){e.reload_stats()}))}setup_list_group_by(){this.list_group_by=new frappe.views.ListGroupBy({doctype:this.doctype,sidebar:this,list_view:this.list_view,page:this.page})}setup_list_filter(){this.list_filter=new ListFilter({wrapper:this.page.sidebar.find(".list-filters"),doctype:this.doctype,list_view:this.list_view})}get_stats(){var e=this;frappe.call({method:"frappe.desk.reportview.get_sidebar_stats",type:"GET",args:{stats:e.stats,doctype:e.doctype,filters:(e.list_view.filter_area?e.list_view.get_filters_for_args():e.default_filters)||[]},callback:function(t){e.render_stat((t.message.stats||{})._user_tags);var n=e.sidebar.find(".list-stats-dropdown");frappe.utils.setup_search(n,".stat-link",".stat-label")}})}render_stat(e){var t=this,n={stats:e,label:__("Tags")},i=$(frappe.render_template("list_sidebar_stat",n)).on("click",".stat-link",(function(e){var n=$(e.currentTarget).attr("data-field"),i=$(e.currentTarget).attr("data-label"),r="like",a=t.list_view.filter_area.filter_list.get_filter(n);a&&a.remove(),"No Tags"==i&&(i="%,%",r="not like"),t.list_view.filter_area.add(t.doctype,n,r,i)}));this.sidebar.find(".list-stats-dropdown .stat-result").html(i)}reload_stats(){this.sidebar.find(".stat-link").remove(),this.sidebar.find(".stat-no-records").remove(),this.get_stats()}},frappe.templates.list_sidebar='<ul class="list-unstyled sidebar-menu user-actions hide">  <li class="divider"></li> </ul> <ul class="list-unstyled sidebar-menu">  <div class="sidebar-section views-section hide">   <li class="sidebar-label">   </li>   <div class="current-view">    <li class="list-link">     <a class="btn btn-default btn-sm list-sidebar-button"      data-toggle="dropdown"      aria-haspopup="true"      aria-expanded="false"      href="#"     >      <span class="selected-view ellipsis">      </span>      <span>       <svg class="icon icon-xs">        <use xlink:href="#icon-select"></use>       </svg>      </span>     </a>     <ul class="dropdown-menu views-dropdown" role="menu">     </ul>    </li>    <li class="sidebar-action">     <a class="view-action"></a>    </li>   </div>  </div>   <div class="sidebar-section filter-section">   <li class="sidebar-label">    {{ __("Filter By") }}   </li>    <div class="list-group-by">   </div>    <div class="list-tags">    <li class="list-stats list-link">     <a      class="btn btn-default btn-sm list-sidebar-button"      data-toggle="dropdown"      aria-haspopup="true"      aria-expanded="false"      href="#"     >      <span>{{ __("Tags") }}</span>      <span>       <svg class="icon icon-xs">        <use xlink:href="#icon-select"></use>       </svg>      </span>     </a>     <ul class="dropdown-menu list-stats-dropdown" role="menu">      <div class="dropdown-search">       <input type="text" placeholder={{__("Search") }} data-element="search" class="form-control input-xs">      </div>      <div class="stat-result">      </div>     </ul>    </li>    <li class="sidebar-action show-tags">     <a class="list-tag-preview">{{ __("Show Tags") }}</a>    </li>   </div>  </div>   <div class="sidebar-section save-filter-section">   <li class="sidebar-label">    {{ __("Save Filter") }}   </li>   <li class="list-filters list-link"></li>  </div>  </ul>',frappe.templates.list_sidebar_stat='{% if (!stats.length) { %} <li class="stat-no-records text-muted">{{ __("No records tagged.") }}</li> {% } else {  for (var i=0, l=stats.length; i < l; i++) {   var stat_label = stats[i][0];   var stat_count = stats[i][1]; %} <li>  <a class="stat-link dropdown-item" data-label="{{ stat_label %}" data-field="_user_tags" href="#" onclick="return false;">   <span class="badge pull-right" style="position: relative">{{ stat_count }}</span>   <span class="stat-label">{{ __(stat_label) }}</span>   <span>{{ stat_count }}</span>  </a> </li>  {% } } %}',frappe.provide("frappe.views"),frappe.views.ListGroupBy=class{constructor(e){$.extend(this,e),this.make_wrapper(),this.user_settings=frappe.get_user_settings(this.doctype),this.group_by_fields=["assigned_to","owner"],this.user_settings.group_by_fields&&(this.group_by_fields=this.group_by_fields.concat(this.user_settings.group_by_fields)),this.render_group_by_items(),this.make_group_by_fields_modal(),this.setup_dropdown(),this.setup_filter_by()}make_group_by_fields_modal(){var e=this,t=new frappe.ui.Dialog({title:__("Select Filters"),fields:this.get_group_by_dropdown_fields()});t.set_primary_action(__("Save"),(function(n){var i=n.group_by_fields;frappe.model.user_settings.save(e.doctype,"group_by_fields",i||null),e.group_by_fields=i?["assigned_to","owner"].concat(i):["assigned_to","owner"],e.render_group_by_items(),e.setup_dropdown(),t.hide()})),t.$body.prepend('\n\t\t\t<div class="filters-search">\n\t\t\t\t<input type="text"\n\t\t\t\t\tplaceholder="'+__("Search")+'"\n\t\t\t\t\tdata-element="search" class="form-control input-xs">\n\t\t\t</div>\n\t\t'),this.page.sidebar.find(".add-list-group-by a").on("click",(function(){frappe.utils.setup_search(t.$body,".unit-checkbox",".label-area"),t.show()}))}make_wrapper(){this.$wrapper=this.sidebar.sidebar.find(".list-group-by");var e='\n\t\t\t<div class="list-group-by-fields">\n\t\t\t</div>\n\t\t\t<li class="add-list-group-by sidebar-action">\n\t\t\t\t<a class="add-group-by">\n\t\t\t\t\t'+__("Edit Filters")+"\n\t\t\t\t</a>\n\t\t\t</li>\n\t\t";this.$wrapper.html(e)}render_group_by_items(){var e=this,t=this.group_by_fields.map((function(t){var n,i;if("assigned_to"===t)n=__("Assigned To");else if("owner"===t)n=__("Created By");else{n=frappe.meta.get_label(e.doctype,t);var r=frappe.meta.get_docfield(e.doctype,t);if(!r)return;i=r.fieldtype}return'<li class="group-by-field list-link">\n\t\t\t\t\t<a class="btn btn-default btn-sm list-sidebar-button" data-toggle="dropdown"\n\t\t\t\t\taria-haspopup="true" aria-expanded="false"\n\t\t\t\t\tdata-label="'+n+'" data-fieldname="'+t+'" data-fieldtype="'+i+'"\n\t\t\t\t\thref="#" onclick="return false;">\n\t\t\t\t\t\t<span class="ellipsis">'+__(n)+"</span>\n\t\t\t\t\t\t<span>"+frappe.utils.icon("select","xs")+'</span>\n\t\t\t\t\t</a>\n\t\t\t\t\t<ul class="dropdown-menu group-by-dropdown" role="menu">\n\t\t\t\t\t</ul>\n\t\t\t</li>'})).join("");this.$wrapper.find(".list-group-by-fields").html(t)}setup_dropdown(){var e=this;this.$wrapper.find(".group-by-field").on("show.bs.dropdown",(function(t){var n=$(t.currentTarget).find(".group-by-dropdown");e.set_loading_state(n);var i=$(t.currentTarget).find("a").attr("data-fieldname"),r=$(t.currentTarget).find("a").attr("data-fieldtype");e.get_group_by_count(i).then((function(t){if(t.length){var a=e.list_view.get_filter_value("assigned_to"==i?"_assign":i);e.render_dropdown_items(t,r,n,a),e.setup_search(n)}else e.set_empty_state(n)}))}))}set_loading_state(e){e.html('<li>\n\t\t\t<div class="empty-state group-by-loading">\n\t\t\t\t'+__("Loading...")+"\n\t\t\t</div>\n\t\t</li>")}set_empty_state(e){e.html('<div class="empty-state group-by-empty">\n\t\t\t\t'+__("No filters found")+"\n\t\t\t</div>")}setup_search(e){frappe.utils.setup_search(e,".group-by-item",".group-by-value","data-name")}get_group_by_dropdown_fields(){var e=this,t=[],n=this.list_view.meta.fields.filter((function(e){return["Select","Link","Data","Int","Check"].includes(e.fieldtype)}));return t.push({label:__(this.doctype),fieldname:"group_by_fields",fieldtype:"MultiCheck",columns:2,options:n.map((function(t){return{label:__(t.label),value:t.fieldname,checked:e.group_by_fields.includes(t.fieldname)}}))}),t}get_group_by_count(e){var t=this.list_view.get_filters_for_args();t=t.filter((function(t){return!t.includes("assigned_to"===e?"_assign":e)}));var n={doctype:this.doctype,current_filters:t,field:e};return frappe.call("frappe.desk.listview.get_group_by_count",n).then((function(e){var t=e.message||[],n=(t=t.filter((function(e){return 0!==e.count}))).find((function(e){return e.name===frappe.session.user}));return t=t.filter((function(e){return!["Guest","Administrator",frappe.session.user].includes(e.name)})),n&&t.unshift(n),t}))}render_dropdown_items(e,t,n,i){var r=this,a='\n\t\t\t<div class="dropdown-search">\n\t\t\t\t<input type="text"\n\t\t\t\t\tplaceholder="'+__("Search")+'"\n\t\t\t\t\tdata-element="search"\n\t\t\t\t\tclass="dropdown-search-input form-control input-xs"\n\t\t\t\t>\n\t\t\t</div>\n\t\t',s="",o="";e.map((function(e){e.name===i?s=r.get_dropdown_html(e,t,!0):o+=r.get_dropdown_html(e,t)}));var l=a+s+o;n.toggleClass("has-selected",Boolean(s)),n.html(l)}get_dropdown_html(e,t,n){void 0===n&&(n=!1);var i=null==e.name?__("Not Set"):e.name;return i===frappe.session.user?i=__("Me"):t&&"Check"==t&&(i="0"==i?__("No"):__("Yes")),'<li class="group-by-item '+(n?"selected":"")+'" data-value="'+(null==e.name?"":encodeURIComponent(e.name))+'">\n\t\t\t<a class="dropdown-item" href="#" onclick="return false;">\n\t\t\t\t'+(n?'<span class="applied"> '+frappe.utils.icon("tick","xs")+" </span>":"")+'\n\t\t\t\t<span class="group-by-value ellipsis" data-name="'+e.name+'">'+i+'</span>\n\t\t\t\t<span class="group-by-count">'+e.count+"</span>\n\t\t\t</a>\n\t\t</li>"}setup_filter_by(){var e=this;this.$wrapper.on("click",".group-by-item",(function(t){var n=$(t.currentTarget),i=n.hasClass("selected"),r=n.parents(".group-by-field").find("a").data("fieldname"),a="string"==typeof n.data("value")?decodeURIComponent(n.data("value").trim()):n.data("value");return r="assigned_to"===r?"_assign":r,e.list_view.filter_area.remove(r).then((function(){if(!i)return e.apply_filter(r,a)}))}))}apply_filter(e,t){var n="=";return""===t&&(n="is",t="not set"),"_assign"===e&&(n="like",t="%"+t+"%"),this.list_view.filter_area.add(this.doctype,e,n,t)}},frappe.templates.list_view_permission_restrictions='<table class="table table-bordered" style="margin: 0;">  <thead>   <th>{{ __("Field") }}</th>   <th>{{ __("Value") }}</th>  </thead>  <tbody>   {% for (let condition of condition_list ) { %}    {% for (let key in condition) { %}    <tr>     <td>{{ __(key) }}</td>     <td>{{ frappe.utils.comma_or(condition[key]) }}</td>    </tr>    {% } %}   {% } %}  </tbody> </table> ',frappe.provide("frappe.views"),frappe.views.GanttView=class extends frappe.views.ListView{get view_name(){return"Gantt"}setup_defaults(){super.setup_defaults(),this.page_title=this.page_title+" "+__("Gantt"),this.calendar_settings=frappe.views.calendar[this.doctype]||{},"object"==typeof this.calendar_settings.gantt&&Object.assign(this.calendar_settings,this.calendar_settings.gantt),this.calendar_settings.order_by?(this.sort_by=this.calendar_settings.order_by,this.sort_order="asc"):(this.sort_by=this.view_user_settings.sort_by||this.calendar_settings.field_map.start,this.sort_order=this.view_user_settings.sort_order||"asc")}setup_view(){}prepare_data(e){super.prepare_data(e),this.prepare_tasks()}prepare_tasks(){var e=this,t=this.meta,n=this.calendar_settings.field_map;this.tasks=this.data.map((function(i){var r,a=0;n.progress&&$.isFunction(n.progress)?a=n.progress(i):n.progress&&(a=i[n.progress]),r=t.title_field?i.progress?__("{0} ({1}) - {2}%",[i[t.title_field],i.name,i.progress]):__("{0} ({1})",[i[t.title_field],i.name]):i[n.title];var s={start:i[n.start],end:i[n.end],name:r,id:i[n.id||"name"],doctype:e.doctype,progress:a,dependencies:i.depends_on_tasks||""};return i.color&&frappe.ui.color.validate_hex(i.color)&&(s.custom_class="color-"+i.color.substr(1)),i.is_milestone&&(s.custom_class="bar-milestone"),s}))}render(){var e=this;this.load_lib.then((function(){e.render_gantt()}))}render_header(){}render_gantt(){var e=this,t=this.view_user_settings.gantt_view_mode||"Day",n=this.calendar_settings.field_map,i="YYYY-MM-DD";this.$result.empty(),this.$result.addClass("gantt-modern"),this.gantt=new Gantt(this.$result[0],this.tasks,{bar_height:35,bar_corner_radius:4,resize_handle_width:8,resize_handle_height:28,resize_handle_corner_radius:3,resize_handle_offset:4,view_mode:t,date_format:"YYYY-MM-DD",on_click:function(e){frappe.set_route("Form",e.doctype,e.id)},on_date_change:function(t,r,a){var s;e.can_write&&frappe.db.set_value(t.doctype,t.id,((s={})[n.start]=moment(r).format(i),s[n.end]=moment(a).format(i),s))},on_progress_change:function(t,i){var r;if(e.can_write){var a="progress";$.isFunction(n.progress)?a=null:n.progress&&(a=n.progress),a&&frappe.db.set_value(t.doctype,t.id,((r={})[a]=parseInt(i),r))}},on_view_change:function(t){e.save_view_user_settings({gantt_view_mode:t})},custom_popup_html:function(t){var n=e.get_item(t.id),i='<div class="title">'+t.name+'</div>\n\t\t\t\t\t<div class="subtitle">'+moment(t._start).format("MMM D")+" - "+moment(t._end).format("MMM D")+"</div>",r=e.settings.gantt_custom_popup_html;r&&$.isFunction(r)&&(i=r(t,n));return'<div class="details-container">'+i+"</div>"}}),this.setup_view_mode_buttons(),this.set_colors()}setup_view_mode_buttons(){var e=this;if(!(this.$paging_area.find(".gantt-view-mode").length>0)){var t=this.gantt.options.view_modes||[],n='<div class="btn-group gantt-view-mode">\n\t\t\t\t'+t.map((function(t){return'<button type="button"\n\t\t\t\t\t\tclass="btn btn-default btn-sm btn-view-mode '+(n=t,(e.gantt.view_is(n)?"btn-info":"")+'"\n\t\t\t\t\t\tdata-value="')+t+'">\n\t\t\t\t\t\t'+__(t)+"\n\t\t\t\t\t</button>";var n})).join("")+"\n\t\t\t</div>";this.$paging_area.find(".level-left").append(n);this.$paging_area.on("click",".btn-view-mode",(function(t){var n=$(t.currentTarget);e.$paging_area.find(".btn-view-mode").removeClass("btn-info"),n.addClass("btn-info"),function(t){setTimeout((function(){return e.gantt.change_view_mode(t)}),0)}(n.data().value)}))}}set_colors(){var e=this.tasks.map((function(e){return e.custom_class})).filter((function(e){return e&&e.startsWith("color-")})).map((function(e){var t=e.replace("#",""),n="#"+e.substr(6);return"\n\t\t\t\t.gantt .bar-wrapper."+t+" .bar {\n\t\t\t\t\tfill: "+n+";\n\t\t\t\t}\n\t\t\t\t.gantt .bar-wrapper."+t+" .bar-progress {\n\t\t\t\t\tfill: "+frappe.ui.color.get_contrast_color(n)+";\n\t\t\t\t}\n\t\t\t"})).join("");e="<style>"+e+"</style>",this.$result.prepend(e)}get_item(e){return this.data.find((function(t){return t.name===e}))}get required_libs(){return["assets/frappe/node_modules/frappe-gantt/dist/frappe-gantt.css","assets/frappe/node_modules/frappe-gantt/dist/frappe-gantt.min.js"]}};
/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */
var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function __extends(e,t){function n(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var __assign=function(){return(__assign=Object.assign||function(e){for(var t,n=arguments,i=1,r=arguments.length;i<r;i++)for(var a in t=n[i])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function __spreadArrays(){for(var e=arguments,t=0,n=0,i=arguments.length;n<i;n++)t+=e[n].length;var r=Array(t),a=0;for(n=0;n<i;n++)for(var s=arguments[n],o=0,l=s.length;o<l;o++,a++)r[a]=s[o];return r}var n,u,i,t,r,o,f={},e=[],c=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function s(e,t){for(var n in t)e[n]=t[n];return e}function a(e){var t=e.parentNode;t&&t.removeChild(e)}function v(e,t,n){var i,r=arguments,a={};for(i in t)"key"!==i&&"ref"!==i&&(a[i]=t[i]);if(arguments.length>3)for(n=[n],i=3;i<arguments.length;i++)n.push(r[i]);if(null!=n&&(a.children=n),"function"==typeof e&&null!=e.defaultProps)for(i in e.defaultProps)void 0===a[i]&&(a[i]=e.defaultProps[i]);return h(e,a,t&&t.key,t&&t.ref,null)}function h(e,t,i,r,a){var s={type:e,props:t,key:i,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:a};return null==a&&(s.__v=s),n.vnode&&n.vnode(s),s}function y(){return{current:null}}function p(e){return e.children}function d(e,t){this.props=e,this.context=t}function _(e,t){if(null==t)return e.__?_(e.__,e.__.__k.indexOf(e)+1):null;for(var n;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e)return n.__e;return"function"==typeof e.type?_(e):null}function k(e){var t,n;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e){e.__e=e.__c.base=n.__e;break}return k(e)}}function w(e){(!e.__d&&(e.__d=!0)&&u.push(e)&&!m.__r++||t!==n.debounceRendering)&&((t=n.debounceRendering)||i)(m)}function m(){for(var e;m.__r=u.length;)e=u.sort((function(e,t){return e.__v.__b-t.__v.__b})),u=[],e.some((function(e){var t,n,i,r,a,o,l;e.__d&&(o=(a=(t=e).__v).__e,(l=t.__P)&&(n=[],(i=s({},a)).__v=i,r=T(l,a,i,t.__n,void 0!==l.ownerSVGElement,null,n,null==o?_(a):o),$$1(n,a),r!=o&&k(a)))}))}function g(t,n,i,r,s,o,l,d,c,u){var g,m,v,y,b,w,E,S=r&&r.__k||e,D=S.length;for(c==f&&(c=null!=l?l[0]:D?_(r,0):null),i.__k=[],g=0;g<n.length;g++)if(null!=(y=i.__k[g]=null==(y=n[g])||"boolean"==typeof y?null:"string"==typeof y||"number"==typeof y?h(null,y,null,null,y):Array.isArray(y)?h(p,{children:y},null,null,null):null!=y.__e||null!=y.__c?h(y.type,y.props,y.key,null,y.__v):y)){if(y.__=i,y.__b=i.__b+1,null===(v=S[g])||v&&y.key==v.key&&y.type===v.type)S[g]=void 0;else for(m=0;m<D;m++){if((v=S[m])&&y.key==v.key&&y.type===v.type){S[m]=void 0;break}v=null}b=T(t,y,v=v||f,s,o,l,d,c,u),(m=y.ref)&&v.ref!=m&&(E||(E=[]),v.ref&&E.push(v.ref,null,y),E.push(m,y.__c||b,y)),null!=b?(null==w&&(w=b),c=x(t,y,v,S,l,b,c),"option"==i.type?t.value="":"function"==typeof i.type&&(i.__d=c)):c&&v.__e==c&&c.parentNode!=t&&(c=_(v))}if(i.__e=w,null!=l&&"function"!=typeof i.type)for(g=l.length;g--;)null!=l[g]&&a(l[g]);for(g=D;g--;)null!=S[g]&&I(S[g],S[g]);if(E)for(g=0;g<E.length;g++)H(E[g],E[++g],E[++g])}function x(e,t,n,i,r,a,s){var o,l,d;if(void 0!==t.__d)o=t.__d,t.__d=void 0;else if(r==n||a!=s||null==a.parentNode)e:if(null==s||s.parentNode!==e)e.appendChild(a),o=null;else{for(l=s,d=0;(l=l.nextSibling)&&d<i.length;d+=2)if(l==a)break e;e.insertBefore(a,s),o=s}return void 0!==o?o:a.nextSibling}function A(e,t,n,i,r){var a;for(a in n)"children"===a||"key"===a||a in t||C(e,a,null,n[a],i);for(a in t)r&&"function"!=typeof t[a]||"children"===a||"key"===a||"value"===a||"checked"===a||n[a]===t[a]||C(e,a,t[a],n[a],i)}function P(e,t,n){"-"===t[0]?e.setProperty(t,n):e[t]="number"==typeof n&&!1===c.test(t)?n+"px":null==n?"":n}function C(e,t,n,i,r){var a,s,o,l,d;if(r?"className"===t&&(t="class"):"class"===t&&(t="className"),"style"===t)if(a=e.style,"string"==typeof n)a.cssText=n;else{if("string"==typeof i&&(a.cssText="",i=null),i)for(l in i)n&&l in n||P(a,l,"");if(n)for(d in n)i&&n[d]===i[d]||P(a,d,n[d])}else"o"===t[0]&&"n"===t[1]?(s=t!==(t=t.replace(/Capture$/,"")),o=t.toLowerCase(),t=(o in e?o:t).slice(2),n?(i||e.addEventListener(t,N,s),(e.l||(e.l={}))[t]=n):e.removeEventListener(t,N,s)):"list"!==t&&"tagName"!==t&&"form"!==t&&"type"!==t&&"size"!==t&&!r&&t in e?e[t]=null==n?"":n:"function"!=typeof n&&"dangerouslySetInnerHTML"!==t&&(t!==(t=t.replace(/^xlink:?/,""))?null==n||!1===n?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),n):null==n||!1===n&&!/^ar/.test(t)?e.removeAttribute(t):e.setAttribute(t,n))}function N(e){this.l[e.type](n.event?n.event(e):e)}function z(e,t,n){var i,r;for(i=0;i<e.__k.length;i++)(r=e.__k[i])&&(r.__=e,r.__e&&("function"==typeof r.type&&r.__k.length>1&&z(r,t,n),t=x(n,r,r,e.__k,null,r.__e,t),"function"==typeof e.type&&(e.__d=t)))}function T(e,t,i,r,a,o,l,c,u){var f,h,_,m,v,y,b,w,E,S,D,C=t.type;if(void 0!==t.constructor)return null;(f=n.__b)&&f(t);try{e:if("function"==typeof C){if(w=t.props,E=(f=C.contextType)&&r[f.__c],S=f?E?E.props.value:f.__:r,i.__c?b=(h=t.__c=i.__c).__=h.__E:("prototype"in C&&C.prototype.render?t.__c=h=new C(w,S):(t.__c=h=new d(w,S),h.constructor=C,h.render=L$1),E&&E.sub(h),h.props=w,h.state||(h.state={}),h.context=S,h.__n=r,_=h.__d=!0,h.__h=[]),null==h.__s&&(h.__s=h.state),null!=C.getDerivedStateFromProps&&(h.__s==h.state&&(h.__s=s({},h.__s)),s(h.__s,C.getDerivedStateFromProps(w,h.__s))),m=h.props,v=h.state,_)null==C.getDerivedStateFromProps&&null!=h.componentWillMount&&h.componentWillMount(),null!=h.componentDidMount&&h.__h.push(h.componentDidMount);else{if(null==C.getDerivedStateFromProps&&w!==m&&null!=h.componentWillReceiveProps&&h.componentWillReceiveProps(w,S),!h.__e&&null!=h.shouldComponentUpdate&&!1===h.shouldComponentUpdate(w,h.__s,S)||t.__v===i.__v){h.props=w,h.state=h.__s,t.__v!==i.__v&&(h.__d=!1),h.__v=t,t.__e=i.__e,t.__k=i.__k,h.__h.length&&l.push(h),z(t,c,e);break e}null!=h.componentWillUpdate&&h.componentWillUpdate(w,h.__s,S),null!=h.componentDidUpdate&&h.__h.push((function(){h.componentDidUpdate(m,v,y)}))}h.context=S,h.props=w,h.state=h.__s,(f=n.__r)&&f(t),h.__d=!1,h.__v=t,h.__P=e,f=h.render(h.props,h.state,h.context),h.state=h.__s,null!=h.getChildContext&&(r=s(s({},r),h.getChildContext())),_||null==h.getSnapshotBeforeUpdate||(y=h.getSnapshotBeforeUpdate(m,v)),D=null!=f&&f.type==p&&null==f.key?f.props.children:f,g(e,Array.isArray(D)?D:[D],t,i,r,a,o,l,c,u),h.base=t.__e,h.__h.length&&l.push(h),b&&(h.__E=h.__=null),h.__e=!1}else null==o&&t.__v===i.__v?(t.__k=i.__k,t.__e=i.__e):t.__e=j(i.__e,t,i,r,a,o,l,u);(f=n.diffed)&&f(t)}catch(e){t.__v=null,n.__e(e,t,i)}return t.__e}function $$1(e,t){n.__c&&n.__c(t,e),e.some((function(t){try{e=t.__h,t.__h=[],e.some((function(e){e.call(t)}))}catch(e){n.__e(e,t.__v)}}))}function j(t,n,i,r,a,s,o,l){var d,c,u,p,h,_=i.props,m=n.props;if(a="svg"===n.type||a,null!=s)for(d=0;d<s.length;d++)if(null!=(c=s[d])&&((null===n.type?3===c.nodeType:c.localName===n.type)||t==c)){t=c,s[d]=null;break}if(null==t){if(null===n.type)return document.createTextNode(m);t=a?document.createElementNS("http://www.w3.org/2000/svg",n.type):document.createElement(n.type,m.is&&{is:m.is}),s=null,l=!1}if(null===n.type)_!==m&&t.data!=m&&(t.data=m);else{if(null!=s&&(s=e.slice.call(t.childNodes)),u=(_=i.props||f).dangerouslySetInnerHTML,p=m.dangerouslySetInnerHTML,!l){if(null!=s)for(_={},h=0;h<t.attributes.length;h++)_[t.attributes[h].name]=t.attributes[h].value;(p||u)&&(p&&u&&p.__html==u.__html||(t.innerHTML=p&&p.__html||""))}A(t,m,_,a,l),p?n.__k=[]:(d=n.props.children,g(t,Array.isArray(d)?d:[d],n,i,r,"foreignObject"!==n.type&&a,s,o,f,l)),l||("value"in m&&void 0!==(d=m.value)&&d!==t.value&&C(t,"value",d,_.value,!1),"checked"in m&&void 0!==(d=m.checked)&&d!==t.checked&&C(t,"checked",d,_.checked,!1))}return t}function H(e,t,i){try{"function"==typeof e?e(t):e.current=t}catch(e){n.__e(e,i)}}function I(e,t,i){var r,s,o;if(n.unmount&&n.unmount(e),(r=e.ref)&&(r.current&&r.current!==e.__e||H(r,null,t)),i||"function"==typeof e.type||(i=null!=(s=e.__e)),e.__e=e.__d=void 0,null!=(r=e.__c)){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(e){n.__e(e,t)}r.base=r.__P=null}if(r=e.__k)for(o=0;o<r.length;o++)r[o]&&I(r[o],t,i);null!=s&&a(s)}function L$1(e,t,n){return this.constructor(e,n)}function M(t,i,a){var s,o,l;n.__&&n.__(t,i),o=(s=a===r)?null:a&&a.__k||i.__k,t=v(p,null,[t]),l=[],T(i,(s?i:a||i).__k=t,o||f,f,void 0!==i.ownerSVGElement,a&&!s?[a]:o?null:i.childNodes.length?e.slice.call(i.childNodes):null,l,a||f,s),$$1(l,t)}function q(e){var t={},n={__c:"__cC"+o++,__:e,Consumer:function(e,t){return e.children(t)},Provider:function(e){var i,r=this;return this.getChildContext||(i=[],this.getChildContext=function(){return t[n.__c]=r,t},this.shouldComponentUpdate=function(e){r.props.value!==e.value&&i.some((function(t){t.context=e.value,w(t)}))},this.sub=function(e){i.push(e);var t=e.componentWillUnmount;e.componentWillUnmount=function(){i.splice(i.indexOf(e),1),t&&t.call(e)}}),e.children}};return n.Consumer.contextType=n,n.Provider.__=n,n}function flushToDom(){var e=n.debounceRendering,t=[];for(n.debounceRendering=function(e){t.push(e)},M(v(FakeComponent,{}),document.createElement("div"));t.length;)t.shift()();n.debounceRendering=e}n={__e:function(e,t){for(var n,i;t=t.__;)if((n=t.__c)&&!n.__)try{if(n.constructor&&null!=n.constructor.getDerivedStateFromError&&(i=!0,n.setState(n.constructor.getDerivedStateFromError(e))),null!=n.componentDidCatch&&(i=!0,n.componentDidCatch(e)),i)return w(n.__E=n)}catch(t){e=t}throw e}},d.prototype.setState=function(e,t){var n;n=this.__s!==this.state?this.__s:this.__s=s({},this.state),"function"==typeof e&&(e=e(n,this.props)),e&&s(n,e),null!=e&&this.__v&&(t&&this.__h.push(t),w(this))},d.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),w(this))},d.prototype.render=p,u=[],i="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,m.__r=0,r=f,o=0,("undefined"!=typeof globalThis?globalThis:window).FullCalendarVDom={Component:d,createElement:v,render:M,createRef:y,Fragment:p,createContext:createContext,flushToDom:flushToDom};var FakeComponent=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.render=function(){return v("div",{})},t.prototype.componentDidMount=function(){this.setState({})},t}(d);function createContext(e){var t=q(e),n=t.Provider;return t.Provider=function(){var e=this,t=!this.getChildContext,i=n.apply(this,arguments);if(t){var r=[];this.shouldComponentUpdate=function(t){e.props.value!==t.value&&r.some((function(e){e.context=t.value,e.forceUpdate()}))},this.sub=function(e){r.push(e);var t=e.componentWillUnmount;e.componentWillUnmount=function(){r.splice(r.indexOf(e),1),t&&t.call(e)}}}return i},t}if("undefined"==typeof FullCalendarVDom)throw new Error("Please import the top-level fullcalendar lib before attempting to import a plugin.");var Component=FullCalendarVDom.Component,createElement=FullCalendarVDom.createElement,render=FullCalendarVDom.render,createRef=FullCalendarVDom.createRef,Fragment=FullCalendarVDom.Fragment,createContext$1=FullCalendarVDom.createContext,flushToDom$1=FullCalendarVDom.flushToDom,EventSourceApi=function(){function e(e,t){this.context=e,this.internalEventSource=t}return e.prototype.remove=function(){this.context.dispatch({type:"REMOVE_EVENT_SOURCE",sourceId:this.internalEventSource.sourceId})},e.prototype.refetch=function(){this.context.dispatch({type:"FETCH_EVENT_SOURCES",sourceIds:[this.internalEventSource.sourceId]})},Object.defineProperty(e.prototype,"id",{get:function(){return this.internalEventSource.publicId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return this.internalEventSource.meta.url},enumerable:!1,configurable:!0}),e}();function removeElement(e){e.parentNode&&e.parentNode.removeChild(e)}function elementClosest(e,t){if(e.closest)return e.closest(t);if(!document.documentElement.contains(e))return null;do{if(elementMatches(e,t))return e;e=e.parentElement||e.parentNode}while(null!==e&&1===e.nodeType);return null}function elementMatches(e,t){return(e.matches||e.matchesSelector||e.msMatchesSelector).call(e,t)}function findElements(e,t){for(var n=e instanceof HTMLElement?[e]:e,i=[],r=0;r<n.length;r++)for(var a=n[r].querySelectorAll(t),s=0;s<a.length;s++)i.push(a[s]);return i}var PIXEL_PROP_RE=/(top|left|right|bottom|width|height)$/i;function applyStyle(e,t){for(var n in t)applyStyleProp(e,n,t[n])}function applyStyleProp(e,t,n){null==n?e.style[t]="":"number"==typeof n&&PIXEL_PROP_RE.test(t)?e.style[t]=n+"px":e.style[t]=n}function preventDefault(e){e.preventDefault()}function buildDelegationHandler(e,t){return function(n){var i=elementClosest(n.target,e);i&&t.call(i,n,i)}}function listenBySelector(e,t,n,i){var r=buildDelegationHandler(n,i);return e.addEventListener(t,r),function(){e.removeEventListener(t,r)}}function listenToHoverBySelector(e,t,n,i){var r;return listenBySelector(e,"mouseover",t,(function(e,t){if(t!==r){r=t,n(e,t);var a=function(e){r=null,i(e,t),t.removeEventListener("mouseleave",a)};t.addEventListener("mouseleave",a)}}))}var transitionEventNames=["webkitTransitionEnd","otransitionend","oTransitionEnd","msTransitionEnd","transitionend"];function whenTransitionDone(e,t){var n=function(i){t(i),transitionEventNames.forEach((function(t){e.removeEventListener(t,n)}))};transitionEventNames.forEach((function(t){e.addEventListener(t,n)}))}var guidNumber=0;function guid(){return String(guidNumber++)}function disableCursor(){document.body.classList.add("fc-not-allowed")}function enableCursor(){document.body.classList.remove("fc-not-allowed")}function preventSelection(e){e.classList.add("fc-unselectable"),e.addEventListener("selectstart",preventDefault)}function allowSelection(e){e.classList.remove("fc-unselectable"),e.removeEventListener("selectstart",preventDefault)}function preventContextMenu(e){e.addEventListener("contextmenu",preventDefault)}function allowContextMenu(e){e.removeEventListener("contextmenu",preventDefault)}function parseFieldSpecs(e){var t,n,i=[],r=[];for("string"==typeof e?r=e.split(/\s*,\s*/):"function"==typeof e?r=[e]:Array.isArray(e)&&(r=e),t=0;t<r.length;t++)"string"==typeof(n=r[t])?i.push("-"===n.charAt(0)?{field:n.substring(1),order:-1}:{field:n,order:1}):"function"==typeof n&&i.push({func:n});return i}function compareByFieldSpecs(e,t,n){var i,r;for(i=0;i<n.length;i++)if(r=compareByFieldSpec(e,t,n[i]))return r;return 0}function compareByFieldSpec(e,t,n){return n.func?n.func(e,t):flexibleCompare(e[n.field],t[n.field])*(n.order||1)}function flexibleCompare(e,t){return e||t?null==t?-1:null==e?1:"string"==typeof e||"string"==typeof t?String(e).localeCompare(String(t)):e-t:0}function padStart(e,t){var n=String(e);return"000".substr(0,t-n.length)+n}function compareNumbers(e,t){return e-t}function isInt(e){return e%1==0}function computeSmallestCellWidth(e){var t=e.querySelector(".fc-scrollgrid-shrink-frame"),n=e.querySelector(".fc-scrollgrid-shrink-cushion");if(!t)throw new Error("needs fc-scrollgrid-shrink-frame className");if(!n)throw new Error("needs fc-scrollgrid-shrink-cushion className");return e.getBoundingClientRect().width-t.getBoundingClientRect().width+n.getBoundingClientRect().width}var DAY_IDS=["sun","mon","tue","wed","thu","fri","sat"];function addWeeks(e,t){var n=dateToUtcArray(e);return n[2]+=7*t,arrayToUtcDate(n)}function addDays(e,t){var n=dateToUtcArray(e);return n[2]+=t,arrayToUtcDate(n)}function addMs(e,t){var n=dateToUtcArray(e);return n[6]+=t,arrayToUtcDate(n)}function diffWeeks(e,t){return diffDays(e,t)/7}function diffDays(e,t){return(t.valueOf()-e.valueOf())/864e5}function diffHours(e,t){return(t.valueOf()-e.valueOf())/36e5}function diffMinutes(e,t){return(t.valueOf()-e.valueOf())/6e4}function diffSeconds(e,t){return(t.valueOf()-e.valueOf())/1e3}function diffDayAndTime(e,t){var n=startOfDay(e),i=startOfDay(t);return{years:0,months:0,days:Math.round(diffDays(n,i)),milliseconds:t.valueOf()-i.valueOf()-(e.valueOf()-n.valueOf())}}function diffWholeWeeks(e,t){var n=diffWholeDays(e,t);return null!==n&&n%7==0?n/7:null}function diffWholeDays(e,t){return timeAsMs(e)===timeAsMs(t)?Math.round(diffDays(e,t)):null}function startOfDay(e){return arrayToUtcDate([e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()])}function startOfHour(e){return arrayToUtcDate([e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours()])}function startOfMinute(e){return arrayToUtcDate([e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes()])}function startOfSecond(e){return arrayToUtcDate([e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds()])}function weekOfYear(e,t,n){var i=e.getUTCFullYear(),r=weekOfGivenYear(e,i,t,n);if(r<1)return weekOfGivenYear(e,i-1,t,n);var a=weekOfGivenYear(e,i+1,t,n);return a>=1?Math.min(r,a):r}function weekOfGivenYear(e,t,n,i){var r=arrayToUtcDate([t,0,1+firstWeekOffset(t,n,i)]),a=startOfDay(e),s=Math.round(diffDays(r,a));return Math.floor(s/7)+1}function firstWeekOffset(e,t,n){var i=7+t-n;return-((7+arrayToUtcDate([e,0,i]).getUTCDay()-t)%7)+i-1}function dateToLocalArray(e){return[e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()]}function arrayToLocalDate(e){return new Date(e[0],e[1]||0,null==e[2]?1:e[2],e[3]||0,e[4]||0,e[5]||0)}function dateToUtcArray(e){return[e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()]}function arrayToUtcDate(e){return 1===e.length&&(e=e.concat([0])),new Date(Date.UTC.apply(Date,e))}function isValidDate(e){return!isNaN(e.valueOf())}function timeAsMs(e){return 1e3*e.getUTCHours()*60*60+1e3*e.getUTCMinutes()*60+1e3*e.getUTCSeconds()+e.getUTCMilliseconds()}function createEventInstance(e,t,n,i){return{instanceId:guid(),defId:e,range:t,forcedStartTzo:null==n?null:n,forcedEndTzo:null==i?null:i}}var hasOwnProperty=Object.prototype.hasOwnProperty;function mergeProps(e,t){var n={};if(t)for(var i in t){for(var r=[],a=e.length-1;a>=0;a--){var s=e[a][i];if("object"==typeof s&&s)r.unshift(s);else if(void 0!==s){n[i]=s;break}}r.length&&(n[i]=mergeProps(r))}for(a=e.length-1;a>=0;a--){var o=e[a];for(var l in o)l in n||(n[l]=o[l])}return n}function filterHash(e,t){var n={};for(var i in e)t(e[i],i)&&(n[i]=e[i]);return n}function mapHash(e,t){var n={};for(var i in e)n[i]=t(e[i],i);return n}function arrayToHash(e){for(var t={},n=0,i=e;n<i.length;n++){t[i[n]]=!0}return t}function hashValuesToArray(e){var t=[];for(var n in e)t.push(e[n]);return t}function isPropsEqual(e,t){if(e===t)return!0;for(var n in e)if(hasOwnProperty.call(e,n)&&!(n in t))return!1;for(var n in t)if(hasOwnProperty.call(t,n)&&e[n]!==t[n])return!1;return!0}function getUnequalProps(e,t){var n=[];for(var i in e)hasOwnProperty.call(e,i)&&(i in t||n.push(i));for(var i in t)hasOwnProperty.call(t,i)&&e[i]!==t[i]&&n.push(i);return n}function compareObjs(e,t,n){if(void 0===n&&(n={}),e===t)return!0;for(var i in t)if(!(i in e)||!isObjValsEqual(e[i],t[i],n[i]))return!1;for(var i in e)if(!(i in t))return!1;return!0}function isObjValsEqual(e,t,n){return e===t||!0===n||!!n&&n(e,t)}function collectFromHash(e,t,n,i){void 0===t&&(t=0),void 0===i&&(i=1);var r=[];null==n&&(n=Object.keys(e).length);for(var a=t;a<n;a+=i){var s=e[a];void 0!==s&&r.push(s)}return r}function parseRecurring(e,t,n,i){for(var r=0;r<i.length;r++){var a=i[r].parse(e,n);if(a){var s=e.allDay;return null==s&&null==(s=t)&&null==(s=a.allDayGuess)&&(s=!1),{allDay:s,duration:a.duration,typeData:a.typeData,typeId:r}}}return null}function expandRecurring(e,t,n){var i=n.dateEnv,r=n.pluginHooks,a=n.options,s=e.defs,o=e.instances;for(var l in o=filterHash(o,(function(e){return!s[e.defId].recurringDef})),s){var d=s[l];if(d.recurringDef){var c=d.recurringDef.duration;c||(c=d.allDay?a.defaultAllDayEventDuration:a.defaultTimedEventDuration);for(var u=0,p=expandRecurringRanges(d,c,t,i,r.recurringTypes);u<p.length;u++){var f=p[u],h=createEventInstance(l,{start:f,end:i.add(f,c)});o[h.instanceId]=h}}}return{defs:s,instances:o}}function expandRecurringRanges(e,t,n,i,r){var a=r[e.recurringDef.typeId].expand(e.recurringDef.typeData,{start:i.subtract(n.start,t),end:n.end},i);return e.allDay&&(a=a.map(startOfDay)),a}var INTERNAL_UNITS=["years","months","days","milliseconds"],PARSE_RE=/^(-?)(?:(\d+)\.)?(\d+):(\d\d)(?::(\d\d)(?:\.(\d\d\d))?)?/;function createDuration(e,t){var n;return"string"==typeof e?parseString(e):"object"==typeof e&&e?parseObject(e):"number"==typeof e?parseObject(((n={})[t||"milliseconds"]=e,n)):null}function parseString(e){var t=PARSE_RE.exec(e);if(t){var n=t[1]?-1:1;return{years:0,months:0,days:n*(t[2]?parseInt(t[2],10):0),milliseconds:n*(60*(t[3]?parseInt(t[3],10):0)*60*1e3+60*(t[4]?parseInt(t[4],10):0)*1e3+1e3*(t[5]?parseInt(t[5],10):0)+(t[6]?parseInt(t[6],10):0))}}return null}function parseObject(e){var t={years:e.years||e.year||0,months:e.months||e.month||0,days:e.days||e.day||0,milliseconds:60*(e.hours||e.hour||0)*60*1e3+60*(e.minutes||e.minute||0)*1e3+1e3*(e.seconds||e.second||0)+(e.milliseconds||e.millisecond||e.ms||0)},n=e.weeks||e.week;return n&&(t.days+=7*n,t.specifiedWeeks=!0),t}function durationsEqual(e,t){return e.years===t.years&&e.months===t.months&&e.days===t.days&&e.milliseconds===t.milliseconds}function addDurations(e,t){return{years:e.years+t.years,months:e.months+t.months,days:e.days+t.days,milliseconds:e.milliseconds+t.milliseconds}}function subtractDurations(e,t){return{years:e.years-t.years,months:e.months-t.months,days:e.days-t.days,milliseconds:e.milliseconds-t.milliseconds}}function multiplyDuration(e,t){return{years:e.years*t,months:e.months*t,days:e.days*t,milliseconds:e.milliseconds*t}}function asRoughYears(e){return asRoughDays(e)/365}function asRoughMonths(e){return asRoughDays(e)/30}function asRoughDays(e){return asRoughMs(e)/864e5}function asRoughMs(e){return 31536e6*e.years+2592e6*e.months+864e5*e.days+e.milliseconds}function wholeDivideDurations(e,t){for(var n=null,i=0;i<INTERNAL_UNITS.length;i++){var r=INTERNAL_UNITS[i];if(t[r]){var a=e[r]/t[r];if(!isInt(a)||null!==n&&n!==a)return null;n=a}else if(e[r])return null}return n}function greatestDurationDenominator(e){var t=e.milliseconds;if(t){if(t%1e3!=0)return{unit:"millisecond",value:t};if(t%6e4!=0)return{unit:"second",value:t/1e3};if(t%36e5!=0)return{unit:"minute",value:t/6e4};if(t)return{unit:"hour",value:t/36e5}}return e.days?e.specifiedWeeks&&e.days%7==0?{unit:"week",value:e.days/7}:{unit:"day",value:e.days}:e.months?{unit:"month",value:e.months}:e.years?{unit:"year",value:e.years}:{unit:"millisecond",value:0}}function buildIsoString(e,t,n){void 0===n&&(n=!1);var i=e.toISOString();return i=i.replace(".000",""),n&&(i=i.replace("T00:00:00Z","")),i.length>10&&(null==t?i=i.replace("Z",""):0!==t&&(i=i.replace("Z",formatTimeZoneOffset(t,!0)))),i}function formatDayString(e){return e.toISOString().replace(/T.*$/,"")}function formatIsoTimeString(e){return padStart(e.getUTCHours(),2)+":"+padStart(e.getUTCMinutes(),2)+":"+padStart(e.getUTCSeconds(),2)}function formatTimeZoneOffset(e,t){void 0===t&&(t=!1);var n=e<0?"-":"+",i=Math.abs(e),r=Math.floor(i/60),a=Math.round(i%60);return t?n+padStart(r,2)+":"+padStart(a,2):"GMT"+n+r+(a?":"+padStart(a,2):"")}function isArraysEqual(e,t,n){if(e===t)return!0;var i,r=e.length;if(r!==t.length)return!1;for(i=0;i<r;i++)if(!(n?n(e[i],t[i]):e[i]===t[i]))return!1;return!0}function memoize(e,t,n){var i,r;return function(){for(var a=arguments,s=[],o=0;o<arguments.length;o++)s[o]=a[o];if(i){if(!isArraysEqual(i,s)){n&&n(r);var l=e.apply(this,s);t&&t(l,r)||(r=l)}}else r=e.apply(this,s);return i=s,r}}function memoizeObjArg(e,t,n){var i,r;return function(a){if(i){if(!isPropsEqual(i,a)){n&&n(r);var s=e.call(this,a);t&&t(s,r)||(r=s)}}else r=e.call(this,a);return i=a,r}}var EXTENDED_SETTINGS_AND_SEVERITIES={week:3,separator:0,omitZeroMinute:0,meridiem:0,omitCommas:0},STANDARD_DATE_PROP_SEVERITIES={timeZoneName:7,era:6,year:5,month:4,day:2,weekday:2,hour:1,minute:1,second:1},MERIDIEM_RE=/\s*([ap])\.?m\.?/i,COMMA_RE=/,/g,MULTI_SPACE_RE=/\s+/g,LTR_RE=/\u200e/g,UTC_RE=/UTC|GMT/,NativeFormatter=function(){function e(e){var t={},n={},i=0;for(var r in e)r in EXTENDED_SETTINGS_AND_SEVERITIES?(n[r]=e[r],i=Math.max(EXTENDED_SETTINGS_AND_SEVERITIES[r],i)):(t[r]=e[r],r in STANDARD_DATE_PROP_SEVERITIES&&(i=Math.max(STANDARD_DATE_PROP_SEVERITIES[r],i)));this.standardDateProps=t,this.extendedSettings=n,this.severity=i,this.buildFormattingFunc=memoize(buildFormattingFunc)}return e.prototype.format=function(e,t){return this.buildFormattingFunc(this.standardDateProps,this.extendedSettings,t)(e)},e.prototype.formatRange=function(e,t,n,i){var r=this.standardDateProps,a=this.extendedSettings,s=computeMarkerDiffSeverity(e.marker,t.marker,n.calendarSystem);if(!s)return this.format(e,n);var o=s;!(o>1)||"numeric"!==r.year&&"2-digit"!==r.year||"numeric"!==r.month&&"2-digit"!==r.month||"numeric"!==r.day&&"2-digit"!==r.day||(o=1);var l=this.format(e,n),d=this.format(t,n);if(l===d)return l;var c=buildFormattingFunc(computePartialFormattingOptions(r,o),a,n),u=c(e),p=c(t),f=findCommonInsertion(l,u,d,p),h=a.separator||i||n.defaultSeparator||"";return f?f.before+u+h+p+f.after:l+h+d},e.prototype.getLargestUnit=function(){switch(this.severity){case 7:case 6:case 5:return"year";case 4:return"month";case 3:return"week";case 2:return"day";default:return"time"}},e}();function buildFormattingFunc(e,t,n){var i=Object.keys(e).length;return 1===i&&"short"===e.timeZoneName?function(e){return formatTimeZoneOffset(e.timeZoneOffset)}:0===i&&t.week?function(e){return formatWeekNumber(n.computeWeekNumber(e.marker),n.weekText,n.locale,t.week)}:buildNativeFormattingFunc(e,t,n)}function buildNativeFormattingFunc(e,t,n){e=__assign({},e),t=__assign({},t),sanitizeSettings(e,t),e.timeZone="UTC";var i,r=new Intl.DateTimeFormat(n.locale.codes,e);if(t.omitZeroMinute){var a=__assign({},e);delete a.minute,i=new Intl.DateTimeFormat(n.locale.codes,a)}return function(a){var s=a.marker;return postProcess((i&&!s.getUTCMinutes()?i:r).format(s),a,e,t,n)}}function sanitizeSettings(e,t){e.timeZoneName&&(e.hour||(e.hour="2-digit"),e.minute||(e.minute="2-digit")),"long"===e.timeZoneName&&(e.timeZoneName="short"),t.omitZeroMinute&&(e.second||e.millisecond)&&delete t.omitZeroMinute}function postProcess(e,t,n,i,r){return e=e.replace(LTR_RE,""),"short"===n.timeZoneName&&(e=injectTzoStr(e,"UTC"===r.timeZone||null==t.timeZoneOffset?"UTC":formatTimeZoneOffset(t.timeZoneOffset))),i.omitCommas&&(e=e.replace(COMMA_RE,"").trim()),i.omitZeroMinute&&(e=e.replace(":00","")),!1===i.meridiem?e=e.replace(MERIDIEM_RE,"").trim():"narrow"===i.meridiem?e=e.replace(MERIDIEM_RE,(function(e,t){return t.toLocaleLowerCase()})):"short"===i.meridiem?e=e.replace(MERIDIEM_RE,(function(e,t){return t.toLocaleLowerCase()+"m"})):"lowercase"===i.meridiem&&(e=e.replace(MERIDIEM_RE,(function(e){return e.toLocaleLowerCase()}))),e=(e=e.replace(MULTI_SPACE_RE," ")).trim()}function injectTzoStr(e,t){var n=!1;return e=e.replace(UTC_RE,(function(){return n=!0,t})),n||(e+=" "+t),e}function formatWeekNumber(e,t,n,i){var r=[];return"narrow"===i?r.push(t):"short"===i&&r.push(t," "),r.push(n.simpleNumberFormat.format(e)),"rtl"===n.options.direction&&r.reverse(),r.join("")}function computeMarkerDiffSeverity(e,t,n){return n.getMarkerYear(e)!==n.getMarkerYear(t)?5:n.getMarkerMonth(e)!==n.getMarkerMonth(t)?4:n.getMarkerDay(e)!==n.getMarkerDay(t)?2:timeAsMs(e)!==timeAsMs(t)?1:0}function computePartialFormattingOptions(e,t){var n={};for(var i in e)(!(i in STANDARD_DATE_PROP_SEVERITIES)||STANDARD_DATE_PROP_SEVERITIES[i]<=t)&&(n[i]=e[i]);return n}function findCommonInsertion(e,t,n,i){for(var r=0;r<e.length;){var a=e.indexOf(t,r);if(-1===a)break;var s=e.substr(0,a);r=a+t.length;for(var o=e.substr(r),l=0;l<n.length;){var d=n.indexOf(i,l);if(-1===d)break;var c=n.substr(0,d);l=d+i.length;var u=n.substr(l);if(s===c&&o===u)return{before:s,after:o}}}return null}function expandZonedMarker(e,t){var n=t.markerToArray(e.marker);return{marker:e.marker,timeZoneOffset:e.timeZoneOffset,array:n,year:n[0],month:n[1],day:n[2],hour:n[3],minute:n[4],second:n[5],millisecond:n[6]}}function createVerboseFormattingArg(e,t,n,i){var r=expandZonedMarker(e,n.calendarSystem);return{date:r,start:r,end:t?expandZonedMarker(t,n.calendarSystem):null,timeZone:n.timeZone,localeCodes:n.locale.codes,defaultSeparator:i||n.defaultSeparator}}var CmdFormatter=function(){function e(e){this.cmdStr=e}return e.prototype.format=function(e,t,n){return t.cmdFormatter(this.cmdStr,createVerboseFormattingArg(e,null,t,n))},e.prototype.formatRange=function(e,t,n,i){return n.cmdFormatter(this.cmdStr,createVerboseFormattingArg(e,t,n,i))},e}(),FuncFormatter=function(){function e(e){this.func=e}return e.prototype.format=function(e,t,n){return this.func(createVerboseFormattingArg(e,null,t,n))},e.prototype.formatRange=function(e,t,n,i){return this.func(createVerboseFormattingArg(e,t,n,i))},e}();function createFormatter(e){return"object"==typeof e&&e?new NativeFormatter(e):"string"==typeof e?new CmdFormatter(e):"function"==typeof e?new FuncFormatter(e):void 0}var BASE_OPTION_REFINERS={navLinkDayClick:identity,navLinkWeekClick:identity,duration:createDuration,bootstrapFontAwesome:identity,buttonIcons:identity,customButtons:identity,defaultAllDayEventDuration:createDuration,defaultTimedEventDuration:createDuration,nextDayThreshold:createDuration,scrollTime:createDuration,slotMinTime:createDuration,slotMaxTime:createDuration,dayPopoverFormat:createFormatter,slotDuration:createDuration,snapDuration:createDuration,headerToolbar:identity,footerToolbar:identity,defaultRangeSeparator:String,titleRangeSeparator:String,forceEventDuration:Boolean,dayHeaders:Boolean,dayHeaderFormat:createFormatter,dayHeaderClassNames:identity,dayHeaderContent:identity,dayHeaderDidMount:identity,dayHeaderWillUnmount:identity,dayCellClassNames:identity,dayCellContent:identity,dayCellDidMount:identity,dayCellWillUnmount:identity,initialView:String,aspectRatio:Number,weekends:Boolean,weekNumberCalculation:identity,weekNumbers:Boolean,weekNumberClassNames:identity,weekNumberContent:identity,weekNumberDidMount:identity,weekNumberWillUnmount:identity,editable:Boolean,viewClassNames:identity,viewDidMount:identity,viewWillUnmount:identity,nowIndicator:Boolean,nowIndicatorClassNames:identity,nowIndicatorContent:identity,nowIndicatorDidMount:identity,nowIndicatorWillUnmount:identity,showNonCurrentDates:Boolean,lazyFetching:Boolean,startParam:String,endParam:String,timeZoneParam:String,timeZone:String,locales:identity,locale:identity,themeSystem:String,dragRevertDuration:Number,dragScroll:Boolean,allDayMaintainDuration:Boolean,unselectAuto:Boolean,dropAccept:identity,eventOrder:parseFieldSpecs,handleWindowResize:Boolean,windowResizeDelay:Number,longPressDelay:Number,eventDragMinDistance:Number,expandRows:Boolean,height:identity,contentHeight:identity,direction:String,weekNumberFormat:createFormatter,eventResizableFromStart:Boolean,displayEventTime:Boolean,displayEventEnd:Boolean,weekText:String,progressiveEventRendering:Boolean,businessHours:identity,initialDate:identity,now:identity,eventDataTransform:identity,stickyHeaderDates:identity,stickyFooterScrollbar:identity,viewHeight:identity,defaultAllDay:Boolean,eventSourceFailure:identity,eventSourceSuccess:identity,eventDisplay:String,eventStartEditable:Boolean,eventDurationEditable:Boolean,eventOverlap:identity,eventConstraint:identity,eventAllow:identity,eventBackgroundColor:String,eventBorderColor:String,eventTextColor:String,eventColor:String,eventClassNames:identity,eventContent:identity,eventDidMount:identity,eventWillUnmount:identity,selectConstraint:identity,selectOverlap:identity,selectAllow:identity,droppable:Boolean,unselectCancel:String,slotLabelFormat:identity,slotLaneClassNames:identity,slotLaneContent:identity,slotLaneDidMount:identity,slotLaneWillUnmount:identity,slotLabelClassNames:identity,slotLabelContent:identity,slotLabelDidMount:identity,slotLabelWillUnmount:identity,dayMaxEvents:identity,dayMaxEventRows:identity,dayMinWidth:Number,slotLabelInterval:createDuration,allDayText:String,allDayClassNames:identity,allDayContent:identity,allDayDidMount:identity,allDayWillUnmount:identity,slotMinWidth:Number,navLinks:Boolean,eventTimeFormat:createFormatter,rerenderDelay:Number,moreLinkText:identity,selectMinDistance:Number,selectable:Boolean,selectLongPressDelay:Number,eventLongPressDelay:Number,selectMirror:Boolean,eventMinHeight:Number,slotEventOverlap:Boolean,plugins:identity,firstDay:Number,dayCount:Number,dateAlignment:String,dateIncrement:createDuration,hiddenDays:identity,monthMode:Boolean,fixedWeekCount:Boolean,validRange:identity,visibleRange:identity,titleFormat:identity,noEventsText:String},BASE_OPTION_DEFAULTS={eventDisplay:"auto",defaultRangeSeparator:" - ",titleRangeSeparator:"  ",defaultTimedEventDuration:"01:00:00",defaultAllDayEventDuration:{day:1},forceEventDuration:!1,nextDayThreshold:"00:00:00",dayHeaders:!0,initialView:"",aspectRatio:1.35,headerToolbar:{start:"title",center:"",end:"today prev,next"},weekends:!0,weekNumbers:!1,weekNumberCalculation:"local",editable:!1,nowIndicator:!1,scrollTime:"06:00:00",slotMinTime:"00:00:00",slotMaxTime:"24:00:00",showNonCurrentDates:!0,lazyFetching:!0,startParam:"start",endParam:"end",timeZoneParam:"timeZone",timeZone:"local",locales:[],locale:"",themeSystem:"standard",dragRevertDuration:500,dragScroll:!0,allDayMaintainDuration:!1,unselectAuto:!0,dropAccept:"*",eventOrder:"start,-duration,allDay,title",dayPopoverFormat:{month:"long",day:"numeric",year:"numeric"},handleWindowResize:!0,windowResizeDelay:100,longPressDelay:1e3,eventDragMinDistance:5,expandRows:!1,navLinks:!1,selectable:!1},CALENDAR_LISTENER_REFINERS={datesSet:identity,eventsSet:identity,eventAdd:identity,eventChange:identity,eventRemove:identity,windowResize:identity,eventClick:identity,eventMouseEnter:identity,eventMouseLeave:identity,select:identity,unselect:identity,loading:identity,_unmount:identity,_beforeprint:identity,_afterprint:identity,_noEventDrop:identity,_noEventResize:identity,_resize:identity,_scrollRequest:identity},CALENDAR_OPTION_REFINERS={buttonText:identity,views:identity,plugins:identity,initialEvents:identity,events:identity,eventSources:identity},COMPLEX_OPTION_COMPARATORS={headerToolbar:isBoolComplexEqual,footerToolbar:isBoolComplexEqual,buttonText:isBoolComplexEqual,buttonIcons:isBoolComplexEqual};function isBoolComplexEqual(e,t){return"object"==typeof e&&"object"==typeof t&&e&&t?isPropsEqual(e,t):e===t}var VIEW_OPTION_REFINERS={type:String,component:identity,buttonText:String,buttonTextKey:String,dateProfileGeneratorClass:identity,usesMinMaxTime:Boolean,classNames:identity,content:identity,didMount:identity,willUnmount:identity};function mergeRawOptions(e){return mergeProps(e,COMPLEX_OPTION_COMPARATORS)}function refineProps(e,t){var n={},i={};for(var r in t)r in e&&(n[r]=t[r](e[r]));for(var r in e)r in t||(i[r]=e[r]);return{refined:n,extra:i}}function identity(e){return e}function parseEvents(e,t,n,i){for(var r=createEmptyEventStore(),a=buildEventRefiners(n),s=0,o=e;s<o.length;s++){var l=parseEvent(o[s],t,n,i,a);l&&eventTupleToStore(l,r)}return r}function eventTupleToStore(e,t){return void 0===t&&(t=createEmptyEventStore()),t.defs[e.def.defId]=e.def,e.instance&&(t.instances[e.instance.instanceId]=e.instance),t}function getRelevantEvents(e,t){var n=e.instances[t];if(n){var i=e.defs[n.defId],r=filterEventStoreDefs(e,(function(e){return isEventDefsGrouped(i,e)}));return r.defs[i.defId]=i,r.instances[n.instanceId]=n,r}return createEmptyEventStore()}function isEventDefsGrouped(e,t){return Boolean(e.groupId&&e.groupId===t.groupId)}function createEmptyEventStore(){return{defs:{},instances:{}}}function mergeEventStores(e,t){return{defs:__assign(__assign({},e.defs),t.defs),instances:__assign(__assign({},e.instances),t.instances)}}function filterEventStoreDefs(e,t){var n=filterHash(e.defs,t),i=filterHash(e.instances,(function(e){return n[e.defId]}));return{defs:n,instances:i}}function excludeSubEventStore(e,t){var n=e.defs,i=e.instances,r={},a={};for(var s in n)t.defs[s]||(r[s]=n[s]);for(var o in i)!t.instances[o]&&r[i[o].defId]&&(a[o]=i[o]);return{defs:r,instances:a}}function normalizeConstraint(e,t){return Array.isArray(e)?parseEvents(e,null,t,!0):"object"==typeof e&&e?parseEvents([e],null,t,!0):null!=e?String(e):null}function parseClassNames(e){return Array.isArray(e)?e:"string"==typeof e?e.split(/\s+/):[]}var EVENT_UI_REFINERS={display:String,editable:Boolean,startEditable:Boolean,durationEditable:Boolean,constraint:identity,overlap:identity,allow:identity,className:parseClassNames,classNames:parseClassNames,color:String,backgroundColor:String,borderColor:String,textColor:String};function createEventUi(e,t){var n=normalizeConstraint(e.constraint,t);return{display:e.display||null,startEditable:null!=e.startEditable?e.startEditable:e.editable,durationEditable:null!=e.durationEditable?e.durationEditable:e.editable,constraints:null!=n?[n]:[],overlap:null!=e.overlap?e.overlap:null,allows:null!=e.allow?[e.allow]:[],backgroundColor:e.backgroundColor||e.color||"",borderColor:e.borderColor||e.color||"",textColor:e.textColor||"",classNames:(e.className||[]).concat(e.classNames||[])}}function combineEventUis(e){return e.reduce(combineTwoEventUis,EMPTY_EVENT_UI)}function combineTwoEventUis(e,t){return{display:null!=t.display?t.display:e.display,startEditable:null!=t.startEditable?t.startEditable:e.startEditable,durationEditable:null!=t.durationEditable?t.durationEditable:e.durationEditable,constraints:e.constraints.concat(t.constraints),overlap:"boolean"==typeof t.overlap?t.overlap:e.overlap,allows:e.allows.concat(t.allows),backgroundColor:t.backgroundColor||e.backgroundColor,borderColor:t.borderColor||e.borderColor,textColor:t.textColor||e.textColor,classNames:e.classNames.concat(t.classNames)}}var EMPTY_EVENT_UI={display:null,startEditable:null,durationEditable:null,constraints:[],overlap:null,allows:[],backgroundColor:"",borderColor:"",textColor:"",classNames:[]},EVENT_NON_DATE_REFINERS={id:String,groupId:String,title:String,url:String},EVENT_DATE_REFINERS={start:identity,end:identity,date:identity,allDay:Boolean},EVENT_REFINERS=__assign(__assign(__assign({},EVENT_NON_DATE_REFINERS),EVENT_DATE_REFINERS),{extendedProps:identity});function parseEvent(e,t,n,i,r){void 0===r&&(r=buildEventRefiners(n));var a=refineEventDef(e,n,r),s=a.refined,o=a.extra,l=computeIsDefaultAllDay(t,n),d=parseRecurring(s,l,n.dateEnv,n.pluginHooks.recurringTypes);if(d)return(c=parseEventDef(s,o,t?t.sourceId:"",d.allDay,Boolean(d.duration),n)).recurringDef={typeId:d.typeId,typeData:d.typeData,duration:d.duration},{def:c,instance:null};var c,u=parseSingle(s,l,n,i);return u?{def:c=parseEventDef(s,o,t?t.sourceId:"",u.allDay,u.hasEnd,n),instance:createEventInstance(c.defId,u.range,u.forcedStartTzo,u.forcedEndTzo)}:null}function refineEventDef(e,t,n){return void 0===n&&(n=buildEventRefiners(t)),refineProps(e,n)}function buildEventRefiners(e){return __assign(__assign(__assign({},EVENT_UI_REFINERS),EVENT_REFINERS),e.pluginHooks.eventRefiners)}function parseEventDef(e,t,n,i,r,a){for(var s={title:e.title||"",groupId:e.groupId||"",publicId:e.id||"",url:e.url||"",recurringDef:null,defId:guid(),sourceId:n,allDay:i,hasEnd:r,ui:createEventUi(e,a),extendedProps:__assign(__assign({},e.extendedProps||{}),t)},o=0,l=a.pluginHooks.eventDefMemberAdders;o<l.length;o++){var d=l[o];__assign(s,d(e))}return Object.freeze(s.ui.classNames),Object.freeze(s.extendedProps),s}function parseSingle(e,t,n,i){var r,a,s=e.allDay,o=null,l=!1,d=null,c=null!=e.start?e.start:e.date;if(r=n.dateEnv.createMarkerMeta(c))o=r.marker;else if(!i)return null;return null!=e.end&&(a=n.dateEnv.createMarkerMeta(e.end)),null==s&&(s=null!=t?t:(!r||r.isTimeUnspecified)&&(!a||a.isTimeUnspecified)),s&&o&&(o=startOfDay(o)),a&&(d=a.marker,s&&(d=startOfDay(d)),o&&d<=o&&(d=null)),d?l=!0:i||(l=n.options.forceEventDuration||!1,d=n.dateEnv.add(o,s?n.options.defaultAllDayEventDuration:n.options.defaultTimedEventDuration)),{allDay:s,hasEnd:l,range:{start:o,end:d},forcedStartTzo:r?r.forcedTzo:null,forcedEndTzo:a?a.forcedTzo:null}}function computeIsDefaultAllDay(e,t){var n=null;return e&&(n=e.defaultAllDay),null==n&&(n=t.options.defaultAllDay),n}function computeAlignedDayRange(e){var t=Math.floor(diffDays(e.start,e.end))||1,n=startOfDay(e.start);return{start:n,end:addDays(n,t)}}function computeVisibleDayRange(e,t){void 0===t&&(t=createDuration(0));var n=null,i=null;if(e.end){i=startOfDay(e.end);var r=e.end.valueOf()-i.valueOf();r&&r>=asRoughMs(t)&&(i=addDays(i,1))}return e.start&&(n=startOfDay(e.start),i&&i<=n&&(i=addDays(n,1))),{start:n,end:i}}function diffDates(e,t,n,i){return"year"===i?createDuration(n.diffWholeYears(e,t),"year"):"month"===i?createDuration(n.diffWholeMonths(e,t),"month"):diffDayAndTime(e,t)}function parseRange(e,t){var n=null,i=null;return e.start&&(n=t.createMarker(e.start)),e.end&&(i=t.createMarker(e.end)),n||i?n&&i&&i<n?null:{start:n,end:i}:null}function invertRanges(e,t){var n,i,r=[],a=t.start;for(e.sort(compareRanges),n=0;n<e.length;n++)(i=e[n]).start>a&&r.push({start:a,end:i.start}),i.end>a&&(a=i.end);return a<t.end&&r.push({start:a,end:t.end}),r}function compareRanges(e,t){return e.start.valueOf()-t.start.valueOf()}function intersectRanges(e,t){var n=e.start,i=e.end,r=null;return null!==t.start&&(n=null===n?t.start:new Date(Math.max(n.valueOf(),t.start.valueOf()))),null!=t.end&&(i=null===i?t.end:new Date(Math.min(i.valueOf(),t.end.valueOf()))),(null===n||null===i||n<i)&&(r={start:n,end:i}),r}function rangesEqual(e,t){return(null===e.start?null:e.start.valueOf())===(null===t.start?null:t.start.valueOf())&&(null===e.end?null:e.end.valueOf())===(null===t.end?null:t.end.valueOf())}function rangesIntersect(e,t){return(null===e.end||null===t.start||e.end>t.start)&&(null===e.start||null===t.end||e.start<t.end)}function rangeContainsRange(e,t){return(null===e.start||null!==t.start&&t.start>=e.start)&&(null===e.end||null!==t.end&&t.end<=e.end)}function rangeContainsMarker(e,t){return(null===e.start||t>=e.start)&&(null===e.end||t<e.end)}function constrainMarkerToRange(e,t){return null!=t.start&&e<t.start?t.start:null!=t.end&&e>=t.end?new Date(t.end.valueOf()-1):e}function sliceEventStore(e,t,n,i){var r={},a={},s={},o=[],l=[],d=compileEventUis(e.defs,t);for(var c in e.defs){"inverse-background"===(f=d[(b=e.defs[c]).defId]).display&&(b.groupId?(r[b.groupId]=[],s[b.groupId]||(s[b.groupId]=b)):a[c]=[])}for(var u in e.instances){var p=e.instances[u],f=d[(b=e.defs[p.defId]).defId],h=p.range,_=!b.allDay&&i?computeVisibleDayRange(h,i):h,g=intersectRanges(_,n);g&&("inverse-background"===f.display?b.groupId?r[b.groupId].push(g):a[p.defId].push(g):"none"!==f.display&&("background"===f.display?o:l).push({def:b,ui:f,instance:p,range:g,isStart:_.start&&_.start.valueOf()===g.start.valueOf(),isEnd:_.end&&_.end.valueOf()===g.end.valueOf()}))}for(var m in r)for(var v=0,y=invertRanges(r[m],n);v<y.length;v++){var b,w=y[v];f=d[(b=s[m]).defId];o.push({def:b,ui:f,instance:null,range:w,isStart:!1,isEnd:!1})}for(var c in a)for(var E=0,S=invertRanges(a[c],n);E<S.length;E++){w=S[E];o.push({def:e.defs[c],ui:d[c],instance:null,range:w,isStart:!1,isEnd:!1})}return{bg:o,fg:l}}function hasBgRendering(e){return"background"===e.ui.display||"inverse-background"===e.ui.display}function setElSeg(e,t){e.fcSeg=t}function getElSeg(e){return e.fcSeg||e.parentNode.fcSeg||null}function compileEventUis(e,t){return mapHash(e,(function(e){return compileEventUi(e,t)}))}function compileEventUi(e,t){var n=[];return t[""]&&n.push(t[""]),t[e.defId]&&n.push(t[e.defId]),n.push(e.ui),combineEventUis(n)}function sortEventSegs(e,t){var n=e.map(buildSegCompareObj);return n.sort((function(e,n){return compareByFieldSpecs(e,n,t)})),n.map((function(e){return e._seg}))}function buildSegCompareObj(e){var t=e.eventRange,n=t.def,i=t.instance?t.instance.range:t.range,r=i.start?i.start.valueOf():0,a=i.end?i.end.valueOf():0;return __assign(__assign(__assign({},n.extendedProps),n),{id:n.publicId,start:r,end:a,duration:a-r,allDay:Number(n.allDay),_seg:e})}function computeSegDraggable(e,t){for(var n=t.pluginHooks.isDraggableTransformers,i=e.eventRange,r=i.def,a=i.ui,s=a.startEditable,o=0,l=n;o<l.length;o++){s=(0,l[o])(s,r,a,t)}return s}function computeSegStartResizable(e,t){return e.isStart&&e.eventRange.ui.durationEditable&&t.options.eventResizableFromStart}function computeSegEndResizable(e,t){return e.isEnd&&e.eventRange.ui.durationEditable}function buildSegTimeText(e,t,n,i,r,a,s){var o=n.dateEnv,l=n.options,d=l.displayEventTime,c=l.displayEventEnd,u=e.eventRange.def,p=e.eventRange.instance;if(null==d&&(d=!1!==i),null==c&&(c=!1!==r),d&&!u.allDay&&(e.isStart||e.isEnd)){var f=a||(e.isStart?p.range.start:e.start||e.eventRange.range.start),h=s||(e.isEnd?p.range.end:e.end||e.eventRange.range.end);return c&&u.hasEnd?o.formatRange(f,h,t,{forcedStartTzo:a?null:p.forcedStartTzo,forcedEndTzo:s?null:p.forcedEndTzo}):o.format(f,t,{forcedTzo:a?null:p.forcedStartTzo})}return""}function getSegMeta(e,t,n){var i=e.eventRange.range;return{isPast:i.end<(n||t.start),isFuture:i.start>=(n||t.end),isToday:t&&rangeContainsMarker(t,i.start)}}function getEventClassNames(e){var t=["fc-event"];return e.isMirror&&t.push("fc-event-mirror"),e.isDraggable&&t.push("fc-event-draggable"),(e.isStartResizable||e.isEndResizable)&&t.push("fc-event-resizable"),e.isDragging&&t.push("fc-event-dragging"),e.isResizing&&t.push("fc-event-resizing"),e.isSelected&&t.push("fc-event-selected"),e.isStart&&t.push("fc-event-start"),e.isEnd&&t.push("fc-event-end"),e.isPast&&t.push("fc-event-past"),e.isToday&&t.push("fc-event-today"),e.isFuture&&t.push("fc-event-future"),t}function buildEventRangeKey(e){return e.instance?e.instance.instanceId:e.def.defId+":"+e.range.start.toISOString()}var STANDARD_PROPS={start:identity,end:identity,allDay:Boolean};function parseDateSpan(e,t,n){var i=parseOpenDateSpan(e,t),r=i.range;if(!r.start)return null;if(!r.end){if(null==n)return null;r.end=t.add(r.start,n)}return i}function parseOpenDateSpan(e,t){var n=refineProps(e,STANDARD_PROPS),i=n.refined,r=n.extra,a=i.start?t.createMarkerMeta(i.start):null,s=i.end?t.createMarkerMeta(i.end):null,o=i.allDay;return null==o&&(o=a&&a.isTimeUnspecified&&(!s||s.isTimeUnspecified)),__assign({range:{start:a?a.marker:null,end:s?s.marker:null},allDay:o},r)}function isDateSpansEqual(e,t){return rangesEqual(e.range,t.range)&&e.allDay===t.allDay&&isSpanPropsEqual(e,t)}function isSpanPropsEqual(e,t){for(var n in t)if("range"!==n&&"allDay"!==n&&e[n]!==t[n])return!1;for(var n in e)if(!(n in t))return!1;return!0}function buildDateSpanApi(e,t){return __assign(__assign({},buildRangeApi(e.range,t,e.allDay)),{allDay:e.allDay})}function buildRangeApiWithTimeZone(e,t,n){return __assign(__assign({},buildRangeApi(e,t,n)),{timeZone:t.timeZone})}function buildRangeApi(e,t,n){return{start:t.toDate(e.start),end:t.toDate(e.end),startStr:t.formatIso(e.start,{omitTime:n}),endStr:t.formatIso(e.end,{omitTime:n})}}function fabricateEventRange(e,t,n){var i=refineEventDef({editable:!1},n),r=parseEventDef(i.refined,i.extra,"",e.allDay,!0,n);return{def:r,ui:compileEventUi(r,t),instance:createEventInstance(r.defId,e.range),range:e.range,isStart:!0,isEnd:!0}}function triggerDateSelect(e,t,n){n.emitter.trigger("select",__assign(__assign({},buildDateSpanApiWithContext(e,n)),{jsEvent:t?t.origEvent:null,view:n.viewApi||n.calendarApi.view}))}function triggerDateUnselect(e,t){t.emitter.trigger("unselect",{jsEvent:e?e.origEvent:null,view:t.viewApi||t.calendarApi.view})}function buildDateSpanApiWithContext(e,t){for(var n={},i=0,r=t.pluginHooks.dateSpanTransforms;i<r.length;i++){var a=r[i];__assign(n,a(e,t))}return __assign(n,buildDateSpanApi(e,t.dateEnv)),n}function getDefaultEventEnd(e,t,n){var i=n.dateEnv,r=n.options,a=t;return e?(a=startOfDay(a),a=i.add(a,r.defaultAllDayEventDuration)):a=i.add(a,r.defaultTimedEventDuration),a}function applyMutationToEventStore(e,t,n,i){var r=compileEventUis(e.defs,t),a=createEmptyEventStore();for(var s in e.defs){var o=e.defs[s];a.defs[s]=applyMutationToEventDef(o,r[s],n,i)}for(var l in e.instances){var d=e.instances[l];o=a.defs[d.defId];a.instances[l]=applyMutationToEventInstance(d,o,r[d.defId],n,i)}return a}function applyMutationToEventDef(e,t,n,i){var r=n.standardProps||{};null==r.hasEnd&&t.durationEditable&&(n.startDelta||n.endDelta)&&(r.hasEnd=!0);var a=__assign(__assign(__assign({},e),r),{ui:__assign(__assign({},e.ui),r.ui)});n.extendedProps&&(a.extendedProps=__assign(__assign({},a.extendedProps),n.extendedProps));for(var s=0,o=i.pluginHooks.eventDefMutationAppliers;s<o.length;s++){(0,o[s])(a,n,i)}return!a.hasEnd&&i.options.forceEventDuration&&(a.hasEnd=!0),a}function applyMutationToEventInstance(e,t,n,i,r){var a=r.dateEnv,s=i.standardProps&&!0===i.standardProps.allDay,o=i.standardProps&&!1===i.standardProps.hasEnd,l=__assign({},e);return s&&(l.range=computeAlignedDayRange(l.range)),i.datesDelta&&n.startEditable&&(l.range={start:a.add(l.range.start,i.datesDelta),end:a.add(l.range.end,i.datesDelta)}),i.startDelta&&n.durationEditable&&(l.range={start:a.add(l.range.start,i.startDelta),end:l.range.end}),i.endDelta&&n.durationEditable&&(l.range={start:l.range.start,end:a.add(l.range.end,i.endDelta)}),o&&(l.range={start:l.range.start,end:getDefaultEventEnd(t.allDay,l.range.start,r)}),t.allDay&&(l.range={start:startOfDay(l.range.start),end:startOfDay(l.range.end)}),l.range.end<l.range.start&&(l.range.end=getDefaultEventEnd(t.allDay,l.range.start,r)),l}var ViewApi=function(){function e(e,t,n){this.type=e,this.getCurrentData=t,this.dateEnv=n}return Object.defineProperty(e.prototype,"calendar",{get:function(){return this.getCurrentData().calendarApi},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"title",{get:function(){return this.getCurrentData().viewTitle},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"activeStart",{get:function(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.activeRange.start)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"activeEnd",{get:function(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.activeRange.end)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentStart",{get:function(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.currentRange.start)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentEnd",{get:function(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.currentRange.end)},enumerable:!1,configurable:!0}),e.prototype.getOption=function(e){return this.getCurrentData().options[e]},e}(),EVENT_SOURCE_REFINERS={id:String,defaultAllDay:Boolean,url:String,events:identity,eventDataTransform:identity,success:identity,failure:identity};function parseEventSource(e,t,n){var i;if(void 0===n&&(n=buildEventSourceRefiners(t)),"string"==typeof e?i={url:e}:"function"==typeof e||Array.isArray(e)?i={events:e}:"object"==typeof e&&e&&(i=e),i){var r=refineProps(i,n),a=r.refined,s=r.extra,o=buildEventSourceMeta(a,t);if(o)return{_raw:e,isFetching:!1,latestFetchId:"",fetchRange:null,defaultAllDay:a.defaultAllDay,eventDataTransform:a.eventDataTransform,success:a.success,failure:a.failure,publicId:a.id||"",sourceId:guid(),sourceDefId:o.sourceDefId,meta:o.meta,ui:createEventUi(a,t),extendedProps:s}}return null}function buildEventSourceRefiners(e){return __assign(__assign(__assign({},EVENT_UI_REFINERS),EVENT_SOURCE_REFINERS),e.pluginHooks.eventSourceRefiners)}function buildEventSourceMeta(e,t){for(var n=t.pluginHooks.eventSourceDefs,i=n.length-1;i>=0;i--){var r=n[i].parseMeta(e);if(r)return{sourceDefId:i,meta:r}}return null}function reduceCurrentDate(e,t){switch(t.type){case"CHANGE_DATE":return t.dateMarker;default:return e}}function getInitialDate(e,t){var n=e.initialDate;return null!=n?t.createMarker(n):getNow(e.now,t)}function getNow(e,t){return"function"==typeof e&&(e=e()),null==e?t.createNowMarker():t.createMarker(e)}var CalendarApi=function(){function e(){}return e.prototype.getCurrentData=function(){return this.currentDataManager.getCurrentData()},e.prototype.dispatch=function(e){return this.currentDataManager.dispatch(e)},Object.defineProperty(e.prototype,"view",{get:function(){return this.getCurrentData().viewApi},enumerable:!1,configurable:!0}),e.prototype.batchRendering=function(e){e()},e.prototype.updateSize=function(){this.trigger("_resize",!0)},e.prototype.setOption=function(e,t){this.dispatch({type:"SET_OPTION",optionName:e,rawOptionValue:t})},e.prototype.getOption=function(e){return this.currentDataManager.currentCalendarOptionsInput[e]},e.prototype.getAvailableLocaleCodes=function(){return Object.keys(this.getCurrentData().availableRawLocales)},e.prototype.on=function(e,t){var n=this.currentDataManager;n.currentCalendarOptionsRefiners[e]?n.emitter.on(e,t):console.warn("Unknown listener name '"+e+"'")},e.prototype.off=function(e,t){this.currentDataManager.emitter.off(e,t)},e.prototype.trigger=function(e){for(var t,n=arguments,i=[],r=1;r<arguments.length;r++)i[r-1]=n[r];(t=this.currentDataManager.emitter).trigger.apply(t,__spreadArrays([e],i))},e.prototype.changeView=function(e,t){var n=this;this.batchRendering((function(){if(n.unselect(),t)if(t.start&&t.end)n.dispatch({type:"CHANGE_VIEW_TYPE",viewType:e}),n.dispatch({type:"SET_OPTION",optionName:"visibleRange",rawOptionValue:t});else{var i=n.getCurrentData().dateEnv;n.dispatch({type:"CHANGE_VIEW_TYPE",viewType:e,dateMarker:i.createMarker(t)})}else n.dispatch({type:"CHANGE_VIEW_TYPE",viewType:e})}))},e.prototype.zoomTo=function(e,t){var n;t=t||"day",n=this.getCurrentData().viewSpecs[t]||this.getUnitViewSpec(t),this.unselect(),n?this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:n.type,dateMarker:e}):this.dispatch({type:"CHANGE_DATE",dateMarker:e})},e.prototype.getUnitViewSpec=function(e){var t,n,i=this.getCurrentData(),r=i.viewSpecs,a=i.toolbarConfig,s=[].concat(a.viewsWithButtons);for(var o in r)s.push(o);for(t=0;t<s.length;t++)if((n=r[s[t]])&&n.singleUnit===e)return n},e.prototype.prev=function(){this.unselect(),this.dispatch({type:"PREV"})},e.prototype.next=function(){this.unselect(),this.dispatch({type:"NEXT"})},e.prototype.prevYear=function(){var e=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.dateEnv.addYears(e.currentDate,-1)})},e.prototype.nextYear=function(){var e=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.dateEnv.addYears(e.currentDate,1)})},e.prototype.today=function(){var e=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:getNow(e.calendarOptions.now,e.dateEnv)})},e.prototype.gotoDate=function(e){var t=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:t.dateEnv.createMarker(e)})},e.prototype.incrementDate=function(e){var t=this.getCurrentData(),n=createDuration(e);n&&(this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:t.dateEnv.add(t.currentDate,n)}))},e.prototype.getDate=function(){var e=this.getCurrentData();return e.dateEnv.toDate(e.currentDate)},e.prototype.formatDate=function(e,t){var n=this.getCurrentData().dateEnv;return n.format(n.createMarker(e),createFormatter(t))},e.prototype.formatRange=function(e,t,n){var i=this.getCurrentData().dateEnv;return i.formatRange(i.createMarker(e),i.createMarker(t),createFormatter(n),n)},e.prototype.formatIso=function(e,t){var n=this.getCurrentData().dateEnv;return n.formatIso(n.createMarker(e),{omitTime:t})},e.prototype.select=function(e,t){var n;n=null==t?null!=e.start?e:{start:e,end:null}:{start:e,end:t};var i=this.getCurrentData(),r=parseDateSpan(n,i.dateEnv,createDuration({days:1}));r&&(this.dispatch({type:"SELECT_DATES",selection:r}),triggerDateSelect(r,null,i))},e.prototype.unselect=function(e){var t=this.getCurrentData();t.dateSelection&&(this.dispatch({type:"UNSELECT_DATES"}),triggerDateUnselect(e,t))},e.prototype.addEvent=function(e,t){if(e instanceof EventApi){var n=e._def,i=e._instance;return this.getCurrentData().eventStore.defs[n.defId]||(this.dispatch({type:"ADD_EVENTS",eventStore:eventTupleToStore({def:n,instance:i})}),this.triggerEventAdd(e)),e}var r,a=this.getCurrentData();if(t instanceof EventSourceApi)r=t.internalEventSource;else if("boolean"==typeof t)t&&(r=hashValuesToArray(a.eventSources)[0]);else if(null!=t){var s=this.getEventSourceById(t);if(!s)return console.warn('Could not find an event source with ID "'+t+'"'),null;r=s.internalEventSource}var o=parseEvent(e,r,a,!1);if(o){var l=new EventApi(a,o.def,o.def.recurringDef?null:o.instance);return this.dispatch({type:"ADD_EVENTS",eventStore:eventTupleToStore(o)}),this.triggerEventAdd(l),l}return null},e.prototype.triggerEventAdd=function(e){var t=this;this.getCurrentData().emitter.trigger("eventAdd",{event:e,relatedEvents:[],revert:function(){t.dispatch({type:"REMOVE_EVENTS",eventStore:eventApiToStore(e)})}})},e.prototype.getEventById=function(e){var t=this.getCurrentData(),n=t.eventStore,i=n.defs,r=n.instances;for(var a in e=String(e),i){var s=i[a];if(s.publicId===e){if(s.recurringDef)return new EventApi(t,s,null);for(var o in r){var l=r[o];if(l.defId===s.defId)return new EventApi(t,s,l)}}}return null},e.prototype.getEvents=function(){var e=this.getCurrentData();return buildEventApis(e.eventStore,e)},e.prototype.removeAllEvents=function(){this.dispatch({type:"REMOVE_ALL_EVENTS"})},e.prototype.getEventSources=function(){var e=this.getCurrentData(),t=e.eventSources,n=[];for(var i in t)n.push(new EventSourceApi(e,t[i]));return n},e.prototype.getEventSourceById=function(e){var t=this.getCurrentData(),n=t.eventSources;for(var i in e=String(e),n)if(n[i].publicId===e)return new EventSourceApi(t,n[i]);return null},e.prototype.addEventSource=function(e){var t=this.getCurrentData();if(e instanceof EventSourceApi)return t.eventSources[e.internalEventSource.sourceId]||this.dispatch({type:"ADD_EVENT_SOURCES",sources:[e.internalEventSource]}),e;var n=parseEventSource(e,t);return n?(this.dispatch({type:"ADD_EVENT_SOURCES",sources:[n]}),new EventSourceApi(t,n)):null},e.prototype.removeAllEventSources=function(){this.dispatch({type:"REMOVE_ALL_EVENT_SOURCES"})},e.prototype.refetchEvents=function(){this.dispatch({type:"FETCH_EVENT_SOURCES"})},e.prototype.scrollToTime=function(e){var t=createDuration(e);t&&this.trigger("_scrollRequest",{time:t})},e}(),EventApi=function(){function e(e,t,n){this._context=e,this._def=t,this._instance=n||null}return e.prototype.setProp=function(e,t){var n,i;if(e in EVENT_DATE_REFINERS)console.warn("Could not set date-related prop 'name'. Use one of the date-related methods instead.");else if(e in EVENT_NON_DATE_REFINERS)t=EVENT_NON_DATE_REFINERS[e](t),this.mutate({standardProps:(n={},n[e]=t,n)});else if(e in EVENT_UI_REFINERS){var r=EVENT_UI_REFINERS[e](t);"color"===e?r={backgroundColor:t,borderColor:t}:"editable"===e?r={startEditable:t,durationEditable:t}:((i={})[e]=t,r=i),this.mutate({standardProps:{ui:r}})}else console.warn("Could not set prop '"+e+"'. Use setExtendedProp instead.")},e.prototype.setExtendedProp=function(e,t){var n;this.mutate({extendedProps:(n={},n[e]=t,n)})},e.prototype.setStart=function(e,t){void 0===t&&(t={});var n=this._context.dateEnv,i=n.createMarker(e);if(i&&this._instance){var r=diffDates(this._instance.range.start,i,n,t.granularity);t.maintainDuration?this.mutate({datesDelta:r}):this.mutate({startDelta:r})}},e.prototype.setEnd=function(e,t){void 0===t&&(t={});var n,i=this._context.dateEnv;if((null==e||(n=i.createMarker(e)))&&this._instance)if(n){var r=diffDates(this._instance.range.end,n,i,t.granularity);this.mutate({endDelta:r})}else this.mutate({standardProps:{hasEnd:!1}})},e.prototype.setDates=function(e,t,n){void 0===n&&(n={});var i,r=this._context.dateEnv,a={allDay:n.allDay},s=r.createMarker(e);if(s&&(null==t||(i=r.createMarker(t)))&&this._instance){var o=this._instance.range;!0===n.allDay&&(o=computeAlignedDayRange(o));var l=diffDates(o.start,s,r,n.granularity);if(i){var d=diffDates(o.end,i,r,n.granularity);durationsEqual(l,d)?this.mutate({datesDelta:l,standardProps:a}):this.mutate({startDelta:l,endDelta:d,standardProps:a})}else a.hasEnd=!1,this.mutate({datesDelta:l,standardProps:a})}},e.prototype.moveStart=function(e){var t=createDuration(e);t&&this.mutate({startDelta:t})},e.prototype.moveEnd=function(e){var t=createDuration(e);t&&this.mutate({endDelta:t})},e.prototype.moveDates=function(e){var t=createDuration(e);t&&this.mutate({datesDelta:t})},e.prototype.setAllDay=function(e,t){void 0===t&&(t={});var n={allDay:e},i=t.maintainDuration;null==i&&(i=this._context.options.allDayMaintainDuration),this._def.allDay!==e&&(n.hasEnd=i),this.mutate({standardProps:n})},e.prototype.formatRange=function(e){var t=this._context.dateEnv,n=this._instance,i=createFormatter(e);return this._def.hasEnd?t.formatRange(n.range.start,n.range.end,i,{forcedStartTzo:n.forcedStartTzo,forcedEndTzo:n.forcedEndTzo}):t.format(n.range.start,i,{forcedTzo:n.forcedStartTzo})},e.prototype.mutate=function(t){var n=this._instance;if(n){var i=this._def,r=this._context,a=getRelevantEvents(r.getCurrentData().eventStore,n.instanceId);a=applyMutationToEventStore(a,{"":{display:"",startEditable:!0,durationEditable:!0,constraints:[],overlap:null,allows:[],backgroundColor:"",borderColor:"",textColor:"",classNames:[]}},t,r);var s=new e(r,i,n);this._def=a.defs[i.defId],this._instance=a.instances[n.instanceId],r.dispatch({type:"MERGE_EVENTS",eventStore:a}),r.emitter.trigger("eventChange",{oldEvent:s,event:this,relatedEvents:buildEventApis(a,r,n),revert:function(){r.dispatch({type:"REMOVE_EVENTS",eventStore:a})}})}},e.prototype.remove=function(){var e=this._context,t=eventApiToStore(this);e.dispatch({type:"REMOVE_EVENTS",eventStore:t}),e.emitter.trigger("eventRemove",{event:this,relatedEvents:[],revert:function(){e.dispatch({type:"MERGE_EVENTS",eventStore:t})}})},Object.defineProperty(e.prototype,"source",{get:function(){var e=this._def.sourceId;return e?new EventSourceApi(this._context,this._context.getCurrentData().eventSources[e]):null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"start",{get:function(){return this._instance?this._context.dateEnv.toDate(this._instance.range.start):null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"end",{get:function(){return this._instance&&this._def.hasEnd?this._context.dateEnv.toDate(this._instance.range.end):null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"startStr",{get:function(){var e=this._instance;return e?this._context.dateEnv.formatIso(e.range.start,{omitTime:this._def.allDay,forcedTzo:e.forcedStartTzo}):""},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"endStr",{get:function(){var e=this._instance;return e&&this._def.hasEnd?this._context.dateEnv.formatIso(e.range.end,{omitTime:this._def.allDay,forcedTzo:e.forcedEndTzo}):""},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._def.publicId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"groupId",{get:function(){return this._def.groupId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"allDay",{get:function(){return this._def.allDay},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"title",{get:function(){return this._def.title},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return this._def.url},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"display",{get:function(){return this._def.ui.display||"auto"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"startEditable",{get:function(){return this._def.ui.startEditable},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"durationEditable",{get:function(){return this._def.ui.durationEditable},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"constraint",{get:function(){return this._def.ui.constraints[0]||null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"overlap",{get:function(){return this._def.ui.overlap},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"allow",{get:function(){return this._def.ui.allows[0]||null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"backgroundColor",{get:function(){return this._def.ui.backgroundColor},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"borderColor",{get:function(){return this._def.ui.borderColor},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textColor",{get:function(){return this._def.ui.textColor},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"classNames",{get:function(){return this._def.ui.classNames},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"extendedProps",{get:function(){return this._def.extendedProps},enumerable:!1,configurable:!0}),e.prototype.toPlainObject=function(e){void 0===e&&(e={});var t=this._def,n=t.ui,i=this.startStr,r=this.endStr,a={};return t.title&&(a.title=t.title),i&&(a.start=i),r&&(a.end=r),t.publicId&&(a.id=t.publicId),t.groupId&&(a.groupId=t.groupId),t.url&&(a.url=t.url),n.display&&"auto"!==n.display&&(a.display=n.display),e.collapseColor&&n.backgroundColor&&n.backgroundColor===n.borderColor?a.color=n.backgroundColor:(n.backgroundColor&&(a.backgroundColor=n.backgroundColor),n.borderColor&&(a.borderColor=n.borderColor)),n.textColor&&(a.textColor=n.textColor),n.classNames.length&&(a.classNames=n.classNames),Object.keys(t.extendedProps).length&&(e.collapseExtendedProps?__assign(a,t.extendedProps):a.extendedProps=t.extendedProps),a},e.prototype.toJSON=function(){return this.toPlainObject()},e}();function eventApiToStore(e){var t,n,i=e._def,r=e._instance;return{defs:(t={},t[i.defId]=i,t),instances:r?(n={},n[r.instanceId]=r,n):{}}}function buildEventApis(e,t,n){var i=e.defs,r=e.instances,a=[],s=n?n.instanceId:"";for(var o in r){var l=r[o],d=i[l.defId];l.instanceId!==s&&a.push(new EventApi(t,d,l))}return a}var calendarSystemClassMap={};function registerCalendarSystem(e,t){calendarSystemClassMap[e]=t}function createCalendarSystem(e){return new calendarSystemClassMap[e]}var GregorianCalendarSystem=function(){function e(){}return e.prototype.getMarkerYear=function(e){return e.getUTCFullYear()},e.prototype.getMarkerMonth=function(e){return e.getUTCMonth()},e.prototype.getMarkerDay=function(e){return e.getUTCDate()},e.prototype.arrayToMarker=function(e){return arrayToUtcDate(e)},e.prototype.markerToArray=function(e){return dateToUtcArray(e)},e}();registerCalendarSystem("gregory",GregorianCalendarSystem);var ISO_RE=/^\s*(\d{4})(-?(\d{2})(-?(\d{2})([T ](\d{2}):?(\d{2})(:?(\d{2})(\.(\d+))?)?(Z|(([-+])(\d{2})(:?(\d{2}))?))?)?)?)?$/;function parse(e){var t=ISO_RE.exec(e);if(t){var n=new Date(Date.UTC(Number(t[1]),t[3]?Number(t[3])-1:0,Number(t[5]||1),Number(t[7]||0),Number(t[8]||0),Number(t[10]||0),t[12]?1e3*Number("0."+t[12]):0));if(isValidDate(n)){var i=null;return t[13]&&(i=("-"===t[15]?-1:1)*(60*Number(t[16]||0)+Number(t[18]||0))),{marker:n,isTimeUnspecified:!t[6],timeZoneOffset:i}}}return null}var DateEnv=function(){function e(e){var t=this.timeZone=e.timeZone,n="local"!==t&&"UTC"!==t;e.namedTimeZoneImpl&&n&&(this.namedTimeZoneImpl=new e.namedTimeZoneImpl(t)),this.canComputeOffset=Boolean(!n||this.namedTimeZoneImpl),this.calendarSystem=createCalendarSystem(e.calendarSystem),this.locale=e.locale,this.weekDow=e.locale.week.dow,this.weekDoy=e.locale.week.doy,"ISO"===e.weekNumberCalculation&&(this.weekDow=1,this.weekDoy=4),"number"==typeof e.firstDay&&(this.weekDow=e.firstDay),"function"==typeof e.weekNumberCalculation&&(this.weekNumberFunc=e.weekNumberCalculation),this.weekText=null!=e.weekText?e.weekText:e.locale.options.weekText,this.cmdFormatter=e.cmdFormatter,this.defaultSeparator=e.defaultSeparator}return e.prototype.createMarker=function(e){var t=this.createMarkerMeta(e);return null===t?null:t.marker},e.prototype.createNowMarker=function(){return this.canComputeOffset?this.timestampToMarker((new Date).valueOf()):arrayToUtcDate(dateToLocalArray(new Date))},e.prototype.createMarkerMeta=function(e){if("string"==typeof e)return this.parse(e);var t=null;return"number"==typeof e?t=this.timestampToMarker(e):e instanceof Date?(e=e.valueOf(),isNaN(e)||(t=this.timestampToMarker(e))):Array.isArray(e)&&(t=arrayToUtcDate(e)),null!==t&&isValidDate(t)?{marker:t,isTimeUnspecified:!1,forcedTzo:null}:null},e.prototype.parse=function(e){var t=parse(e);if(null===t)return null;var n=t.marker,i=null;return null!==t.timeZoneOffset&&(this.canComputeOffset?n=this.timestampToMarker(n.valueOf()-60*t.timeZoneOffset*1e3):i=t.timeZoneOffset),{marker:n,isTimeUnspecified:t.isTimeUnspecified,forcedTzo:i}},e.prototype.getYear=function(e){return this.calendarSystem.getMarkerYear(e)},e.prototype.getMonth=function(e){return this.calendarSystem.getMarkerMonth(e)},e.prototype.add=function(e,t){var n=this.calendarSystem.markerToArray(e);return n[0]+=t.years,n[1]+=t.months,n[2]+=t.days,n[6]+=t.milliseconds,this.calendarSystem.arrayToMarker(n)},e.prototype.subtract=function(e,t){var n=this.calendarSystem.markerToArray(e);return n[0]-=t.years,n[1]-=t.months,n[2]-=t.days,n[6]-=t.milliseconds,this.calendarSystem.arrayToMarker(n)},e.prototype.addYears=function(e,t){var n=this.calendarSystem.markerToArray(e);return n[0]+=t,this.calendarSystem.arrayToMarker(n)},e.prototype.addMonths=function(e,t){var n=this.calendarSystem.markerToArray(e);return n[1]+=t,this.calendarSystem.arrayToMarker(n)},e.prototype.diffWholeYears=function(e,t){var n=this.calendarSystem;return timeAsMs(e)===timeAsMs(t)&&n.getMarkerDay(e)===n.getMarkerDay(t)&&n.getMarkerMonth(e)===n.getMarkerMonth(t)?n.getMarkerYear(t)-n.getMarkerYear(e):null},e.prototype.diffWholeMonths=function(e,t){var n=this.calendarSystem;return timeAsMs(e)===timeAsMs(t)&&n.getMarkerDay(e)===n.getMarkerDay(t)?n.getMarkerMonth(t)-n.getMarkerMonth(e)+12*(n.getMarkerYear(t)-n.getMarkerYear(e)):null},e.prototype.greatestWholeUnit=function(e,t){var n=this.diffWholeYears(e,t);return null!==n?{unit:"year",value:n}:null!==(n=this.diffWholeMonths(e,t))?{unit:"month",value:n}:null!==(n=diffWholeWeeks(e,t))?{unit:"week",value:n}:null!==(n=diffWholeDays(e,t))?{unit:"day",value:n}:isInt(n=diffHours(e,t))?{unit:"hour",value:n}:isInt(n=diffMinutes(e,t))?{unit:"minute",value:n}:isInt(n=diffSeconds(e,t))?{unit:"second",value:n}:{unit:"millisecond",value:t.valueOf()-e.valueOf()}},e.prototype.countDurationsBetween=function(e,t,n){var i;return n.years&&null!==(i=this.diffWholeYears(e,t))?i/asRoughYears(n):n.months&&null!==(i=this.diffWholeMonths(e,t))?i/asRoughMonths(n):n.days&&null!==(i=diffWholeDays(e,t))?i/asRoughDays(n):(t.valueOf()-e.valueOf())/asRoughMs(n)},e.prototype.startOf=function(e,t){return"year"===t?this.startOfYear(e):"month"===t?this.startOfMonth(e):"week"===t?this.startOfWeek(e):"day"===t?startOfDay(e):"hour"===t?startOfHour(e):"minute"===t?startOfMinute(e):"second"===t?startOfSecond(e):void 0},e.prototype.startOfYear=function(e){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(e)])},e.prototype.startOfMonth=function(e){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(e),this.calendarSystem.getMarkerMonth(e)])},e.prototype.startOfWeek=function(e){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(e),this.calendarSystem.getMarkerMonth(e),e.getUTCDate()-(e.getUTCDay()-this.weekDow+7)%7])},e.prototype.computeWeekNumber=function(e){return this.weekNumberFunc?this.weekNumberFunc(this.toDate(e)):weekOfYear(e,this.weekDow,this.weekDoy)},e.prototype.format=function(e,t,n){return void 0===n&&(n={}),t.format({marker:e,timeZoneOffset:null!=n.forcedTzo?n.forcedTzo:this.offsetForMarker(e)},this)},e.prototype.formatRange=function(e,t,n,i){return void 0===i&&(i={}),i.isEndExclusive&&(t=addMs(t,-1)),n.formatRange({marker:e,timeZoneOffset:null!=i.forcedStartTzo?i.forcedStartTzo:this.offsetForMarker(e)},{marker:t,timeZoneOffset:null!=i.forcedEndTzo?i.forcedEndTzo:this.offsetForMarker(t)},this,i.defaultSeparator)},e.prototype.formatIso=function(e,t){void 0===t&&(t={});var n=null;return t.omitTimeZoneOffset||(n=null!=t.forcedTzo?t.forcedTzo:this.offsetForMarker(e)),buildIsoString(e,n,t.omitTime)},e.prototype.timestampToMarker=function(e){return"local"===this.timeZone?arrayToUtcDate(dateToLocalArray(new Date(e))):"UTC"!==this.timeZone&&this.namedTimeZoneImpl?arrayToUtcDate(this.namedTimeZoneImpl.timestampToArray(e)):new Date(e)},e.prototype.offsetForMarker=function(e){return"local"===this.timeZone?-arrayToLocalDate(dateToUtcArray(e)).getTimezoneOffset():"UTC"===this.timeZone?0:this.namedTimeZoneImpl?this.namedTimeZoneImpl.offsetForArray(dateToUtcArray(e)):null},e.prototype.toDate=function(e,t){return"local"===this.timeZone?arrayToLocalDate(dateToUtcArray(e)):"UTC"===this.timeZone?new Date(e.valueOf()):this.namedTimeZoneImpl?new Date(e.valueOf()-1e3*this.namedTimeZoneImpl.offsetForArray(dateToUtcArray(e))*60):new Date(e.valueOf()-(t||0))},e}(),globalLocales=[],RAW_EN_LOCALE={code:"en",week:{dow:0,doy:4},direction:"ltr",buttonText:{prev:"prev",next:"next",prevYear:"prev year",nextYear:"next year",year:"year",today:"today",month:"month",week:"week",day:"day",list:"list"},weekText:"W",allDayText:"all-day",moreLinkText:"more",noEventsText:"No events to display"};function organizeRawLocales(e){for(var t=e.length>0?e[0].code:"en",n=globalLocales.concat(e),i={en:RAW_EN_LOCALE},r=0,a=n;r<a.length;r++){var s=a[r];i[s.code]=s}return{map:i,defaultCode:t}}function buildLocale(e,t){return"object"!=typeof e||Array.isArray(e)?queryLocale(e,t):parseLocale(e.code,[e.code],e)}function queryLocale(e,t){var n=[].concat(e||[]);return parseLocale(e,n,queryRawLocale(n,t)||RAW_EN_LOCALE)}function queryRawLocale(e,t){for(var n=0;n<e.length;n++)for(var i=e[n].toLocaleLowerCase().split("-"),r=i.length;r>0;r--){var a=i.slice(0,r).join("-");if(t[a])return t[a]}return null}function parseLocale(e,t,n){var i=mergeProps([RAW_EN_LOCALE,n],["buttonText"]);delete i.code;var r=i.week;return delete i.week,{codeArg:e,codes:t,week:r,simpleNumberFormat:new Intl.NumberFormat(e),options:i}}var DEF_DEFAULTS={startTime:"09:00",endTime:"17:00",daysOfWeek:[1,2,3,4,5],display:"inverse-background",classNames:"fc-non-business",groupId:"_businessHours"},canVGrowWithinCell;function parseBusinessHours(e,t){return parseEvents(refineInputs(e),null,t)}function refineInputs(e){return(!0===e?[{}]:Array.isArray(e)?e.filter((function(e){return e.daysOfWeek})):"object"==typeof e&&e?[e]:[]).map((function(e){return __assign(__assign({},DEF_DEFAULTS),e)}))}function pointInsideRect(e,t){return e.left>=t.left&&e.left<t.right&&e.top>=t.top&&e.top<t.bottom}function intersectRects(e,t){var n={left:Math.max(e.left,t.left),right:Math.min(e.right,t.right),top:Math.max(e.top,t.top),bottom:Math.min(e.bottom,t.bottom)};return n.left<n.right&&n.top<n.bottom&&n}function constrainPoint(e,t){return{left:Math.min(Math.max(e.left,t.left),t.right),top:Math.min(Math.max(e.top,t.top),t.bottom)}}function getRectCenter(e){return{left:(e.left+e.right)/2,top:(e.top+e.bottom)/2}}function diffPoints(e,t){return{left:e.left-t.left,top:e.top-t.top}}function getCanVGrowWithinCell(){return null==canVGrowWithinCell&&(canVGrowWithinCell=computeCanVGrowWithinCell()),canVGrowWithinCell}function computeCanVGrowWithinCell(){if("undefined"==typeof document)return!0;var e=document.createElement("div");e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.innerHTML="<table><tr><td><div></div></td></tr></table>",e.querySelector("table").style.height="100px",e.querySelector("div").style.height="100%",document.body.appendChild(e);var t=e.querySelector("div").offsetHeight>0;return document.body.removeChild(e),t}var EMPTY_EVENT_STORE=createEmptyEventStore(),Splitter=function(){function e(){this.getKeysForEventDefs=memoize(this._getKeysForEventDefs),this.splitDateSelection=memoize(this._splitDateSpan),this.splitEventStore=memoize(this._splitEventStore),this.splitIndividualUi=memoize(this._splitIndividualUi),this.splitEventDrag=memoize(this._splitInteraction),this.splitEventResize=memoize(this._splitInteraction),this.eventUiBuilders={}}return e.prototype.splitProps=function(e){var t=this,n=this.getKeyInfo(e),i=this.getKeysForEventDefs(e.eventStore),r=this.splitDateSelection(e.dateSelection),a=this.splitIndividualUi(e.eventUiBases,i),s=this.splitEventStore(e.eventStore,i),o=this.splitEventDrag(e.eventDrag),l=this.splitEventResize(e.eventResize),d={};for(var c in this.eventUiBuilders=mapHash(n,(function(e,n){return t.eventUiBuilders[n]||memoize(buildEventUiForKey)})),n){var u=n[c],p=s[c]||EMPTY_EVENT_STORE,f=this.eventUiBuilders[c];d[c]={businessHours:u.businessHours||e.businessHours,dateSelection:r[c]||null,eventStore:p,eventUiBases:f(e.eventUiBases[""],u.ui,a[c]),eventSelection:p.instances[e.eventSelection]?e.eventSelection:"",eventDrag:o[c]||null,eventResize:l[c]||null}}return d},e.prototype._splitDateSpan=function(e){var t={};if(e)for(var n=0,i=this.getKeysForDateSpan(e);n<i.length;n++){t[i[n]]=e}return t},e.prototype._getKeysForEventDefs=function(e){var t=this;return mapHash(e.defs,(function(e){return t.getKeysForEventDef(e)}))},e.prototype._splitEventStore=function(e,t){var n=e.defs,i=e.instances,r={};for(var a in n)for(var s=0,o=t[a];s<o.length;s++){r[p=o[s]]||(r[p]=createEmptyEventStore()),r[p].defs[a]=n[a]}for(var l in i)for(var d=i[l],c=0,u=t[d.defId];c<u.length;c++){var p;r[p=u[c]]&&(r[p].instances[l]=d)}return r},e.prototype._splitIndividualUi=function(e,t){var n={};for(var i in e)if(i)for(var r=0,a=t[i];r<a.length;r++){var s=a[r];n[s]||(n[s]={}),n[s][i]=e[i]}return n},e.prototype._splitInteraction=function(e){var t={};if(e){var n=this._splitEventStore(e.affectedEvents,this._getKeysForEventDefs(e.affectedEvents)),i=this._getKeysForEventDefs(e.mutatedEvents),r=this._splitEventStore(e.mutatedEvents,i),a=function(i){t[i]||(t[i]={affectedEvents:n[i]||EMPTY_EVENT_STORE,mutatedEvents:r[i]||EMPTY_EVENT_STORE,isEvent:e.isEvent})};for(var s in n)a(s);for(var s in r)a(s)}return t},e}();function buildEventUiForKey(e,t,n){var i=[];e&&i.push(e),t&&i.push(t);var r={"":combineEventUis(i)};return n&&__assign(r,n),r}function getDateMeta(e,t,n,i){return{dow:e.getUTCDay(),isDisabled:Boolean(i&&!rangeContainsMarker(i.activeRange,e)),isOther:Boolean(i&&!rangeContainsMarker(i.currentRange,e)),isToday:Boolean(t&&rangeContainsMarker(t,e)),isPast:Boolean(n?e<n:!!t&&e<t.start),isFuture:Boolean(n?e>n:!!t&&e>=t.end)}}function getDayClassNames(e,t){var n=["fc-day","fc-day-"+DAY_IDS[e.dow]];return e.isDisabled?n.push("fc-day-disabled"):(e.isToday&&(n.push("fc-day-today"),n.push(t.getClass("today"))),e.isPast&&n.push("fc-day-past"),e.isFuture&&n.push("fc-day-future"),e.isOther&&n.push("fc-day-other")),n}function buildNavLinkData(e,t){return void 0===t&&(t="day"),JSON.stringify({date:formatDayString(e),type:t})}var _isRtlScrollbarOnLeft=null,_scrollbarWidths;function getIsRtlScrollbarOnLeft(){return null===_isRtlScrollbarOnLeft&&(_isRtlScrollbarOnLeft=computeIsRtlScrollbarOnLeft()),_isRtlScrollbarOnLeft}function computeIsRtlScrollbarOnLeft(){var e=document.createElement("div");applyStyle(e,{position:"absolute",top:-1e3,left:0,border:0,padding:0,overflow:"scroll",direction:"rtl"}),e.innerHTML="<div></div>",document.body.appendChild(e);var t=e.firstChild.getBoundingClientRect().left>e.getBoundingClientRect().left;return removeElement(e),t}function getScrollbarWidths(){return _scrollbarWidths||(_scrollbarWidths=computeScrollbarWidths()),_scrollbarWidths}function computeScrollbarWidths(){var e=document.createElement("div");e.style.overflow="scroll",document.body.appendChild(e);var t=computeScrollbarWidthsForEl(e);return document.body.removeChild(e),t}function computeScrollbarWidthsForEl(e){return{x:e.offsetHeight-e.clientHeight,y:e.offsetWidth-e.clientWidth}}function computeEdges(e,t){void 0===t&&(t=!1);var n=window.getComputedStyle(e),i=parseInt(n.borderLeftWidth,10)||0,r=parseInt(n.borderRightWidth,10)||0,a=parseInt(n.borderTopWidth,10)||0,s=parseInt(n.borderBottomWidth,10)||0,o=computeScrollbarWidthsForEl(e),l=o.y-i-r,d={borderLeft:i,borderRight:r,borderTop:a,borderBottom:s,scrollbarBottom:o.x-a-s,scrollbarLeft:0,scrollbarRight:0};return getIsRtlScrollbarOnLeft()&&"rtl"===n.direction?d.scrollbarLeft=l:d.scrollbarRight=l,t&&(d.paddingLeft=parseInt(n.paddingLeft,10)||0,d.paddingRight=parseInt(n.paddingRight,10)||0,d.paddingTop=parseInt(n.paddingTop,10)||0,d.paddingBottom=parseInt(n.paddingBottom,10)||0),d}function computeInnerRect(e,t,n){void 0===t&&(t=!1);var i=n?e.getBoundingClientRect():computeRect(e),r=computeEdges(e,t),a={left:i.left+r.borderLeft+r.scrollbarLeft,right:i.right-r.borderRight-r.scrollbarRight,top:i.top+r.borderTop,bottom:i.bottom-r.borderBottom-r.scrollbarBottom};return t&&(a.left+=r.paddingLeft,a.right-=r.paddingRight,a.top+=r.paddingTop,a.bottom-=r.paddingBottom),a}function computeRect(e){var t=e.getBoundingClientRect();return{left:t.left+window.pageXOffset,top:t.top+window.pageYOffset,right:t.right+window.pageXOffset,bottom:t.bottom+window.pageYOffset}}function getClippingParents(e){for(var t=[];e instanceof HTMLElement;){var n=window.getComputedStyle(e);if("fixed"===n.position)break;/(auto|scroll)/.test(n.overflow+n.overflowY+n.overflowX)&&t.push(e),e=e.parentNode}return t}function unpromisify(e,t,n){var i=!1,r=function(){i||(i=!0,t.apply(this,arguments))},a=function(){i||(i=!0,n&&n.apply(this,arguments))},s=e(r,a);s&&"function"==typeof s.then&&s.then(r,a)}var Emitter=function(){function e(){this.handlers={},this.thisContext=null}return e.prototype.setThisContext=function(e){this.thisContext=e},e.prototype.setOptions=function(e){this.options=e},e.prototype.on=function(e,t){addToHash(this.handlers,e,t)},e.prototype.off=function(e,t){removeFromHash(this.handlers,e,t)},e.prototype.trigger=function(e){for(var t=arguments,n=[],i=1;i<arguments.length;i++)n[i-1]=t[i];for(var r=this.handlers[e]||[],a=this.options&&this.options[e],s=[].concat(a||[],r),o=0,l=s;o<l.length;o++){var d=l[o];d.apply(this.thisContext,n)}},e.prototype.hasHandlers=function(e){return this.handlers[e]&&this.handlers[e].length||this.options&&this.options[e]},e}();function addToHash(e,t,n){(e[t]||(e[t]=[])).push(n)}function removeFromHash(e,t,n){n?e[t]&&(e[t]=e[t].filter((function(e){return e!==n}))):delete e[t]}var PositionCache=function(){function e(e,t,n,i){this.els=t;var r=this.originClientRect=e.getBoundingClientRect();n&&this.buildElHorizontals(r.left),i&&this.buildElVerticals(r.top)}return e.prototype.buildElHorizontals=function(e){for(var t=[],n=[],i=0,r=this.els;i<r.length;i++){var a=r[i].getBoundingClientRect();t.push(a.left-e),n.push(a.right-e)}this.lefts=t,this.rights=n},e.prototype.buildElVerticals=function(e){for(var t=[],n=[],i=0,r=this.els;i<r.length;i++){var a=r[i].getBoundingClientRect();t.push(a.top-e),n.push(a.bottom-e)}this.tops=t,this.bottoms=n},e.prototype.leftToIndex=function(e){var t,n=this.lefts,i=this.rights,r=n.length;for(t=0;t<r;t++)if(e>=n[t]&&e<i[t])return t},e.prototype.topToIndex=function(e){var t,n=this.tops,i=this.bottoms,r=n.length;for(t=0;t<r;t++)if(e>=n[t]&&e<i[t])return t},e.prototype.getWidth=function(e){return this.rights[e]-this.lefts[e]},e.prototype.getHeight=function(e){return this.bottoms[e]-this.tops[e]},e}(),ScrollController=function(){function e(){}return e.prototype.getMaxScrollTop=function(){return this.getScrollHeight()-this.getClientHeight()},e.prototype.getMaxScrollLeft=function(){return this.getScrollWidth()-this.getClientWidth()},e.prototype.canScrollVertically=function(){return this.getMaxScrollTop()>0},e.prototype.canScrollHorizontally=function(){return this.getMaxScrollLeft()>0},e.prototype.canScrollUp=function(){return this.getScrollTop()>0},e.prototype.canScrollDown=function(){return this.getScrollTop()<this.getMaxScrollTop()},e.prototype.canScrollLeft=function(){return this.getScrollLeft()>0},e.prototype.canScrollRight=function(){return this.getScrollLeft()<this.getMaxScrollLeft()},e}(),ElementScrollController=function(e){function t(t){var n=e.call(this)||this;return n.el=t,n}return __extends(t,e),t.prototype.getScrollTop=function(){return this.el.scrollTop},t.prototype.getScrollLeft=function(){return this.el.scrollLeft},t.prototype.setScrollTop=function(e){this.el.scrollTop=e},t.prototype.setScrollLeft=function(e){this.el.scrollLeft=e},t.prototype.getScrollWidth=function(){return this.el.scrollWidth},t.prototype.getScrollHeight=function(){return this.el.scrollHeight},t.prototype.getClientHeight=function(){return this.el.clientHeight},t.prototype.getClientWidth=function(){return this.el.clientWidth},t}(ScrollController),WindowScrollController=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getScrollTop=function(){return window.pageYOffset},t.prototype.getScrollLeft=function(){return window.pageXOffset},t.prototype.setScrollTop=function(e){window.scroll(window.pageXOffset,e)},t.prototype.setScrollLeft=function(e){window.scroll(e,window.pageYOffset)},t.prototype.getScrollWidth=function(){return document.documentElement.scrollWidth},t.prototype.getScrollHeight=function(){return document.documentElement.scrollHeight},t.prototype.getClientHeight=function(){return document.documentElement.clientHeight},t.prototype.getClientWidth=function(){return document.documentElement.clientWidth},t}(ScrollController),Theme=function(){function e(e){this.iconOverrideOption&&this.setIconOverride(e[this.iconOverrideOption])}return e.prototype.setIconOverride=function(e){var t,n;if("object"==typeof e&&e){for(n in t=__assign({},this.iconClasses),e)t[n]=this.applyIconOverridePrefix(e[n]);this.iconClasses=t}else!1===e&&(this.iconClasses={})},e.prototype.applyIconOverridePrefix=function(e){var t=this.iconOverridePrefix;return t&&0!==e.indexOf(t)&&(e=t+e),e},e.prototype.getClass=function(e){return this.classes[e]||""},e.prototype.getIconClass=function(e,t){var n;return(n=t&&this.rtlIconClasses&&this.rtlIconClasses[e]||this.iconClasses[e])?this.baseIconClass+" "+n:""},e.prototype.getCustomButtonIconClass=function(e){var t;return this.iconOverrideCustomButtonOption&&(t=e[this.iconOverrideCustomButtonOption])?this.baseIconClass+" "+this.applyIconOverridePrefix(t):""},e}();Theme.prototype.classes={},Theme.prototype.iconClasses={},Theme.prototype.baseIconClass="",Theme.prototype.iconOverridePrefix="";var ScrollResponder=function(){function e(e,t,n){var i=this;this.execFunc=e,this.emitter=t,this.scrollTime=n,this.handleScrollRequest=function(e){i.queuedRequest=__assign({},i.queuedRequest||{},e),i.drain()},t.on("_scrollRequest",this.handleScrollRequest),this.fireInitialScroll()}return e.prototype.detach=function(){this.emitter.off("_scrollRequest",this.handleScrollRequest)},e.prototype.update=function(e){e?this.fireInitialScroll():this.drain()},e.prototype.fireInitialScroll=function(){this.handleScrollRequest({time:this.scrollTime})},e.prototype.drain=function(){this.queuedRequest&&this.execFunc(this.queuedRequest)&&(this.queuedRequest=null)},e}(),ViewContextType=createContext$1({});function buildViewContext(e,t,n,i,r,a,s,o,l,d,c,u,p){return{dateEnv:r,options:n,pluginHooks:s,emitter:d,dispatch:o,getCurrentData:l,calendarApi:c,viewSpec:e,viewApi:t,dateProfileGenerator:i,theme:a,isRtl:"rtl"===n.direction,addResizeHandler:function(e){d.on("_resize",e)},removeResizeHandler:function(e){d.off("_resize",e)},createScrollResponder:function(e){return new ScrollResponder(e,d,createDuration(n.scrollTime))},registerInteractiveComponent:u,unregisterInteractiveComponent:p}}var PureComponent=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.shouldComponentUpdate=function(e,t){return this.debug&&console.log(getUnequalProps(e,this.props),getUnequalProps(t,this.state)),!compareObjs(this.props,e,this.propEquality)||!compareObjs(this.state,t,this.stateEquality)},t.addPropsEquality=addPropsEquality,t.addStateEquality=addStateEquality,t.contextType=ViewContextType,t}(Component);PureComponent.prototype.propEquality={},PureComponent.prototype.stateEquality={};var BaseComponent=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.contextType=ViewContextType,t}(PureComponent);function addPropsEquality(e){var t=Object.create(this.prototype.propEquality);__assign(t,e),this.prototype.propEquality=t}function addStateEquality(e){var t=Object.create(this.prototype.stateEquality);__assign(t,e),this.prototype.stateEquality=t}function setRef(e,t){"function"==typeof e?e(t):e&&(e.current=t)}function reduceEventStore(e,t,n,i,r){switch(t.type){case"RECEIVE_EVENTS":return receiveRawEvents(e,n[t.sourceId],t.fetchId,t.fetchRange,t.rawEvents,r);case"ADD_EVENTS":return addEvent(e,t.eventStore,i?i.activeRange:null,r);case"MERGE_EVENTS":return mergeEventStores(e,t.eventStore);case"PREV":case"NEXT":case"CHANGE_DATE":case"CHANGE_VIEW_TYPE":return i?expandRecurring(e,i.activeRange,r):e;case"REMOVE_EVENTS":return excludeSubEventStore(e,t.eventStore);case"REMOVE_EVENT_SOURCE":return excludeEventsBySourceId(e,t.sourceId);case"REMOVE_ALL_EVENT_SOURCES":return filterEventStoreDefs(e,(function(e){return!e.sourceId}));case"REMOVE_ALL_EVENTS":return createEmptyEventStore();default:return e}}function receiveRawEvents(e,t,n,i,r,a){if(t&&n===t.latestFetchId){var s=parseEvents(transformRawEvents(r,t,a),t,a);return i&&(s=expandRecurring(s,i,a)),mergeEventStores(excludeEventsBySourceId(e,t.sourceId),s)}return e}function transformRawEvents(e,t,n){var i=n.options.eventDataTransform,r=t?t.eventDataTransform:null;return r&&(e=transformEachRawEvent(e,r)),i&&(e=transformEachRawEvent(e,i)),e}function transformEachRawEvent(e,t){var n;if(t){n=[];for(var i=0,r=e;i<r.length;i++){var a=r[i],s=t(a);s?n.push(s):null==s&&n.push(a)}}else n=e;return n}function addEvent(e,t,n,i){return n&&(t=expandRecurring(t,n,i)),mergeEventStores(e,t)}function rezoneEventStoreDates(e,t,n){var i=e.defs,r=mapHash(e.instances,(function(e){var r=i[e.defId];return r.allDay||r.recurringDef?e:__assign(__assign({},e),{range:{start:n.createMarker(t.toDate(e.range.start,e.forcedStartTzo)),end:n.createMarker(t.toDate(e.range.end,e.forcedEndTzo))},forcedStartTzo:n.canComputeOffset?null:e.forcedStartTzo,forcedEndTzo:n.canComputeOffset?null:e.forcedEndTzo})}));return{defs:i,instances:r}}function excludeEventsBySourceId(e,t){return filterEventStoreDefs(e,(function(e){return e.sourceId!==t}))}function excludeInstances(e,t){return{defs:e.defs,instances:filterHash(e.instances,(function(e){return!t[e.instanceId]}))}}function isInteractionValid(e,t){return isNewPropsValid({eventDrag:e},t)}function isDateSelectionValid(e,t){return isNewPropsValid({dateSelection:e},t)}function isNewPropsValid(e,t){var n=t.getCurrentData(),i=__assign({businessHours:n.businessHours,dateSelection:"",eventStore:n.eventStore,eventUiBases:n.eventUiBases,eventSelection:"",eventDrag:null,eventResize:null},e);return(t.pluginHooks.isPropsValid||isPropsValid)(i,t)}function isPropsValid(e,t,n,i){return void 0===n&&(n={}),!(e.eventDrag&&!isInteractionPropsValid(e,t,n,i))&&!(e.dateSelection&&!isDateSelectionPropsValid(e,t,n,i))}function isInteractionPropsValid(e,t,n,i){var r=t.getCurrentData(),a=e.eventDrag,s=a.mutatedEvents,o=s.defs,l=s.instances,d=compileEventUis(o,a.isEvent?e.eventUiBases:{"":r.selectionConfig});i&&(d=mapHash(d,i));var c=excludeInstances(e.eventStore,a.affectedEvents.instances),u=c.defs,p=c.instances,f=compileEventUis(u,e.eventUiBases);for(var h in l){var _=l[h],g=_.range,m=d[_.defId],v=o[_.defId];if(!allConstraintsPass(m.constraints,g,c,e.businessHours,t))return!1;var y=t.options.eventOverlap,b="function"==typeof y?y:null;for(var w in p){var E=p[w];if(rangesIntersect(g,E.range)){if(!1===f[E.defId].overlap&&a.isEvent)return!1;if(!1===m.overlap)return!1;if(b&&!b(new EventApi(t,u[E.defId],E),new EventApi(t,v,_)))return!1}}for(var S=r.eventStore,D=0,C=m.allows;D<C.length;D++){var k=C[D],T=__assign(__assign({},n),{range:_.range,allDay:v.allDay}),R=S.defs[v.defId],x=S.instances[h],M=void 0;if(M=R?new EventApi(t,R,x):new EventApi(t,v),!k(buildDateSpanApiWithContext(T,t),M))return!1}}return!0}function isDateSelectionPropsValid(e,t,n,i){var r=e.eventStore,a=r.defs,s=r.instances,o=e.dateSelection,l=o.range,d=t.getCurrentData().selectionConfig;if(i&&(d=i(d)),!allConstraintsPass(d.constraints,l,r,e.businessHours,t))return!1;var c=t.options.selectOverlap,u="function"==typeof c?c:null;for(var p in s){var f=s[p];if(rangesIntersect(l,f.range)){if(!1===d.overlap)return!1;if(u&&!u(new EventApi(t,a[f.defId],f),null))return!1}}for(var h=0,_=d.allows;h<_.length;h++){if(!(0,_[h])(buildDateSpanApiWithContext(__assign(__assign({},n),o),t),null))return!1}return!0}function allConstraintsPass(e,t,n,i,r){for(var a=0,s=e;a<s.length;a++){if(!anyRangesContainRange(constraintToRanges(s[a],t,n,i,r),t))return!1}return!0}function constraintToRanges(e,t,n,i,r){return"businessHours"===e?eventStoreToRanges(expandRecurring(i,t,r)):"string"==typeof e?eventStoreToRanges(filterEventStoreDefs(n,(function(t){return t.groupId===e}))):"object"==typeof e&&e?eventStoreToRanges(expandRecurring(e,t,r)):[]}function eventStoreToRanges(e){var t=e.instances,n=[];for(var i in t)n.push(t[i].range);return n}function anyRangesContainRange(e,t){for(var n=0,i=e;n<i.length;n++){if(rangeContainsRange(i[n],t))return!0}return!1}var DateComponent=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.uid=guid(),t}return __extends(t,e),t.prototype.prepareHits=function(){},t.prototype.queryHit=function(e,t,n,i){return null},t.prototype.isInteractionValid=function(e){var t=this.props.dateProfile,n=e.mutatedEvents.instances;if(t)for(var i in n)if(!rangeContainsRange(t.validRange,n[i].range))return!1;return isInteractionValid(e,this.context)},t.prototype.isDateSelectionValid=function(e){var t=this.props.dateProfile;return!(t&&!rangeContainsRange(t.validRange,e.range))&&isDateSelectionValid(e,this.context)},t.prototype.isValidSegDownEl=function(e){return!this.props.eventDrag&&!this.props.eventResize&&!elementClosest(e,".fc-event-mirror")&&(this.isPopover()||!this.isInPopover(e))},t.prototype.isValidDateDownEl=function(e){return!(elementClosest(e,".fc-event:not(.fc-bg-event)")||elementClosest(e,".fc-daygrid-more-link")||elementClosest(e,"a[data-navlink]")||this.isInPopover(e))},t.prototype.isPopover=function(){return!1},t.prototype.isInPopover=function(e){return Boolean(elementClosest(e,".fc-popover"))},t}(BaseComponent);function createPlugin(e){return{id:guid(),deps:e.deps||[],reducers:e.reducers||[],contextInit:[].concat(e.contextInit||[]),eventRefiners:e.eventRefiners||{},eventDefMemberAdders:e.eventDefMemberAdders||[],eventSourceRefiners:e.eventSourceRefiners||{},isDraggableTransformers:e.isDraggableTransformers||[],eventDragMutationMassagers:e.eventDragMutationMassagers||[],eventDefMutationAppliers:e.eventDefMutationAppliers||[],dateSelectionTransformers:e.dateSelectionTransformers||[],datePointTransforms:e.datePointTransforms||[],dateSpanTransforms:e.dateSpanTransforms||[],views:e.views||{},viewPropsTransformers:e.viewPropsTransformers||[],isPropsValid:e.isPropsValid||null,externalDefTransforms:e.externalDefTransforms||[],eventResizeJoinTransforms:e.eventResizeJoinTransforms||[],viewContainerAppends:e.viewContainerAppends||[],eventDropTransformers:e.eventDropTransformers||[],componentInteractions:e.componentInteractions||[],calendarInteractions:e.calendarInteractions||[],themeClasses:e.themeClasses||{},eventSourceDefs:e.eventSourceDefs||[],cmdFormatter:e.cmdFormatter,recurringTypes:e.recurringTypes||[],namedTimeZonedImpl:e.namedTimeZonedImpl,initialView:e.initialView||"",elementDraggingImpl:e.elementDraggingImpl,optionChangeHandlers:e.optionChangeHandlers||{},scrollGridImpl:e.scrollGridImpl||null,contentTypeHandlers:e.contentTypeHandlers||{},listenerRefiners:e.listenerRefiners||{},optionRefiners:e.optionRefiners||{},propSetHandlers:e.propSetHandlers||{}}}function buildPluginHooks(e,t){var n={},i={reducers:[],contextInit:[],eventRefiners:{},eventDefMemberAdders:[],eventSourceRefiners:{},isDraggableTransformers:[],eventDragMutationMassagers:[],eventDefMutationAppliers:[],dateSelectionTransformers:[],datePointTransforms:[],dateSpanTransforms:[],views:{},viewPropsTransformers:[],isPropsValid:null,externalDefTransforms:[],eventResizeJoinTransforms:[],viewContainerAppends:[],eventDropTransformers:[],componentInteractions:[],calendarInteractions:[],themeClasses:{},eventSourceDefs:[],cmdFormatter:null,recurringTypes:[],namedTimeZonedImpl:null,initialView:"",elementDraggingImpl:null,optionChangeHandlers:{},scrollGridImpl:null,contentTypeHandlers:{},listenerRefiners:{},optionRefiners:{},propSetHandlers:{}};function r(e){for(var t=0,a=e;t<a.length;t++){var s=a[t];n[s.id]||(n[s.id]=!0,r(s.deps),i=combineHooks(i,s))}}return e&&r(e),r(t),i}function buildBuildPluginHooks(){var e,t=[],n=[];return function(i,r){return e&&isArraysEqual(i,t)&&isArraysEqual(r,n)||(e=buildPluginHooks(i,r)),t=i,n=r,e}}function combineHooks(e,t){return{reducers:e.reducers.concat(t.reducers),contextInit:e.contextInit.concat(t.contextInit),eventRefiners:__assign(__assign({},e.eventRefiners),t.eventRefiners),eventDefMemberAdders:e.eventDefMemberAdders.concat(t.eventDefMemberAdders),eventSourceRefiners:__assign(__assign({},e.eventSourceRefiners),t.eventSourceRefiners),isDraggableTransformers:e.isDraggableTransformers.concat(t.isDraggableTransformers),eventDragMutationMassagers:e.eventDragMutationMassagers.concat(t.eventDragMutationMassagers),eventDefMutationAppliers:e.eventDefMutationAppliers.concat(t.eventDefMutationAppliers),dateSelectionTransformers:e.dateSelectionTransformers.concat(t.dateSelectionTransformers),datePointTransforms:e.datePointTransforms.concat(t.datePointTransforms),dateSpanTransforms:e.dateSpanTransforms.concat(t.dateSpanTransforms),views:__assign(__assign({},e.views),t.views),viewPropsTransformers:e.viewPropsTransformers.concat(t.viewPropsTransformers),isPropsValid:t.isPropsValid||e.isPropsValid,externalDefTransforms:e.externalDefTransforms.concat(t.externalDefTransforms),eventResizeJoinTransforms:e.eventResizeJoinTransforms.concat(t.eventResizeJoinTransforms),viewContainerAppends:e.viewContainerAppends.concat(t.viewContainerAppends),eventDropTransformers:e.eventDropTransformers.concat(t.eventDropTransformers),calendarInteractions:e.calendarInteractions.concat(t.calendarInteractions),componentInteractions:e.componentInteractions.concat(t.componentInteractions),themeClasses:__assign(__assign({},e.themeClasses),t.themeClasses),eventSourceDefs:e.eventSourceDefs.concat(t.eventSourceDefs),cmdFormatter:t.cmdFormatter||e.cmdFormatter,recurringTypes:e.recurringTypes.concat(t.recurringTypes),namedTimeZonedImpl:t.namedTimeZonedImpl||e.namedTimeZonedImpl,initialView:e.initialView||t.initialView,elementDraggingImpl:e.elementDraggingImpl||t.elementDraggingImpl,optionChangeHandlers:__assign(__assign({},e.optionChangeHandlers),t.optionChangeHandlers),scrollGridImpl:t.scrollGridImpl||e.scrollGridImpl,contentTypeHandlers:__assign(__assign({},e.contentTypeHandlers),t.contentTypeHandlers),listenerRefiners:__assign(__assign({},e.listenerRefiners),t.listenerRefiners),optionRefiners:__assign(__assign({},e.optionRefiners),t.optionRefiners),propSetHandlers:__assign(__assign({},e.propSetHandlers),t.propSetHandlers)}}var StandardTheme=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(Theme);function compileViewDefs(e,t){var n,i={};for(n in e)ensureViewDef(n,i,e,t);for(n in t)ensureViewDef(n,i,e,t);return i}function ensureViewDef(e,t,n,i){if(t[e])return t[e];var r=buildViewDef(e,t,n,i);return r&&(t[e]=r),r}function buildViewDef(e,t,n,i){var r=n[e],a=i[e],s=function(e){return r&&null!==r[e]?r[e]:a&&null!==a[e]?a[e]:null},o=s("component"),l=s("superType"),d=null;if(l){if(l===e)throw new Error("Can't have a custom view type that references itself");d=ensureViewDef(l,t,n,i)}return!o&&d&&(o=d.component),o?{type:e,component:o,defaults:__assign(__assign({},d?d.defaults:{}),r?r.rawOptions:{}),overrides:__assign(__assign({},d?d.overrides:{}),a?a.rawOptions:{})}:null}StandardTheme.prototype.classes={root:"fc-theme-standard",tableCellShaded:"fc-cell-shaded",buttonGroup:"fc-button-group",button:"fc-button fc-button-primary",buttonActive:"fc-button-active"},StandardTheme.prototype.baseIconClass="fc-icon",StandardTheme.prototype.iconClasses={close:"fc-icon-x",prev:"fc-icon-chevron-left",next:"fc-icon-chevron-right",prevYear:"fc-icon-chevrons-left",nextYear:"fc-icon-chevrons-right"},StandardTheme.prototype.rtlIconClasses={prev:"fc-icon-chevron-right",next:"fc-icon-chevron-left",prevYear:"fc-icon-chevrons-right",nextYear:"fc-icon-chevrons-left"},StandardTheme.prototype.iconOverrideOption="buttonIcons",StandardTheme.prototype.iconOverrideCustomButtonOption="icon",StandardTheme.prototype.iconOverridePrefix="fc-icon-";var RenderHook=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.rootElRef=createRef(),t.handleRootEl=function(e){setRef(t.rootElRef,e),t.props.elRef&&setRef(t.props.elRef,e)},t}return __extends(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.hookProps;return createElement(MountHook,{hookProps:n,didMount:t.didMount,willUnmount:t.willUnmount,elRef:this.handleRootEl},(function(i){return createElement(ContentHook,{hookProps:n,content:t.content,defaultContent:t.defaultContent,backupElRef:e.rootElRef},(function(e,r){return t.children(i,normalizeClassNames(t.classNames,n),e,r)}))}))},t}(BaseComponent),CustomContentRenderContext=createContext$1(0);function ContentHook(e){return createElement(CustomContentRenderContext.Consumer,null,(function(t){return createElement(ContentHookInner,__assign({renderId:t},e))}))}var ContentHookInner=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.innerElRef=createRef(),t}return __extends(t,e),t.prototype.render=function(){return this.props.children(this.innerElRef,this.renderInnerContent())},t.prototype.componentDidMount=function(){this.updateCustomContent()},t.prototype.componentDidUpdate=function(){this.updateCustomContent()},t.prototype.renderInnerContent=function(){var e=this.context.pluginHooks.contentTypeHandlers,t=this.props,n=this.customContentInfo,i=normalizeContent(t.content,t.hookProps),r=null;if(void 0===i&&(i=normalizeContent(t.defaultContent,t.hookProps)),void 0!==i){if(n)n.contentVal=i[n.contentKey];else if("object"==typeof i)for(var a in e)if(void 0!==i[a]){n=this.customContentInfo={contentKey:a,contentVal:i[a],handler:e[a]()};break}r=n?[]:i}return r},t.prototype.updateCustomContent=function(){this.customContentInfo&&this.customContentInfo.handler(this.innerElRef.current||this.props.backupElRef.current,this.customContentInfo.contentVal)},t}(BaseComponent),MountHook=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleRootEl=function(e){t.rootEl=e,t.props.elRef&&setRef(t.props.elRef,e)},t}return __extends(t,e),t.prototype.render=function(){return this.props.children(this.handleRootEl)},t.prototype.componentDidMount=function(){var e=this.props.didMount;e&&e(__assign(__assign({},this.props.hookProps),{el:this.rootEl}))},t.prototype.componentWillUnmount=function(){var e=this.props.willUnmount;e&&e(__assign(__assign({},this.props.hookProps),{el:this.rootEl}))},t}(BaseComponent);function buildClassNameNormalizer(){var e,t,n=[];return function(i,r){return t&&isPropsEqual(t,r)&&i===e||(e=i,t=r,n=normalizeClassNames(i,r)),n}}function normalizeClassNames(e,t){return"function"==typeof e&&(e=e(t)),parseClassNames(e)}function normalizeContent(e,t){return"function"==typeof e?e(t,createElement):e}var ViewRoot=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.normalizeClassNames=buildClassNameNormalizer(),t}return __extends(t,e),t.prototype.render=function(){var e=this.props,t=this.context,n=t.options,i={view:t.viewApi},r=this.normalizeClassNames(n.viewClassNames,i);return createElement(MountHook,{hookProps:i,didMount:n.viewDidMount,willUnmount:n.viewWillUnmount,elRef:e.elRef},(function(t){return e.children(t,["fc-"+e.viewSpec.type+"-view","fc-view"].concat(r))}))},t}(BaseComponent);function parseViewConfigs(e){return mapHash(e,parseViewConfig)}function parseViewConfig(e){var t="function"==typeof e?{component:e}:e,n=t.component;return t.content&&(n=createViewHookComponent(t)),{superType:t.type,component:n,rawOptions:t}}function createViewHookComponent(e){return function(t){return createElement(ViewContextType.Consumer,null,(function(n){return createElement(ViewRoot,{viewSpec:n.viewSpec},(function(i,r){var a=__assign(__assign({},t),{nextDayThreshold:n.options.nextDayThreshold});return createElement(RenderHook,{hookProps:a,classNames:e.classNames,content:e.content,didMount:e.didMount,willUnmount:e.willUnmount,elRef:i},(function(e,t,n,i){return createElement("div",{className:r.concat(t).join(" "),ref:e},i)}))}))}))}}function buildViewSpecs(e,t,n,i){var r=parseViewConfigs(e),a=parseViewConfigs(t.views);return mapHash(compileViewDefs(r,a),(function(e){return buildViewSpec(e,a,t,n,i)}))}function buildViewSpec(e,t,n,i,r){var a=e.overrides.duration||e.defaults.duration||i.duration||n.duration,s=null,o="",l="",d={};if(a&&(s=createDurationCached(a))){var c=greatestDurationDenominator(s);o=c.unit,1===c.value&&(l=o,d=t[o]?t[o].rawOptions:{})}var u=function(t){var n=t.buttonText||{},i=e.defaults.buttonTextKey;return null!=i&&null!=n[i]?n[i]:null!=n[e.type]?n[e.type]:null!=n[l]?n[l]:void 0};return{type:e.type,component:e.component,duration:s,durationUnit:o,singleUnit:l,optionDefaults:e.defaults,optionOverrides:__assign(__assign({},d),e.overrides),buttonTextOverride:u(i)||u(n)||e.overrides.buttonText,buttonTextDefault:u(r)||e.defaults.buttonText||u(BASE_OPTION_DEFAULTS)||e.type}}var durationInputMap={};function createDurationCached(e){var t=JSON.stringify(e),n=durationInputMap[t];return void 0===n&&(n=createDuration(e),durationInputMap[t]=n),n}var DateProfileGenerator=function(){function e(e){this.props=e,this.nowDate=getNow(e.nowInput,e.dateEnv),this.initHiddenDays()}return e.prototype.buildPrev=function(e,t,n){var i=this.props.dateEnv,r=i.subtract(i.startOf(t,e.currentRangeUnit),e.dateIncrement);return this.build(r,-1,n)},e.prototype.buildNext=function(e,t,n){var i=this.props.dateEnv,r=i.add(i.startOf(t,e.currentRangeUnit),e.dateIncrement);return this.build(r,1,n)},e.prototype.build=function(e,t,n){void 0===n&&(n=!0);var i,r,a,s,o,l,d=this.props;return i=this.buildValidRange(),i=this.trimHiddenDays(i),n&&(e=constrainMarkerToRange(e,i)),r=this.buildCurrentRangeInfo(e,t),a=/^(year|month|week|day)$/.test(r.unit),s=this.buildRenderRange(this.trimHiddenDays(r.range),r.unit,a),o=s=this.trimHiddenDays(s),d.showNonCurrentDates||(o=intersectRanges(o,r.range)),o=intersectRanges(o=this.adjustActiveRange(o),i),l=rangesIntersect(r.range,i),{validRange:i,currentRange:r.range,currentRangeUnit:r.unit,isRangeAllDay:a,activeRange:o,renderRange:s,slotMinTime:d.slotMinTime,slotMaxTime:d.slotMaxTime,isValid:l,dateIncrement:this.buildDateIncrement(r.duration)}},e.prototype.buildValidRange=function(){var e=this.props.validRangeInput,t="function"==typeof e?e.call(this.props.calendarApi,this.nowDate):e;return this.refineRange(t)||{start:null,end:null}},e.prototype.buildCurrentRangeInfo=function(e,t){var n,i=this.props,r=null,a=null,s=null;return i.duration?(r=i.duration,a=i.durationUnit,s=this.buildRangeFromDuration(e,t,r,a)):(n=this.props.dayCount)?(a="day",s=this.buildRangeFromDayCount(e,t,n)):(s=this.buildCustomVisibleRange(e))?a=i.dateEnv.greatestWholeUnit(s.start,s.end).unit:(a=greatestDurationDenominator(r=this.getFallbackDuration()).unit,s=this.buildRangeFromDuration(e,t,r,a)),{duration:r,unit:a,range:s}},e.prototype.getFallbackDuration=function(){return createDuration({day:1})},e.prototype.adjustActiveRange=function(e){var t=this.props,n=t.dateEnv,i=t.usesMinMaxTime,r=t.slotMinTime,a=t.slotMaxTime,s=e.start,o=e.end;return i&&(asRoughDays(r)<0&&(s=startOfDay(s),s=n.add(s,r)),asRoughDays(a)>1&&(o=addDays(o=startOfDay(o),-1),o=n.add(o,a))),{start:s,end:o}},e.prototype.buildRangeFromDuration=function(e,t,n,i){var r,a,s,o=this.props,l=o.dateEnv,d=o.dateAlignment;if(!d){var c=this.props.dateIncrement;d=c&&asRoughMs(c)<asRoughMs(n)?greatestDurationDenominator(c).unit:i}function u(){r=l.startOf(e,d),a=l.add(r,n),s={start:r,end:a}}return asRoughDays(n)<=1&&this.isHiddenDay(r)&&(r=startOfDay(r=this.skipHiddenDays(r,t))),u(),this.trimHiddenDays(s)||(e=this.skipHiddenDays(e,t),u()),s},e.prototype.buildRangeFromDayCount=function(e,t,n){var i,r=this.props,a=r.dateEnv,s=r.dateAlignment,o=0,l=e;s&&(l=a.startOf(l,s)),l=startOfDay(l),i=l=this.skipHiddenDays(l,t);do{i=addDays(i,1),this.isHiddenDay(i)||o++}while(o<n);return{start:l,end:i}},e.prototype.buildCustomVisibleRange=function(e){var t=this.props,n=t.visibleRangeInput,i="function"==typeof n?n.call(t.calendarApi,t.dateEnv.toDate(e)):n,r=this.refineRange(i);return!r||null!=r.start&&null!=r.end?r:null},e.prototype.buildRenderRange=function(e,t,n){return e},e.prototype.buildDateIncrement=function(e){var t,n=this.props.dateIncrement;return n||((t=this.props.dateAlignment)?createDuration(1,t):e||createDuration({days:1}))},e.prototype.refineRange=function(e){if(e){var t=parseRange(e,this.props.dateEnv);return t&&(t=computeVisibleDayRange(t)),t}return null},e.prototype.initHiddenDays=function(){var e,t=this.props.hiddenDays||[],n=[],i=0;for(!1===this.props.weekends&&t.push(0,6),e=0;e<7;e++)(n[e]=-1!==t.indexOf(e))||i++;if(!i)throw new Error("invalid hiddenDays");this.isHiddenDayHash=n},e.prototype.trimHiddenDays=function(e){var t=e.start,n=e.end;return t&&(t=this.skipHiddenDays(t)),n&&(n=this.skipHiddenDays(n,-1,!0)),null==t||null==n||t<n?{start:t,end:n}:null},e.prototype.isHiddenDay=function(e){return e instanceof Date&&(e=e.getUTCDay()),this.isHiddenDayHash[e]},e.prototype.skipHiddenDays=function(e,t,n){for(void 0===t&&(t=1),void 0===n&&(n=!1);this.isHiddenDayHash[(e.getUTCDay()+(n?t:0)+7)%7];)e=addDays(e,t);return e},e}();function reduceViewType(e,t){switch(t.type){case"CHANGE_VIEW_TYPE":return t.viewType}return e}function reduceDynamicOptionOverrides(e,t){var n;switch(t.type){case"SET_OPTION":return __assign(__assign({},e),((n={})[t.optionName]=t.rawOptionValue,n));default:return e}}function reduceDateProfile(e,t,n,i){var r;switch(t.type){case"CHANGE_VIEW_TYPE":return i.build(t.dateMarker||n);case"CHANGE_DATE":if(!e.activeRange||!rangeContainsMarker(e.currentRange,t.dateMarker))return i.build(t.dateMarker);break;case"PREV":if((r=i.buildPrev(e,n)).isValid)return r;break;case"NEXT":if((r=i.buildNext(e,n)).isValid)return r}return e}function initEventSources(e,t,n){var i=t?t.activeRange:null;return addSources({},parseInitialSources(e,n),i,n)}function reduceEventSources(e,t,n,i){var r=n?n.activeRange:null;switch(t.type){case"ADD_EVENT_SOURCES":return addSources(e,t.sources,r,i);case"REMOVE_EVENT_SOURCE":return removeSource(e,t.sourceId);case"PREV":case"NEXT":case"CHANGE_DATE":case"CHANGE_VIEW_TYPE":return n?fetchDirtySources(e,r,i):e;case"FETCH_EVENT_SOURCES":return fetchSourcesByIds(e,t.sourceIds?arrayToHash(t.sourceIds):excludeStaticSources(e,i),r,i);case"RECEIVE_EVENTS":case"RECEIVE_EVENT_ERROR":return receiveResponse(e,t.sourceId,t.fetchId,t.fetchRange);case"REMOVE_ALL_EVENT_SOURCES":return{};default:return e}}function reduceEventSourcesNewTimeZone(e,t,n){var i=t?t.activeRange:null;return fetchSourcesByIds(e,excludeStaticSources(e,n),i,n)}function computeEventSourceLoadingLevel(e){var t=0;for(var n in e)e[n].isFetching&&t++;return t}function addSources(e,t,n,i){for(var r={},a=0,s=t;a<s.length;a++){var o=s[a];r[o.sourceId]=o}return n&&(r=fetchDirtySources(r,n,i)),__assign(__assign({},e),r)}function removeSource(e,t){return filterHash(e,(function(e){return e.sourceId!==t}))}function fetchDirtySources(e,t,n){return fetchSourcesByIds(e,filterHash(e,(function(e){return isSourceDirty(e,t,n)})),t,n)}function isSourceDirty(e,t,n){return doesSourceNeedRange(e,n)?!n.options.lazyFetching||!e.fetchRange||e.isFetching||t.start<e.fetchRange.start||t.end>e.fetchRange.end:!e.latestFetchId}function fetchSourcesByIds(e,t,n,i){var r={};for(var a in e){var s=e[a];t[a]?r[a]=fetchSource(s,n,i):r[a]=s}return r}function fetchSource(e,t,n){var i=n.options,r=n.calendarApi,a=n.pluginHooks.eventSourceDefs[e.sourceDefId],s=guid();return a.fetch({eventSource:e,range:t,context:n},(function(a){var o=a.rawEvents;i.eventSourceSuccess&&(o=i.eventSourceSuccess.call(r,o,a.xhr)||o),e.success&&(o=e.success.call(r,o,a.xhr)||o),n.dispatch({type:"RECEIVE_EVENTS",sourceId:e.sourceId,fetchId:s,fetchRange:t,rawEvents:o})}),(function(a){console.warn(a.message,a),i.eventSourceFailure&&i.eventSourceFailure.call(r,a),e.failure&&e.failure(a),n.dispatch({type:"RECEIVE_EVENT_ERROR",sourceId:e.sourceId,fetchId:s,fetchRange:t,error:a})})),__assign(__assign({},e),{isFetching:!0,latestFetchId:s})}function receiveResponse(e,t,n,i){var r,a=e[t];return a&&n===a.latestFetchId?__assign(__assign({},e),((r={})[t]=__assign(__assign({},a),{isFetching:!1,fetchRange:i}),r)):e}function excludeStaticSources(e,t){return filterHash(e,(function(e){return doesSourceNeedRange(e,t)}))}function parseInitialSources(e,t){var n=buildEventSourceRefiners(t),i=[].concat(e.eventSources||[]),r=[];e.initialEvents&&i.unshift(e.initialEvents),e.events&&i.unshift(e.events);for(var a=0,s=i;a<s.length;a++){var o=parseEventSource(s[a],t,n);o&&r.push(o)}return r}function doesSourceNeedRange(e,t){return!t.pluginHooks.eventSourceDefs[e.sourceDefId].ignoreRange}function reduceDateSelection(e,t){switch(t.type){case"UNSELECT_DATES":return null;case"SELECT_DATES":return t.selection;default:return e}}function reduceSelectedEvent(e,t){switch(t.type){case"UNSELECT_EVENT":return"";case"SELECT_EVENT":return t.eventInstanceId;default:return e}}function reduceEventDrag(e,t){var n;switch(t.type){case"UNSET_EVENT_DRAG":return null;case"SET_EVENT_DRAG":return{affectedEvents:(n=t.state).affectedEvents,mutatedEvents:n.mutatedEvents,isEvent:n.isEvent};default:return e}}function reduceEventResize(e,t){var n;switch(t.type){case"UNSET_EVENT_RESIZE":return null;case"SET_EVENT_RESIZE":return{affectedEvents:(n=t.state).affectedEvents,mutatedEvents:n.mutatedEvents,isEvent:n.isEvent};default:return e}}function parseToolbars(e,t,n,i,r){var a=[];return{headerToolbar:e.headerToolbar?parseToolbar(e.headerToolbar,e,t,n,i,r,a):null,footerToolbar:e.footerToolbar?parseToolbar(e.footerToolbar,e,t,n,i,r,a):null,viewsWithButtons:a}}function parseToolbar(e,t,n,i,r,a,s){return mapHash(e,(function(e){return parseSection(e,t,n,i,r,a,s)}))}function parseSection(e,t,n,i,r,a,s){var o="rtl"===t.direction,l=t.customButtons||{},d=n.buttonText||{},c=t.buttonText||{};return(e?e.split(" "):[]).map((function(e){return e.split(",").map((function(e){if("title"===e)return{buttonName:e};var t,n=void 0,u=void 0,p=void 0,f=void 0;return(t=l[e])?(u=function(e){t.click&&t.click.call(e.target,e,e.target)},(p=i.getCustomButtonIconClass(t))||(p=i.getIconClass(e,o))||(f=t.text)):(n=r[e])?(s.push(e),u=function(){a.changeView(e)},(f=n.buttonTextOverride)||(p=i.getIconClass(e,o))||(f=n.buttonTextDefault)):a[e]&&(u=function(){a[e]()},(f=d[e])||(p=i.getIconClass(e,o))||(f=c[e])),{buttonName:e,buttonClick:u,buttonIcon:p,buttonText:f}}))}))}var eventSourceDef={ignoreRange:!0,parseMeta:function(e){return Array.isArray(e.events)?e.events:null},fetch:function(e,t){t({rawEvents:e.eventSource.meta})}},arrayEventSourcePlugin=createPlugin({eventSourceDefs:[eventSourceDef]}),eventSourceDef$1={parseMeta:function(e){return"function"==typeof e.events?e.events:null},fetch:function(e,t,n){var i=e.context.dateEnv;unpromisify(e.eventSource.meta.bind(null,buildRangeApiWithTimeZone(e.range,i)),(function(e){t({rawEvents:e})}),n)}},funcEventSourcePlugin=createPlugin({eventSourceDefs:[eventSourceDef$1]});function requestJson(e,t,n,i,r){var a=null;"GET"===(e=e.toUpperCase())?t=injectQueryStringParams(t,n):a=encodeParams(n);var s=new XMLHttpRequest;s.open(e,t,!0),"GET"!==e&&s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.onload=function(){if(s.status>=200&&s.status<400){var e=!1,t=void 0;try{t=JSON.parse(s.responseText),e=!0}catch(e){}e?i(t,s):r("Failure parsing JSON",s)}else r("Request failed",s)},s.onerror=function(){r("Request failed",s)},s.send(a)}function injectQueryStringParams(e,t){return e+(-1===e.indexOf("?")?"?":"&")+encodeParams(t)}function encodeParams(e){var t=[];for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")}var JSON_FEED_EVENT_SOURCE_REFINERS={method:String,extraParams:identity,startParam:String,endParam:String,timeZoneParam:String},eventSourceDef$2={parseMeta:function(e){return e.url?{url:e.url,method:(e.method||"GET").toUpperCase(),extraParams:e.extraParams,startParam:e.startParam,endParam:e.endParam,timeZoneParam:e.timeZoneParam}:null},fetch:function(e,t,n){var i=e.eventSource.meta,r=buildRequestParams(i,e.range,e.context);requestJson(i.method,i.url,r,(function(e,n){t({rawEvents:e,xhr:n})}),(function(e,t){n({message:e,xhr:t})}))}},jsonFeedEventSourcePlugin=createPlugin({eventSourceRefiners:JSON_FEED_EVENT_SOURCE_REFINERS,eventSourceDefs:[eventSourceDef$2]});function buildRequestParams(e,t,n){var i,r,a,s,o=n.dateEnv,l=n.options,d={};return null==(i=e.startParam)&&(i=l.startParam),null==(r=e.endParam)&&(r=l.endParam),null==(a=e.timeZoneParam)&&(a=l.timeZoneParam),s="function"==typeof e.extraParams?e.extraParams():e.extraParams||{},__assign(d,s),d[i]=o.formatIso(t.start),d[r]=o.formatIso(t.end),"local"!==o.timeZone&&(d[a]=o.timeZone),d}var SIMPLE_RECURRING_REFINERS={daysOfWeek:identity,startTime:createDuration,endTime:createDuration,duration:createDuration,startRecur:identity,endRecur:identity},recurring={parse:function(e,t){if(e.daysOfWeek||e.startTime||e.endTime||e.startRecur||e.endRecur){var n={daysOfWeek:e.daysOfWeek||null,startTime:e.startTime||null,endTime:e.endTime||null,startRecur:e.startRecur?t.createMarker(e.startRecur):null,endRecur:e.endRecur?t.createMarker(e.endRecur):null},i=void 0;return e.duration&&(i=e.duration),!i&&e.startTime&&e.endTime&&(i=subtractDurations(e.endTime,e.startTime)),{allDayGuess:Boolean(!e.startTime&&!e.endTime),duration:i,typeData:n}}return null},expand:function(e,t,n){var i=intersectRanges(t,{start:e.startRecur,end:e.endRecur});return i?expandRanges(e.daysOfWeek,e.startTime,i,n):[]}},simpleRecurringEventsPlugin=createPlugin({recurringTypes:[recurring],eventRefiners:SIMPLE_RECURRING_REFINERS});function expandRanges(e,t,n,i){for(var r=e?arrayToHash(e):null,a=startOfDay(n.start),s=n.end,o=[];a<s;){var l=void 0;r&&!r[a.getUTCDay()]||(l=t?i.add(a,t):a,o.push(l)),a=addDays(a,1)}return o}var changeHandlerPlugin=createPlugin({optionChangeHandlers:{events:function(e,t){handleEventSources([e],t)},eventSources:handleEventSources}});function handleEventSources(e,t){for(var n=hashValuesToArray(t.getCurrentData().eventSources),i=[],r=0,a=e;r<a.length;r++){for(var s=a[r],o=!1,l=0;l<n.length;l++)if(n[l]._raw===s){n.splice(l,1),o=!0;break}o||i.push(s)}for(var d=0,c=n;d<c.length;d++){var u=c[d];t.dispatch({type:"REMOVE_EVENT_SOURCE",sourceId:u.sourceId})}for(var p=0,f=i;p<f.length;p++){var h=f[p];t.calendarApi.addEventSource(h)}}function handleDateProfile(e,t){t.emitter.trigger("datesSet",__assign(__assign({},buildRangeApiWithTimeZone(e.activeRange,t.dateEnv)),{view:t.viewApi}))}function handleEventStore(e,t){var n=t.emitter;n.hasHandlers("eventsSet")&&n.trigger("eventsSet",buildEventApis(e,t))}var globalPlugins=[arrayEventSourcePlugin,funcEventSourcePlugin,jsonFeedEventSourcePlugin,simpleRecurringEventsPlugin,changeHandlerPlugin,createPlugin({contentTypeHandlers:{html:function(){return injectHtml},domNodes:function(){return injectDomNodes}},propSetHandlers:{dateProfile:handleDateProfile,eventStore:handleEventStore}})];function injectHtml(e,t){e.innerHTML=t}function injectDomNodes(e,t){var n=Array.prototype.slice.call(e.childNodes),i=Array.prototype.slice.call(t);if(!isArraysEqual(n,i)){for(var r=0,a=i;r<a.length;r++){var s=a[r];e.appendChild(s)}n.forEach(removeElement)}}var DelayedRunner=function(){function e(e){this.drainedOption=e,this.isRunning=!1,this.isDirty=!1,this.pauseDepths={},this.timeoutId=0}return e.prototype.request=function(e){this.isDirty=!0,this.isPaused()||(this.clearTimeout(),null==e?this.tryDrain():this.timeoutId=setTimeout(this.tryDrain.bind(this),e))},e.prototype.pause=function(e){void 0===e&&(e="");var t=this.pauseDepths;t[e]=(t[e]||0)+1,this.clearTimeout()},e.prototype.resume=function(e,t){void 0===e&&(e="");var n=this.pauseDepths;if(e in n){if(t)delete n[e];else--n[e]<=0&&delete n[e];this.tryDrain()}},e.prototype.isPaused=function(){return Object.keys(this.pauseDepths).length},e.prototype.tryDrain=function(){if(!this.isRunning&&!this.isPaused()){for(this.isRunning=!0;this.isDirty;)this.isDirty=!1,this.drained();this.isRunning=!1}},e.prototype.clear=function(){this.clearTimeout(),this.isDirty=!1,this.pauseDepths={}},e.prototype.clearTimeout=function(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=0)},e.prototype.drained=function(){this.drainedOption&&this.drainedOption()},e}(),TaskRunner=function(){function e(e,t){this.runTaskOption=e,this.drainedOption=t,this.queue=[],this.delayedRunner=new DelayedRunner(this.drain.bind(this))}return e.prototype.request=function(e,t){this.queue.push(e),this.delayedRunner.request(t)},e.prototype.pause=function(e){this.delayedRunner.pause(e)},e.prototype.resume=function(e,t){this.delayedRunner.resume(e,t)},e.prototype.drain=function(){for(var e=this.queue;e.length;){for(var t=[],n=void 0;n=e.shift();)this.runTask(n),t.push(n);this.drained(t)}},e.prototype.runTask=function(e){this.runTaskOption&&this.runTaskOption(e)},e.prototype.drained=function(e){this.drainedOption&&this.drainedOption(e)},e}();function buildTitle(e,t,n){var i;return i=/^(year|month)$/.test(e.currentRangeUnit)?e.currentRange:e.activeRange,n.formatRange(i.start,i.end,createFormatter(t.titleFormat||buildTitleFormat(e)),{isEndExclusive:e.isRangeAllDay,defaultSeparator:t.titleRangeSeparator})}function buildTitleFormat(e){var t=e.currentRangeUnit;if("year"===t)return{year:"numeric"};if("month"===t)return{year:"numeric",month:"long"};var n=diffWholeDays(e.currentRange.start,e.currentRange.end);return null!==n&&n>1?{year:"numeric",month:"short",day:"numeric"}:{year:"numeric",month:"long",day:"numeric"}}var CalendarDataManager=function(){function e(e){var t=this;this.computeOptionsData=memoize(this._computeOptionsData),this.computeCurrentViewData=memoize(this._computeCurrentViewData),this.organizeRawLocales=memoize(organizeRawLocales),this.buildLocale=memoize(buildLocale),this.buildPluginHooks=buildBuildPluginHooks(),this.buildDateEnv=memoize(buildDateEnv$1),this.buildTheme=memoize(buildTheme),this.parseToolbars=memoize(parseToolbars),this.buildViewSpecs=memoize(buildViewSpecs),this.buildDateProfileGenerator=memoizeObjArg(buildDateProfileGenerator),this.buildViewApi=memoize(buildViewApi),this.buildViewUiProps=memoizeObjArg(buildViewUiProps),this.buildEventUiBySource=memoize(buildEventUiBySource,isPropsEqual),this.buildEventUiBases=memoize(buildEventUiBases),this.parseContextBusinessHours=memoizeObjArg(parseContextBusinessHours),this.buildTitle=memoize(buildTitle),this.emitter=new Emitter,this.actionRunner=new TaskRunner(this._handleAction.bind(this),this.updateData.bind(this)),this.currentCalendarOptionsInput={},this.currentCalendarOptionsRefined={},this.currentViewOptionsInput={},this.currentViewOptionsRefined={},this.currentCalendarOptionsRefiners={},this.getCurrentData=function(){return t.data},this.dispatch=function(e){t.actionRunner.request(e)},this.props=e,this.actionRunner.pause();var n={},i=this.computeOptionsData(e.optionOverrides,n,e.calendarApi),r=i.calendarOptions.initialView||i.pluginHooks.initialView,a=this.computeCurrentViewData(r,i,e.optionOverrides,n);e.calendarApi.currentDataManager=this,this.emitter.setThisContext(e.calendarApi),this.emitter.setOptions(a.options);var s=getInitialDate(i.calendarOptions,i.dateEnv),o=a.dateProfileGenerator.build(s);rangeContainsMarker(o.activeRange,s)||(s=o.currentRange.start);for(var l={dateEnv:i.dateEnv,options:i.calendarOptions,pluginHooks:i.pluginHooks,calendarApi:e.calendarApi,dispatch:this.dispatch,emitter:this.emitter,getCurrentData:this.getCurrentData},d=0,c=i.pluginHooks.contextInit;d<c.length;d++){(0,c[d])(l)}for(var u=initEventSources(i.calendarOptions,o,l),p={dynamicOptionOverrides:n,currentViewType:r,currentDate:s,dateProfile:o,businessHours:this.parseContextBusinessHours(l),eventSources:u,eventUiBases:{},loadingLevel:computeEventSourceLoadingLevel(u),eventStore:createEmptyEventStore(),renderableEventStore:createEmptyEventStore(),dateSelection:null,eventSelection:"",eventDrag:null,eventResize:null,selectionConfig:this.buildViewUiProps(l).selectionConfig},f=__assign(__assign({},l),p),h=0,_=i.pluginHooks.reducers;h<_.length;h++){var g=_[h];__assign(p,g(null,null,f))}p.loadingLevel&&this.emitter.trigger("loading",!0),this.state=p,this.updateData(),this.actionRunner.resume()}return e.prototype.resetOptions=function(e,t){var n=this.props;n.optionOverrides=t?__assign(__assign({},n.optionOverrides),e):e,this.actionRunner.request({type:"NOTHING"})},e.prototype._handleAction=function(e){var t=this,n=t.props,i=t.state,r=t.emitter,a=reduceDynamicOptionOverrides(i.dynamicOptionOverrides,e),s=this.computeOptionsData(n.optionOverrides,a,n.calendarApi),o=reduceViewType(i.currentViewType,e),l=this.computeCurrentViewData(o,s,n.optionOverrides,a);n.calendarApi.currentDataManager=this,r.setThisContext(n.calendarApi),r.setOptions(l.options);var d={dateEnv:s.dateEnv,options:s.calendarOptions,pluginHooks:s.pluginHooks,calendarApi:n.calendarApi,dispatch:this.dispatch,emitter:r,getCurrentData:this.getCurrentData},c=i.currentDate,u=i.dateProfile;this.data&&this.data.dateProfileGenerator!==l.dateProfileGenerator&&(u=l.dateProfileGenerator.build(c)),rangeContainsMarker((u=reduceDateProfile(u,e,c=reduceCurrentDate(c,e),l.dateProfileGenerator)).currentRange,c)||(c=u.currentRange.start);for(var p=reduceEventSources(i.eventSources,e,u,d),f=computeEventSourceLoadingLevel(p),h=reduceEventStore(i.eventStore,e,p,u,d),_=f&&!l.options.progressiveEventRendering&&i.renderableEventStore||h,g=this.buildViewUiProps(d),m=g.eventUiSingleBase,v=g.selectionConfig,y=this.buildEventUiBySource(p),b=this.buildEventUiBases(_.defs,m,y),w=i.loadingLevel||0,E=f,S={dynamicOptionOverrides:a,currentViewType:o,currentDate:c,dateProfile:u,eventSources:p,eventStore:h,renderableEventStore:_,selectionConfig:v,eventUiBases:b,loadingLevel:E,businessHours:this.parseContextBusinessHours(d),dateSelection:reduceDateSelection(i.dateSelection,e),eventSelection:reduceSelectedEvent(i.eventSelection,e),eventDrag:reduceEventDrag(i.eventDrag,e),eventResize:reduceEventResize(i.eventResize,e)},D=__assign(__assign({},d),S),C=0,k=s.pluginHooks.reducers;C<k.length;C++){var T=k[C];__assign(S,T(i,e,D))}!w&&E?r.trigger("loading",!0):w&&!E&&r.trigger("loading",!1),this.state=S,n.onAction&&n.onAction(e)},e.prototype.updateData=function(){var e=this.props,t=this.state,n=this.data,i=this.computeOptionsData(e.optionOverrides,t.dynamicOptionOverrides,e.calendarApi),r=this.computeCurrentViewData(t.currentViewType,i,e.optionOverrides,t.dynamicOptionOverrides),a=this.data=__assign(__assign(__assign({viewTitle:this.buildTitle(t.dateProfile,r.options,i.dateEnv),calendarApi:e.calendarApi,dispatch:this.dispatch,emitter:this.emitter,getCurrentData:this.getCurrentData},i),r),t),s=i.pluginHooks.optionChangeHandlers,o=n&&n.calendarOptions,l=i.calendarOptions;if(o&&o!==l)for(var d in o.timeZone!==l.timeZone&&(t.eventSources=a.eventSources=reduceEventSourcesNewTimeZone(a.eventSources,t.dateProfile,a),t.eventStore=a.eventStore=rezoneEventStoreDates(a.eventStore,n.dateEnv,a.dateEnv)),s)o[d]!==l[d]&&s[d](l[d],a);e.onData&&e.onData(a)},e.prototype._computeOptionsData=function(e,t,n){var i=this.processRawCalendarOptions(e,t),r=i.refinedOptions,a=i.pluginHooks,s=i.localeDefaults,o=i.availableLocaleData;warnUnknownOptions(i.extra);var l=this.buildDateEnv(r.timeZone,r.locale,r.weekNumberCalculation,r.firstDay,r.weekText,a,o,r.defaultRangeSeparator),d=this.buildViewSpecs(a.views,e,t,s),c=this.buildTheme(r,a);return{calendarOptions:r,pluginHooks:a,dateEnv:l,viewSpecs:d,theme:c,toolbarConfig:this.parseToolbars(r,e,c,d,n),localeDefaults:s,availableRawLocales:o.map}},e.prototype.processRawCalendarOptions=function(e,t){var n=mergeRawOptions([BASE_OPTION_DEFAULTS,e,t]),i=n.locales,r=n.locale,a=this.organizeRawLocales(i),s=a.map,o=this.buildLocale(r||a.defaultCode,s).options,l=this.buildPluginHooks(e.plugins||[],globalPlugins),d=this.currentCalendarOptionsRefiners=__assign(__assign(__assign(__assign(__assign({},BASE_OPTION_REFINERS),CALENDAR_LISTENER_REFINERS),CALENDAR_OPTION_REFINERS),l.listenerRefiners),l.optionRefiners),c={},u=mergeRawOptions([BASE_OPTION_DEFAULTS,o,e,t]),p={},f=this.currentCalendarOptionsInput,h=this.currentCalendarOptionsRefined,_=!1;for(var g in u)"plugins"!==g&&(u[g]===f[g]||COMPLEX_OPTION_COMPARATORS[g]&&g in f&&COMPLEX_OPTION_COMPARATORS[g](f[g],u[g])?p[g]=h[g]:d[g]?(p[g]=d[g](u[g]),_=!0):c[g]=f[g]);return _&&(this.currentCalendarOptionsInput=u,this.currentCalendarOptionsRefined=p),{rawOptions:this.currentCalendarOptionsInput,refinedOptions:this.currentCalendarOptionsRefined,pluginHooks:l,availableLocaleData:a,localeDefaults:o,extra:c}},e.prototype._computeCurrentViewData=function(e,t,n,i){var r=t.viewSpecs[e];if(!r)throw new Error('viewType "'+e+"\" is not available. Please make sure you've loaded all neccessary plugins");var a=this.processRawViewOptions(r,t.pluginHooks,t.localeDefaults,n,i),s=a.refinedOptions;return warnUnknownOptions(a.extra),{viewSpec:r,options:s,dateProfileGenerator:this.buildDateProfileGenerator({dateProfileGeneratorClass:r.optionDefaults.dateProfileGeneratorClass,duration:r.duration,durationUnit:r.durationUnit,usesMinMaxTime:r.optionDefaults.usesMinMaxTime,dateEnv:t.dateEnv,calendarApi:this.props.calendarApi,slotMinTime:s.slotMinTime,slotMaxTime:s.slotMaxTime,showNonCurrentDates:s.showNonCurrentDates,dayCount:s.dayCount,dateAlignment:s.dateAlignment,dateIncrement:s.dateIncrement,hiddenDays:s.hiddenDays,weekends:s.weekends,nowInput:s.now,validRangeInput:s.validRange,visibleRangeInput:s.visibleRange,monthMode:s.monthMode,fixedWeekCount:s.fixedWeekCount}),viewApi:this.buildViewApi(e,this.getCurrentData,t.dateEnv)}},e.prototype.processRawViewOptions=function(e,t,n,i,r){var a=mergeRawOptions([BASE_OPTION_DEFAULTS,e.optionDefaults,n,i,e.optionOverrides,r]),s=__assign(__assign(__assign(__assign(__assign(__assign({},BASE_OPTION_REFINERS),CALENDAR_LISTENER_REFINERS),CALENDAR_OPTION_REFINERS),VIEW_OPTION_REFINERS),t.listenerRefiners),t.optionRefiners),o={},l=this.currentViewOptionsInput,d=this.currentViewOptionsRefined,c=!1,u={};for(var p in a)a[p]===l[p]?o[p]=d[p]:(a[p]===this.currentCalendarOptionsInput[p]?p in this.currentCalendarOptionsRefined&&(o[p]=this.currentCalendarOptionsRefined[p]):s[p]?o[p]=s[p](a[p]):u[p]=a[p],c=!0);return c&&(this.currentViewOptionsInput=a,this.currentViewOptionsRefined=o),{rawOptions:this.currentViewOptionsInput,refinedOptions:this.currentViewOptionsRefined,extra:u}},e}();function buildDateEnv$1(e,t,n,i,r,a,s,o){var l=buildLocale(t||s.defaultCode,s.map);return new DateEnv({calendarSystem:"gregory",timeZone:e,namedTimeZoneImpl:a.namedTimeZonedImpl,locale:l,weekNumberCalculation:n,firstDay:i,weekText:r,cmdFormatter:a.cmdFormatter,defaultSeparator:o})}function buildTheme(e,t){return new(t.themeClasses[e.themeSystem]||StandardTheme)(e)}function buildDateProfileGenerator(e){return new(e.dateProfileGeneratorClass||DateProfileGenerator)(e)}function buildViewApi(e,t,n){return new ViewApi(e,t,n)}function buildEventUiBySource(e){return mapHash(e,(function(e){return e.ui}))}function buildEventUiBases(e,t,n){var i={"":t};for(var r in e){var a=e[r];a.sourceId&&n[a.sourceId]&&(i[r]=n[a.sourceId])}return i}function buildViewUiProps(e){var t=e.options;return{eventUiSingleBase:createEventUi({display:t.eventDisplay,editable:t.editable,startEditable:t.eventStartEditable,durationEditable:t.eventDurationEditable,constraint:t.eventConstraint,overlap:"boolean"==typeof t.eventOverlap?t.eventOverlap:void 0,allow:t.eventAllow,backgroundColor:t.eventBackgroundColor,borderColor:t.eventBorderColor,textColor:t.eventTextColor,color:t.eventColor},e),selectionConfig:createEventUi({constraint:t.selectConstraint,overlap:"boolean"==typeof t.selectOverlap?t.selectOverlap:void 0,allow:t.selectAllow},e)}}function parseContextBusinessHours(e){return parseBusinessHours(e.options.businessHours,e)}function warnUnknownOptions(e,t){for(var n in e)console.warn("Unknown option '"+n+"'"+(t?" for view '"+t+"'":""))}var CalendarDataProvider=function(e){function t(t){var n=e.call(this,t)||this;return n.handleData=function(e){n.dataManager?n.setState(e):n.state=e},n.dataManager=new CalendarDataManager({optionOverrides:t.optionOverrides,calendarApi:t.calendarApi,onData:n.handleData}),n}return __extends(t,e),t.prototype.render=function(){return this.props.children(this.state)},t.prototype.componentDidUpdate=function(e){var t=this.props.optionOverrides;t!==e.optionOverrides&&this.dataManager.resetOptions(t)},t}(Component),Interaction=function(){function e(e){this.component=e.component}return e.prototype.destroy=function(){},e}();function parseInteractionSettings(e,t){return{component:e,el:t.el,useEventCenter:null==t.useEventCenter||t.useEventCenter}}function interactionSettingsToStore(e){var t;return(t={})[e.component.uid]=e,t}var interactionSettingsStore={},ElementDragging=function(){function e(e,t){this.emitter=new Emitter}return e.prototype.destroy=function(){},e.prototype.setMirrorIsVisible=function(e){},e.prototype.setMirrorNeedsRevert=function(e){},e.prototype.setAutoScrollEnabled=function(e){},e}(),config={},Toolbar=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.render=function(){var e,t,n=this.props,i=n.model,r=n.extraClassName,a=!1,s=i.center;return i.left?(a=!0,e=i.left):e=i.start,i.right?(a=!0,t=i.right):t=i.end,createElement("div",{className:[r||"","fc-toolbar",a?"fc-toolbar-ltr":""].join(" ")},this.renderSection("start",e||[]),this.renderSection("center",s||[]),this.renderSection("end",t||[]))},t.prototype.renderSection=function(e,t){var n=this.props;return createElement(ToolbarSection,{key:e,widgetGroups:t,title:n.title,activeButton:n.activeButton,isTodayEnabled:n.isTodayEnabled,isPrevEnabled:n.isPrevEnabled,isNextEnabled:n.isNextEnabled})},t}(BaseComponent),ToolbarSection=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.render=function(){var e=this,t=this.props.widgetGroups.map((function(t){return e.renderWidgetGroup(t)}));return createElement.apply(void 0,__spreadArrays(["div",{className:"fc-toolbar-chunk"}],t))},t.prototype.renderWidgetGroup=function(e){for(var t=this.props,n=this.context.theme,i=[],r=!0,a=0,s=e;a<s.length;a++){var o=s[a],l=o.buttonName,d=o.buttonClick,c=o.buttonText,u=o.buttonIcon;if("title"===l)r=!1,i.push(createElement("h2",{className:"fc-toolbar-title"},t.title));else{var p=u?{"aria-label":l}:{},f=["fc-"+l+"-button",n.getClass("button")];l===t.activeButton&&f.push(n.getClass("buttonActive"));var h=!t.isTodayEnabled&&"today"===l||!t.isPrevEnabled&&"prev"===l||!t.isNextEnabled&&"next"===l;i.push(createElement("button",__assign({disabled:h,className:f.join(" "),onClick:d,type:"button"},p),c||(u?createElement("span",{className:u}):"")))}}if(i.length>1){var _=r&&n.getClass("buttonGroup")||"";return createElement.apply(void 0,__spreadArrays(["div",{className:_}],i))}return i[0]},t}(BaseComponent),ViewContainer=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={availableWidth:null},t.handleEl=function(e){t.el=e,setRef(t.props.elRef,e),t.updateAvailableWidth()},t.handleResize=function(){t.updateAvailableWidth()},t}return __extends(t,e),t.prototype.render=function(){var e=this.props,t=this.state,n=e.aspectRatio,i=["fc-view-harness",n||e.liquid||e.height?"fc-view-harness-active":"fc-view-harness-passive"],r="",a="";return n?null!==t.availableWidth?r=t.availableWidth/n:a=1/n*100+"%":r=e.height||"",createElement("div",{ref:this.handleEl,onClick:e.onClick,className:i.join(" "),style:{height:r,paddingBottom:a}},e.children)},t.prototype.componentDidMount=function(){this.context.addResizeHandler(this.handleResize)},t.prototype.componentWillUnmount=function(){this.context.removeResizeHandler(this.handleResize)},t.prototype.updateAvailableWidth=function(){this.el&&this.props.aspectRatio&&this.setState({availableWidth:this.el.offsetWidth})},t}(BaseComponent),EventClicking=function(e){function t(t){var n=e.call(this,t)||this;return n.handleSegClick=function(e,t){var i=n.component,r=i.context,a=getElSeg(t);if(a&&i.isValidSegDownEl(e.target)){var s=elementClosest(e.target,".fc-event-forced-url"),o=s?s.querySelector("a[href]").href:"";r.emitter.trigger("eventClick",{el:t,event:new EventApi(i.context,a.eventRange.def,a.eventRange.instance),jsEvent:e,view:r.viewApi}),o&&!e.defaultPrevented&&(window.location.href=o)}},n.destroy=listenBySelector(t.el,"click",".fc-event",n.handleSegClick),n}return __extends(t,e),t}(Interaction),EventHovering=function(e){function t(t){var n=e.call(this,t)||this;return n.handleEventElRemove=function(e){e===n.currentSegEl&&n.handleSegLeave(null,n.currentSegEl)},n.handleSegEnter=function(e,t){getElSeg(t)&&(n.currentSegEl=t,n.triggerEvent("eventMouseEnter",e,t))},n.handleSegLeave=function(e,t){n.currentSegEl&&(n.currentSegEl=null,n.triggerEvent("eventMouseLeave",e,t))},n.removeHoverListeners=listenToHoverBySelector(t.el,".fc-event",n.handleSegEnter,n.handleSegLeave),n}return __extends(t,e),t.prototype.destroy=function(){this.removeHoverListeners()},t.prototype.triggerEvent=function(e,t,n){var i=this.component,r=i.context,a=getElSeg(n);t&&!i.isValidSegDownEl(t.target)||r.emitter.trigger(e,{el:n,event:new EventApi(r,a.eventRange.def,a.eventRange.instance),jsEvent:t,view:r.viewApi})},t}(Interaction),CalendarContent=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.buildViewContext=memoize(buildViewContext),t.buildViewPropTransformers=memoize(buildViewPropTransformers),t.buildToolbarProps=memoize(buildToolbarProps),t.handleNavLinkClick=buildDelegationHandler("a[data-navlink]",t._handleNavLinkClick.bind(t)),t.headerRef=createRef(),t.footerRef=createRef(),t.interactionsStore={},t.registerInteractiveComponent=function(e,n){var i=parseInteractionSettings(e,n),r=[EventClicking,EventHovering].concat(t.props.pluginHooks.componentInteractions).map((function(e){return new e(i)}));t.interactionsStore[e.uid]=r,interactionSettingsStore[e.uid]=i},t.unregisterInteractiveComponent=function(e){for(var n=0,i=t.interactionsStore[e.uid];n<i.length;n++){i[n].destroy()}delete t.interactionsStore[e.uid],delete interactionSettingsStore[e.uid]},t.resizeRunner=new DelayedRunner((function(){t.props.emitter.trigger("_resize",!0),t.props.emitter.trigger("windowResize",{view:t.props.viewApi})})),t.handleWindowResize=function(e){var n=t.props.options;n.handleWindowResize&&e.target===window&&t.resizeRunner.request(n.windowResizeDelay)},t}return __extends(t,e),t.prototype.render=function(){var e,t=this.props,n=t.toolbarConfig,i=t.options,r=this.buildToolbarProps(t.viewSpec,t.dateProfile,t.dateProfileGenerator,t.currentDate,getNow(t.options.now,t.dateEnv),t.viewTitle),a=!1,s="";t.isHeightAuto||t.forPrint?s="":null!=i.height?a=!0:null!=i.contentHeight?s=i.contentHeight:e=Math.max(i.aspectRatio,.5);var o=this.buildViewContext(t.viewSpec,t.viewApi,t.options,t.dateProfileGenerator,t.dateEnv,t.theme,t.pluginHooks,t.dispatch,t.getCurrentData,t.emitter,t.calendarApi,this.registerInteractiveComponent,this.unregisterInteractiveComponent);return createElement(ViewContextType.Provider,{value:o},n.headerToolbar&&createElement(Toolbar,__assign({ref:this.headerRef,extraClassName:"fc-header-toolbar",model:n.headerToolbar},r)),createElement(ViewContainer,{liquid:a,height:s,aspectRatio:e,onClick:this.handleNavLinkClick},this.renderView(t),this.buildAppendContent()),n.footerToolbar&&createElement(Toolbar,__assign({ref:this.footerRef,extraClassName:"fc-footer-toolbar",model:n.footerToolbar},r)))},t.prototype.componentDidMount=function(){var e=this.props;this.calendarInteractions=e.pluginHooks.calendarInteractions.map((function(t){return new t(e)})),window.addEventListener("resize",this.handleWindowResize);var t=e.pluginHooks.propSetHandlers;for(var n in t)t[n](e[n],e)},t.prototype.componentDidUpdate=function(e){var t=this.props,n=t.pluginHooks.propSetHandlers;for(var i in n)t[i]!==e[i]&&n[i](t[i],t)},t.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.handleWindowResize),this.resizeRunner.clear();for(var e=0,t=this.calendarInteractions;e<t.length;e++){t[e].destroy()}this.props.emitter.trigger("_unmount")},t.prototype._handleNavLinkClick=function(e,t){var n=this.props,i=n.dateEnv,r=n.options,a=n.calendarApi,s=t.getAttribute("data-navlink");s=s?JSON.parse(s):{};var o=i.createMarker(s.date),l=s.type,d="day"===l?r.navLinkDayClick:"week"===l?r.navLinkWeekClick:null;"function"==typeof d?d.call(a,i.toDate(o),e):("string"==typeof d&&(l=d),a.zoomTo(o,l))},t.prototype.buildAppendContent=function(){var e=this.props,t=e.pluginHooks.viewContainerAppends.map((function(t){return t(e)}));return createElement.apply(void 0,__spreadArrays([Fragment,{}],t))},t.prototype.renderView=function(e){for(var t=e.pluginHooks,n=e.viewSpec,i={dateProfile:e.dateProfile,businessHours:e.businessHours,eventStore:e.renderableEventStore,eventUiBases:e.eventUiBases,dateSelection:e.dateSelection,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,isHeightAuto:e.isHeightAuto,forPrint:e.forPrint},r=0,a=this.buildViewPropTransformers(t.viewPropsTransformers);r<a.length;r++){var s=a[r];__assign(i,s.transform(i,e))}var o=n.component;return createElement(o,__assign({},i))},t}(PureComponent);function buildToolbarProps(e,t,n,i,r,a){var s=n.build(r,void 0,!1),o=n.buildPrev(t,i,!1),l=n.buildNext(t,i,!1);return{title:a,activeButton:e.type,isTodayEnabled:s.isValid&&!rangeContainsMarker(t.currentRange,r),isPrevEnabled:o.isValid,isNextEnabled:l.isValid}}function buildViewPropTransformers(e){return e.map((function(e){return new e}))}var CalendarRoot=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={forPrint:!1},t.handleBeforePrint=function(){t.setState({forPrint:!0})},t.handleAfterPrint=function(){t.setState({forPrint:!1})},t}return __extends(t,e),t.prototype.render=function(){var e=this.props,t=e.options,n=this.state.forPrint,i=n||"auto"===t.height||"auto"===t.contentHeight,r=i||null==t.height?"":t.height,a=["fc",n?"fc-media-print":"fc-media-screen","fc-direction-"+t.direction,e.theme.getClass("root")];return getCanVGrowWithinCell()||a.push("fc-liquid-hack"),e.children(a,r,i,n)},t.prototype.componentDidMount=function(){var e=this.props.emitter;e.on("_beforeprint",this.handleBeforePrint),e.on("_afterprint",this.handleAfterPrint)},t.prototype.componentWillUnmount=function(){var e=this.props.emitter;e.off("_beforeprint",this.handleBeforePrint),e.off("_afterprint",this.handleAfterPrint)},t}(BaseComponent);function computeFallbackHeaderFormat(e,t){return createFormatter(!e||t>10?{weekday:"short"}:t>1?{weekday:"short",month:"numeric",day:"numeric",omitCommas:!0}:{weekday:"long"})}var CLASS_NAME="fc-col-header-cell",TableDateCell=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.render=function(){var e=this.context,t=e.dateEnv,n=e.options,i=e.theme,r=e.viewApi,a=this.props,s=a.date,o=a.dateProfile,l=getDateMeta(s,a.todayRange,null,o),d=[CLASS_NAME].concat(getDayClassNames(l,i)),c=t.format(s,a.dayHeaderFormat),u=n.navLinks&&!l.isDisabled&&a.colCnt>1?{"data-navlink":buildNavLinkData(s),tabIndex:0}:{},p=__assign(__assign(__assign({date:t.toDate(s),view:r},a.extraHookProps),{text:c}),l);return createElement(RenderHook,{hookProps:p,classNames:n.dayHeaderClassNames,content:n.dayHeaderContent,defaultContent:renderInner,didMount:n.dayHeaderDidMount,willUnmount:n.dayHeaderWillUnmount},(function(e,t,n,i){return createElement("th",__assign({ref:e,className:d.concat(t).join(" "),"data-date":l.isDisabled?void 0:formatDayString(s),colSpan:a.colSpan},a.extraDataAttrs),createElement("div",{className:"fc-scrollgrid-sync-inner"},!l.isDisabled&&createElement("a",__assign({ref:n,className:["fc-col-header-cell-cushion",a.isSticky?"fc-sticky":""].join(" ")},u),i)))}))},t}(BaseComponent),TableDowCell=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.render=function(){var e=this.props,t=this.context,n=t.dateEnv,i=t.theme,r=t.viewApi,a=t.options,s=addDays(new Date(2592e5),e.dow),o={dow:e.dow,isDisabled:!1,isFuture:!1,isPast:!1,isToday:!1,isOther:!1},l=[CLASS_NAME].concat(getDayClassNames(o,i),e.extraClassNames||[]),d=n.format(s,e.dayHeaderFormat),c=__assign(__assign(__assign(__assign({date:s},o),{view:r}),e.extraHookProps),{text:d});return createElement(RenderHook,{hookProps:c,classNames:a.dayHeaderClassNames,content:a.dayHeaderContent,defaultContent:renderInner,didMount:a.dayHeaderDidMount,willUnmount:a.dayHeaderWillUnmount},(function(t,n,i,r){return createElement("th",__assign({ref:t,className:l.concat(n).join(" "),colSpan:e.colSpan},e.extraDataAttrs),createElement("div",{className:"fc-scrollgrid-sync-inner"},createElement("a",{className:["fc-col-header-cell-cushion",e.isSticky?"fc-sticky":""].join(" "),ref:i},r)))}))},t}(BaseComponent);function renderInner(e){return e.text}var NowTimer=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.initialNowDate=getNow(n.options.now,n.dateEnv),i.initialNowQueriedMs=(new Date).valueOf(),i.state=i.computeTiming().currentState,i}return __extends(t,e),t.prototype.render=function(){var e=this.props,t=this.state;return e.children(t.nowDate,t.todayRange)},t.prototype.componentDidMount=function(){this.setTimeout()},t.prototype.componentDidUpdate=function(e){e.unit!==this.props.unit&&(this.clearTimeout(),this.setTimeout())},t.prototype.componentWillUnmount=function(){this.clearTimeout()},t.prototype.computeTiming=function(){var e=this.props,t=this.context,n=addMs(this.initialNowDate,(new Date).valueOf()-this.initialNowQueriedMs),i=t.dateEnv.startOf(n,e.unit),r=t.dateEnv.add(i,createDuration(1,e.unit)),a=r.valueOf()-n.valueOf();return{currentState:{nowDate:i,todayRange:buildDayRange(i)},nextState:{nowDate:r,todayRange:buildDayRange(r)},waitMs:a}},t.prototype.setTimeout=function(){var e=this,t=this.computeTiming(),n=t.nextState,i=t.waitMs;this.timeoutId=setTimeout((function(){e.setState(n,(function(){e.setTimeout()}))}),i)},t.prototype.clearTimeout=function(){this.timeoutId&&clearTimeout(this.timeoutId)},t.contextType=ViewContextType,t}(Component);function buildDayRange(e){var t=startOfDay(e);return{start:t,end:addDays(t,1)}}var DayHeader=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.createDayHeaderFormatter=memoize(createDayHeaderFormatter),t}return __extends(t,e),t.prototype.render=function(){var e=this.context,t=this.props,n=t.dates,i=t.dateProfile,r=t.datesRepDistinctDays,a=t.renderIntro,s=this.createDayHeaderFormatter(e.options.dayHeaderFormat,r,n.length);return createElement(NowTimer,{unit:"day"},(function(e,t){return createElement("tr",null,a&&a(),n.map((function(e){return r?createElement(TableDateCell,{key:e.toISOString(),date:e,dateProfile:i,todayRange:t,colCnt:n.length,dayHeaderFormat:s}):createElement(TableDowCell,{key:e.getUTCDay(),dow:e.getUTCDay(),dayHeaderFormat:s})})))}))},t}(BaseComponent);function createDayHeaderFormatter(e,t,n){return e||computeFallbackHeaderFormat(t,n)}var DaySeriesModel=function(){function e(e,t){for(var n=e.start,i=e.end,r=[],a=[],s=-1;n<i;)t.isHiddenDay(n)?r.push(s+.5):(s++,r.push(s),a.push(n)),n=addDays(n,1);this.dates=a,this.indices=r,this.cnt=a.length}return e.prototype.sliceRange=function(e){var t=this.getDateDayIndex(e.start),n=this.getDateDayIndex(addDays(e.end,-1)),i=Math.max(0,t),r=Math.min(this.cnt-1,n);return(i=Math.ceil(i))<=(r=Math.floor(r))?{firstIndex:i,lastIndex:r,isStart:t===i,isEnd:n===r}:null},e.prototype.getDateDayIndex=function(e){var t=this.indices,n=Math.floor(diffDays(this.dates[0],e));return n<0?t[0]-1:n>=t.length?t[t.length-1]+1:t[n]},e}(),DayTableModel=function(){function e(e,t){var n,i,r,a=e.dates;if(t){for(i=a[0].getUTCDay(),n=1;n<a.length&&a[n].getUTCDay()!==i;n++);r=Math.ceil(a.length/n)}else r=1,n=a.length;this.rowCnt=r,this.colCnt=n,this.daySeries=e,this.cells=this.buildCells(),this.headerDates=this.buildHeaderDates()}return e.prototype.buildCells=function(){for(var e=[],t=0;t<this.rowCnt;t++){for(var n=[],i=0;i<this.colCnt;i++)n.push(this.buildCell(t,i));e.push(n)}return e},e.prototype.buildCell=function(e,t){var n=this.daySeries.dates[e*this.colCnt+t];return{key:n.toISOString(),date:n}},e.prototype.buildHeaderDates=function(){for(var e=[],t=0;t<this.colCnt;t++)e.push(this.cells[0][t].date);return e},e.prototype.sliceRange=function(e){var t=this.colCnt,n=this.daySeries.sliceRange(e),i=[];if(n)for(var r=n.firstIndex,a=n.lastIndex,s=r;s<=a;){var o=Math.floor(s/t),l=Math.min((o+1)*t,a+1);i.push({row:o,firstCol:s%t,lastCol:(l-1)%t,isStart:n.isStart&&s===r,isEnd:n.isEnd&&l-1===a}),s=l}return i},e}(),Slicer=function(){function e(){this.sliceBusinessHours=memoize(this._sliceBusinessHours),this.sliceDateSelection=memoize(this._sliceDateSpan),this.sliceEventStore=memoize(this._sliceEventStore),this.sliceEventDrag=memoize(this._sliceInteraction),this.sliceEventResize=memoize(this._sliceInteraction),this.forceDayIfListItem=!1}return e.prototype.sliceProps=function(e,t,n,i){for(var r=arguments,a=[],s=4;s<arguments.length;s++)a[s-4]=r[s];var o=e.eventUiBases,l=this.sliceEventStore.apply(this,__spreadArrays([e.eventStore,o,t,n],a));return{dateSelectionSegs:this.sliceDateSelection.apply(this,__spreadArrays([e.dateSelection,o,i],a)),businessHourSegs:this.sliceBusinessHours.apply(this,__spreadArrays([e.businessHours,t,n,i],a)),fgEventSegs:l.fg,bgEventSegs:l.bg,eventDrag:this.sliceEventDrag.apply(this,__spreadArrays([e.eventDrag,o,t,n],a)),eventResize:this.sliceEventResize.apply(this,__spreadArrays([e.eventResize,o,t,n],a)),eventSelection:e.eventSelection}},e.prototype.sliceNowDate=function(e,t){for(var n=arguments,i=[],r=2;r<arguments.length;r++)i[r-2]=n[r];return this._sliceDateSpan.apply(this,__spreadArrays([{range:{start:e,end:addMs(e,1)},allDay:!1},{},t],i))},e.prototype._sliceBusinessHours=function(e,t,n,i){for(var r=arguments,a=[],s=4;s<arguments.length;s++)a[s-4]=r[s];return e?this._sliceEventStore.apply(this,__spreadArrays([expandRecurring(e,computeActiveRange(t,Boolean(n)),i),{},t,n],a)).bg:[]},e.prototype._sliceEventStore=function(e,t,n,i){for(var r=arguments,a=[],s=4;s<arguments.length;s++)a[s-4]=r[s];if(e){var o=sliceEventStore(e,t,computeActiveRange(n,Boolean(i)),i);return{bg:this.sliceEventRanges(o.bg,a),fg:this.sliceEventRanges(o.fg,a)}}return{bg:[],fg:[]}},e.prototype._sliceInteraction=function(e,t,n,i){for(var r=arguments,a=[],s=4;s<arguments.length;s++)a[s-4]=r[s];if(!e)return null;var o=sliceEventStore(e.mutatedEvents,t,computeActiveRange(n,Boolean(i)),i);return{segs:this.sliceEventRanges(o.fg,a),affectedInstances:e.affectedEvents.instances,isEvent:e.isEvent}},e.prototype._sliceDateSpan=function(e,t,n){for(var i=arguments,r=[],a=3;a<arguments.length;a++)r[a-3]=i[a];if(!e)return[];for(var s=fabricateEventRange(e,t,n),o=this.sliceRange.apply(this,__spreadArrays([e.range],r)),l=0,d=o;l<d.length;l++){var c=d[l];c.eventRange=s}return o},e.prototype.sliceEventRanges=function(e,t){for(var n=[],i=0,r=e;i<r.length;i++){var a=r[i];n.push.apply(n,this.sliceEventRange(a,t))}return n},e.prototype.sliceEventRange=function(e,t){var n=e.range;this.forceDayIfListItem&&"list-item"===e.ui.display&&(n={start:n.start,end:addDays(n.start,1)});for(var i=this.sliceRange.apply(this,__spreadArrays([n],t)),r=0,a=i;r<a.length;r++){var s=a[r];s.eventRange=e,s.isStart=e.isStart&&s.isStart,s.isEnd=e.isEnd&&s.isEnd}return i},e}();function computeActiveRange(e,t){var n=e.activeRange;return t?n:{start:addMs(n.start,e.slotMinTime.milliseconds),end:addMs(n.end,e.slotMaxTime.milliseconds-864e5)}}var VISIBLE_HIDDEN_RE=/^(visible|hidden)$/,Scroller=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleEl=function(e){t.el=e,setRef(t.props.elRef,e)},t}return __extends(t,e),t.prototype.render=function(){var e=this.props,t=e.liquid,n=e.liquidIsAbsolute,i=t&&n,r=["fc-scroller"];return t&&(n?r.push("fc-scroller-liquid-absolute"):r.push("fc-scroller-liquid")),createElement("div",{ref:this.handleEl,className:r.join(" "),style:{overflowX:e.overflowX,overflowY:e.overflowY,left:i&&-(e.overcomeLeft||0)||"",right:i&&-(e.overcomeRight||0)||"",bottom:i&&-(e.overcomeBottom||0)||"",marginLeft:!i&&-(e.overcomeLeft||0)||"",marginRight:!i&&-(e.overcomeRight||0)||"",marginBottom:!i&&-(e.overcomeBottom||0)||"",maxHeight:e.maxHeight||""}},e.children)},t.prototype.needsXScrolling=function(){if(VISIBLE_HIDDEN_RE.test(this.props.overflowX))return!1;for(var e=this.el,t=this.el.getBoundingClientRect().width-this.getYScrollbarWidth(),n=e.children,i=0;i<n.length;i++){if(n[i].getBoundingClientRect().width>t)return!0}return!1},t.prototype.needsYScrolling=function(){if(VISIBLE_HIDDEN_RE.test(this.props.overflowY))return!1;for(var e=this.el,t=this.el.getBoundingClientRect().height-this.getXScrollbarWidth(),n=e.children,i=0;i<n.length;i++){if(n[i].getBoundingClientRect().height>t)return!0}return!1},t.prototype.getXScrollbarWidth=function(){return VISIBLE_HIDDEN_RE.test(this.props.overflowX)?0:this.el.offsetHeight-this.el.clientHeight},t.prototype.getYScrollbarWidth=function(){return VISIBLE_HIDDEN_RE.test(this.props.overflowY)?0:this.el.offsetWidth-this.el.clientWidth},t}(BaseComponent),RefMap=function(){function e(e){var t=this;this.masterCallback=e,this.currentMap={},this.depths={},this.callbackMap={},this.handleValue=function(e,n){var i=t,r=i.depths,a=i.currentMap,s=!1,o=!1;null!==e?(s=n in a,a[n]=e,r[n]=(r[n]||0)+1,o=!0):0==--r[n]&&(delete a[n],delete t.callbackMap[n],s=!0),t.masterCallback&&(s&&t.masterCallback(null,String(n)),o&&t.masterCallback(e,String(n)))}}return e.prototype.createRef=function(e){var t=this,n=this.callbackMap[e];return n||(n=this.callbackMap[e]=function(n){t.handleValue(n,String(e))}),n},e.prototype.collect=function(e,t,n){return collectFromHash(this.currentMap,e,t,n)},e.prototype.getAll=function(){return hashValuesToArray(this.currentMap)},e}();function computeShrinkWidth(e){for(var t=0,n=0,i=findElements(e,".fc-scrollgrid-shrink");n<i.length;n++){var r=i[n];t=Math.max(t,computeSmallestCellWidth(r))}return Math.ceil(t)}function getSectionHasLiquidHeight(e,t){return e.liquid&&t.liquid}function getAllowYScrolling(e,t){return null!=t.maxHeight||getSectionHasLiquidHeight(e,t)}function renderChunkContent(e,t,n){var i=n.expandRows;return"function"==typeof t.content?t.content(n):createElement("table",{className:[t.tableClassName,e.syncRowHeights?"fc-scrollgrid-sync-table":""].join(" "),style:{minWidth:n.tableMinWidth,width:n.clientWidth,height:i?n.clientHeight:""}},n.tableColGroupNode,createElement("tbody",{},"function"==typeof t.rowContent?t.rowContent(n):t.rowContent))}function isColPropsEqual(e,t){return isArraysEqual(e,t,isPropsEqual)}function renderMicroColGroup(e,t){for(var n=[],i=0,r=e;i<r.length;i++)for(var a=r[i],s=a.span||1,o=0;o<s;o++)n.push(createElement("col",{style:{width:"shrink"===a.width?sanitizeShrinkWidth(t):a.width||"",minWidth:a.minWidth||""}}));return createElement.apply(void 0,__spreadArrays(["colgroup",{}],n))}function sanitizeShrinkWidth(e){return null==e?4:e}function hasShrinkWidth(e){for(var t=0,n=e;t<n.length;t++){if("shrink"===n[t].width)return!0}return!1}function getScrollGridClassNames(e,t){var n=["fc-scrollgrid",t.theme.getClass("table")];return e&&n.push("fc-scrollgrid-liquid"),n}function getSectionClassNames(e,t){var n=["fc-scrollgrid-section","fc-scrollgrid-section-"+e.type,e.className];return t&&e.liquid&&null==e.maxHeight&&n.push("fc-scrollgrid-section-liquid"),e.isSticky&&n.push("fc-scrollgrid-section-sticky"),n}function renderScrollShim(e){return createElement("div",{className:"fc-scrollgrid-sticky-shim",style:{width:e.clientWidth,minWidth:e.tableMinWidth}})}function getStickyHeaderDates(e){var t=e.stickyHeaderDates;return null!=t&&"auto"!==t||(t="auto"===e.height||"auto"===e.viewHeight),t}function getStickyFooterScrollbar(e){var t=e.stickyFooterScrollbar;return null!=t&&"auto"!==t||(t="auto"===e.height||"auto"===e.viewHeight),t}var SimpleScrollGrid=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.processCols=memoize((function(e){return e}),isColPropsEqual),t.renderMicroColGroup=memoize(renderMicroColGroup),t.scrollerRefs=new RefMap,t.scrollerElRefs=new RefMap(t._handleScrollerEl.bind(t)),t.state={shrinkWidth:null,forceYScrollbars:!1,scrollerClientWidths:{},scrollerClientHeights:{}},t.handleSizing=function(){t.setState(__assign({shrinkWidth:t.computeShrinkWidth()},t.computeScrollerDims()))},t}return __extends(t,e),t.prototype.render=function(){for(var e,t=this,n=t.props,i=t.state,r=t.context,a=n.sections||[],s=this.processCols(n.cols),o=this.renderMicroColGroup(s,i.shrinkWidth),l=getScrollGridClassNames(n.liquid,r),d=a.length,c=0,u=[],p=[],f=[];c<d&&"header"===(e=a[c]).type;)u.push(this.renderSection(e,c,o)),c++;for(;c<d&&"body"===(e=a[c]).type;)p.push(this.renderSection(e,c,o)),c++;for(;c<d&&"footer"===(e=a[c]).type;)f.push(this.renderSection(e,c,o)),c++;var h=!getCanVGrowWithinCell();return createElement("table",{className:l.join(" "),style:{height:n.height}},Boolean(!h&&u.length)&&createElement.apply(void 0,__spreadArrays(["thead",{}],u)),Boolean(!h&&p.length)&&createElement.apply(void 0,__spreadArrays(["tbody",{}],p)),Boolean(!h&&f.length)&&createElement.apply(void 0,__spreadArrays(["tfoot",{}],f)),h&&createElement.apply(void 0,__spreadArrays(["tbody",{}],u,p,f)))},t.prototype.renderSection=function(e,t,n){return"outerContent"in e?createElement(Fragment,{key:e.key},e.outerContent):createElement("tr",{key:e.key,className:getSectionClassNames(e,this.props.liquid).join(" ")},this.renderChunkTd(e,t,n,e.chunk))},t.prototype.renderChunkTd=function(e,t,n,i){if("outerContent"in i)return i.outerContent;var r=this.props,a=this.state,s=a.forceYScrollbars,o=a.scrollerClientWidths,l=a.scrollerClientHeights,d=getAllowYScrolling(r,e),c=getSectionHasLiquidHeight(r,e),u=r.liquid?s?"scroll":d?"auto":"hidden":"visible",p=renderChunkContent(e,i,{tableColGroupNode:n,tableMinWidth:"",clientWidth:void 0!==o[t]?o[t]:null,clientHeight:void 0!==l[t]?l[t]:null,expandRows:e.expandRows,syncRowHeights:!1,rowSyncHeights:[],reportRowHeightChange:function(){}});return createElement("td",{ref:i.elRef},createElement("div",{className:"fc-scroller-harness"+(c?" fc-scroller-harness-liquid":"")},createElement(Scroller,{ref:this.scrollerRefs.createRef(t),elRef:this.scrollerElRefs.createRef(t),overflowY:u,overflowX:r.liquid?"hidden":"visible",maxHeight:e.maxHeight,liquid:c,liquidIsAbsolute:!0},p)))},t.prototype._handleScrollerEl=function(e,t){var n=parseInt(t,10);setRef(this.props.sections[n].chunk.scrollerElRef,e)},t.prototype.componentDidMount=function(){this.handleSizing(),this.context.addResizeHandler(this.handleSizing)},t.prototype.componentDidUpdate=function(){this.handleSizing()},t.prototype.componentWillUnmount=function(){this.context.removeResizeHandler(this.handleSizing)},t.prototype.computeShrinkWidth=function(){return hasShrinkWidth(this.props.cols)?computeShrinkWidth(this.scrollerElRefs.getAll()):0},t.prototype.computeScrollerDims=function(){for(var e=getScrollbarWidths(),t=this.props.sections.length,n=this.scrollerRefs,i=this.scrollerElRefs,r=!1,a={},s={},o=0;o<t;o++){var l=n.currentMap[o];if(l&&l.needsYScrolling()){r=!0;break}}for(o=0;o<t;o++){var d=i.currentMap[o];if(d){var c=d.parentNode;a[o]=Math.floor(c.getBoundingClientRect().width-(r?e.y:0)),s[o]=Math.floor(c.getBoundingClientRect().height)}}return{forceYScrollbars:r,scrollerClientWidths:a,scrollerClientHeights:s}},t}(BaseComponent);SimpleScrollGrid.addStateEquality({scrollerClientWidths:isPropsEqual,scrollerClientHeights:isPropsEqual});var EventRoot=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.elRef=createRef(),t}return __extends(t,e),t.prototype.render=function(){var e=this.props,t=this.context,n=t.options,i=e.seg,r=i.eventRange,a=r.ui,s={event:new EventApi(t,r.def,r.instance),view:t.viewApi,timeText:e.timeText,textColor:a.textColor,backgroundColor:a.backgroundColor,borderColor:a.borderColor,isDraggable:!e.disableDragging&&computeSegDraggable(i,t),isStartResizable:!e.disableResizing&&computeSegStartResizable(i,t),isEndResizable:!e.disableResizing&&computeSegEndResizable(i),isMirror:Boolean(e.isDragging||e.isResizing||e.isDateSelecting),isStart:Boolean(i.isStart),isEnd:Boolean(i.isEnd),isPast:Boolean(e.isPast),isFuture:Boolean(e.isFuture),isToday:Boolean(e.isToday),isSelected:Boolean(e.isSelected),isDragging:Boolean(e.isDragging),isResizing:Boolean(e.isResizing)},o=getEventClassNames(s).concat(a.classNames);return createElement(RenderHook,{hookProps:s,classNames:n.eventClassNames,content:n.eventContent,defaultContent:e.defaultContent,didMount:n.eventDidMount,willUnmount:n.eventWillUnmount,elRef:this.elRef},(function(t,n,i,r){return e.children(t,o.concat(n),i,r,s)}))},t.prototype.componentDidMount=function(){setElSeg(this.elRef.current,this.props.seg)},t.prototype.componentDidUpdate=function(e){var t=this.props.seg;t!==e.seg&&setElSeg(this.elRef.current,t)},t}(BaseComponent),StandardEvent=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.render=function(){var e=this.props,t=this.context,n=e.seg,i=t.options.eventTimeFormat||e.defaultTimeFormat,r=buildSegTimeText(n,i,t,e.defaultDisplayEventTime,e.defaultDisplayEventEnd);return createElement(EventRoot,{seg:n,timeText:r,disableDragging:e.disableDragging,disableResizing:e.disableResizing,defaultContent:e.defaultContent||renderInnerContent,isDragging:e.isDragging,isResizing:e.isResizing,isDateSelecting:e.isDateSelecting,isSelected:e.isSelected,isPast:e.isPast,isFuture:e.isFuture,isToday:e.isToday},(function(t,i,r,a,s){return createElement("a",__assign({className:e.extraClassNames.concat(i).join(" "),style:{borderColor:s.borderColor,backgroundColor:s.backgroundColor},ref:t},getSegAnchorAttrs(n)),createElement("div",{className:"fc-event-main",ref:r,style:{color:s.textColor}},a),s.isStartResizable&&createElement("div",{className:"fc-event-resizer fc-event-resizer-start"}),s.isEndResizable&&createElement("div",{className:"fc-event-resizer fc-event-resizer-end"}))}))},t}(BaseComponent);function renderInnerContent(e){return createElement("div",{className:"fc-event-main-frame"},e.timeText&&createElement("div",{className:"fc-event-time"},e.timeText),createElement("div",{className:"fc-event-title-container"},createElement("div",{className:"fc-event-title fc-sticky"},e.event.title||createElement(Fragment,null,""))))}function getSegAnchorAttrs(e){var t=e.eventRange.def.url;return t?{href:t}:{}}var NowIndicatorRoot=function(e){return createElement(ViewContextType.Consumer,null,(function(t){var n=t.options,i={isAxis:e.isAxis,date:t.dateEnv.toDate(e.date),view:t.viewApi};return createElement(RenderHook,{hookProps:i,classNames:n.nowIndicatorClassNames,content:n.nowIndicatorContent,didMount:n.nowIndicatorDidMount,willUnmount:n.nowIndicatorWillUnmount},e.children)}))},DAY_NUM_FORMAT=createFormatter({day:"numeric"}),DayCellRoot=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.refineHookProps=memoizeObjArg(refineHookProps),t.normalizeClassNames=buildClassNameNormalizer(),t}return __extends(t,e),t.prototype.render=function(){var e=this.props,t=this.context,n=t.options,i=this.refineHookProps({date:e.date,dateProfile:e.dateProfile,todayRange:e.todayRange,showDayNumber:e.showDayNumber,extraProps:e.extraHookProps,viewApi:t.viewApi,dateEnv:t.dateEnv}),r=getDayClassNames(i,t.theme).concat(i.isDisabled?[]:this.normalizeClassNames(n.dayCellClassNames,i)),a=i.isDisabled?{}:{"data-date":formatDayString(e.date)};return createElement(MountHook,{hookProps:i,didMount:n.dayCellDidMount,willUnmount:n.dayCellWillUnmount,elRef:e.elRef},(function(t){return e.children(t,r,a,i.isDisabled)}))},t}(BaseComponent),DayCellContent=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.render=function(){var e=this.props,t=this.context,n=t.options,i=refineHookProps({date:e.date,dateProfile:e.dateProfile,todayRange:e.todayRange,showDayNumber:e.showDayNumber,extraProps:e.extraHookProps,viewApi:t.viewApi,dateEnv:t.dateEnv});return createElement(ContentHook,{hookProps:i,content:n.dayCellContent,defaultContent:e.defaultContent},e.children)},t}(BaseComponent);function refineHookProps(e){var t=e.date,n=e.dateEnv,i=getDateMeta(t,e.todayRange,null,e.dateProfile);return __assign(__assign(__assign({date:n.toDate(t),view:e.viewApi},i),{dayNumberText:e.showDayNumber?n.format(t,DAY_NUM_FORMAT):""}),e.extraProps)}function renderFill(e){return createElement("div",{className:"fc-"+e})}var BgEvent=function(e){return createElement(EventRoot,{defaultContent:renderInnerContent$1,seg:e.seg,timeText:"",disableDragging:!0,disableResizing:!0,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:!1,isPast:e.isPast,isFuture:e.isFuture,isToday:e.isToday},(function(e,t,n,i,r){return createElement("div",{ref:e,className:["fc-bg-event"].concat(t).join(" "),style:{backgroundColor:r.backgroundColor}},i)}))};function renderInnerContent$1(e){return e.event.title&&createElement("div",{className:"fc-event-title"},e.event.title)}var WeekNumberRoot=function(e){return createElement(ViewContextType.Consumer,null,(function(t){var n=t.dateEnv,i=t.options,r=e.date,a=i.weekNumberFormat||e.defaultFormat,s=n.computeWeekNumber(r),o=n.format(r,a);return createElement(RenderHook,{hookProps:{num:s,text:o,date:r},classNames:i.weekNumberClassNames,content:i.weekNumberContent,defaultContent:renderInner$1,didMount:i.weekNumberDidMount,willUnmount:i.weekNumberWillUnmount},e.children)}))};function renderInner$1(e){return e.text}
/*!
	FullCalendar v5.3.1
	Docs & License: https://fullcalendar.io/
	(c) 2020 Adam Shaw
	*/var Calendar=function(e){function t(t,n){void 0===n&&(n={});var i=e.call(this)||this;return i.isRendering=!1,i.isRendered=!1,i.currentClassNames=[],i.customContentRenderId=0,i.handleAction=function(e){switch(e.type){case"SET_EVENT_DRAG":case"SET_EVENT_RESIZE":i.renderRunner.tryDrain()}},i.handleData=function(e){i.currentData=e,i.renderRunner.request(e.calendarOptions.rerenderDelay)},i.handleRenderRequest=function(){if(i.isRendering){i.isRendered=!0;var e=i.currentData;render(createElement(CalendarRoot,{options:e.calendarOptions,theme:e.theme,emitter:e.emitter},(function(t,n,r,a){return i.setClassNames(t),i.setHeight(n),createElement(CustomContentRenderContext.Provider,{value:i.customContentRenderId},createElement(CalendarContent,__assign({isHeightAuto:r,forPrint:a},e)))})),i.el)}else i.isRendered&&(i.isRendered=!1,render(null,i.el),i.setClassNames([]),i.setHeight(""));flushToDom$1()},i.el=t,i.renderRunner=new DelayedRunner(i.handleRenderRequest),new CalendarDataManager({optionOverrides:n,calendarApi:i,onAction:i.handleAction,onData:i.handleData}),i}return __extends(t,e),Object.defineProperty(t.prototype,"view",{get:function(){return this.currentData.viewApi},enumerable:!1,configurable:!0}),t.prototype.render=function(){var e=this.isRendering;e?this.customContentRenderId++:this.isRendering=!0,this.renderRunner.request(),e&&this.updateSize()},t.prototype.destroy=function(){this.isRendering&&(this.isRendering=!1,this.renderRunner.request())},t.prototype.updateSize=function(){e.prototype.updateSize.call(this),flushToDom$1()},t.prototype.batchRendering=function(e){this.renderRunner.pause("batchRendering"),e(),this.renderRunner.resume("batchRendering")},t.prototype.pauseRendering=function(){this.renderRunner.pause("pauseRendering")},t.prototype.resumeRendering=function(){this.renderRunner.resume("pauseRendering",!0)},t.prototype.resetOptions=function(e,t){this.currentDataManager.resetOptions(e,t)},t.prototype.setClassNames=function(e){if(!isArraysEqual(e,this.currentClassNames)){for(var t=this.el.classList,n=0,i=this.currentClassNames;n<i.length;n++){var r=i[n];t.remove(r)}for(var a=0,s=e;a<s.length;a++){r=s[a];t.add(r)}this.currentClassNames=e}},t.prototype.setHeight=function(e){applyStyleProp(this.el,"height",e)},t}(CalendarApi),TableView=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.headerElRef=createRef(),t}return __extends(t,e),t.prototype.renderSimpleLayout=function(e,t){var n=this.props,i=this.context,r=[],a=getStickyHeaderDates(i.options);return e&&r.push({type:"header",key:"header",isSticky:a,chunk:{elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}}),r.push({type:"body",key:"body",liquid:!0,chunk:{content:t}}),createElement(ViewRoot,{viewSpec:i.viewSpec},(function(e,t){return createElement("div",{ref:e,className:["fc-daygrid"].concat(t).join(" ")},createElement(SimpleScrollGrid,{liquid:!n.isHeightAuto&&!n.forPrint,cols:[],sections:r}))}))},t.prototype.renderHScrollLayout=function(e,t,n,i){var r=this.context.pluginHooks.scrollGridImpl;if(!r)throw new Error("No ScrollGrid implementation");var a=this.props,s=this.context,o=!a.forPrint&&getStickyHeaderDates(s.options),l=!a.forPrint&&getStickyFooterScrollbar(s.options),d=[];return e&&d.push({type:"header",key:"header",isSticky:o,chunks:[{key:"main",elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}]}),d.push({type:"body",key:"body",liquid:!0,chunks:[{key:"main",content:t}]}),l&&d.push({type:"footer",key:"footer",isSticky:!0,chunks:[{key:"main",content:renderScrollShim}]}),createElement(ViewRoot,{viewSpec:s.viewSpec},(function(e,t){return createElement("div",{ref:e,className:["fc-daygrid"].concat(t).join(" ")},createElement(r,{liquid:!a.isHeightAuto&&!a.forPrint,colGroups:[{cols:[{span:n,minWidth:i}]}],sections:d}))}))},t}(DateComponent);
/*!
	FullCalendar v5.3.2
	Docs & License: https://fullcalendar.io/
	(c) 2020 Adam Shaw
	*/function splitSegsByRow(e,t){for(var n=[],i=0;i<t;i++)n[i]=[];for(var r=0,a=e;r<a.length;r++){var s=a[r];n[s.row].push(s)}return n}function splitSegsByFirstCol(e,t){for(var n=[],i=0;i<t;i++)n[i]=[];for(var r=0,a=e;r<a.length;r++){var s=a[r];n[s.firstCol].push(s)}return n}function splitInteractionByRow(e,t){var n=[];if(e){for(s=0;s<t;s++)n[s]={affectedInstances:e.affectedInstances,isEvent:e.isEvent,segs:[]};for(var i=0,r=e.segs;i<r.length;i++){var a=r[i];n[a.row].segs.push(a)}}else for(var s=0;s<t;s++)n[s]=null;return n}var DEFAULT_WEEK_NUM_FORMAT=createFormatter({week:"narrow"}),TableCell=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleRootEl=function(e){t.rootEl=e,setRef(t.props.elRef,e)},t.handleMoreLinkClick=function(e){var n=t.props;if(n.onMoreClick){var i=n.segsByEachCol,r=i.filter((function(e){return n.segIsHidden[e.eventRange.instance.instanceId]}));n.onMoreClick({date:n.date,allSegs:i,hiddenSegs:r,moreCnt:n.moreCnt,dayEl:t.rootEl,ev:e})}},t}return __extends(t,e),t.prototype.render=function(){var e=this,t=this.context,n=t.options,i=t.viewApi,r=this.props,a=r.date,s=r.dateProfile,o={num:r.moreCnt,text:r.buildMoreLinkText(r.moreCnt),view:i},l=n.navLinks?{"data-navlink":buildNavLinkData(a,"week"),tabIndex:0}:{};return createElement(DayCellRoot,{date:a,dateProfile:s,todayRange:r.todayRange,showDayNumber:r.showDayNumber,extraHookProps:r.extraHookProps,elRef:this.handleRootEl},(function(t,i,d,c){return createElement("td",__assign({ref:t,className:["fc-daygrid-day"].concat(i,r.extraClassNames||[]).join(" ")},d,r.extraDataAttrs),createElement("div",{className:"fc-daygrid-day-frame fc-scrollgrid-sync-inner",ref:r.innerElRef},r.showWeekNumber&&createElement(WeekNumberRoot,{date:a,defaultFormat:DEFAULT_WEEK_NUM_FORMAT},(function(e,t,n,i){return createElement("a",__assign({ref:e,className:["fc-daygrid-week-number"].concat(t).join(" ")},l),i)})),!c&&createElement(TableCellTop,{date:a,dateProfile:s,showDayNumber:r.showDayNumber,forceDayTop:r.forceDayTop,todayRange:r.todayRange,extraHookProps:r.extraHookProps}),createElement("div",{className:"fc-daygrid-day-events",ref:r.fgContentElRef,style:{paddingBottom:r.fgPaddingBottom}},r.fgContent,Boolean(r.moreCnt)&&createElement("div",{className:"fc-daygrid-day-bottom",style:{marginTop:r.moreMarginTop}},createElement(RenderHook,{hookProps:o,classNames:n.moreLinkClassNames,content:n.moreLinkContent,defaultContent:renderMoreLinkInner,didMount:n.moreLinkDidMount,willUnmount:n.moreLinkWillUnmount},(function(t,n,i,r){return createElement("a",{onClick:e.handleMoreLinkClick,ref:t,className:["fc-daygrid-more-link"].concat(n).join(" ")},r)})))),createElement("div",{className:"fc-daygrid-day-bg"},r.bgContent)))}))},t}(DateComponent);function renderTopInner(e){return e.dayNumberText}function renderMoreLinkInner(e){return e.text}var TableCellTop=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.render=function(){var e=this.props,t=this.context.options.navLinks?{"data-navlink":buildNavLinkData(e.date),tabIndex:0}:{};return createElement(DayCellContent,{date:e.date,dateProfile:e.dateProfile,todayRange:e.todayRange,showDayNumber:e.showDayNumber,extraHookProps:e.extraHookProps,defaultContent:renderTopInner},(function(n,i){return(i||e.forceDayTop)&&createElement("div",{className:"fc-daygrid-day-top",ref:n},createElement("a",__assign({className:"fc-daygrid-day-number"},t),i||createElement(Fragment,null,"")))}))},t}(BaseComponent),DEFAULT_TABLE_EVENT_TIME_FORMAT=createFormatter({hour:"numeric",minute:"2-digit",omitZeroMinute:!0,meridiem:"narrow"});function hasListItemDisplay(e){var t=e.eventRange.ui.display;return"list-item"===t||"auto"===t&&!e.eventRange.def.allDay&&e.firstCol===e.lastCol&&e.isStart&&e.isEnd}var TableListItemEvent=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.render=function(){var e=this.props,t=this.context,n=t.options.eventTimeFormat||DEFAULT_TABLE_EVENT_TIME_FORMAT,i=buildSegTimeText(e.seg,n,t,!0,e.defaultDisplayEventEnd);return createElement(EventRoot,{seg:e.seg,timeText:i,defaultContent:renderInnerContent$2,isDragging:e.isDragging,isResizing:!1,isDateSelecting:!1,isSelected:e.isSelected,isPast:e.isPast,isFuture:e.isFuture,isToday:e.isToday},(function(t,n,i,r){return createElement("a",__assign({className:["fc-daygrid-event","fc-daygrid-dot-event"].concat(n).join(" "),ref:t},getSegAnchorAttrs$1(e.seg)),r)}))},t}(BaseComponent);function renderInnerContent$2(e){return createElement(Fragment,null,createElement("div",{className:"fc-daygrid-event-dot",style:{borderColor:e.borderColor||e.backgroundColor}}),e.timeText&&createElement("div",{className:"fc-event-time"},e.timeText),createElement("div",{className:"fc-event-title"},e.event.title||createElement(Fragment,null,"")))}function getSegAnchorAttrs$1(e){var t=e.eventRange.def.url;return t?{href:t}:{}}var TableBlockEvent=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.render=function(){var e=this.props;return createElement(StandardEvent,__assign({},e,{extraClassNames:["fc-daygrid-event","fc-daygrid-block-event","fc-h-event"],defaultTimeFormat:DEFAULT_TABLE_EVENT_TIME_FORMAT,defaultDisplayEventEnd:e.defaultDisplayEventEnd,disableResizing:!e.seg.eventRange.def.allDay}))},t}(BaseComponent);function computeFgSegPlacement(e,t,n,i,r,a,s,o){for(var l=[],d=[],c={},u={},p={},f={},h={},_=0;_<s;_++)l.push([]),d.push(0);for(var g=0,m=t=sortEventSegs(t,o);g<m.length;g++){C(S=m[g],r[S.eventRange.instance.instanceId+":"+S.firstCol]||0)}!0===n||!0===i?limitByMaxHeight(d,c,l,a):"number"==typeof n?limitByMaxEvents(d,c,l,n):"number"==typeof i&&limitByMaxRows(d,c,l,i);for(var v=0;v<s;v++){for(var y=0,b=0,w=0,E=l[v];w<E.length;w++){var S,D=E[w];c[(S=D.seg).eventRange.instance.instanceId]||(u[S.eventRange.instance.instanceId]=D.top,S.firstCol===S.lastCol&&S.isStart&&S.isEnd?(p[S.eventRange.instance.instanceId]=D.top-y,b=0,y=D.bottom):b=D.bottom-y)}b&&(d[v]?f[v]=b:h[v]=b)}function C(e,t){if(!k(e,t,0))for(var n=e.firstCol;n<=e.lastCol;n++)for(var i=0,r=l[n];i<r.length;i++){if(k(e,t,r[i].bottom))return}}function k(e,t,n){if(function(e,t,n){for(var i=e.firstCol;i<=e.lastCol;i++)for(var r=0,a=l[i];r<a.length;r++){var s=a[r];if(n<s.bottom&&n+t>s.top)return!1}return!0}(e,t,n)){for(var i=e.firstCol;i<=e.lastCol;i++){for(var r=l[i],a=0;a<r.length&&n>=r[a].top;)a++;r.splice(a,0,{seg:e,top:n,bottom:n+t})}return!0}return!1}for(var T in r)r[T]||(c[T.split(":")[0]]=!0);return{segsByFirstCol:l.map(extractFirstColSegs),segsByEachCol:l.map((function(t,n){var i=extractAllColSegs(t);return i=resliceDaySegs(i,e[n].date,n)})),segIsHidden:c,segTops:u,segMarginTops:p,moreCnts:d,moreTops:f,paddingBottoms:h}}function extractFirstColSegs(e,t){for(var n=[],i=0,r=e;i<r.length;i++){var a=r[i];a.seg.firstCol===t&&n.push(a.seg)}return n}function extractAllColSegs(e){for(var t=[],n=0,i=e;n<i.length;n++){var r=i[n];t.push(r.seg)}return t}function limitByMaxHeight(e,t,n,i){limitEvents(e,t,n,!0,(function(e){return e.bottom<=i}))}function limitByMaxEvents(e,t,n,i){limitEvents(e,t,n,!1,(function(e,t){return t<i}))}function limitByMaxRows(e,t,n,i){limitEvents(e,t,n,!0,(function(e,t){return t<i}))}function limitEvents(e,t,n,i,r){for(var a=e.length,s={},o=[],l=0;l<a;l++)o.push([]);for(l=0;l<a;l++)for(var d=0,c=0,u=n[l];c<u.length;c++){var p=u[c];r(p,d)?f(p):h(p,d,i),p.top!==p.bottom&&d++}function f(e){var t=e.seg,n=t.eventRange.instance.instanceId;if(!s[n]){s[n]=!0;for(var i=t.firstCol;i<=t.lastCol;i++)o[i].push(e)}}function h(n,i,r){var a=n.seg,s=a.eventRange.instance.instanceId;if(!t[s]){t[s]=!0;for(var l=a.firstCol;l<=a.lastCol;l++){var d=++e[l];if(r&&1===d)for(var c=i-1;o[l].length>c;)h(o[l].pop(),o[l].length,!1)}}}}function resliceDaySegs(e,t,n){for(var i={start:t,end:addDays(t,1)},r=[],a=0,s=e;a<s.length;a++){var o=s[a],l=o.eventRange,d=l.range,c=intersectRanges(d,i);c&&r.push(__assign(__assign({},o),{firstCol:n,lastCol:n,eventRange:{def:l.def,ui:__assign(__assign({},l.ui),{durationEditable:!1}),instance:l.instance,range:c},isStart:o.isStart&&c.start.valueOf()===d.start.valueOf(),isEnd:o.isEnd&&c.end.valueOf()===d.end.valueOf()}))}return r}var TableRow=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cellElRefs=new RefMap,t.frameElRefs=new RefMap,t.fgElRefs=new RefMap,t.segHarnessRefs=new RefMap,t.rootElRef=createRef(),t.state={framePositions:null,maxContentHeight:null,segHeights:{}},t}return __extends(t,e),t.prototype.render=function(){var e=this,t=this,n=t.props,i=t.state,r=t.context,a=n.cells.length,s=splitSegsByFirstCol(n.businessHourSegs,a),o=splitSegsByFirstCol(n.bgEventSegs,a),l=splitSegsByFirstCol(this.getHighlightSegs(),a),d=splitSegsByFirstCol(this.getMirrorSegs(),a),c=computeFgSegPlacement(n.cells,n.fgEventSegs,n.dayMaxEvents,n.dayMaxEventRows,i.segHeights,i.maxContentHeight,a,r.options.eventOrder),u=c.paddingBottoms,p=c.segsByFirstCol,f=c.segsByEachCol,h=c.segIsHidden,_=c.segTops,g=c.segMarginTops,m=c.moreCnts,v=c.moreTops,y=n.eventDrag&&n.eventDrag.affectedInstances||n.eventResize&&n.eventResize.affectedInstances||{};return createElement("tr",{ref:this.rootElRef},n.renderIntro&&n.renderIntro(),n.cells.map((function(t,i){var r=e.renderFgSegs(p[i],h,_,g,y,n.todayRange),a=e.renderFgSegs(d[i],{},_,{},{},n.todayRange,Boolean(n.eventDrag),Boolean(n.eventResize),!1);return createElement(TableCell,{key:t.key,elRef:e.cellElRefs.createRef(t.key),innerElRef:e.frameElRefs.createRef(t.key),dateProfile:n.dateProfile,date:t.date,showDayNumber:n.showDayNumbers,showWeekNumber:n.showWeekNumbers&&0===i,forceDayTop:n.showWeekNumbers,todayRange:n.todayRange,extraHookProps:t.extraHookProps,extraDataAttrs:t.extraDataAttrs,extraClassNames:t.extraClassNames,moreCnt:m[i],buildMoreLinkText:n.buildMoreLinkText,onMoreClick:n.onMoreClick,segIsHidden:h,moreMarginTop:v[i],segsByEachCol:f[i],fgPaddingBottom:u[i],fgContentElRef:e.fgElRefs.createRef(t.key),fgContent:createElement(Fragment,null,createElement(Fragment,null,r),createElement(Fragment,null,a)),bgContent:createElement(Fragment,null,e.renderFillSegs(l[i],"highlight"),e.renderFillSegs(s[i],"non-business"),e.renderFillSegs(o[i],"bg-event"))})})))},t.prototype.componentDidMount=function(){this.updateSizing(!0)},t.prototype.componentDidUpdate=function(e,t){var n=this.props;this.updateSizing(!isPropsEqual(e,n))},t.prototype.getHighlightSegs=function(){var e=this.props;return e.eventDrag&&e.eventDrag.segs.length?e.eventDrag.segs:e.eventResize&&e.eventResize.segs.length?e.eventResize.segs:e.dateSelectionSegs},t.prototype.getMirrorSegs=function(){var e=this.props;return e.eventResize&&e.eventResize.segs.length?e.eventResize.segs:[]},t.prototype.renderFgSegs=function(e,t,n,i,r,a,s,o,l){var d=this.context,c=this.props.eventSelection,u=this.state.framePositions,p=1===this.props.cells.length,f=[];if(u)for(var h=0,_=e;h<_.length;h++){var g=_[h],m=g.eventRange.instance.instanceId,v=s||o||l,y=r[m],b=t[m]||y,w=t[m]||v||g.firstCol!==g.lastCol||!g.isStart||!g.isEnd,E=void 0,S=void 0,D=void 0,C=void 0;w?(S=n[m],d.isRtl?(C=0,D=u.lefts[g.lastCol]-u.lefts[g.firstCol]):(D=0,C=u.rights[g.firstCol]-u.rights[g.lastCol])):E=i[m],f.push(createElement("div",{className:"fc-daygrid-event-harness"+(w?" fc-daygrid-event-harness-abs":""),key:m,ref:v?null:this.segHarnessRefs.createRef(m+":"+g.firstCol),style:{visibility:b?"hidden":"",marginTop:E||"",top:S||"",left:D||"",right:C||""}},hasListItemDisplay(g)?createElement(TableListItemEvent,__assign({seg:g,isDragging:s,isSelected:m===c,defaultDisplayEventEnd:p},getSegMeta(g,a))):createElement(TableBlockEvent,__assign({seg:g,isDragging:s,isResizing:o,isDateSelecting:l,isSelected:m===c,defaultDisplayEventEnd:p},getSegMeta(g,a)))))}return f},t.prototype.renderFillSegs=function(e,t){var n=this.context.isRtl,i=this.props.todayRange,r=this.state.framePositions,a=[];if(r)for(var s=0,o=e;s<o.length;s++){var l=o[s],d=n?{right:0,left:r.lefts[l.lastCol]-r.lefts[l.firstCol]}:{left:0,right:r.rights[l.firstCol]-r.rights[l.lastCol]};a.push(createElement("div",{key:buildEventRangeKey(l.eventRange),className:"fc-daygrid-bg-harness",style:d},"bg-event"===t?createElement(BgEvent,__assign({seg:l},getSegMeta(l,i))):renderFill(t)))}return createElement.apply(void 0,__spreadArrays([Fragment,{}],a))},t.prototype.updateSizing=function(e){var t=this.props,n=this.frameElRefs;if(null!==t.clientWidth){if(e){var i=t.cells.map((function(e){return n.currentMap[e.key]}));if(i.length){var r=this.rootElRef.current;this.setState({framePositions:new PositionCache(r,i,!0,!1)})}}var a=!0===t.dayMaxEvents||!0===t.dayMaxEventRows;this.setState({segHeights:this.computeSegHeights(),maxContentHeight:a?this.computeMaxContentHeight():null})}},t.prototype.computeSegHeights=function(){return mapHash(this.segHarnessRefs.currentMap,(function(e){return e.getBoundingClientRect().height}))},t.prototype.computeMaxContentHeight=function(){var e=this.props.cells[0].key,t=this.cellElRefs.currentMap[e],n=this.fgElRefs.currentMap[e];return t.getBoundingClientRect().bottom-n.getBoundingClientRect().top},t.prototype.getCellEls=function(){var e=this.cellElRefs.currentMap;return this.props.cells.map((function(t){return e[t.key]}))},t}(DateComponent);TableRow.addStateEquality({segHeights:isPropsEqual});var PADDING_FROM_VIEWPORT=10,SCROLL_DEBOUNCE=10,Popover=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.repositioner=new DelayedRunner(t.updateSize.bind(t)),t.handleRootEl=function(e){t.rootEl=e,t.props.elRef&&setRef(t.props.elRef,e)},t.handleDocumentMousedown=function(e){var n=t.props.onClose;n&&!t.rootEl.contains(e.target)&&n()},t.handleDocumentScroll=function(){t.repositioner.request(SCROLL_DEBOUNCE)},t.handleCloseClick=function(){var e=t.props.onClose;e&&e()},t}return __extends(t,e),t.prototype.render=function(){var e=this.context.theme,t=this.props,n=["fc-popover",e.getClass("popover")].concat(t.extraClassNames||[]);return createElement("div",__assign({className:n.join(" ")},t.extraAttrs,{ref:this.handleRootEl}),createElement("div",{className:"fc-popover-header "+e.getClass("popoverHeader")},createElement("span",{className:"fc-popover-title"},t.title),createElement("span",{className:"fc-popover-close "+e.getIconClass("close"),onClick:this.handleCloseClick})),createElement("div",{className:"fc-popover-body "+e.getClass("popoverContent")},t.children))},t.prototype.componentDidMount=function(){document.addEventListener("mousedown",this.handleDocumentMousedown),document.addEventListener("scroll",this.handleDocumentScroll),this.updateSize()},t.prototype.componentWillUnmount=function(){document.removeEventListener("mousedown",this.handleDocumentMousedown),document.removeEventListener("scroll",this.handleDocumentScroll)},t.prototype.updateSize=function(){var e=this.props,t=e.alignmentEl,n=e.topAlignmentEl,i=this.rootEl;if(i){var r,a=i.getBoundingClientRect(),s=t.getBoundingClientRect(),o=n?n.getBoundingClientRect().top:s.top;o=Math.min(o,window.innerHeight-a.height-PADDING_FROM_VIEWPORT),o=Math.max(o,PADDING_FROM_VIEWPORT),r=this.context.isRtl?s.right-a.width:s.left,r=Math.min(r,window.innerWidth-a.width-PADDING_FROM_VIEWPORT),applyStyle(i,{top:o,left:r=Math.max(r,PADDING_FROM_VIEWPORT)})}},t}(BaseComponent),MorePopover=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handlePopoverEl=function(e){t.popoverEl=e,e?t.context.registerInteractiveComponent(t,{el:e,useEventCenter:!1}):t.context.unregisterInteractiveComponent(t)},t}return __extends(t,e),t.prototype.render=function(){var e=this.context,t=e.options,n=e.dateEnv,i=this.props,r=i.date,a=i.hiddenInstances,s=i.todayRange,o=i.dateProfile,l=i.selectedInstanceId,d=n.format(r,t.dayPopoverFormat);return createElement(DayCellRoot,{date:r,dateProfile:o,todayRange:s,elRef:this.handlePopoverEl},(function(e,t,n){return createElement(Popover,{elRef:e,title:d,extraClassNames:["fc-more-popover"].concat(t),extraAttrs:n,onClose:i.onCloseClick,alignmentEl:i.alignmentEl,topAlignmentEl:i.topAlignmentEl},createElement(DayCellContent,{date:r,dateProfile:o,todayRange:s},(function(e,t){return t&&createElement("div",{className:"fc-more-popover-misc",ref:e},t)})),i.segs.map((function(e){var t=e.eventRange.instance.instanceId;return createElement("div",{className:"fc-daygrid-event-harness",key:t,style:{visibility:a[t]?"hidden":""}},hasListItemDisplay(e)?createElement(TableListItemEvent,__assign({seg:e,isDragging:!1,isSelected:t===l,defaultDisplayEventEnd:!1},getSegMeta(e,s))):createElement(TableBlockEvent,__assign({seg:e,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:t===l,defaultDisplayEventEnd:!1},getSegMeta(e,s))))})))}))},t.prototype.queryHit=function(e,t,n,i){var r=this.props.date;if(e<n&&t<i)return{component:this,dateSpan:{allDay:!0,range:{start:r,end:addDays(r,1)}},dayEl:this.popoverEl,rect:{left:0,top:0,right:n,bottom:i},layer:1}},t.prototype.isPopover=function(){return!0},t}(DateComponent),Table=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.splitBusinessHourSegs=memoize(splitSegsByRow),t.splitBgEventSegs=memoize(splitSegsByRow),t.splitFgEventSegs=memoize(splitSegsByRow),t.splitDateSelectionSegs=memoize(splitSegsByRow),t.splitEventDrag=memoize(splitInteractionByRow),t.splitEventResize=memoize(splitInteractionByRow),t.buildBuildMoreLinkText=memoize(buildBuildMoreLinkText),t.rowRefs=new RefMap,t.state={morePopoverState:null},t.handleRootEl=function(e){t.rootEl=e,setRef(t.props.elRef,e)},t.handleMoreLinkClick=function(e){var n=t.context,i=n.dateEnv,r=n.options.moreLinkClick;function a(e){var t=e.eventRange,r=t.def,a=t.instance,s=t.range;return{event:new EventApi(n,r,a),start:i.toDate(s.start),end:i.toDate(s.end),isStart:e.isStart,isEnd:e.isEnd}}"function"==typeof r&&(r=r({date:i.toDate(e.date),allDay:!0,allSegs:e.allSegs.map(a),hiddenSegs:e.hiddenSegs.map(a),jsEvent:e.ev,view:n.viewApi})),r&&"popover"!==r?"string"==typeof r&&n.calendarApi.zoomTo(e.date,r):t.setState({morePopoverState:__assign(__assign({},e),{currentFgEventSegs:t.props.fgEventSegs})})},t.handleMorePopoverClose=function(){t.setState({morePopoverState:null})},t}return __extends(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.dateProfile,i=t.dayMaxEventRows,r=t.dayMaxEvents,a=t.expandRows,s=this.state.morePopoverState,o=t.cells.length,l=this.splitBusinessHourSegs(t.businessHourSegs,o),d=this.splitBgEventSegs(t.bgEventSegs,o),c=this.splitFgEventSegs(t.fgEventSegs,o),u=this.splitDateSelectionSegs(t.dateSelectionSegs,o),p=this.splitEventDrag(t.eventDrag,o),f=this.splitEventResize(t.eventResize,o),h=this.buildBuildMoreLinkText(this.context.options.moreLinkText),_=!0===r||!0===i;return _&&!a&&(_=!1,i=null,r=null),createElement("div",{className:["fc-daygrid-body",_?"fc-daygrid-body-balanced":"fc-daygrid-body-unbalanced",a?"":"fc-daygrid-body-natural"].join(" "),ref:this.handleRootEl,style:{width:t.clientWidth,minWidth:t.tableMinWidth}},createElement(NowTimer,{unit:"day"},(function(_,g){return createElement(Fragment,null,createElement("table",{className:"fc-scrollgrid-sync-table",style:{width:t.clientWidth,minWidth:t.tableMinWidth,height:a?t.clientHeight:""}},t.colGroupNode,createElement("tbody",null,t.cells.map((function(a,s){return createElement(TableRow,{ref:e.rowRefs.createRef(s),key:a.length?a[0].date.toISOString():s,showDayNumbers:o>1,showWeekNumbers:t.showWeekNumbers,todayRange:g,dateProfile:n,cells:a,renderIntro:t.renderRowIntro,businessHourSegs:l[s],eventSelection:t.eventSelection,bgEventSegs:d[s].filter(isSegAllDay),fgEventSegs:c[s],dateSelectionSegs:u[s],eventDrag:p[s],eventResize:f[s],dayMaxEvents:r,dayMaxEventRows:i,clientWidth:t.clientWidth,clientHeight:t.clientHeight,buildMoreLinkText:h,onMoreClick:e.handleMoreLinkClick})})))),!t.forPrint&&s&&s.currentFgEventSegs===t.fgEventSegs&&createElement(MorePopover,{date:s.date,dateProfile:n,segs:s.allSegs,alignmentEl:s.dayEl,topAlignmentEl:1===o?t.headerAlignElRef.current:null,onCloseClick:e.handleMorePopoverClose,selectedInstanceId:t.eventSelection,hiddenInstances:(t.eventDrag?t.eventDrag.affectedInstances:null)||(t.eventResize?t.eventResize.affectedInstances:null)||{},todayRange:g}))})))},t.prototype.prepareHits=function(){this.rowPositions=new PositionCache(this.rootEl,this.rowRefs.collect().map((function(e){return e.getCellEls()[0]})),!1,!0),this.colPositions=new PositionCache(this.rootEl,this.rowRefs.currentMap[0].getCellEls(),!0,!1)},t.prototype.positionToHit=function(e,t){var n=this.colPositions,i=this.rowPositions,r=n.leftToIndex(e),a=i.topToIndex(t);if(null!=a&&null!=r)return{row:a,col:r,dateSpan:{range:this.getCellRange(a,r),allDay:!0},dayEl:this.getCellEl(a,r),relativeRect:{left:n.lefts[r],right:n.rights[r],top:i.tops[a],bottom:i.bottoms[a]}}},t.prototype.getCellEl=function(e,t){return this.rowRefs.currentMap[e].getCellEls()[t]},t.prototype.getCellRange=function(e,t){var n=this.props.cells[e][t].date;return{start:n,end:addDays(n,1)}},t}(DateComponent);function buildBuildMoreLinkText(e){return"function"==typeof e?e:function(t){return"+"+t+" "+e}}function isSegAllDay(e){return e.eventRange.def.allDay}var DayTable=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.slicer=new DayTableSlicer,t.tableRef=createRef(),t.handleRootEl=function(e){e?t.context.registerInteractiveComponent(t,{el:e}):t.context.unregisterInteractiveComponent(t)},t}return __extends(t,e),t.prototype.render=function(){var e=this.props,t=this.context;return createElement(Table,__assign({ref:this.tableRef,elRef:this.handleRootEl},this.slicer.sliceProps(e,e.dateProfile,e.nextDayThreshold,t,e.dayTableModel),{dateProfile:e.dateProfile,cells:e.dayTableModel.cells,colGroupNode:e.colGroupNode,tableMinWidth:e.tableMinWidth,renderRowIntro:e.renderRowIntro,dayMaxEvents:e.dayMaxEvents,dayMaxEventRows:e.dayMaxEventRows,showWeekNumbers:e.showWeekNumbers,expandRows:e.expandRows,headerAlignElRef:e.headerAlignElRef,clientWidth:e.clientWidth,clientHeight:e.clientHeight,forPrint:e.forPrint}))},t.prototype.prepareHits=function(){this.tableRef.current.prepareHits()},t.prototype.queryHit=function(e,t){var n=this.tableRef.current.positionToHit(e,t);if(n)return{component:this,dateSpan:n.dateSpan,dayEl:n.dayEl,rect:{left:n.relativeRect.left,right:n.relativeRect.right,top:n.relativeRect.top,bottom:n.relativeRect.bottom},layer:0}},t}(DateComponent),DayTableSlicer=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.forceDayIfListItem=!0,t}return __extends(t,e),t.prototype.sliceRange=function(e,t){return t.sliceRange(e)},t}(Slicer),DayTableView=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.buildDayTableModel=memoize(buildDayTableModel),t.headerRef=createRef(),t.tableRef=createRef(),t}return __extends(t,e),t.prototype.render=function(){var e=this,t=this.context,n=t.options,i=t.dateProfileGenerator,r=this.props,a=this.buildDayTableModel(r.dateProfile,i),s=n.dayHeaders&&createElement(DayHeader,{ref:this.headerRef,dateProfile:r.dateProfile,dates:a.headerDates,datesRepDistinctDays:1===a.rowCnt}),o=function(t){return createElement(DayTable,{ref:e.tableRef,dateProfile:r.dateProfile,dayTableModel:a,businessHours:r.businessHours,dateSelection:r.dateSelection,eventStore:r.eventStore,eventUiBases:r.eventUiBases,eventSelection:r.eventSelection,eventDrag:r.eventDrag,eventResize:r.eventResize,nextDayThreshold:n.nextDayThreshold,colGroupNode:t.tableColGroupNode,tableMinWidth:t.tableMinWidth,dayMaxEvents:n.dayMaxEvents,dayMaxEventRows:n.dayMaxEventRows,showWeekNumbers:n.weekNumbers,expandRows:!r.isHeightAuto,headerAlignElRef:e.headerElRef,clientWidth:t.clientWidth,clientHeight:t.clientHeight,forPrint:r.forPrint})};return n.dayMinWidth?this.renderHScrollLayout(s,o,a.colCnt,n.dayMinWidth):this.renderSimpleLayout(s,o)},t}(TableView);function buildDayTableModel(e,t){var n=new DaySeriesModel(e.renderRange,t);return new DayTableModel(n,/year|month|week/.test(e.currentRangeUnit))}var TableDateProfileGenerator=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.buildRenderRange=function(t,n,i){var r,a=this.props.dateEnv,s=e.prototype.buildRenderRange.call(this,t,n,i),o=s.start,l=s.end;(/^(year|month)$/.test(n)&&(o=a.startOfWeek(o),(r=a.startOfWeek(l)).valueOf()!==l.valueOf()&&(l=addWeeks(r,1))),this.props.monthMode&&this.props.fixedWeekCount)&&(l=addWeeks(l,6-Math.ceil(diffWeeks(o,l))));return{start:o,end:l}},t}(DateProfileGenerator),OPTION_REFINERS={moreLinkClick:identity,moreLinkClassNames:identity,moreLinkContent:identity,moreLinkDidMount:identity,moreLinkWillUnmount:identity},main=createPlugin({initialView:"dayGridMonth",optionRefiners:OPTION_REFINERS,views:{dayGrid:{component:DayTableView,dateProfileGeneratorClass:TableDateProfileGenerator},dayGridDay:{type:"dayGrid",duration:{days:1}},dayGridWeek:{type:"dayGrid",duration:{weeks:1}},dayGridMonth:{type:"dayGrid",duration:{months:1},monthMode:!0,fixedWeekCount:!0}}}),AllDaySplitter=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getKeyInfo=function(){return{allDay:{},timed:{}}},t.prototype.getKeysForDateSpan=function(e){return e.allDay?["allDay"]:["timed"]},t.prototype.getKeysForEventDef=function(e){return e.allDay?hasBgRendering(e)?["timed","allDay"]:["allDay"]:["timed"]},t}(Splitter),TimeColsSlatsCoords=function(){function e(e,t,n){this.positions=e,this.dateProfile=t,this.slatMetas=n}return e.prototype.safeComputeTop=function(e){var t=this.dateProfile;if(rangeContainsMarker(t.currentRange,e)){var n=startOfDay(e),i=e.valueOf()-n.valueOf();if(i>=asRoughMs(t.slotMinTime)&&i<asRoughMs(t.slotMaxTime))return this.computeTimeTop(createDuration(i))}},e.prototype.computeDateTop=function(e,t){return t||(t=startOfDay(e)),this.computeTimeTop(createDuration(e.valueOf()-t.valueOf()))},e.prototype.computeTimeTop=function(e){var t,n,i=this,r=i.positions,a=i.dateProfile,s=i.slatMetas,o=r.els.length,l=s[1].date.valueOf()-s[0].date.valueOf(),d=(e.milliseconds-asRoughMs(a.slotMinTime))/l;return d=Math.max(0,d),d=Math.min(o,d),t=Math.floor(d),n=d-(t=Math.min(t,o-1)),r.tops[t]+r.getHeight(t)*n},e}(),STOCK_SUB_DURATIONS=[{hours:1},{minutes:30},{minutes:15},{seconds:30},{seconds:15}],TimeColsSlats=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.rootElRef=createRef(),t.slatElRefs=new RefMap,t}return __extends(t,e),t.prototype.render=function(){var e=this.props,t=this.context;return createElement("div",{className:"fc-timegrid-slots",ref:this.rootElRef},createElement("table",{className:t.theme.getClass("table"),style:{minWidth:e.tableMinWidth,width:e.clientWidth,height:e.minHeight}},e.tableColGroupNode,createElement(TimeColsSlatsBody,{slatElRefs:this.slatElRefs,axis:e.axis,slatMetas:e.slatMetas})))},t.prototype.componentDidMount=function(){this.updateSizing()},t.prototype.componentDidUpdate=function(){this.updateSizing()},t.prototype.componentWillUnmount=function(){this.props.onCoords&&this.props.onCoords(null)},t.prototype.updateSizing=function(){var e=this.props;e.onCoords&&null!==e.clientWidth&&(this.rootElRef.current.offsetHeight&&e.onCoords(new TimeColsSlatsCoords(new PositionCache(this.rootElRef.current,collectSlatEls(this.slatElRefs.currentMap,e.slatMetas),!1,!0),this.props.dateProfile,e.slatMetas)))},t}(BaseComponent);function collectSlatEls(e,t){return t.map((function(t){return e[t.key]}))}var TimeColsSlatsBody=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.render=function(){var e=this.props,t=this.context,n=t.options,i=e.slatElRefs;return createElement("tbody",null,e.slatMetas.map((function(r,a){var s={time:r.time,date:t.dateEnv.toDate(r.date),view:t.viewApi},o=["fc-timegrid-slot","fc-timegrid-slot-lane",r.isLabeled?"":"fc-timegrid-slot-minor"];return createElement("tr",{key:r.key,ref:i.createRef(r.key)},e.axis&&createElement(TimeColsAxisCell,__assign({},r)),createElement(RenderHook,{hookProps:s,classNames:n.slotLaneClassNames,content:n.slotLaneContent,didMount:n.slotLaneDidMount,willUnmount:n.slotLaneWillUnmount},(function(e,t,n,i){return createElement("td",{ref:e,className:o.concat(t).join(" "),"data-time":r.isoTimeStr},i)})))})))},t}(BaseComponent),DEFAULT_SLAT_LABEL_FORMAT=createFormatter({hour:"numeric",minute:"2-digit",omitZeroMinute:!0,meridiem:"short"});function TimeColsAxisCell(e){var t=["fc-timegrid-slot","fc-timegrid-slot-label",e.isLabeled?"fc-scrollgrid-shrink":"fc-timegrid-slot-minor"];return createElement(ViewContextType.Consumer,null,(function(n){if(e.isLabeled){var i=n.dateEnv,r=n.options,a=n.viewApi,s=null==r.slotLabelFormat?DEFAULT_SLAT_LABEL_FORMAT:Array.isArray(r.slotLabelFormat)?createFormatter(r.slotLabelFormat[0]):createFormatter(r.slotLabelFormat),o={level:0,time:e.time,date:i.toDate(e.date),view:a,text:i.format(e.date,s)};return createElement(RenderHook,{hookProps:o,classNames:r.slotLabelClassNames,content:r.slotLabelContent,defaultContent:renderInnerContent$3,didMount:r.slotLabelDidMount,willUnmount:r.slotLabelWillUnmount},(function(n,i,r,a){return createElement("td",{ref:n,className:t.concat(i).join(" "),"data-time":e.isoTimeStr},createElement("div",{className:"fc-timegrid-slot-label-frame fc-scrollgrid-shrink-frame"},createElement("div",{className:"fc-timegrid-slot-label-cushion fc-scrollgrid-shrink-cushion",ref:r},a)))}))}return createElement("td",{className:t.join(" "),"data-time":e.isoTimeStr})}))}function renderInnerContent$3(e){return e.text}function buildSlatMetas(e,t,n,i,r){for(var a=new Date(0),s=e,o=createDuration(0),l=n||computeLabelInterval(i),d=[];asRoughMs(s)<asRoughMs(t);){var c=r.add(a,s),u=null!==wholeDivideDurations(o,l);d.push({date:c,time:s,key:c.toISOString(),isoTimeStr:formatIsoTimeString(c),isLabeled:u}),s=addDurations(s,i),o=addDurations(o,i)}return d}function computeLabelInterval(e){var t,n,i;for(t=STOCK_SUB_DURATIONS.length-1;t>=0;t--)if(null!==(i=wholeDivideDurations(n=createDuration(STOCK_SUB_DURATIONS[t]),e))&&i>1)return n;return e}var DEFAULT_WEEK_NUM_FORMAT$1=createFormatter({week:"short"}),AUTO_ALL_DAY_MAX_EVENT_ROWS=5,TimeColsView=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.allDaySplitter=new AllDaySplitter,t.headerElRef=createRef(),t.rootElRef=createRef(),t.scrollerElRef=createRef(),t.state={slatCoords:null},t.handleScrollTopRequest=function(e){var n=t.scrollerElRef.current;n&&(n.scrollTop=e)},t.renderHeadAxis=function(e){void 0===e&&(e="");var n=t.context.options,i=t.props.dateProfile.renderRange,r=diffDays(i.start,i.end),a=n.navLinks&&1===r?{"data-navlink":buildNavLinkData(i.start,"week"),tabIndex:0}:{};return n.weekNumbers?createElement(WeekNumberRoot,{date:i.start,defaultFormat:DEFAULT_WEEK_NUM_FORMAT$1},(function(t,n,i,r){return createElement("th",{ref:t,className:["fc-timegrid-axis","fc-scrollgrid-shrink"].concat(n).join(" ")},createElement("div",{className:"fc-timegrid-axis-frame fc-scrollgrid-shrink-frame fc-timegrid-axis-frame-liquid",style:{height:e}},createElement("a",__assign({ref:i,className:"fc-timegrid-axis-cushion fc-scrollgrid-shrink-cushion fc-scrollgrid-sync-inner"},a),r)))})):createElement("th",{className:"fc-timegrid-axis"},createElement("div",{className:"fc-timegrid-axis-frame",style:{height:e}}))},t.renderTableRowAxis=function(e){var n=t.context,i=n.options,r=n.viewApi,a={text:i.allDayText,view:r};return createElement(RenderHook,{hookProps:a,classNames:i.allDayClassNames,content:i.allDayContent,defaultContent:renderAllDayInner,didMount:i.allDayDidMount,willUnmount:i.allDayWillUnmount},(function(t,n,i,r){return createElement("td",{ref:t,className:["fc-timegrid-axis","fc-scrollgrid-shrink"].concat(n).join(" ")},createElement("div",{className:"fc-timegrid-axis-frame fc-scrollgrid-shrink-frame"+(null==e?" fc-timegrid-axis-frame-liquid":""),style:{height:e}},createElement("span",{className:"fc-timegrid-axis-cushion fc-scrollgrid-shrink-cushion fc-scrollgrid-sync-inner",ref:i},r)))}))},t.handleSlatCoords=function(e){t.setState({slatCoords:e})},t}return __extends(t,e),t.prototype.renderSimpleLayout=function(e,t,n){var i=this.context,r=this.props,a=[],s=getStickyHeaderDates(i.options);return e&&a.push({type:"header",key:"header",isSticky:s,chunk:{elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}}),t&&(a.push({type:"body",key:"all-day",chunk:{content:t}}),a.push({type:"body",key:"all-day-divider",outerContent:createElement("tr",{className:"fc-scrollgrid-section"},createElement("td",{className:"fc-timegrid-divider "+i.theme.getClass("tableCellShaded")}))})),a.push({type:"body",key:"body",liquid:!0,expandRows:Boolean(i.options.expandRows),chunk:{scrollerElRef:this.scrollerElRef,content:n}}),createElement(ViewRoot,{viewSpec:i.viewSpec,elRef:this.rootElRef},(function(e,t){return createElement("div",{className:["fc-timegrid"].concat(t).join(" "),ref:e},createElement(SimpleScrollGrid,{liquid:!r.isHeightAuto&&!r.forPrint,cols:[{width:"shrink"}],sections:a}))}))},t.prototype.renderHScrollLayout=function(e,t,n,i,r,a,s){var o=this,l=this.context.pluginHooks.scrollGridImpl;if(!l)throw new Error("No ScrollGrid implementation");var d=this.context,c=this.props,u=!c.forPrint&&getStickyHeaderDates(d.options),p=!c.forPrint&&getStickyFooterScrollbar(d.options),f=[];e&&f.push({type:"header",key:"header",isSticky:u,syncRowHeights:!0,chunks:[{key:"axis",rowContent:function(e){return createElement("tr",null,o.renderHeadAxis(e.rowSyncHeights[0]))}},{key:"cols",elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}]}),t&&(f.push({type:"body",key:"all-day",syncRowHeights:!0,chunks:[{key:"axis",rowContent:function(e){return createElement("tr",null,o.renderTableRowAxis(e.rowSyncHeights[0]))}},{key:"cols",content:t}]}),f.push({key:"all-day-divider",type:"body",outerContent:createElement("tr",{className:"fc-scrollgrid-section"},createElement("td",{colSpan:2,className:"fc-timegrid-divider "+d.theme.getClass("tableCellShaded")}))}));var h=d.options.nowIndicator;return f.push({type:"body",key:"body",liquid:!0,expandRows:Boolean(d.options.expandRows),chunks:[{key:"axis",content:function(e){return createElement("div",{className:"fc-timegrid-axis-chunk"},createElement("table",{style:{height:e.expandRows?e.clientHeight:""}},e.tableColGroupNode,createElement("tbody",null,createElement(TimeBodyAxis,{slatMetas:a}))),createElement("div",{className:"fc-timegrid-now-indicator-container"},createElement(NowTimer,{unit:h?"minute":"day"},(function(e){var t=h&&s&&s.safeComputeTop(e);return"number"==typeof t?createElement(NowIndicatorRoot,{isAxis:!0,date:e},(function(e,n,i,r){return createElement("div",{ref:e,className:["fc-timegrid-now-indicator-arrow"].concat(n).join(" "),style:{top:t}},r)})):null}))))}},{key:"cols",scrollerElRef:this.scrollerElRef,content:n}]}),p&&f.push({key:"footer",type:"footer",isSticky:!0,chunks:[{key:"axis",content:renderScrollShim},{key:"cols",content:renderScrollShim}]}),createElement(ViewRoot,{viewSpec:d.viewSpec,elRef:this.rootElRef},(function(e,t){return createElement("div",{className:["fc-timegrid"].concat(t).join(" "),ref:e},createElement(l,{liquid:!c.isHeightAuto&&!c.forPrint,colGroups:[{width:"shrink",cols:[{width:"shrink"}]},{cols:[{span:i,minWidth:r}]}],sections:f}))}))},t.prototype.getAllDayMaxEventProps=function(){var e=this.context.options,t=e.dayMaxEvents,n=e.dayMaxEventRows;return!0!==t&&!0!==n||(t=void 0,n=AUTO_ALL_DAY_MAX_EVENT_ROWS),{dayMaxEvents:t,dayMaxEventRows:n}},t}(DateComponent);function renderAllDayInner(e){return e.text}var TimeBodyAxis=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.render=function(){return this.props.slatMetas.map((function(e){return createElement("tr",{key:e.key},createElement(TimeColsAxisCell,__assign({},e)))}))},t}(BaseComponent);function splitSegsByCol(e,t){var n,i=[];for(n=0;n<t;n++)i.push([]);if(e)for(n=0;n<e.length;n++)i[e[n].col].push(e[n]);return i}function splitInteractionByCol(e,t){var n=[];if(e){for(s=0;s<t;s++)n[s]={affectedInstances:e.affectedInstances,isEvent:e.isEvent,segs:[]};for(var i=0,r=e.segs;i<r.length;i++){var a=r[i];n[a.col].segs.push(a)}}else for(var s=0;s<t;s++)n[s]=null;return n}function computeSegCoords(e,t,n,i,r){return computeSegVerticals(e,t,n,i),computeSegHorizontals(e,r)}function computeSegVerticals(e,t,n,i){for(var r=0,a=e;r<a.length;r++){var s=a[r];s.top=n.computeDateTop(s.start,t),s.bottom=Math.max(s.top+(i||0),n.computeDateTop(s.end,t))}}function computeSegHorizontals(e,t){for(var n=0,i=e;n<i.length;n++){(c=i[n]).level=null,c.forwardCoord=null,c.backwardCoord=null,c.forwardPressure=null}var r,a=buildSlotSegLevels(e=sortEventSegs(e,t));if(computeForwardSlotSegs(a),r=a[0]){for(var s=0,o=r;s<o.length;s++){computeSlotSegPressures(c=o[s])}for(var l=0,d=r;l<d.length;l++){var c;computeSegForwardBack(c=d[l],0,0,t)}}return e}function buildSlotSegLevels(e){var t,n,i,r=[];for(t=0;t<e.length;t++){for(n=e[t],i=0;i<r.length&&computeSlotSegCollisions(n,r[i]).length;i++);n.level=i,(r[i]||(r[i]=[])).push(n)}return r}function computeSlotSegCollisions(e,t,n){void 0===n&&(n=[]);for(var i=0;i<t.length;i++)isSlotSegCollision(e,t[i])&&n.push(t[i]);return n}function isSlotSegCollision(e,t){return e.bottom>t.top&&e.top<t.bottom}function computeForwardSlotSegs(e){var t,n,i,r,a;for(t=0;t<e.length;t++)for(n=e[t],i=0;i<n.length;i++)for((r=n[i]).forwardSegs=[],a=t+1;a<e.length;a++)computeSlotSegCollisions(r,e[a],r.forwardSegs)}function computeSlotSegPressures(e){var t,n,i=e.forwardSegs,r=0;if(null==e.forwardPressure){for(t=0;t<i.length;t++)computeSlotSegPressures(n=i[t]),r=Math.max(r,1+n.forwardPressure);e.forwardPressure=r}}function computeSegForwardBack(e,t,n,i){var r,a=e.forwardSegs;if(null==e.forwardCoord)for(a.length?(sortForwardSegs(a,i),computeSegForwardBack(a[0],t+1,n,i),e.forwardCoord=a[0].backwardCoord):e.forwardCoord=1,e.backwardCoord=e.forwardCoord-(e.forwardCoord-n)/(t+1),r=0;r<a.length;r++)computeSegForwardBack(a[r],0,e.forwardCoord,i)}function sortForwardSegs(e,t){var n=e.map(buildTimeGridSegCompareObj),i=[{field:"forwardPressure",order:-1},{field:"backwardCoord",order:1}].concat(t);return n.sort((function(e,t){return compareByFieldSpecs(e,t,i)})),n.map((function(e){return e._seg}))}function buildTimeGridSegCompareObj(e){var t=buildSegCompareObj(e);return t.forwardPressure=e.forwardPressure,t.backwardCoord=e.backwardCoord,t}var DEFAULT_TIME_FORMAT=createFormatter({hour:"numeric",minute:"2-digit",meridiem:!1}),TimeColEvent=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.render=function(){var e=["fc-timegrid-event","fc-v-event"];return this.props.isCondensed&&e.push("fc-timegrid-event-condensed"),createElement(StandardEvent,__assign({},this.props,{defaultTimeFormat:DEFAULT_TIME_FORMAT,extraClassNames:e}))},t}(BaseComponent);config.timeGridEventCondensedHeight=30;var TimeCol=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.render=function(){var e=this,t=this.props,n=this.context.options.selectMirror,i=t.eventDrag&&t.eventDrag.segs||t.eventResize&&t.eventResize.segs||n&&t.dateSelectionSegs||[],r=t.eventDrag&&t.eventDrag.affectedInstances||t.eventResize&&t.eventResize.affectedInstances||{};return createElement(DayCellRoot,{elRef:t.elRef,date:t.date,dateProfile:t.dateProfile,todayRange:t.todayRange,extraHookProps:t.extraHookProps},(function(a,s,o){return createElement("td",__assign({ref:a,className:["fc-timegrid-col"].concat(s,t.extraClassNames||[]).join(" ")},o,t.extraDataAttrs),createElement("div",{className:"fc-timegrid-col-frame"},createElement("div",{className:"fc-timegrid-col-bg"},e.renderFillSegs(t.businessHourSegs,"non-business"),e.renderFillSegs(t.bgEventSegs,"bg-event"),e.renderFillSegs(t.dateSelectionSegs,"highlight")),createElement("div",{className:"fc-timegrid-col-events"},e.renderFgSegs(t.fgEventSegs,r)),createElement("div",{className:"fc-timegrid-col-events"},e.renderFgSegs(i,{},Boolean(t.eventDrag),Boolean(t.eventResize),Boolean(n))),createElement("div",{className:"fc-timegrid-now-indicator-container"},e.renderNowIndicator(t.nowIndicatorSegs)),createElement(TimeColMisc,{date:t.date,dateProfile:t.dateProfile,todayRange:t.todayRange,extraHookProps:t.extraHookProps})))}))},t.prototype.renderFgSegs=function(e,t,n,i,r){var a=this.props;return a.forPrint?this.renderPrintFgSegs(e):a.slatCoords?this.renderPositionedFgSegs(e,t,n,i,r):void 0},t.prototype.renderPrintFgSegs=function(e){var t=this.props;return(e=sortEventSegs(e,this.context.options.eventOrder)).map((function(e){return createElement("div",{className:"fc-timegrid-event-harness",key:e.eventRange.instance.instanceId},createElement(TimeColEvent,__assign({seg:e,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:!1,isCondensed:!1},getSegMeta(e,t.todayRange,t.nowDate))))}))},t.prototype.renderPositionedFgSegs=function(e,t,n,i,r){var a=this,s=this.context,o=this.props;return(e=computeSegCoords(e,o.date,o.slatCoords,s.options.eventMinHeight,s.options.eventOrder)).map((function(e){var s=e.eventRange.instance.instanceId,l=n||i||r?__assign({left:0,right:0},a.computeSegTopBottomCss(e)):a.computeFgSegPositionCss(e);return createElement("div",{className:"fc-timegrid-event-harness"+(e.level>0?" fc-timegrid-event-harness-inset":""),key:s,style:__assign({visibility:t[s]?"hidden":""},l)},createElement(TimeColEvent,__assign({seg:e,isDragging:n,isResizing:i,isDateSelecting:r,isSelected:s===o.eventSelection,isCondensed:e.bottom-e.top<config.timeGridEventCondensedHeight},getSegMeta(e,o.todayRange,o.nowDate))))}))},t.prototype.renderFillSegs=function(e,t){var n=this,i=this.context,r=this.props;if(r.slatCoords){computeSegVerticals(e,r.date,r.slatCoords,i.options.eventMinHeight);var a=e.map((function(e){return createElement("div",{key:buildEventRangeKey(e.eventRange),className:"fc-timegrid-bg-harness",style:n.computeSegTopBottomCss(e)},"bg-event"===t?createElement(BgEvent,__assign({seg:e},getSegMeta(e,r.todayRange,r.nowDate))):renderFill(t))}));return createElement(Fragment,null,a)}},t.prototype.renderNowIndicator=function(e){var t=this.props,n=t.slatCoords,i=t.date;if(n)return e.map((function(e,t){return createElement(NowIndicatorRoot,{isAxis:!1,date:i,key:t},(function(t,r,a,s){return createElement("div",{ref:t,className:["fc-timegrid-now-indicator-line"].concat(r).join(" "),style:{top:n.computeDateTop(e.start,i)}},s)}))}))},t.prototype.computeFgSegPositionCss=function(e){var t,n,i=this.context,r=i.isRtl,a=i.options.slotEventOverlap,s=e.backwardCoord,o=e.forwardCoord;a&&(o=Math.min(1,s+2*(o-s))),r?(t=1-o,n=s):(t=s,n=1-o);var l={zIndex:e.level+1,left:100*t+"%",right:100*n+"%"};return a&&e.forwardPressure&&(l[r?"marginLeft":"marginRight"]=20),__assign(__assign({},l),this.computeSegTopBottomCss(e))},t.prototype.computeSegTopBottomCss=function(e){return{top:e.top,bottom:-e.bottom}},t}(BaseComponent),TimeColMisc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.render=function(){var e=this.props;return createElement(DayCellContent,{date:e.date,dateProfile:e.dateProfile,todayRange:e.todayRange,extraHookProps:e.extraHookProps},(function(e,t){return t&&createElement("div",{className:"fc-timegrid-col-misc",ref:e},t)}))},t}(BaseComponent),TimeColsContent=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.splitFgEventSegs=memoize(splitSegsByCol),t.splitBgEventSegs=memoize(splitSegsByCol),t.splitBusinessHourSegs=memoize(splitSegsByCol),t.splitNowIndicatorSegs=memoize(splitSegsByCol),t.splitDateSelectionSegs=memoize(splitSegsByCol),t.splitEventDrag=memoize(splitInteractionByCol),t.splitEventResize=memoize(splitInteractionByCol),t.rootElRef=createRef(),t.cellElRefs=new RefMap,t}return __extends(t,e),t.prototype.render=function(){var e=this,t=this.props,n=this.context.options.nowIndicator&&t.slatCoords&&t.slatCoords.safeComputeTop(t.nowDate),i=t.cells.length,r=this.splitFgEventSegs(t.fgEventSegs,i),a=this.splitBgEventSegs(t.bgEventSegs,i),s=this.splitBusinessHourSegs(t.businessHourSegs,i),o=this.splitNowIndicatorSegs(t.nowIndicatorSegs,i),l=this.splitDateSelectionSegs(t.dateSelectionSegs,i),d=this.splitEventDrag(t.eventDrag,i),c=this.splitEventResize(t.eventResize,i);return createElement("div",{className:"fc-timegrid-cols",ref:this.rootElRef},createElement("table",{style:{minWidth:t.tableMinWidth,width:t.clientWidth}},t.tableColGroupNode,createElement("tbody",null,createElement("tr",null,t.axis&&createElement("td",{className:"fc-timegrid-col fc-timegrid-axis"},createElement("div",{className:"fc-timegrid-col-frame"},createElement("div",{className:"fc-timegrid-now-indicator-container"},"number"==typeof n&&createElement(NowIndicatorRoot,{isAxis:!0,date:t.nowDate},(function(e,t,i,r){return createElement("div",{ref:e,className:["fc-timegrid-now-indicator-arrow"].concat(t).join(" "),style:{top:n}},r)}))))),t.cells.map((function(n,i){return createElement(TimeCol,{key:n.key,elRef:e.cellElRefs.createRef(n.key),dateProfile:t.dateProfile,date:n.date,nowDate:t.nowDate,todayRange:t.todayRange,extraHookProps:n.extraHookProps,extraDataAttrs:n.extraDataAttrs,extraClassNames:n.extraClassNames,fgEventSegs:r[i],bgEventSegs:a[i],businessHourSegs:s[i],nowIndicatorSegs:o[i],dateSelectionSegs:l[i],eventDrag:d[i],eventResize:c[i],slatCoords:t.slatCoords,eventSelection:t.eventSelection,forPrint:t.forPrint})}))))))},t.prototype.componentDidMount=function(){this.updateCoords()},t.prototype.componentDidUpdate=function(){this.updateCoords()},t.prototype.updateCoords=function(){var e=this.props;e.onColCoords&&null!==e.clientWidth&&e.onColCoords(new PositionCache(this.rootElRef.current,collectCellEls(this.cellElRefs.currentMap,e.cells),!0,!1))},t}(BaseComponent);function collectCellEls(e,t){return t.map((function(t){return e[t.key]}))}var TimeCols=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.processSlotOptions=memoize(processSlotOptions),t.state={slatCoords:null},t.handleScrollRequest=function(e){var n=t.props.onScrollTopRequest,i=t.state.slatCoords;if(n&&i){if(e.time){var r=i.computeTimeTop(e.time);(r=Math.ceil(r))&&r++,n(r)}return!0}},t.handleColCoords=function(e){t.colCoords=e},t.handleSlatCoords=function(e){t.setState({slatCoords:e}),t.props.onSlatCoords&&t.props.onSlatCoords(e)},t}return __extends(t,e),t.prototype.render=function(){var e=this.props,t=this.state;return createElement("div",{className:"fc-timegrid-body",ref:e.rootElRef,style:{width:e.clientWidth,minWidth:e.tableMinWidth}},createElement(TimeColsSlats,{axis:e.axis,dateProfile:e.dateProfile,slatMetas:e.slatMetas,clientWidth:e.clientWidth,minHeight:e.expandRows?e.clientHeight:"",tableMinWidth:e.tableMinWidth,tableColGroupNode:e.axis?e.tableColGroupNode:null,onCoords:this.handleSlatCoords}),createElement(TimeColsContent,{cells:e.cells,axis:e.axis,dateProfile:e.dateProfile,businessHourSegs:e.businessHourSegs,bgEventSegs:e.bgEventSegs,fgEventSegs:e.fgEventSegs,dateSelectionSegs:e.dateSelectionSegs,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,todayRange:e.todayRange,nowDate:e.nowDate,nowIndicatorSegs:e.nowIndicatorSegs,clientWidth:e.clientWidth,tableMinWidth:e.tableMinWidth,tableColGroupNode:e.tableColGroupNode,slatCoords:t.slatCoords,onColCoords:this.handleColCoords,forPrint:e.forPrint}))},t.prototype.componentDidMount=function(){this.scrollResponder=this.context.createScrollResponder(this.handleScrollRequest)},t.prototype.componentDidUpdate=function(e){this.scrollResponder.update(e.dateProfile!==this.props.dateProfile)},t.prototype.componentWillUnmount=function(){this.scrollResponder.detach()},t.prototype.positionToHit=function(e,t){var n=this.context,i=n.dateEnv,r=n.options,a=this.colCoords,s=this.props.dateProfile,o=this.state.slatCoords,l=this.processSlotOptions(this.props.slotDuration,r.snapDuration),d=l.snapDuration,c=l.snapsPerSlot,u=a.leftToIndex(e),p=o.positions.topToIndex(t);if(null!=u&&null!=p){var f=o.positions.tops[p],h=o.positions.getHeight(p),_=(t-f)/h,g=p*c+Math.floor(_*c),m=this.props.cells[u].date,v=addDurations(s.slotMinTime,multiplyDuration(d,g)),y=i.add(m,v);return{col:u,dateSpan:{range:{start:y,end:i.add(y,d)},allDay:!1},dayEl:a.els[u],relativeRect:{left:a.lefts[u],right:a.rights[u],top:f,bottom:f+h}}}},t}(BaseComponent);function processSlotOptions(e,t){var n=t||e,i=wholeDivideDurations(e,n);return null===i&&(n=e,i=1),{snapDuration:n,snapsPerSlot:i}}var DayTimeCols=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.buildDayRanges=memoize(buildDayRanges),t.slicer=new DayTimeColsSlicer,t.timeColsRef=createRef(),t.handleRootEl=function(e){e?t.context.registerInteractiveComponent(t,{el:e}):t.context.unregisterInteractiveComponent(t)},t}return __extends(t,e),t.prototype.render=function(){var e=this,t=this.props,n=this.context,i=t.dateProfile,r=t.dayTableModel,a=n.options.nowIndicator,s=this.buildDayRanges(r,i,n.dateEnv);return createElement(NowTimer,{unit:a?"minute":"day"},(function(o,l){return createElement(TimeCols,__assign({ref:e.timeColsRef,rootElRef:e.handleRootEl},e.slicer.sliceProps(t,i,null,n,s),{forPrint:t.forPrint,axis:t.axis,dateProfile:i,slatMetas:t.slatMetas,slotDuration:t.slotDuration,cells:r.cells[0],tableColGroupNode:t.tableColGroupNode,tableMinWidth:t.tableMinWidth,clientWidth:t.clientWidth,clientHeight:t.clientHeight,expandRows:t.expandRows,nowDate:o,nowIndicatorSegs:a&&e.slicer.sliceNowDate(o,n,s),todayRange:l,onScrollTopRequest:t.onScrollTopRequest,onSlatCoords:t.onSlatCoords}))}))},t.prototype.queryHit=function(e,t){var n=this.timeColsRef.current.positionToHit(e,t);if(n)return{component:this,dateSpan:n.dateSpan,dayEl:n.dayEl,rect:{left:n.relativeRect.left,right:n.relativeRect.right,top:n.relativeRect.top,bottom:n.relativeRect.bottom},layer:0}},t}(DateComponent);function buildDayRanges(e,t,n){for(var i=[],r=0,a=e.headerDates;r<a.length;r++){var s=a[r];i.push({start:n.add(s,t.slotMinTime),end:n.add(s,t.slotMaxTime)})}return i}var DayTimeColsSlicer=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.sliceRange=function(e,t){for(var n=[],i=0;i<t.length;i++){var r=intersectRanges(e,t[i]);r&&n.push({start:r.start,end:r.end,isStart:r.start.valueOf()===e.start.valueOf(),isEnd:r.end.valueOf()===e.end.valueOf(),col:i})}return n},t}(Slicer),DayTimeColsView=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.buildTimeColsModel=memoize(buildTimeColsModel),t.buildSlatMetas=memoize(buildSlatMetas),t}return __extends(t,e),t.prototype.render=function(){var e=this,t=this.context,n=t.options,i=t.dateEnv,r=t.dateProfileGenerator,a=this.props,s=a.dateProfile,o=this.buildTimeColsModel(s,r),l=this.allDaySplitter.splitProps(a),d=this.buildSlatMetas(s.slotMinTime,s.slotMaxTime,n.slotLabelInterval,n.slotDuration,i),c=n.dayMinWidth,u=!c,p=c,f=n.dayHeaders&&createElement(DayHeader,{dates:o.headerDates,dateProfile:s,datesRepDistinctDays:!0,renderIntro:u?this.renderHeadAxis:null}),h=!1!==n.allDaySlot&&function(t){return createElement(DayTable,__assign({},l.allDay,{dateProfile:s,dayTableModel:o,nextDayThreshold:n.nextDayThreshold,tableMinWidth:t.tableMinWidth,colGroupNode:t.tableColGroupNode,renderRowIntro:u?e.renderTableRowAxis:null,showWeekNumbers:!1,expandRows:!1,headerAlignElRef:e.headerElRef,clientWidth:t.clientWidth,clientHeight:t.clientHeight,forPrint:a.forPrint},e.getAllDayMaxEventProps()))},_=function(t){return createElement(DayTimeCols,__assign({},l.timed,{dayTableModel:o,dateProfile:s,axis:u,slotDuration:n.slotDuration,slatMetas:d,forPrint:a.forPrint,tableColGroupNode:t.tableColGroupNode,tableMinWidth:t.tableMinWidth,clientWidth:t.clientWidth,clientHeight:t.clientHeight,onSlatCoords:e.handleSlatCoords,expandRows:t.expandRows,onScrollTopRequest:e.handleScrollTopRequest}))};return p?this.renderHScrollLayout(f,h,_,o.colCnt,c,d,this.state.slatCoords):this.renderSimpleLayout(f,h,_)},t}(TimeColsView);function buildTimeColsModel(e,t){var n=new DaySeriesModel(e.renderRange,t);return new DayTableModel(n,!1)}var OPTION_REFINERS$1={allDaySlot:Boolean},main$1=createPlugin({initialView:"timeGridWeek",optionRefiners:OPTION_REFINERS$1,views:{timeGrid:{component:DayTimeColsView,usesMinMaxTime:!0,allDaySlot:!0,slotDuration:"00:30:00",slotEventOverlap:!0},timeGridDay:{type:"timeGrid",duration:{days:1}},timeGridWeek:{type:"timeGrid",duration:{weeks:1}}}});
/*!
	FullCalendar v5.3.1
	Docs & License: https://fullcalendar.io/
	(c) 2020 Adam Shaw
	*/
config.touchMouseIgnoreWait=500;var ignoreMouseDepth=0,listenerCnt=0,isWindowTouchMoveCancelled=!1,PointerDragging=function(){function e(e){var t=this;this.subjectEl=null,this.selector="",this.handleSelector="",this.shouldIgnoreMove=!1,this.shouldWatchScroll=!0,this.isDragging=!1,this.isTouchDragging=!1,this.wasTouchScroll=!1,this.handleMouseDown=function(e){if(!t.shouldIgnoreMouse()&&isPrimaryMouseButton(e)&&t.tryStart(e)){var n=t.createEventFromMouse(e,!0);t.emitter.trigger("pointerdown",n),t.initScrollWatch(n),t.shouldIgnoreMove||document.addEventListener("mousemove",t.handleMouseMove),document.addEventListener("mouseup",t.handleMouseUp)}},this.handleMouseMove=function(e){var n=t.createEventFromMouse(e);t.recordCoords(n),t.emitter.trigger("pointermove",n)},this.handleMouseUp=function(e){document.removeEventListener("mousemove",t.handleMouseMove),document.removeEventListener("mouseup",t.handleMouseUp),t.emitter.trigger("pointerup",t.createEventFromMouse(e)),t.cleanup()},this.handleTouchStart=function(e){if(t.tryStart(e)){t.isTouchDragging=!0;var n=t.createEventFromTouch(e,!0);t.emitter.trigger("pointerdown",n),t.initScrollWatch(n);var i=e.target;t.shouldIgnoreMove||i.addEventListener("touchmove",t.handleTouchMove),i.addEventListener("touchend",t.handleTouchEnd),i.addEventListener("touchcancel",t.handleTouchEnd),window.addEventListener("scroll",t.handleTouchScroll,!0)}},this.handleTouchMove=function(e){var n=t.createEventFromTouch(e);t.recordCoords(n),t.emitter.trigger("pointermove",n)},this.handleTouchEnd=function(e){if(t.isDragging){var n=e.target;n.removeEventListener("touchmove",t.handleTouchMove),n.removeEventListener("touchend",t.handleTouchEnd),n.removeEventListener("touchcancel",t.handleTouchEnd),window.removeEventListener("scroll",t.handleTouchScroll,!0),t.emitter.trigger("pointerup",t.createEventFromTouch(e)),t.cleanup(),t.isTouchDragging=!1,startIgnoringMouse()}},this.handleTouchScroll=function(){t.wasTouchScroll=!0},this.handleScroll=function(e){if(!t.shouldIgnoreMove){var n=window.pageXOffset-t.prevScrollX+t.prevPageX,i=window.pageYOffset-t.prevScrollY+t.prevPageY;t.emitter.trigger("pointermove",{origEvent:e,isTouch:t.isTouchDragging,subjectEl:t.subjectEl,pageX:n,pageY:i,deltaX:n-t.origPageX,deltaY:i-t.origPageY})}},this.containerEl=e,this.emitter=new Emitter,e.addEventListener("mousedown",this.handleMouseDown),e.addEventListener("touchstart",this.handleTouchStart,{passive:!0}),listenerCreated()}return e.prototype.destroy=function(){this.containerEl.removeEventListener("mousedown",this.handleMouseDown),this.containerEl.removeEventListener("touchstart",this.handleTouchStart,{passive:!0}),listenerDestroyed()},e.prototype.tryStart=function(e){var t=this.querySubjectEl(e),n=e.target;return!(!t||this.handleSelector&&!elementClosest(n,this.handleSelector))&&(this.subjectEl=t,this.isDragging=!0,this.wasTouchScroll=!1,!0)},e.prototype.cleanup=function(){isWindowTouchMoveCancelled=!1,this.isDragging=!1,this.subjectEl=null,this.destroyScrollWatch()},e.prototype.querySubjectEl=function(e){return this.selector?elementClosest(e.target,this.selector):this.containerEl},e.prototype.shouldIgnoreMouse=function(){return ignoreMouseDepth||this.isTouchDragging},e.prototype.cancelTouchScroll=function(){this.isDragging&&(isWindowTouchMoveCancelled=!0)},e.prototype.initScrollWatch=function(e){this.shouldWatchScroll&&(this.recordCoords(e),window.addEventListener("scroll",this.handleScroll,!0))},e.prototype.recordCoords=function(e){this.shouldWatchScroll&&(this.prevPageX=e.pageX,this.prevPageY=e.pageY,this.prevScrollX=window.pageXOffset,this.prevScrollY=window.pageYOffset)},e.prototype.destroyScrollWatch=function(){this.shouldWatchScroll&&window.removeEventListener("scroll",this.handleScroll,!0)},e.prototype.createEventFromMouse=function(e,t){var n=0,i=0;return t?(this.origPageX=e.pageX,this.origPageY=e.pageY):(n=e.pageX-this.origPageX,i=e.pageY-this.origPageY),{origEvent:e,isTouch:!1,subjectEl:this.subjectEl,pageX:e.pageX,pageY:e.pageY,deltaX:n,deltaY:i}},e.prototype.createEventFromTouch=function(e,t){var n,i,r=e.touches,a=0,s=0;return r&&r.length?(n=r[0].pageX,i=r[0].pageY):(n=e.pageX,i=e.pageY),t?(this.origPageX=n,this.origPageY=i):(a=n-this.origPageX,s=i-this.origPageY),{origEvent:e,isTouch:!0,subjectEl:this.subjectEl,pageX:n,pageY:i,deltaX:a,deltaY:s}},e}();function isPrimaryMouseButton(e){return 0===e.button&&!e.ctrlKey}function startIgnoringMouse(){ignoreMouseDepth++,setTimeout((function(){ignoreMouseDepth--}),config.touchMouseIgnoreWait)}function listenerCreated(){listenerCnt++||window.addEventListener("touchmove",onWindowTouchMove,{passive:!1})}function listenerDestroyed(){--listenerCnt||window.removeEventListener("touchmove",onWindowTouchMove,{passive:!1})}function onWindowTouchMove(e){isWindowTouchMoveCancelled&&e.preventDefault()}var ElementMirror=function(){function e(){this.isVisible=!1,this.sourceEl=null,this.mirrorEl=null,this.sourceElRect=null,this.parentNode=document.body,this.zIndex=9999,this.revertDuration=0}return e.prototype.start=function(e,t,n){this.sourceEl=e,this.sourceElRect=this.sourceEl.getBoundingClientRect(),this.origScreenX=t-window.pageXOffset,this.origScreenY=n-window.pageYOffset,this.deltaX=0,this.deltaY=0,this.updateElPosition()},e.prototype.handleMove=function(e,t){this.deltaX=e-window.pageXOffset-this.origScreenX,this.deltaY=t-window.pageYOffset-this.origScreenY,this.updateElPosition()},e.prototype.setIsVisible=function(e){e?this.isVisible||(this.mirrorEl&&(this.mirrorEl.style.display=""),this.isVisible=e,this.updateElPosition()):this.isVisible&&(this.mirrorEl&&(this.mirrorEl.style.display="none"),this.isVisible=e)},e.prototype.stop=function(e,t){var n=this,i=function(){n.cleanup(),t()};e&&this.mirrorEl&&this.isVisible&&this.revertDuration&&(this.deltaX||this.deltaY)?this.doRevertAnimation(i,this.revertDuration):setTimeout(i,0)},e.prototype.doRevertAnimation=function(e,t){var n=this.mirrorEl,i=this.sourceEl.getBoundingClientRect();n.style.transition="top "+t+"ms,left "+t+"ms",applyStyle(n,{left:i.left,top:i.top}),whenTransitionDone(n,(function(){n.style.transition="",e()}))},e.prototype.cleanup=function(){this.mirrorEl&&(removeElement(this.mirrorEl),this.mirrorEl=null),this.sourceEl=null},e.prototype.updateElPosition=function(){this.sourceEl&&this.isVisible&&applyStyle(this.getMirrorEl(),{left:this.sourceElRect.left+this.deltaX,top:this.sourceElRect.top+this.deltaY})},e.prototype.getMirrorEl=function(){var e=this.sourceElRect,t=this.mirrorEl;return t||((t=this.mirrorEl=this.sourceEl.cloneNode(!0)).classList.add("fc-unselectable"),t.classList.add("fc-event-dragging"),applyStyle(t,{position:"fixed",zIndex:this.zIndex,visibility:"",boxSizing:"border-box",width:e.right-e.left,height:e.bottom-e.top,right:"auto",bottom:"auto",margin:0}),this.parentNode.appendChild(t)),t},e}(),ScrollGeomCache=function(e){function t(t,n){var i=e.call(this)||this;return i.handleScroll=function(){i.scrollTop=i.scrollController.getScrollTop(),i.scrollLeft=i.scrollController.getScrollLeft(),i.handleScrollChange()},i.scrollController=t,i.doesListening=n,i.scrollTop=i.origScrollTop=t.getScrollTop(),i.scrollLeft=i.origScrollLeft=t.getScrollLeft(),i.scrollWidth=t.getScrollWidth(),i.scrollHeight=t.getScrollHeight(),i.clientWidth=t.getClientWidth(),i.clientHeight=t.getClientHeight(),i.clientRect=i.computeClientRect(),i.doesListening&&i.getEventTarget().addEventListener("scroll",i.handleScroll),i}return __extends(t,e),t.prototype.destroy=function(){this.doesListening&&this.getEventTarget().removeEventListener("scroll",this.handleScroll)},t.prototype.getScrollTop=function(){return this.scrollTop},t.prototype.getScrollLeft=function(){return this.scrollLeft},t.prototype.setScrollTop=function(e){this.scrollController.setScrollTop(e),this.doesListening||(this.scrollTop=Math.max(Math.min(e,this.getMaxScrollTop()),0),this.handleScrollChange())},t.prototype.setScrollLeft=function(e){this.scrollController.setScrollLeft(e),this.doesListening||(this.scrollLeft=Math.max(Math.min(e,this.getMaxScrollLeft()),0),this.handleScrollChange())},t.prototype.getClientWidth=function(){return this.clientWidth},t.prototype.getClientHeight=function(){return this.clientHeight},t.prototype.getScrollWidth=function(){return this.scrollWidth},t.prototype.getScrollHeight=function(){return this.scrollHeight},t.prototype.handleScrollChange=function(){},t}(ScrollController),ElementScrollGeomCache=function(e){function t(t,n){return e.call(this,new ElementScrollController(t),n)||this}return __extends(t,e),t.prototype.getEventTarget=function(){return this.scrollController.el},t.prototype.computeClientRect=function(){return computeInnerRect(this.scrollController.el)},t}(ScrollGeomCache),WindowScrollGeomCache=function(e){function t(t){return e.call(this,new WindowScrollController,t)||this}return __extends(t,e),t.prototype.getEventTarget=function(){return window},t.prototype.computeClientRect=function(){return{left:this.scrollLeft,right:this.scrollLeft+this.clientWidth,top:this.scrollTop,bottom:this.scrollTop+this.clientHeight}},t.prototype.handleScrollChange=function(){this.clientRect=this.computeClientRect()},t}(ScrollGeomCache),getTime="function"==typeof performance?performance.now:Date.now,AutoScroller=function(){function e(){var e=this;this.isEnabled=!0,this.scrollQuery=[window,".fc-scroller"],this.edgeThreshold=50,this.maxVelocity=300,this.pointerScreenX=null,this.pointerScreenY=null,this.isAnimating=!1,this.scrollCaches=null,this.everMovedUp=!1,this.everMovedDown=!1,this.everMovedLeft=!1,this.everMovedRight=!1,this.animate=function(){if(e.isAnimating){var t=e.computeBestEdge(e.pointerScreenX+window.pageXOffset,e.pointerScreenY+window.pageYOffset);if(t){var n=getTime();e.handleSide(t,(n-e.msSinceRequest)/1e3),e.requestAnimation(n)}else e.isAnimating=!1}}}return e.prototype.start=function(e,t){this.isEnabled&&(this.scrollCaches=this.buildCaches(),this.pointerScreenX=null,this.pointerScreenY=null,this.everMovedUp=!1,this.everMovedDown=!1,this.everMovedLeft=!1,this.everMovedRight=!1,this.handleMove(e,t))},e.prototype.handleMove=function(e,t){if(this.isEnabled){var n=e-window.pageXOffset,i=t-window.pageYOffset,r=null===this.pointerScreenY?0:i-this.pointerScreenY,a=null===this.pointerScreenX?0:n-this.pointerScreenX;r<0?this.everMovedUp=!0:r>0&&(this.everMovedDown=!0),a<0?this.everMovedLeft=!0:a>0&&(this.everMovedRight=!0),this.pointerScreenX=n,this.pointerScreenY=i,this.isAnimating||(this.isAnimating=!0,this.requestAnimation(getTime()))}},e.prototype.stop=function(){if(this.isEnabled){this.isAnimating=!1;for(var e=0,t=this.scrollCaches;e<t.length;e++){t[e].destroy()}this.scrollCaches=null}},e.prototype.requestAnimation=function(e){this.msSinceRequest=e,requestAnimationFrame(this.animate)},e.prototype.handleSide=function(e,t){var n=e.scrollCache,i=this.edgeThreshold,r=i-e.distance,a=r*r/(i*i)*this.maxVelocity*t,s=1;switch(e.name){case"left":s=-1;case"right":n.setScrollLeft(n.getScrollLeft()+a*s);break;case"top":s=-1;case"bottom":n.setScrollTop(n.getScrollTop()+a*s)}},e.prototype.computeBestEdge=function(e,t){for(var n=this.edgeThreshold,i=null,r=0,a=this.scrollCaches;r<a.length;r++){var s=a[r],o=s.clientRect,l=e-o.left,d=o.right-e,c=t-o.top,u=o.bottom-t;l>=0&&d>=0&&c>=0&&u>=0&&(c<=n&&this.everMovedUp&&s.canScrollUp()&&(!i||i.distance>c)&&(i={scrollCache:s,name:"top",distance:c}),u<=n&&this.everMovedDown&&s.canScrollDown()&&(!i||i.distance>u)&&(i={scrollCache:s,name:"bottom",distance:u}),l<=n&&this.everMovedLeft&&s.canScrollLeft()&&(!i||i.distance>l)&&(i={scrollCache:s,name:"left",distance:l}),d<=n&&this.everMovedRight&&s.canScrollRight()&&(!i||i.distance>d)&&(i={scrollCache:s,name:"right",distance:d}))}return i},e.prototype.buildCaches=function(){return this.queryScrollEls().map((function(e){return e===window?new WindowScrollGeomCache(!1):new ElementScrollGeomCache(e,!1)}))},e.prototype.queryScrollEls=function(){for(var e=[],t=0,n=this.scrollQuery;t<n.length;t++){var i=n[t];"object"==typeof i?e.push(i):e.push.apply(e,Array.prototype.slice.call(document.querySelectorAll(i)))}return e},e}(),FeaturefulElementDragging=function(e){function t(t,n){var i=e.call(this,t)||this;i.delay=null,i.minDistance=0,i.touchScrollAllowed=!0,i.mirrorNeedsRevert=!1,i.isInteracting=!1,i.isDragging=!1,i.isDelayEnded=!1,i.isDistanceSurpassed=!1,i.delayTimeoutId=null,i.onPointerDown=function(e){i.isDragging||(i.isInteracting=!0,i.isDelayEnded=!1,i.isDistanceSurpassed=!1,preventSelection(document.body),preventContextMenu(document.body),e.isTouch||e.origEvent.preventDefault(),i.emitter.trigger("pointerdown",e),i.isInteracting&&!i.pointer.shouldIgnoreMove&&(i.mirror.setIsVisible(!1),i.mirror.start(e.subjectEl,e.pageX,e.pageY),i.startDelay(e),i.minDistance||i.handleDistanceSurpassed(e)))},i.onPointerMove=function(e){if(i.isInteracting){if(i.emitter.trigger("pointermove",e),!i.isDistanceSurpassed){var t=i.minDistance,n=e.deltaX,r=e.deltaY;n*n+r*r>=t*t&&i.handleDistanceSurpassed(e)}i.isDragging&&("scroll"!==e.origEvent.type&&(i.mirror.handleMove(e.pageX,e.pageY),i.autoScroller.handleMove(e.pageX,e.pageY)),i.emitter.trigger("dragmove",e))}},i.onPointerUp=function(e){i.isInteracting&&(i.isInteracting=!1,allowSelection(document.body),allowContextMenu(document.body),i.emitter.trigger("pointerup",e),i.isDragging&&(i.autoScroller.stop(),i.tryStopDrag(e)),i.delayTimeoutId&&(clearTimeout(i.delayTimeoutId),i.delayTimeoutId=null))};var r=i.pointer=new PointerDragging(t);return r.emitter.on("pointerdown",i.onPointerDown),r.emitter.on("pointermove",i.onPointerMove),r.emitter.on("pointerup",i.onPointerUp),n&&(r.selector=n),i.mirror=new ElementMirror,i.autoScroller=new AutoScroller,i}return __extends(t,e),t.prototype.destroy=function(){this.pointer.destroy(),this.onPointerUp({})},t.prototype.startDelay=function(e){var t=this;"number"==typeof this.delay?this.delayTimeoutId=setTimeout((function(){t.delayTimeoutId=null,t.handleDelayEnd(e)}),this.delay):this.handleDelayEnd(e)},t.prototype.handleDelayEnd=function(e){this.isDelayEnded=!0,this.tryStartDrag(e)},t.prototype.handleDistanceSurpassed=function(e){this.isDistanceSurpassed=!0,this.tryStartDrag(e)},t.prototype.tryStartDrag=function(e){this.isDelayEnded&&this.isDistanceSurpassed&&(this.pointer.wasTouchScroll&&!this.touchScrollAllowed||(this.isDragging=!0,this.mirrorNeedsRevert=!1,this.autoScroller.start(e.pageX,e.pageY),this.emitter.trigger("dragstart",e),!1===this.touchScrollAllowed&&this.pointer.cancelTouchScroll()))},t.prototype.tryStopDrag=function(e){this.mirror.stop(this.mirrorNeedsRevert,this.stopDrag.bind(this,e))},t.prototype.stopDrag=function(e){this.isDragging=!1,this.emitter.trigger("dragend",e)},t.prototype.setIgnoreMove=function(e){this.pointer.shouldIgnoreMove=e},t.prototype.setMirrorIsVisible=function(e){this.mirror.setIsVisible(e)},t.prototype.setMirrorNeedsRevert=function(e){this.mirrorNeedsRevert=e},t.prototype.setAutoScrollEnabled=function(e){this.autoScroller.isEnabled=e},t}(ElementDragging),OffsetTracker=function(){function e(e){this.origRect=computeRect(e),this.scrollCaches=getClippingParents(e).map((function(e){return new ElementScrollGeomCache(e,!0)}))}return e.prototype.destroy=function(){for(var e=0,t=this.scrollCaches;e<t.length;e++){t[e].destroy()}},e.prototype.computeLeft=function(){for(var e=this.origRect.left,t=0,n=this.scrollCaches;t<n.length;t++){var i=n[t];e+=i.origScrollLeft-i.getScrollLeft()}return e},e.prototype.computeTop=function(){for(var e=this.origRect.top,t=0,n=this.scrollCaches;t<n.length;t++){var i=n[t];e+=i.origScrollTop-i.getScrollTop()}return e},e.prototype.isWithinClipping=function(e,t){for(var n={left:e,top:t},i=0,r=this.scrollCaches;i<r.length;i++){var a=r[i];if(!isIgnoredClipping(a.getEventTarget())&&!pointInsideRect(n,a.clientRect))return!1}return!0},e}();function isIgnoredClipping(e){var t=e.tagName;return"HTML"===t||"BODY"===t}var HitDragging=function(){function e(e,t){var n=this;this.useSubjectCenter=!1,this.requireInitial=!0,this.initialHit=null,this.movingHit=null,this.finalHit=null,this.handlePointerDown=function(e){var t=n.dragging;n.initialHit=null,n.movingHit=null,n.finalHit=null,n.prepareHits(),n.processFirstCoord(e),n.initialHit||!n.requireInitial?(t.setIgnoreMove(!1),n.emitter.trigger("pointerdown",e)):t.setIgnoreMove(!0)},this.handleDragStart=function(e){n.emitter.trigger("dragstart",e),n.handleMove(e,!0)},this.handleDragMove=function(e){n.emitter.trigger("dragmove",e),n.handleMove(e)},this.handlePointerUp=function(e){n.releaseHits(),n.emitter.trigger("pointerup",e)},this.handleDragEnd=function(e){n.movingHit&&n.emitter.trigger("hitupdate",null,!0,e),n.finalHit=n.movingHit,n.movingHit=null,n.emitter.trigger("dragend",e)},this.droppableStore=t,e.emitter.on("pointerdown",this.handlePointerDown),e.emitter.on("dragstart",this.handleDragStart),e.emitter.on("dragmove",this.handleDragMove),e.emitter.on("pointerup",this.handlePointerUp),e.emitter.on("dragend",this.handleDragEnd),this.dragging=e,this.emitter=new Emitter}return e.prototype.processFirstCoord=function(e){var t,n={left:e.pageX,top:e.pageY},i=n,r=e.subjectEl;r!==document&&(i=constrainPoint(i,t=computeRect(r)));var a=this.initialHit=this.queryHitForOffset(i.left,i.top);if(a){if(this.useSubjectCenter&&t){var s=intersectRects(t,a.rect);s&&(i=getRectCenter(s))}this.coordAdjust=diffPoints(i,n)}else this.coordAdjust={left:0,top:0}},e.prototype.handleMove=function(e,t){var n=this.queryHitForOffset(e.pageX+this.coordAdjust.left,e.pageY+this.coordAdjust.top);!t&&isHitsEqual(this.movingHit,n)||(this.movingHit=n,this.emitter.trigger("hitupdate",n,!1,e))},e.prototype.prepareHits=function(){this.offsetTrackers=mapHash(this.droppableStore,(function(e){return e.component.prepareHits(),new OffsetTracker(e.el)}))},e.prototype.releaseHits=function(){var e=this.offsetTrackers;for(var t in e)e[t].destroy();this.offsetTrackers={}},e.prototype.queryHitForOffset=function(e,t){var n=this.droppableStore,i=this.offsetTrackers,r=null;for(var a in n){var s=n[a].component,o=i[a];if(o&&o.isWithinClipping(e,t)){var l=o.computeLeft(),d=o.computeTop(),c=e-l,u=t-d,p=o.origRect,f=p.right-p.left,h=p.bottom-p.top;if(c>=0&&c<f&&u>=0&&u<h){var _=s.queryHit(c,u,f,h),g=s.context.getCurrentData().dateProfile;_&&rangeContainsRange(g.activeRange,_.dateSpan.range)&&(!r||_.layer>r.layer)&&(_.rect.left+=l,_.rect.right+=l,_.rect.top+=d,_.rect.bottom+=d,r=_)}}}return r},e}();function isHitsEqual(e,t){return!e&&!t||Boolean(e)===Boolean(t)&&isDateSpansEqual(e.dateSpan,t.dateSpan)}function buildDatePointApiWithContext(e,t){for(var n={},i=0,r=t.pluginHooks.datePointTransforms;i<r.length;i++){var a=r[i];__assign(n,a(e,t))}return __assign(n,buildDatePointApi(e,t.dateEnv)),n}function buildDatePointApi(e,t){return{date:t.toDate(e.range.start),dateStr:t.formatIso(e.range.start,{omitTime:e.allDay}),allDay:e.allDay}}var DateClicking=function(e){function t(t){var n=e.call(this,t)||this;n.handlePointerDown=function(e){var t=n.dragging,i=e.origEvent.target;t.setIgnoreMove(!n.component.isValidDateDownEl(i))},n.handleDragEnd=function(e){var t=n.component;if(!n.dragging.pointer.wasTouchScroll){var i=n.hitDragging,r=i.initialHit,a=i.finalHit;if(r&&a&&isHitsEqual(r,a)){var s=t.context,o=__assign(__assign({},buildDatePointApiWithContext(r.dateSpan,s)),{dayEl:r.dayEl,jsEvent:e.origEvent,view:s.viewApi||s.calendarApi.view});s.emitter.trigger("dateClick",o)}}},n.dragging=new FeaturefulElementDragging(t.el),n.dragging.autoScroller.isEnabled=!1;var i=n.hitDragging=new HitDragging(n.dragging,interactionSettingsToStore(t));return i.emitter.on("pointerdown",n.handlePointerDown),i.emitter.on("dragend",n.handleDragEnd),n}return __extends(t,e),t.prototype.destroy=function(){this.dragging.destroy()},t}(Interaction),DateSelecting=function(e){function t(t){var n=e.call(this,t)||this;n.dragSelection=null,n.handlePointerDown=function(e){var t=n,i=t.component,r=t.dragging,a=i.context.options.selectable&&i.isValidDateDownEl(e.origEvent.target);r.setIgnoreMove(!a),r.delay=e.isTouch?getComponentTouchDelay(i):null},n.handleDragStart=function(e){n.component.context.calendarApi.unselect(e)},n.handleHitUpdate=function(e,t){var i=n.component.context,r=null,a=!1;e&&((r=joinHitsIntoSelection(n.hitDragging.initialHit,e,i.pluginHooks.dateSelectionTransformers))&&n.component.isDateSelectionValid(r)||(a=!0,r=null)),r?i.dispatch({type:"SELECT_DATES",selection:r}):t||i.dispatch({type:"UNSELECT_DATES"}),a?disableCursor():enableCursor(),t||(n.dragSelection=r)},n.handlePointerUp=function(e){n.dragSelection&&(triggerDateSelect(n.dragSelection,e,n.component.context),n.dragSelection=null)};var i=t.component.context.options,r=n.dragging=new FeaturefulElementDragging(t.el);r.touchScrollAllowed=!1,r.minDistance=i.selectMinDistance||0,r.autoScroller.isEnabled=i.dragScroll;var a=n.hitDragging=new HitDragging(n.dragging,interactionSettingsToStore(t));return a.emitter.on("pointerdown",n.handlePointerDown),a.emitter.on("dragstart",n.handleDragStart),a.emitter.on("hitupdate",n.handleHitUpdate),a.emitter.on("pointerup",n.handlePointerUp),n}return __extends(t,e),t.prototype.destroy=function(){this.dragging.destroy()},t}(Interaction);function getComponentTouchDelay(e){var t=e.context.options,n=t.selectLongPressDelay;return null==n&&(n=t.longPressDelay),n}function joinHitsIntoSelection(e,t,n){var i=e.dateSpan,r=t.dateSpan,a=[i.range.start,i.range.end,r.range.start,r.range.end];a.sort(compareNumbers);for(var s={},o=0,l=n;o<l.length;o++){var d=(0,l[o])(e,t);if(!1===d)return null;d&&__assign(s,d)}return s.range={start:a[0],end:a[3]},s.allDay=i.allDay,s}var EventDragging=function(e){function t(n){var i=e.call(this,n)||this;i.subjectEl=null,i.subjectSeg=null,i.isDragging=!1,i.eventRange=null,i.relevantEvents=null,i.receivingContext=null,i.validMutation=null,i.mutatedRelevantEvents=null,i.handlePointerDown=function(e){var t=e.origEvent.target,n=i,r=n.component,a=n.dragging,s=a.mirror,o=r.context.options,l=r.context;i.subjectEl=e.subjectEl;var d=i.subjectSeg=getElSeg(e.subjectEl),c=(i.eventRange=d.eventRange).instance.instanceId;i.relevantEvents=getRelevantEvents(l.getCurrentData().eventStore,c),a.minDistance=e.isTouch?0:o.eventDragMinDistance,a.delay=e.isTouch&&c!==r.props.eventSelection?getComponentTouchDelay$1(r):null,s.parentNode=elementClosest(t,".fc"),s.revertDuration=o.dragRevertDuration;var u=r.isValidSegDownEl(t)&&!elementClosest(t,".fc-event-resizer");a.setIgnoreMove(!u),i.isDragging=u&&e.subjectEl.classList.contains("fc-event-draggable")},i.handleDragStart=function(e){var t=i.component.context,n=i.eventRange,r=n.instance.instanceId;e.isTouch?r!==i.component.props.eventSelection&&t.dispatch({type:"SELECT_EVENT",eventInstanceId:r}):t.dispatch({type:"UNSELECT_EVENT"}),i.isDragging&&(t.calendarApi.unselect(e),t.emitter.trigger("eventDragStart",{el:i.subjectEl,event:new EventApi(t,n.def,n.instance),jsEvent:e.origEvent,view:t.viewApi}))},i.handleHitUpdate=function(e,t){if(i.isDragging){var n=i.relevantEvents,r=i.hitDragging.initialHit,a=i.component.context,s=null,o=null,l=null,d=!1,c={affectedEvents:n,mutatedEvents:createEmptyEventStore(),isEvent:!0};if(e){var u=e.component,p=(s=u.context).options;a===s||p.editable&&p.droppable?(o=computeEventMutation(r,e,s.getCurrentData().pluginHooks.eventDragMutationMassagers))&&(l=applyMutationToEventStore(n,s.getCurrentData().eventUiBases,o,s),c.mutatedEvents=l,u.isInteractionValid(c)||(d=!0,o=null,l=null,c.mutatedEvents=createEmptyEventStore())):s=null}i.displayDrag(s,c),d?disableCursor():enableCursor(),t||(a===s&&isHitsEqual(r,e)&&(o=null),i.dragging.setMirrorNeedsRevert(!o),i.dragging.setMirrorIsVisible(!e||!document.querySelector(".fc-event-mirror")),i.receivingContext=s,i.validMutation=o,i.mutatedRelevantEvents=l)}},i.handlePointerUp=function(){i.isDragging||i.cleanup()},i.handleDragEnd=function(e){if(i.isDragging){var t=i.component.context,n=t.viewApi,r=i,a=r.receivingContext,s=r.validMutation,o=i.eventRange.def,l=i.eventRange.instance,d=new EventApi(t,o,l),c=i.relevantEvents,u=i.mutatedRelevantEvents,p=i.hitDragging.finalHit;if(i.clearDrag(),t.emitter.trigger("eventDragStop",{el:i.subjectEl,event:d,jsEvent:e.origEvent,view:n}),s){if(a===t){var f=new EventApi(t,u.defs[o.defId],l?u.instances[l.instanceId]:null);t.dispatch({type:"MERGE_EVENTS",eventStore:u});for(var h={oldEvent:d,event:f,relatedEvents:buildEventApis(u,t,l),revert:function(){t.dispatch({type:"MERGE_EVENTS",eventStore:c})}},_={},g=0,m=t.getCurrentData().pluginHooks.eventDropTransformers;g<m.length;g++){var v=m[g];__assign(_,v(s,t))}t.emitter.trigger("eventDrop",__assign(__assign(__assign({},h),_),{el:e.subjectEl,delta:s.datesDelta,jsEvent:e.origEvent,view:n})),t.emitter.trigger("eventChange",h)}else if(a){var y={event:d,relatedEvents:buildEventApis(c,t,l),revert:function(){t.dispatch({type:"MERGE_EVENTS",eventStore:c})}};t.emitter.trigger("eventLeave",__assign(__assign({},y),{draggedEl:e.subjectEl,view:n})),t.dispatch({type:"REMOVE_EVENTS",eventStore:c}),t.emitter.trigger("eventRemove",y);var b=u.defs[o.defId],w=u.instances[l.instanceId],E=new EventApi(a,b,w);a.dispatch({type:"MERGE_EVENTS",eventStore:u});var S={event:E,relatedEvents:buildEventApis(u,a,w),revert:function(){a.dispatch({type:"REMOVE_EVENTS",eventStore:u})}};a.emitter.trigger("eventAdd",S),e.isTouch&&a.dispatch({type:"SELECT_EVENT",eventInstanceId:l.instanceId}),a.emitter.trigger("drop",__assign(__assign({},buildDatePointApiWithContext(p.dateSpan,a)),{draggedEl:e.subjectEl,jsEvent:e.origEvent,view:p.component.context.viewApi})),a.emitter.trigger("eventReceive",__assign(__assign({},S),{draggedEl:e.subjectEl,view:p.component.context.viewApi}))}}else t.emitter.trigger("_noEventDrop")}i.cleanup()};var r=i.component.context.options,a=i.dragging=new FeaturefulElementDragging(n.el);a.pointer.selector=t.SELECTOR,a.touchScrollAllowed=!1,a.autoScroller.isEnabled=r.dragScroll;var s=i.hitDragging=new HitDragging(i.dragging,interactionSettingsStore);return s.useSubjectCenter=n.useEventCenter,s.emitter.on("pointerdown",i.handlePointerDown),s.emitter.on("dragstart",i.handleDragStart),s.emitter.on("hitupdate",i.handleHitUpdate),s.emitter.on("pointerup",i.handlePointerUp),s.emitter.on("dragend",i.handleDragEnd),i}return __extends(t,e),t.prototype.destroy=function(){this.dragging.destroy()},t.prototype.displayDrag=function(e,t){var n=this.component.context,i=this.receivingContext;i&&i!==e&&(i===n?i.dispatch({type:"SET_EVENT_DRAG",state:{affectedEvents:t.affectedEvents,mutatedEvents:createEmptyEventStore(),isEvent:!0}}):i.dispatch({type:"UNSET_EVENT_DRAG"})),e&&e.dispatch({type:"SET_EVENT_DRAG",state:t})},t.prototype.clearDrag=function(){var e=this.component.context,t=this.receivingContext;t&&t.dispatch({type:"UNSET_EVENT_DRAG"}),e!==t&&e.dispatch({type:"UNSET_EVENT_DRAG"})},t.prototype.cleanup=function(){this.subjectSeg=null,this.isDragging=!1,this.eventRange=null,this.relevantEvents=null,this.receivingContext=null,this.validMutation=null,this.mutatedRelevantEvents=null},t.SELECTOR=".fc-event-draggable, .fc-event-resizable",t}(Interaction);function computeEventMutation(e,t,n){var i=e.dateSpan,r=t.dateSpan,a=i.range.start,s=r.range.start,o={};i.allDay!==r.allDay&&(o.allDay=r.allDay,o.hasEnd=t.component.context.options.allDayMaintainDuration,r.allDay&&(a=startOfDay(a)));var l=diffDates(a,s,e.component.context.dateEnv,e.component===t.component?e.component.largeUnit:null);l.milliseconds&&(o.allDay=!1);for(var d={datesDelta:l,standardProps:o},c=0,u=n;c<u.length;c++){(0,u[c])(d,e,t)}return d}function getComponentTouchDelay$1(e){var t=e.context.options,n=t.eventLongPressDelay;return null==n&&(n=t.longPressDelay),n}var EventResizing=function(e){function t(t){var n=e.call(this,t)||this;n.draggingSegEl=null,n.draggingSeg=null,n.eventRange=null,n.relevantEvents=null,n.validMutation=null,n.mutatedRelevantEvents=null,n.handlePointerDown=function(e){var t=n.component,i=getElSeg(n.querySegEl(e)),r=n.eventRange=i.eventRange;n.dragging.minDistance=t.context.options.eventDragMinDistance,n.dragging.setIgnoreMove(!n.component.isValidSegDownEl(e.origEvent.target)||e.isTouch&&n.component.props.eventSelection!==r.instance.instanceId)},n.handleDragStart=function(e){var t=n.component.context,i=n.eventRange;n.relevantEvents=getRelevantEvents(t.getCurrentData().eventStore,n.eventRange.instance.instanceId);var r=n.querySegEl(e);n.draggingSegEl=r,n.draggingSeg=getElSeg(r),t.calendarApi.unselect(),t.emitter.trigger("eventResizeStart",{el:r,event:new EventApi(t,i.def,i.instance),jsEvent:e.origEvent,view:t.viewApi})},n.handleHitUpdate=function(e,t,i){var r=n.component.context,a=n.relevantEvents,s=n.hitDragging.initialHit,o=n.eventRange.instance,l=null,d=null,c=!1,u={affectedEvents:a,mutatedEvents:createEmptyEventStore(),isEvent:!0};e&&(l=computeMutation(s,e,i.subjectEl.classList.contains("fc-event-resizer-start"),o.range,r.pluginHooks.eventResizeJoinTransforms)),l&&(d=applyMutationToEventStore(a,r.getCurrentData().eventUiBases,l,r),u.mutatedEvents=d,n.component.isInteractionValid(u)||(c=!0,l=null,d=null,u.mutatedEvents=null)),d?r.dispatch({type:"SET_EVENT_RESIZE",state:u}):r.dispatch({type:"UNSET_EVENT_RESIZE"}),c?disableCursor():enableCursor(),t||(l&&isHitsEqual(s,e)&&(l=null),n.validMutation=l,n.mutatedRelevantEvents=d)},n.handleDragEnd=function(e){var t=n.component.context,i=n.eventRange.def,r=n.eventRange.instance,a=new EventApi(t,i,r),s=n.relevantEvents,o=n.mutatedRelevantEvents;if(t.emitter.trigger("eventResizeStop",{el:n.draggingSegEl,event:a,jsEvent:e.origEvent,view:t.viewApi}),n.validMutation){var l=new EventApi(t,o.defs[i.defId],r?o.instances[r.instanceId]:null);t.dispatch({type:"MERGE_EVENTS",eventStore:o});var d={oldEvent:a,event:l,relatedEvents:buildEventApis(o,t,r),revert:function(){t.dispatch({type:"MERGE_EVENTS",eventStore:s})}};t.emitter.trigger("eventResize",__assign(__assign({},d),{el:n.draggingSegEl,startDelta:n.validMutation.startDelta||createDuration(0),endDelta:n.validMutation.endDelta||createDuration(0),jsEvent:e.origEvent,view:t.viewApi})),t.emitter.trigger("eventChange",d)}else t.emitter.trigger("_noEventResize");n.draggingSeg=null,n.relevantEvents=null,n.validMutation=null};var i=t.component,r=n.dragging=new FeaturefulElementDragging(t.el);r.pointer.selector=".fc-event-resizer",r.touchScrollAllowed=!1,r.autoScroller.isEnabled=i.context.options.dragScroll;var a=n.hitDragging=new HitDragging(n.dragging,interactionSettingsToStore(t));return a.emitter.on("pointerdown",n.handlePointerDown),a.emitter.on("dragstart",n.handleDragStart),a.emitter.on("hitupdate",n.handleHitUpdate),a.emitter.on("dragend",n.handleDragEnd),n}return __extends(t,e),t.prototype.destroy=function(){this.dragging.destroy()},t.prototype.querySegEl=function(e){return elementClosest(e.subjectEl,".fc-event")},t}(Interaction);function computeMutation(e,t,n,i,r){for(var a=e.component.context.dateEnv,s=diffDates(e.dateSpan.range.start,t.dateSpan.range.start,a,e.component.largeUnit),o={},l=0,d=r;l<d.length;l++){var c=(0,d[l])(e,t);if(!1===c)return null;c&&__assign(o,c)}if(n){if(a.add(i.start,s)<i.end)return o.startDelta=s,o}else if(a.add(i.end,s)>i.start)return o.endDelta=s,o;return null}var UnselectAuto=function(){function e(e){var t=this;this.context=e,this.isRecentPointerDateSelect=!1,this.matchesCancel=!1,this.matchesEvent=!1,this.onSelect=function(e){e.jsEvent&&(t.isRecentPointerDateSelect=!0)},this.onDocumentPointerDown=function(e){var n=t.context.options.unselectCancel,i=e.origEvent.target;t.matchesCancel=!!elementClosest(i,n),t.matchesEvent=!!elementClosest(i,EventDragging.SELECTOR)},this.onDocumentPointerUp=function(e){var n=t.context,i=t.documentPointer,r=n.getCurrentData();if(!i.wasTouchScroll){if(r.dateSelection&&!t.isRecentPointerDateSelect){var a=n.options.unselectAuto;!a||a&&t.matchesCancel||n.calendarApi.unselect(e)}r.eventSelection&&!t.matchesEvent&&n.dispatch({type:"UNSELECT_EVENT"})}t.isRecentPointerDateSelect=!1};var n=this.documentPointer=new PointerDragging(document);n.shouldIgnoreMove=!0,n.shouldWatchScroll=!1,n.emitter.on("pointerdown",this.onDocumentPointerDown),n.emitter.on("pointerup",this.onDocumentPointerUp),e.emitter.on("select",this.onSelect)}return e.prototype.destroy=function(){this.context.emitter.off("select",this.onSelect),this.documentPointer.destroy()},e}(),LISTENER_REFINERS={dateClick:identity,eventDragStart:identity,eventDragStop:identity,eventDrop:identity,eventResizeStart:identity,eventResizeStop:identity,eventResize:identity,drop:identity,eventReceive:identity,eventLeave:identity};config.dataAttrPrefix="";var InferredElementDragging=function(e){function t(t){var n=e.call(this,t)||this;n.shouldIgnoreMove=!1,n.mirrorSelector="",n.currentMirrorEl=null,n.handlePointerDown=function(e){n.emitter.trigger("pointerdown",e),n.shouldIgnoreMove||n.emitter.trigger("dragstart",e)},n.handlePointerMove=function(e){n.shouldIgnoreMove||n.emitter.trigger("dragmove",e)},n.handlePointerUp=function(e){n.emitter.trigger("pointerup",e),n.shouldIgnoreMove||n.emitter.trigger("dragend",e)};var i=n.pointer=new PointerDragging(t);return i.emitter.on("pointerdown",n.handlePointerDown),i.emitter.on("pointermove",n.handlePointerMove),i.emitter.on("pointerup",n.handlePointerUp),n}return __extends(t,e),t.prototype.destroy=function(){this.pointer.destroy()},t.prototype.setIgnoreMove=function(e){this.shouldIgnoreMove=e},t.prototype.setMirrorIsVisible=function(e){if(e)this.currentMirrorEl&&(this.currentMirrorEl.style.visibility="",this.currentMirrorEl=null);else{var t=this.mirrorSelector?document.querySelector(this.mirrorSelector):null;t&&(this.currentMirrorEl=t,t.style.visibility="hidden")}},t}(ElementDragging),main$2=createPlugin({componentInteractions:[DateClicking,DateSelecting,EventDragging,EventResizing],calendarInteractions:[UnselectAuto],elementDraggingImpl:FeaturefulElementDragging,listenerRefiners:LISTENER_REFINERS});frappe.provide("frappe.views.calendar"),frappe.provide("frappe.views.calendars");var day_map={Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6};function redirect_to_home_if_invalid_route(){return"List"===frappe.get_route()[2]&&(frappe.set_route("List","File","Home"),!0)}function get_doc_mappings(){return{Event:{field_map:{interaction_type:"doctype",summary:"subject",description:"description",category:"event_category",due_date:"starts_on",public:"event_type"},reqd_fields:["summary","due_date"],hidden_fields:[]},ToDo:{field_map:{interaction_type:"doctype",description:"description",due_date:"date",reference_doctype:"reference_type",reference_document:"reference_name",assigned_to:"owner"},reqd_fields:["description"],hidden_fields:["public","category"]}}}frappe.views.CalendarView=class extends frappe.views.ListView{static load_last_view(){var e=frappe.get_route();if(3===e.length){var t=e[1],n=frappe.get_user_settings(t).Calendar||{};return e.push(n.last_calendar||"default"),frappe.set_route(e),!0}return!1}toggle_result_area(){}get view_name(){return"Calendar"}setup_page(){this.hide_page_form=!1,super.setup_page()}setup_defaults(){super.setup_defaults(),this.page_title=__("{0} Calendar",[this.page_title]),this.calendar_settings=frappe.views.calendar[this.doctype]||{},this.calendar_name=frappe.utils.to_title_case(frappe.get_route()[3]||"")}before_refresh(){super.before_refresh(),this.calendar_settings.filters&&this.calendar_settings.filters.length>0&&Array.isArray(this.calendar_settings.filters[0])&&this.filter_area.add(this.calendar_settings.filters)}setup_view(){this.sort_selector.wrapper.hide()}before_render(){super.before_render(),this.save_view_user_settings({last_calendar:this.calendar_name})}render(){var e=this;this.calendar?this.calendar.refresh():this.load_lib.then((function(){return e.get_calendar_preferences()})).then((function(t){e.calendar=new frappe.views.Calendar(t)}))}get_calendar_preferences(){var e=this,t={doctype:this.doctype,parent:this.$result,page:this.page,list_view:this},n=this.calendar_name;return new Promise((function(i){"Default"===n?(Object.assign(t,frappe.views.calendar[e.doctype]),i(t)):frappe.model.with_doc("Calendar View",n,(function(){var e=frappe.get_doc("Calendar View",n);Object.assign(t,{field_map:{id:"name",start:e.start_date_field,end:e.end_date_field,title:e.subject_field,allDay:e.all_day_field,status:e.status_field,color:e.color_field,rrule:e.recurrence_rule_field,secondary_status:e.secondary_status_field},secondary_status_color:e.secondary_status.reduce((function(e,t){var n;return Object.assign(e,((n={})[t.value]=t.color,n))}),{}),calendar_defaults:{slots_start_time:e.daily_minimum_time,slots_end_time:e.daily_maximum_time,first_day:e.first_day?day_map[e.first_day]:null,display_event_time:1==e.display_event_time,display_event_end:1==e.display_event_end}}),i(t)}))}))}get required_libs(){}},frappe.views.Calendar=class{constructor(e){$.extend(this,e),this.fullcalendar=null,this.calendar_defaults=this.calendar_defaults&&Object.keys(this.calendar_defaults)?this.calendar_defaults:{display_event_time:!0,display_event_end:!0},this.sidebar_menu=this.list_view.list_sidebar.sidebar.find(".sidebar-menu"),this.get_default_options()}get_default_options(){var e=this;return new Promise((function(e){var t=localStorage.getItem("cal_initialView"),n=localStorage.getItem("cal_weekends");e({initialView:t&&["timeGridDay","timeGridWeek","dayGridMonth"].includes(t)?t:"dayGridMonth",weekends:n||!0})})).then((function(t){Object.assign(e.calendar_defaults,t),e.make_page(),e.setup_options(e.calendar_defaults),e.make(),e.setup_view_mode_button(e.calendar_defaults),e.bind()}))}make_page(){var e=this;e.page.clear_user_actions(),$.each(frappe.boot.calendars,(function(t,n){frappe.model.can_read(n)&&e.page.add_menu_item(__(n),(function(){frappe.set_route("List",n,"Calendar")}))})),$(this.parent).on("show",(function(){e.fullcalendar.refetchEvents()}))}make(){this.$wrapper=this.parent,this.$cal=$("<div>").appendTo(this.$wrapper),this.footnote_area=frappe.utils.set_footnote(this.footnote_area,this.$wrapper,__("Select or drag across time slots to create a new event.")),this.footnote_area.css({"border-top":"0px"}),this.fullcalendar=new Calendar(this.$cal[0],this.cal_options),this.fullcalendar.render(),this.$wrapper.find(".fc-today-button").prepend(frappe.utils.icon("today")),this.secondary_status_color&&this.show_secondary_status_legend()}setup_view_mode_button(e){$(this.footnote_area).find(".btn-weekend").detach();var t='<button class="btn btn-default btn-xs btn-weekend">'+(e.weekends?__("Hide Weekends"):__("Show Weekends"))+"</button>";this.footnote_area.append(t)}set_localStorage_option(e,t){localStorage.removeItem(e),localStorage.setItem(e,t)}bind(){var e=this;e.$wrapper.find(".fc-button-group").on("click",".fc-button",(function(){var t=$(this).hasClass("fc-timeGridWeek-button")?"timeGridWeek":$(this).hasClass("fc-timeGridDay-button")?"timeGridDay":"dayGridMonth";e.set_localStorage_option("cal_initialView",t)})),e.$wrapper.on("click",".btn-weekend",(function(){e.cal_options.weekends=!e.cal_options.weekends,e.fullcalendar.setOption("weekends",e.cal_options.weekends),e.set_localStorage_option("cal_weekends",e.cal_options.weekends),e.setup_view_mode_button(e.cal_options)}))}field_map(){return{id:"name",start:"start",end:"end",allDay:"all_day"}}show_secondary_status_legend(){var e=this;frappe.model.with_doctype(this.doctype,(function(){var t=frappe.get_meta(e.doctype),n=Object.keys(e.secondary_status_color).map((function(t){return'\n\t\t\t\t\t<div><span class="flex align-items-center status-color '+e.secondary_status_color[t]+'">'+__(t)+"</span></div>\n\t\t\t\t"})).join("");e.sidebar_menu.find(".calendar-status-section").remove(),e.sidebar_menu.append('\n\t\t\t\t<div class="calendar-status-section">\n\t\t\t\t\t<li class="sidebar-label">'+__(t.fields.filter((function(t){return t.fieldname==e.field_map.secondary_status}))[0].label)+"</li>\n\t\t\t\t\t<div>"+n+"</div>\n\t\t\t\t</div>\n\t\t\t")}))}get_system_datetime(e){return e._offset=moment(e).tz(frappe.sys_defaults.time_zone)._offset,frappe.datetime.convert_to_system_tz(e)}setup_options(e){var t=this;this.cal_options={locale:frappe.boot.lang||"en",plugins:[main$2,main$1,main],headerToolbar:{left:"dayGridMonth,timeGridWeek,timeGridDay",center:"prev,title,next",right:"today"},height:"auto",editable:!0,selectable:!0,selectMirror:!0,forceEventDuration:!0,displayEventTime:e.display_event_time,displayEventEnd:e.display_event_end,initialView:e.initialView,weekends:e.weekends,nowIndicator:!0,events:function(e,n){return frappe.xcall(t.get_events_method||"frappe.desk.calendar.get_events",t.get_args(e.start,e.end)).then((function(e){var i=e||[];i=t.prepare_events(i),n(i)}))},eventClick:function(e){var n=e.event.doctype||e.event.extendedProps.doctype||t.doctype;frappe.model.can_read(n)&&frappe.set_route("Form",n,e.event.id)},eventDrop:function(e){t.update_event(e)},eventResize:function(e){t.update_event(e)},select:function(e){if("dayGridMonth"!==e.view.type||e.end-e.start!=864e5){var n=frappe.model.get_new_doc(t.doctype);n[t.field_map.start]=t.get_system_datetime(e.start),t.field_map.end&&(n[t.field_map.end]=t.get_system_datetime(e.end)),t.field_map.allDay&&(n[t.field_map.allDay]=e.allDay,e.allDay&&(n[t.field_map.end]=moment(e.end).subtract(1,"seconds"))),frappe.set_route("Form",t.doctype,n.name)}},dateClick:function(e){return"dayGridMonth"===e.view.type&&(t.fullcalendar.changeView("timeGridDay"),t.fullcalendar.gotoDate(e.date),t.$wrapper.find(".fc-dayGridMonth-button").removeClass("active"),t.$wrapper.find(".fc-timeGridDay-button").addClass("active")),!1},buttonText:{today:__("Today"),month:__("Month"),week:__("Week"),day:__("Day")},allDayContent:function(){return __("All Day")},eventDidMount:function(e){$(e.el).tooltip({title:frappe.utils.html2text(e.event.title),placement:"auto"})},slotMinTime:e.slots_start_time||"06:00:00",slotMaxTime:e.slots_end_time||"22:00:00"},e.first_day&&Object.assign(this.cal_options,{firstDay:e.first_day}),this.options&&$.extend(this.cal_options,this.options)}get_args(e,t){return{doctype:this.doctype,start:this.get_system_datetime(e),end:this.get_system_datetime(t),filters:this.list_view.filter_area.get(),field_map:this.field_map}}refresh(){this.fullcalendar.refetchEvents()}prepare_events(e){var t=this;return(e||[]).map((function(e){return e.id=e.name,e.editable=frappe.model.can_write(e.doctype||t.doctype),e.classNames=[],e.docstatus&&e.docstatus>0&&(e.editable=!1),$.each(t.field_map,(function(t,n){e[t]=e[n]})),t.field_map.allDay||t.no_all_day||(e.allDay=!0),e.start=frappe.datetime.convert_to_user_tz(e.start),e.end=frappe.datetime.convert_to_user_tz(e.end),!frappe.datetime.validate(e.start)&&e.end&&(e.start=frappe.datetime.add_days(e.end,-1)),e.start&&!frappe.datetime.validate(e.end)&&(e.end=frappe.datetime.add_days(e.start,1)),(e.secondary_status||e.status)&&t.secondary_status_color&&e.classNames.push(t.secondary_status_color[e.secondary_status||e.status]||""),t.fix_end_date_for_event_render(e),t.prepare_colors(e),e.title=frappe.utils.html2text(e.title),e}))}prepare_colors(e){var t;return t=e.color,frappe.ui.color.validate_hex(t)&&t||(t=frappe.ui.color.get("blue","default")),e.backgroundColor=t,e.borderColor=t,e.textColor=frappe.ui.color.get_contrast_color(t),e}update_event(e){var t=this;return frappe.model.remove_from_locals(t.doctype,e.event.name),frappe.call({method:t.update_event_method||"frappe.desk.calendar.update_event",args:t.get_update_args(e.event),callback:function(t){t.exc&&(frappe.show_alert(__("Unable to update event")),e.revert())},error:function(){e.revert()}})}get_update_args(e){var t={name:e.id};return t[this.field_map.start]=this.get_system_datetime(e.start),this.field_map.allDay&&(t[this.field_map.allDay]=e.allDay),this.field_map.end&&(e.end||(e.end=e.start.add(1,"hour")),t[this.field_map.end]=this.get_system_datetime(e.end),t[this.field_map.allDay]&&(t[this.field_map.end]=moment(e.end).subtract(1,"seconds"))),t.doctype=e.doctype||this.doctype,{args:t,field_map:this.field_map}}fix_end_date_for_event_render(e){e.allDay&&(e.end=e.end?this.get_system_datetime(moment(e.end).add(1,"day")):null)}},frappe.provide("frappe.views"),frappe.views.DashboardView=class extends frappe.views.ListView{get view_name(){return"Dashboard"}setup_defaults(){var e=this;return super.setup_defaults().then((function(){e.page_title=__("{0} Dashboard",[__(e.doctype)]),e.dashboard_settings=frappe.get_user_settings(e.doctype).dashboard_settings||null}))}render(){}setup_page(){this.hide_sidebar=!0,this.hide_page_form=!0,this.hide_page_form=!0,this.hide_filters=!0,this.hide_sort_selector=!0,super.setup_page()}setup_view(){this.chart_group||this.number_card_group||(this.setup_dashboard_page(),this.setup_dashboard_customization(),this.make_dashboard(),this.filter_area&&this.filter_area.$filter_list_wrapper.hide())}setup_dashboard_customization(){var e=this;this.page.add_menu_item(__("Customize Dashboard"),(function(){return e.customize()})),this.page.add_menu_item(__("Reset Dashboard Customizations"),(function(){return e.reset_dashboard_customization()})),this.add_customization_buttons()}setup_dashboard_page(){this.$frappe_list.html('<div class="dashboard-view"></div>'),this.page.clear_secondary_action(),this.$dashboard_page=this.$page.find(".layout-main-section-wrapper").addClass("dashboard-page"),this.page.main.removeClass("frappe-card"),this.$dashboard_wrapper=this.$page.find(".dashboard-view"),this.$chart_header=this.$page.find(".dashboard-header"),frappe.utils.bind_actions_with_object(this.$dashboard_page,this)}add_customization_buttons(){var e=this;this.save_customizations_button=this.page.add_button(__("Save Customizations"),(function(){e.save_dashboard_customization(),e.page.standard_actions.show()}),{btn_class:"btn-primary"}),this.discard_customizations_button=this.page.add_button(__("Discard"),(function(){e.discard_dashboard_customization(),e.page.standard_actions.show()})),this.toggle_customization_buttons(!1)}set_primary_action(){}toggle_customization_buttons(e){this.save_customizations_button.toggle(e),this.discard_customizations_button.toggle(e)}make_dashboard(){var e=this;this.dashboard_settings?(this.charts=this.dashboard_settings.charts,this.number_cards=this.dashboard_settings.number_cards,this.render_dashboard()):frappe.run_serially([function(){return e.fetch_dashboard_items("Dashboard Chart",{chart_type:["in",["Count","Sum","Group By"]],document_type:e.doctype,is_public:1},"charts")},function(){return e.fetch_dashboard_items("Number Card",{document_type:e.doctype,is_public:1},"number_cards")},function(){return e.render_dashboard()}])}render_dashboard(){var e=this;this.$dashboard_wrapper.empty(),frappe.dashboard_utils.get_dashboard_settings().then((function(t){e.dashboard_chart_settings=t.chart_config?JSON.parse(t.chart_config):{},e.charts.map((function(t){t.label=t.chart_name,t.chart_settings=e.dashboard_chart_settings[t.chart_name]||{}})),e.render_dashboard_charts()})),this.render_number_cards(),this.charts.length||this.number_cards.length||this.render_empty_state()}fetch_dashboard_items(e,t,n){var i=this;return frappe.db.get_list(e,{filters:t,fields:["*"]}).then((function(e){i[n]=e}))}render_number_cards(){this.number_card_group=new frappe.widget.WidgetGroup({container:this.$dashboard_wrapper,type:"number_card",columns:3,options:{allow_sorting:!0,allow_create:!0,allow_delete:!0,allow_hiding:!0},default_values:{doctype:this.doctype},widgets:this.number_cards||[],in_customize_mode:this.in_customize_mode||!1}),this.in_customize_mode&&this.number_card_group.customize()}render_dashboard_charts(){var e=this;this.chart_group=new frappe.widget.WidgetGroup({container:this.$dashboard_wrapper,type:"chart",columns:2,height:240,options:{allow_sorting:!0,allow_create:!0,allow_delete:!0,allow_hiding:!0,allow_resize:!0},custom_dialog:function(){return e.show_add_chart_dialog()},widgets:this.charts,in_customize_mode:this.in_customize_mode||!1}),this.in_customize_mode&&this.chart_group.customize(),this.chart_group.container.find(".widget-group-head").hide()}render_empty_state(){var e='<div class="msg-box no-border empty-dashboard">\n\t\t\t<div>\n\t\t\t\t<img src="/assets/frappe/images/ui-states/list-empty-state.svg" alt="Generic Empty State" class="null-state">\n\t\t\t</div>\n\t\t\t'+("<p>"+__("You haven't added any Dashboard Charts or Number Cards yet.")+"\n\t\t\t<br>"+__("Click On Customize to add your first widget")+"</p>")+"\n\t\t\t"+('<p><button class="btn btn-primary btn-sm" data-action="customize">\n\t\t\t\t'+__("Customize")+"\n\t\t\t</button></p>")+"\n\t\t</div>";this.$dashboard_wrapper.append(e),this.$empty_state=this.$dashboard_wrapper.find(".empty-dashboard")}customize(){this.in_customize_mode||(this.page.standard_actions.hide(),this.$empty_state&&this.$empty_state.remove(),this.toggle_customize(!0),this.in_customize_mode=!0,this.chart_group.customize(),this.number_card_group.customize())}get_widgets_to_save(e){var t=e.get_widget_config(),n=[];return t.order.map((function(e){n.push(t.widgets[e])})),this.remove_duplicates(n)}save_dashboard_customization(){this.toggle_customize(!1);var e=this.get_widgets_to_save(this.chart_group),t=this.get_widgets_to_save(this.number_card_group);this.dashboard_settings={charts:e,number_cards:t},frappe.model.user_settings.save(this.doctype,"dashboard_settings",this.dashboard_settings),this.make_dashboard()}discard_dashboard_customization(){this.dashboard_settings=frappe.get_user_settings(this.doctype).dashboard_settings||null,this.toggle_customize(!1),this.render_dashboard()}reset_dashboard_customization(){var e=this;frappe.confirm(__("Are you sure you want to reset all customizations?"),(function(){e.dashboard_settings=null,frappe.model.user_settings.save(e.doctype,"dashboard_settings",e.dashboard_settings).then((function(){return e.make_dashboard()})),e.toggle_customize(!1)}))}toggle_customize(e){this.toggle_customization_buttons(e),this.in_customize_mode=e}show_add_chart_dialog(){var e=this,t=this.get_field_options(),n=new frappe.ui.Dialog({title:__("Add a {0} Chart",[__(this.doctype)]),fields:[{fieldname:"new_or_existing",fieldtype:"Select",label:__("Choose an existing chart or create a new chart"),options:[{value:"New Chart",label:__("New Chart")},{value:"Existing Chart",label:__("Existing Chart")}],reqd:1},{label:__("Chart"),fieldname:"chart",fieldtype:"Link",get_query:function(){return{query:"frappe.desk.doctype.dashboard_chart.dashboard_chart.get_charts_for_user",filters:{document_type:["in",[e.doctype,""]]}}},options:"Dashboard Chart",depends_on:'eval: doc.new_or_existing == "Existing Chart"'},{fieldname:"sb_2",fieldtype:"Section Break",depends_on:'eval: doc.new_or_existing == "New Chart"'},{label:__("Chart Label"),fieldname:"label",fieldtype:"Data",mandatory_depends_on:'eval: doc.new_or_existing == "New Chart"'},{fieldname:"cb_1",fieldtype:"Column Break"},{label:__("Chart Type"),fieldname:"chart_type",fieldtype:"Select",options:["Time Series","Group By"],mandatory_depends_on:'eval: doc.new_or_existing == "New Chart"'},{fieldname:"sb_2",fieldtype:"Section Break",label:__("Chart Config"),depends_on:'eval: doc.chart_type == "Time Series" && doc.new_or_existing == "New Chart"'},{label:__("Function"),fieldname:"chart_function",fieldtype:"Select",options:["Count","Sum","Average"],default:"Count"},{label:__("Timespan"),fieldtype:"Select",fieldname:"timespan",depends_on:'eval: doc.chart_type == "Time Series"',options:["Last Year","Last Quarter","Last Month","Last Week"],default:"Last Year"},{fieldname:"cb_2",fieldtype:"Column Break"},{label:__("Value Based On"),fieldtype:"Select",fieldname:"based_on",options:t.value_fields,depends_on:'eval: doc.chart_function=="Sum"'},{label:__("Time Series Based On"),fieldtype:"Select",fieldname:"based_on",options:t.date_fields,mandatory_depends_on:'eval: doc.chart_type == "Time Series"'},{label:__("Time Interval"),fieldname:"time_interval",fieldtype:"Select",depends_on:'eval: doc.chart_type == "Time Series"',options:["Yearly","Quarterly","Monthly","Weekly","Daily"],default:"Monthly"},{fieldname:"sb_2",fieldtype:"Section Break",label:__("Chart Config"),depends_on:'eval: doc.chart_type == "Group By" && doc.new_or_existing == "New Chart"'},{label:__("Group By Type"),fieldname:"group_by_type",fieldtype:"Select",options:["Count","Sum","Average"],default:"Count"},{label:__("Aggregate Function Based On"),fieldtype:"Select",fieldname:"aggregate_function_based_on",options:t.aggregate_function_fields,depends_on:'eval: ["Sum", "Avergage"].includes(doc.group_by_type)'},{fieldname:"cb_2",fieldtype:"Column Break"},{label:__("Group By Based On"),fieldtype:"Select",fieldname:"group_by_based_on",options:t.group_by_fields,default:"Last Year"},{label:__("Number of Groups"),fieldtype:"Int",fieldname:"number_of_groups",default:0},{fieldname:"sb_3",fieldtype:"Section Break",depends_on:'eval: doc.new_or_existing == "New Chart"'},{label:__("Chart Type"),fieldname:"type",fieldtype:"Select",options:["Line","Bar","Percentage","Pie"],depends_on:'eval: doc.new_or_existing == "New Chart"'},{fieldname:"cb_1",fieldtype:"Column Break"},{label:__("Chart Color"),fieldname:"color",fieldtype:"Color",depends_on:'eval: doc.new_or_existing == "New Chart"'}],primary_action_label:__("Add"),primary_action:function(t){var i=t;"New Chart"==i.new_or_existing?(i.chart_name=i.label,i.chart_type="Time Series"==i.chart_type?i.chart_function:i.chart_type,i.document_type=e.doctype,i.filters_json="[]",frappe.xcall("frappe.desk.doctype.dashboard_chart.dashboard_chart.create_dashboard_chart",{args:i}).then((function(t){e.chart_group.new_widget.on_create({chart_name:t.chart_name,name:t.chart_name,label:i.label})}))):e.chart_group.new_widget.on_create({chart_name:i.chart,label:i.chart,name:i.chart}),n.hide()}});n.show()}get_field_options(){var e=[{label:__("Created On"),value:"creation"},{label:__("Last Modified On"),value:"modified"}],t=[],n=[],i=[];return frappe.get_meta(this.doctype).fields.map((function(r){if(["Date","Datetime"].includes(r.fieldtype)&&e.push({label:r.label,value:r.fieldname}),frappe.model.numeric_fieldtypes.includes(r.fieldtype)){if("Currency"==r.fieldtype&&(!r.options||"Company:company:default_currency"!==r.options))return;t.push({label:r.label,value:r.fieldname}),i.push({label:r.label,value:r.fieldname})}["Link","Select"].includes(r.fieldtype)&&n.push({label:r.label,value:r.fieldname})})),{date_fields:e,value_fields:t,group_by_fields:n,aggregate_function_fields:i}}remove_duplicates(e){return e.filter((function(t,n){return e.indexOf(t)===n}))}},frappe.provide("frappe.views"),frappe.views.ImageView=class extends frappe.views.ListView{get view_name(){return"Image"}setup_defaults(){var e=this;return super.setup_defaults().then((function(){e.page_title=e.page_title+" "+__("Images")}))}setup_view(){this.setup_columns(),this.setup_check_events(),this.setup_like()}set_fields(){this.fields=["name"].concat(this.get_fields_in_list_view().map((function(e){return e.fieldname})),[this.meta.title_field],[this.meta.image_field],["_liked_by"])}prepare_data(e){var t=this;super.prepare_data(e),this.items=this.data.map((function(e){return e._image_url=t.get_image_url(e),e}))}render(){var e=this;this.get_attached_images().then((function(){e.render_image_view(),e.gallery?e.gallery.prepare_pswp_items(e.items,e.images_map):e.setup_gallery()}))}render_image_view(){var e=this.items.map(this.item_html.bind(this)).join("");this.$page.find(".layout-main-section-wrapper").addClass("image-view"),this.$result.html('\n\t\t\t<div class="image-view-container">\n\t\t\t\t'+e+"\n\t\t\t</div>\n\t\t"),this.render_count()}item_details_html(e){var t=this.get_fields_in_list_view().map((function(e){return e.fieldname}))||[],n=this.meta.title_field||"name";t=t.filter((function(e){return e!==n}));var i='<div><ul class="list-unstyled image-view-info">',r=!1;return t.forEach((function(t,n){e[t]&&!r&&(i+=0==n?"<li>"+e[t]+"</li>":'<li class="text-muted">'+e[t]+"</li>",r=!0)})),i+="</ul></div>"}item_html(e){e._name=encodeURI(e.name);var t=e._name,n=strip_html(e[this.meta.title_field||"name"]),i=frappe.utils.escape_html(n),r=e._image_url?"":"no-image",a=e._image_url?'<img data-name="'+t+'" src="'+e._image_url+'" alt="'+n+'">':'<span class="placeholder-text">\n\t\t\t\t'+frappe.get_abbr(n)+"\n\t\t\t</span>",s=this.item_details_html(e),o=e._image_url?'<div class="zoom-view" data-name="'+t+'">\n\t\t\t\t'+frappe.utils.icon("expand","xs")+"\n\t\t\t</div>":"";return'\n\t\t\t<div class="image-view-item ellipsis">\n\t\t\t\t<div class="image-view-header">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<input class="level-item list-row-checkbox hidden-xs"\n\t\t\t\t\t\t\ttype="checkbox" data-name="'+escape(e.name)+'">\n\t\t\t\t\t\t'+this.get_like_html(e)+'\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="image-view-body '+r+'">\n\t\t\t\t\t<a data-name="'+t+'"\n\t\t\t\t\t\ttitle="'+t+'"\n\t\t\t\t\t\thref="'+this.get_form_link(e)+'"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="image-field"\n\t\t\t\t\t\t\tdata-name="'+t+'"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t'+a+"\n\t\t\t\t\t\t\t"+o+"\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</a>\n\t\t\t\t\t"+o+'\n\t\t\t\t</div>\n\t\t\t\t<div class="image-view-footer">\n\t\t\t\t\t<div class="image-title">\n\t\t\t\t\t\t<span class="ellipsis" title="'+i+'">\n\t\t\t\t\t\t\t<a class="ellipsis" href="'+this.get_form_link(e)+'"\n\t\t\t\t\t\t\t\ttitle="'+i+'" data-doctype="'+this.doctype+'" data-name="'+e.name+'">\n\t\t\t\t\t\t\t\t'+n+"\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t"+s+"\n\t\t\t</div>\n\t\t"}get_attached_images(){var e=this;return frappe.call({method:"frappe.core.doctype.file.file.get_attached_images",args:{doctype:this.doctype,names:this.items.map((function(e){return e.name}))}}).then((function(t){e.images_map=Object.assign(e.images_map||{},t.message)}))}get_header_html(){}setup_gallery(){var e=this;this.gallery=new frappe.views.GalleryView({doctype:this.doctype,items:this.items,wrapper:this.$result,images_map:this.images_map}),this.$result.on("click",".zoom-view",(function(t){t.preventDefault(),t.stopPropagation();var n=$(this).data().name;return n=decodeURIComponent(n),e.gallery.show(n),!1}))}},frappe.views.GalleryView=Class.extend({init:function(e){$.extend(this,e);var t=this;this.lib_ready=this.load_lib(),this.lib_ready.then((function(){t.prepare()}))},prepare:function(){if(this.pswp_root=$("body > .pswp"),0===this.pswp_root.length){var e=frappe.render_template("photoswipe_dom");this.pswp_root=$(e).appendTo("body")}},prepare_pswp_items:function(e,t){var n=this,i=this;return e&&(this.items=this.items.concat(e),this.images_map=t),new Promise((function(e){var t=n.items.map((function(e){var t,n,r='img[data-name="'+e._name+'"]',a=i.wrapper.find(r).get(0);return a&&(t=a.naturalWidth,n=a.naturalHeight),a||(t=(a=i.wrapper.find('.image-field[data-name="'+e._name+'"]').get(0)).getBoundingClientRect().width,n=a.getBoundingClientRect().height),{src:e._image_url,msrc:e._image_url,name:e.name,w:t,h:n,el:a}}));n.pswp_items=t,e()}))},show:function(e){var t=this;this.lib_ready.then((function(){return t.prepare_pswp_items()})).then((function(){return t._show(e)}))},_show:function(e){var t=this,n=this.pswp_items,i={index:n.findIndex((function(t){return t.name===e})),getThumbBoundsFn:function(e){var i='img[data-name="'+n[e]._name+'"]',r=t.wrapper.find(i).get(0);if(r){var a=window.pageYOffset||document.documentElement.scrollTop,s=r.getBoundingClientRect();return{x:s.left,y:s.top+a,w:s.width}}},history:!1,shareEl:!1,showHideOpacity:!0};this.pswp=new PhotoSwipe(this.pswp_root.get(0),PhotoSwipeUI_Default,n,i),this.browse_images(),this.pswp.init()},browse_images:function(){var e=this,t=this.pswp_root.find(".pswp__more-items"),n=this.images_map,i=null;function r(){clearTimeout(i),t.show(),i=setTimeout(a,2e3)}function a(){t.hide()}function s(e){return'<div class="pswp__more-item">\n\t\t\t\t<img src="'+e+'">\n\t\t\t</div>'}this.pswp.listen("afterChange",(function(){var e=n[this.currItem.name];if(e&&1!==e.length){r();var i=e.map(s).join("");t.html(i)}else t.html("")})),this.pswp.listen("beforeChange",a),this.pswp.listen("initialZoomOut",a),this.pswp.listen("destroy",(function(){$(document).off("mousemove",r)})),t.on("click",".pswp__more-item",(function(t){var n=t.target,i=e.pswp.items.findIndex((function(t){return t.name===e.pswp.currItem.name}));e.pswp.goTo(i),e.pswp.items.splice(i,1,{src:n.src,w:n.naturalWidth,h:n.naturalHeight,name:e.pswp.currItem.name}),e.pswp.invalidateCurrItems(),e.pswp.updateSize(!0)})),$(document).on("mousemove",r)},load_lib:function(){return new Promise((function(e){var t="assets/frappe/js/lib/photoswipe/";frappe.require([t+"photoswipe.css",t+"default-skin.css",t+"photoswipe.js",t+"photoswipe-ui-default.js"],e)}))}}),frappe.provide("frappe.views"),frappe.views.KanbanView=class extends frappe.views.ListView{static load_last_view(){var e=frappe.get_route();if(3===e.length){var t=e[1],n=frappe.get_user_settings(t).Kanban||{};return n.last_kanban_board?(e.push(n.last_kanban_board),frappe.set_route(e),!0):(frappe.msgprint({title:__("Error"),indicator:"red",message:__("Missing parameter Kanban Board Name")}),frappe.set_route("List",t,"List"),!0)}return!1}get view_name(){return"Kanban"}setup_defaults(){var e=this;return super.setup_defaults().then((function(){return e.board_name=frappe.get_route()[3],e.page_title=__(e.board_name),e.card_meta=e.get_card_meta(),e.page_length=0,e.menu_items.push({label:__("Save filters"),action:function(){e.save_kanban_board_filters()}}),e.get_board()}))}setup_paging_area(){}toggle_result_area(){this.$result.toggle(this.data.length>0)}get_board(){var e=this;return frappe.db.get_doc("Kanban Board",this.board_name).then((function(t){e.board=t,e.board.filters_array=JSON.parse(e.board.filters||"[]"),e.filters=e.board.filters_array}))}before_refresh(){}setup_page(){this.hide_page_form=!0,this.hide_card_layout=!0,super.setup_page()}setup_side_bar(){super.setup_side_bar(),this.toggle_side_bar()}setup_view(){this.board.columns.length>5&&this.page.container.addClass("full-width"),this.setup_realtime_updates(),this.setup_like()}set_fields(){super.set_fields(),this._add_field(this.card_meta.title_field)}before_render(){frappe.model.user_settings.save(this.doctype,"last_view",this.view_name),this.save_view_user_settings({last_kanban_board:this.board_name})}render_list(){}on_filter_change(){JSON.stringify(this.board.filters_array)!==JSON.stringify(this.filter_area.get())?this.page.set_indicator(__("Not Saved"),"orange"):this.page.clear_indicator()}save_kanban_board_filters(){var e=this,t=this.filter_area.get();frappe.call({method:"frappe.desk.doctype.kanban_board.kanban_board.save_filters",args:{board_name:this.board_name,filters:t}}).then((function(n){n.exc?frappe.show_alert({indicator:"red",message:__("There was an error saving filters")}):(frappe.show_alert({indicator:"green",message:__("Filters saved")}),e.board.filters_array=t,e.on_filter_change())}))}get_fields(){return this.fields.push([this.board.field_name,this.board.reference_doctype]),super.get_fields()}render(){var e=this.board_name;this.kanban&&e===this.kanban.board_name?this.kanban.update(this.data):this.kanban=new frappe.views.KanbanBoard({doctype:this.doctype,board:this.board,board_name:e,cards:this.data,card_meta:this.card_meta,wrapper:this.$result,cur_list:this,user_settings:this.view_user_settings})}get_card_meta(){var e=frappe.get_meta(this.doctype),t=frappe.model.get_new_doc(this.doctype),n=null,i=!1;this.meta.title_field&&(n=frappe.meta.get_field(this.doctype,this.meta.title_field)),this.meta.fields.forEach((function(e){in_list(["Data","Text","Small Text","Text Editor"],e.fieldtype)&&!e.hidden&&!n&&(n=e)}));var r=e.fields.filter((function(e){return e.reqd&&!t[e.fieldname]}));return(r.some((function(e){return frappe.model.table_fields.includes(e.fieldtype)}))||r.length>1)&&(i=!0),n||(n=frappe.meta.get_field(this.doctype,"name")),{quick_entry:i,title_field:n}}get required_libs(){return["assets/frappe/js/lib/fluxify.min.js","assets/frappe/js/frappe/views/kanban/kanban_board.js"]}},frappe.views.KanbanView.get_kanbans=function(e){var t=[];return frappe.call("frappe.desk.doctype.kanban_board.kanban_board.get_kanban_boards",{doctype:e}).then((function(e){return e.message})).then((function(e){return e&&e.forEach((function(e){var n="/app/"+frappe.router.slug(e.reference_doctype)+"/view/kanban/"+e.name;t.push({name:e.name,route:n})})),t}))},frappe.views.KanbanView.show_kanban_dialog=function(e,t){var n=null;frappe.views.KanbanView.get_kanbans(e).then((function(i){(n=function(t,i){if(n)return n;var r=function(t,n){void 0===n&&(n=!1);t.push("Create New Board");var i=[{fieldtype:"Select",fieldname:"selected_kanban",label:__("Choose Kanban Board"),reqd:1,depends_on:"eval: "+n,mandatory_depends_on:"eval: "+n,options:t},{fieldname:"new_kanban_board_sb",fieldtype:"Section Break",depends_on:"eval: !"+n+' || doc.selected_kanban == "Create New Board"'},{fieldtype:"Data",fieldname:"board_name",label:__("Kanban Board Name"),mandatory_depends_on:'eval: doc.selected_kanban == "Create New Board"',description:["Note","ToDo"].includes(e)?__("This Kanban Board will be private"):""}];"Task"===e&&i.push({fieldtype:"Link",fieldname:"project",label:__("Project"),options:"Project"});var r=frappe.get_meta(e).fields.filter((function(e){return"Select"===e.fieldtype&&"kanban_column"!==e.fieldname}));r.length>0?i.push({fieldtype:"Select",fieldname:"field_name",label:__("Columns based on"),options:r.map((function(e){return{label:e.label,value:e.fieldname}})),default:r[0],mandatory_depends_on:'eval: doc.selected_kanban == "Create New Board"'}):i=[{fieldtype:"HTML",options:'\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<p class="text-medium">\n\t\t\t\t\t\t'+__('No fields found that can be used as a Kanban Column. Use the Customize Form to add a Custom Field of type "Select".')+'\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<a class="btn btn-xs btn-default" href="/app/customize-form?doc_type='+e+'">\n\t\t\t\t\t\t\t'+__("Customize Form")+"\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t"}];return i}(t.map((function(e){return e.name})),i),a=__("Save"),s=function(){var i,r,a,s=n.get_values();s.selected_kanban&&"Create New Board"!=s.selected_kanban?frappe.set_route(t.find((function(e){return e.name==s.selected_kanban})).route):(i=s.board_name,r=s.field_name,a=s.project,frappe.call({method:"frappe.desk.doctype.kanban_board.kanban_board.quick_kanban_board",args:{doctype:e,board_name:i,field_name:r,project:a},callback:function(t){var n=t.message;n.filters&&(frappe.provide("frappe.kanban_filters"),frappe.kanban_filters[n.kanban_board_name]=n.filters),frappe.set_route("List",e,"Kanban",n.kanban_board_name)}})).then((function(){return n.hide()}),(function(e){return frappe.msgprint(e)}))};return n=new frappe.ui.Dialog({title:__("New Kanban Board"),fields:r,primary_action_label:a,primary_action:s})}(i,t)).show()}))},frappe.provide("frappe.views"),frappe.views.InboxView=class extends frappe.views.ListView{static load_last_view(){var e,t=frappe.get_route();return!t[3]&&frappe.boot.email_accounts.length?(e="All Accounts"==frappe.boot.email_accounts[0].email_id?"All Accounts":frappe.boot.email_accounts[0].email_account,frappe.set_route("List","Communication","Inbox",e),!0):(t[3]&&("All Accounts"===t[3]||function(e){return frappe.boot.email_accounts.find((function(t){return t.email_account===e}))}(t[3]))||frappe.throw(__("No email account associated with the User. Please add an account under User > Email Inbox.")),!1)}get view_name(){return"Inbox"}show(){super.show(),this.save_view_user_settings({last_email_account:this.current_email_account})}setup_defaults(){super.setup_defaults(),this.sort_by=this.view_user_settings.sort_by||"communication_date",this.sort_order=this.view_user_settings.sort_order||"desc",this.email_account=frappe.get_route()[3],this.page_title=this.email_account,this.filters=this.get_inbox_filters()}setup_columns(){this.columns=[],this.columns.push({type:"Subject",df:{label:__("Subject"),fieldname:"subject"}}),this.columns.push({type:"Field",df:{label:this.is_sent_emails?__("To"):__("From"),fieldname:this.is_sent_emails?"recipients":"sender"}})}get_seen_class(e){return Boolean(e.seen)||JSON.parse(e._seen||"[]").includes(frappe.session.user)?"":"bold"}get is_sent_emails(){var e=this.filter_area.get().find((function(e){return"sent_or_received"===e[1]}));return e&&"Sent"===e[3]}render_header(){this.$result.find(".list-row-head").remove(),this.$result.prepend(this.get_header_html())}render(){this.setup_columns(),this.render_header(),this.render_list(),this.on_row_checked(),this.render_count()}get_meta_html(e){var t=e.has_attachment?'<span class="uil uil-paperclip" title="'+__("Has Attachments")+'"></span>':"",n=frappe.utils.get_form_link(e.reference_doctype,e.reference_name),i=e.reference_doctype&&e.reference_doctype!==this.doctype?'<a class="text-muted grey" href="'+n+'"\n\t\t\t\ttitle="'+__("Linked with {0}",[e.reference_doctype])+'">\n\t\t\t\t<i class="fa fa-link fa-large"></i>\n\t\t\t</a>':"",r=comment_when(e.communication_date,!0);return'\n\t\t\t<div class="level-item list-row-activity">\n\t\t\t\t'+i+"\n\t\t\t\t"+t+"\n\t\t\t\t"+("Closed"==e.status?'<span class="fas fa-check fa-large" title="'+__(e.status)+'"></span>':"Replied"==e.status?'<span class="fas fa-reply fa-large" title="'+__(e.status)+'"></span>':"")+"\n\t\t\t\t"+r+"\n\t\t\t</div>\n\t\t"}get_inbox_filters(){var e=this.email_account,t=[["Communication","communication_type","=","Communication",!0],["Communication","communication_medium","=","Email",!0]],n=[];if("Sent"===e)n=t.concat([["Communication","sent_or_received","=","Sent",!0],["Communication","email_status","not in","Spam,Trash",!0]]);else if(in_list(["Spam","Trash"],e))n=t.concat([["Communication","email_status","=",e,!0],["Communication","email_account","in",frappe.boot.all_accounts,!0]]);else{var i="=";"All Accounts"==e&&(i="in",e=frappe.boot.all_accounts),n=t.concat([["Communication","sent_or_received","=","Received",!0],["Communication","status","=","Open",!0],["Communication","email_account",i,e,!0],["Communication","email_status","not in","Spam,Trash",!0]])}return n}get_no_result_message(){var e,t=this.email_account;return in_list(["Spam","Trash"],t)?__("No {0} mail",[t]):(e=t||frappe.boot.email_accounts.length?{doctype:"Communication",msg:__("No Emails"),label:__("Compose Email")}:{doctype:"Email Account",msg:__("No Email Account"),label:__("New Email Account")},'\n\t\t\t<div class="msg-box no-border">\n\t\t\t\t'+(frappe.model.can_create(e.doctype)?"<p>"+e.msg+'</p>\n\t\t\t<p>\n\t\t\t\t<button class="btn btn-primary btn-sm btn-new-doc">\n\t\t\t\t\t'+e.label+"\n\t\t\t\t</button>\n\t\t\t</p>\n\t\t\t":"<p>"+__("No Email Accounts Assigned")+"</p>")+"\n\t\t\t</div>\n\t\t")}make_new_doc(){this.email_account||frappe.boot.email_accounts.length?new frappe.views.CommunicationComposer({doc:{}}):(frappe.route_options={email_id:frappe.session.user_email},frappe.new_doc("Email Account"))}},frappe.provide("frappe.views"),frappe.views.FileView=class extends frappe.views.ListView{static load_last_view(){if(2===frappe.get_route().length){var e=frappe.get_user_settings("File","File");return frappe.set_route("List","File",e.last_folder||frappe.boot.home_folder),!0}return redirect_to_home_if_invalid_route()}get view_name(){return"File"}show(){redirect_to_home_if_invalid_route()||super.show()}setup_view(){var e=this;this.render_header(),this.setup_events(),this.$page.find(".layout-main-section-wrapper").addClass("file-view"),this.add_file_action_buttons(),this.page.add_button(__("Toggle Grid View"),(function(){frappe.views.FileView.grid_view=!frappe.views.FileView.grid_view,e.refresh()}))}setup_no_result_area(){this.$no_result=$('<div class="no-result">\n\t\t\t<div class="breadcrumbs">'+this.get_breadcrumbs_html()+'</div>\n\t\t\t<div class="text-muted flex justify-center align-center">\n\t\t\t\t'+this.get_no_result_message()+"\n\t\t\t</div>\n\t\t</div>").hide(),this.$frappe_list.append(this.$no_result)}get_args(){var e=super.get_args();return frappe.views.FileView.grid_view&&Object.assign(e,{order_by:"is_folder desc, "+this.sort_by+" "+this.sort_order}),e}set_breadcrumbs(){var e=frappe.get_route();e.splice(-1);var t=e[e.length-1];if("File"!==t){var n=e.indexOf("Home"),i=n?e.slice(n+1):[];"File"!==t&&i.length?frappe.breadcrumbs.add({type:"Custom",label:__(t),route:"/app/file/view/Home/"+i.join("/")}):frappe.breadcrumbs.add({type:"Custom",label:__("Home"),route:"/app/file/view/Home"})}}setup_defaults(){var e=this;return super.setup_defaults().then((function(){e.page_title=__("File Manager");var t=frappe.get_route();e.current_folder=t.slice(2).join("/"),e.filters=[["File","folder","=",e.current_folder,!0]],e.order_by=e.view_user_settings.order_by||"file_name asc",e.menu_items=e.menu_items.concat(e.file_menu_items())}))}file_menu_items(){var e=this;return[{label:__("Home"),action:function(){frappe.set_route("List","File","Home")}},{label:__("New Folder"),action:function(){frappe.prompt(__("Name"),(function(t){t.value.indexOf("/")>-1&&frappe.throw(__("Folder name should not include '/' (slash)"));var n={file_name:t.value,folder:e.current_folder};frappe.call({method:"frappe.core.doctype.file.file.create_new_folder",args:n})}),__("Enter folder name"),__("Create"))}},{label:__("Import Zip"),action:function(){new frappe.ui.FileUploader({folder:e.current_folder,restrictions:{allowed_file_types:[".zip"]},on_success:function(e){frappe.show_alert(__("Unzipping files...")),frappe.call("frappe.core.doctype.file.file.unzip_file",{name:e.name}).then((function(e){e.message&&frappe.show_alert(__("Unzipped {0} files",[e.message]))}))}})}}]}add_file_action_buttons(){var e=this;this.$cut_button=this.page.add_button(__("Cut"),(function(){frappe.file_manager.cut(e.get_checked_items(),e.current_folder),e.$checks.parents(".file-wrapper").addClass("cut")})).hide(),this.$paste_btn=this.page.add_button(__("Paste"),(function(){return frappe.file_manager.paste(e.current_folder)})).hide()}set_fields(){this.fields=this.meta.fields.filter((function(e){return frappe.model.is_value_type(e.fieldtype)&&!e.hidden})).map((function(e){return e.fieldname})).concat(["name","modified","creation"])}prepare_data(e){var t=this;super.prepare_data(e),this.data=this.data.map((function(e){return t.prepare_datum(e)})),"file_name"===this.sort_selector.sort_by&&this.data.sort((function(e,t){return e.is_folder&&!t.is_folder?-1:!e.is_folder&&t.is_folder?1:0}))}prepare_datum(e){var t="",n="";e.is_folder?(t="folder-normal",n="folder"):frappe.utils.is_image_file(e.file_name)?(t="image",n="image"):(t="file",n="file");var i=e.file_name||e.file_url;return i=i.slice(0,60),e._title=i,e.icon_class=t,e._type=n,e.subject_html="\n\t\t\t"+frappe.utils.icon(t)+"\n\t\t\t<span>"+i+"</span>\n\t\t\t"+(e.is_private?'<i class="fa fa-lock fa-fw text-warning"></i>':"")+"\n\t\t",e}before_render(){super.before_render(),frappe.model.user_settings.save("File","grid_view",frappe.views.FileView.grid_view),this.save_view_user_settings({last_folder:this.current_folder})}render(){this.$result.empty().removeClass("file-grid-view"),frappe.views.FileView.grid_view?this.render_grid_view():(super.render(),this.render_header())}after_render(){}render_list(){frappe.views.FileView.grid_view?this.render_grid_view():super.render_list()}render_grid_view(){var e=this,t=this.data.map((function(t){var n=t.icon_class+"-large",i="image"==t._type?'<div class="file-image"><img src="'+t.file_url+'" alt="'+t.file_name+'"></div>':frappe.utils.icon(n,{width:"40px",height:"45px"}),r=escape(t.name),a="Folder"!=t.type;return'\n\t\t\t\t<a href="'+e.get_route_url(t)+'"\n\t\t\t\t\tdraggable="'+a+'" class="file-wrapper ellipsis" data-name="'+r+'">\n\t\t\t\t\t<div class="file-header">\n\t\t\t\t\t\t<input class="level-item list-row-checkbox hidden-xs" type="checkbox" data-name="'+r+'">\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="file-body">\n\t\t\t\t\t\t'+i+'\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="file-footer">\n\t\t\t\t\t\t<div class="file-title ellipsis">'+t._title+'</div>\n\t\t\t\t\t\t<div class="file-creation">'+e.get_creation_date(t)+"</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t"})).join("");this.$result.addClass("file-grid-view"),this.$result.empty().html('<div class="file-grid">\n\t\t\t\t'+t+"\n\t\t\t</div>")}get_breadcrumbs_html(){var e=frappe.router.parse().slice(2);return e.map((function(t,n){return n===e.length-1?"<span>"+t+"</span>":'<a href="'+e.reduce((function(e,t,i){return i<=n&&(e+="/"+t),e}),"/app/file/view")+'">'+t+"</a>"})).join("&nbsp;/&nbsp;")}get_header_html(){var e=this.get_breadcrumbs_html(),t='\n\t\t\t<div class="list-row-col list-subject level">\n\t\t\t\t'+(frappe.views.FileView.grid_view?"":'<input class="level-item list-check-all hidden-xs" type="checkbox" title="'+__("Select All")+'">')+'\n\t\t\t\t<span class="level-item">'+e+"</span>\n\t\t\t</div>\n\t\t\t"+(frappe.views.FileView.grid_view?"":'<div class="list-row-col ellipsis hidden-xs">\n\t\t\t\t\t<span>'+__("Size")+'</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="list-row-col ellipsis hidden-xs">\n\t\t\t\t\t<span>'+__("Created")+"</span>\n\t\t\t\t</div>")+"\n\t\t";return this.get_header_html_skeleton(t,'<span class="list-count"></span>')}get_route_url(e){return e.is_folder?"/app/file/view/"+e.name:this.get_form_link(e)}get_creation_date(e){var t=e.creation.split(" ")[0];return t===frappe.datetime.now_date()?comment_when(e.creation):frappe.datetime.str_to_user(t)}get_left_html(e){var t=(e=this.prepare_datum(e)).file_size?frappe.form.formatters.FileSize(e.file_size):"",n=this.get_route_url(e);return'\n\t\t\t<div class="list-row-col ellipsis list-subject level">\n\t\t\t\t<input class="level-item list-row-checkbox hidden-xs"\n\t\t\t\t\ttype="checkbox" data-name="'+e.name+'">\n\t\t\t\t<span class="level-item ellipsis" title="'+e.file_name+'">\n\t\t\t\t\t<a class="ellipsis" href="'+n+'" title="'+e.file_name+'">\n\t\t\t\t\t\t'+e.subject_html+'\n\t\t\t\t\t</a>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<div class="list-row-col ellipsis hidden-xs text-muted">\n\t\t\t\t<span>'+t+'</span>\n\t\t\t</div>\n\t\t\t<div class="list-row-col ellipsis hidden-xs text-muted">\n\t\t\t\t<span>'+this.get_creation_date(e)+"</span>\n\t\t\t</div>\n\t\t"}get_right_html(e){return'\n\t\t\t<div class="level-item list-row-activity">\n\t\t\t\t'+comment_when(e.modified)+"\n\t\t\t</div>\n\t\t"}setup_events(){super.setup_events(),this.setup_drag_events()}setup_drag_events(){var e=this;this.$result.on("dragstart",".files .file-wrapper",(function(t){t.stopPropagation(),t.originalEvent.dataTransfer.setData("Text",$(t.currentTarget).attr("data-name")),t.target.style.opacity="0.4",frappe.file_manager.cut([{name:$(t.currentTarget).attr("data-name")}],e.current_folder)})),this.$result.on("dragover",(function(e){e.preventDefault()}),!1),this.$result.on("dragend",".files .file-wrapper",(function(e){e.preventDefault(),e.stopPropagation(),e.target.style.opacity="1"})),this.$result.on("drop",(function(t){t.stopPropagation(),t.preventDefault();var n=$(t.target).parents(".file-wrapper"),i=t.originalEvent.dataTransfer;if(i)if(i.files&&i.files.length>0)new frappe.ui.FileUploader({files:i.files,folder:e.current_folder});else if(i.getData("Text")&&0!==n.parents(".folders").length){var r=i.getData("Text"),a=decodeURIComponent(n.attr("data-name"));frappe.file_manager.paste(a),frappe.show_alert("File "+r+" moved to "+a)}}))}toggle_result_area(){super.toggle_result_area(),this.toggle_cut_paste_buttons()}on_row_checked(){super.on_row_checked(),this.toggle_cut_paste_buttons()}toggle_cut_paste_buttons(){var e=!frappe.file_manager.can_paste||frappe.file_manager.old_folder===this.current_folder,t=!(this.$checks&&this.$checks.length>0);this.$paste_btn.toggle(!e),this.$cut_button.toggle(!t)}},frappe.views.FileView.grid_view=frappe.get_user_settings("File").grid_view||!1,frappe.provide("frappe.views"),frappe.views.MapView=class extends frappe.views.ListView{get view_name(){return"Map"}setup_defaults(){super.setup_defaults(),this.page_title=__("{0} Map",[this.page_title])}get_fields(){var e=this;return this.gelocation_fields=this.meta.fields.filter((function(e){return"Geolocation"===e.fieldtype})).map((function(e){return e.fieldname})),this.gelocation_fields.forEach((function(t){e.fields.push([t,e.doctype])})),super.get_fields()}get_list_fields(){this.list_fields=this.meta.fields.filter((function(e){return 1===e.in_list_view||1===e.in_preview})).reduce((function(e,t){var n;return Object.assign(e,((n={})[t.fieldname]=t.label,n))}),{})}setup_view(){this.sort_selector.wrapper.hide(),this.list_sidebar&&this.list_sidebar.parent.find(".list-tag-preview").hide()}prepare_data(e){super.prepare_data(e),this.get_list_fields()}render(){this.make_wrapper(),this.bind_leaflet_map(),this.bind_leaflet_draw_control(),this.render_map()}make_wrapper(){this.$result.empty(),this.map_id=frappe.dom.get_unique_id(),this.map_area=$('<div class="map-wrapper border">\n\t\t\t\t<div id='+this.map_id+' style="min-height: calc(100vh - 284px); z-index: 1; max-width:100%"></div>\n\t\t\t</div>'),this.map_area.prependTo(this.$result)}bind_leaflet_map(){var e=L.Circle.prototype.toGeoJSON;L.Circle.include({toGeoJSON:function(){var t=e.call(this);return t.properties={point_type:"circle",radius:this.getRadius()},t}}),L.CircleMarker.include({toGeoJSON:function(){var t=e.call(this);return t.properties={point_type:"circlemarker",radius:this.getRadius()},t}}),L.Icon.Default.imagePath="/assets/frappe/images/leaflet/",this.map=L.map(this.map_id).fitWorld(),L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}).addTo(this.map)}bind_leaflet_draw_control(){var e=this;this.editableLayers=new L.FeatureGroup;var t={position:"topleft",draw:{polyline:{shapeOptions:{color:frappe.ui.color.get("blue"),weight:5}},polygon:!1,marker:!1,circle:!1,circlemarker:!1,rectangle:!1},edit:{featureGroup:this.editableLayers,remove:!1}},n=new L.Control.Draw(t);this.map.addControl(n),this.map.on("draw:created",(function(t){var n=t.layerType,i=t.layer;"marker"===n&&i.bindPopup("Marker"),e.editableLayers.addLayer(i)})),this.map.on("draw:deleted draw:edited",(function(t){var n=t.layer;e.editableLayers.removeLayer(n)}))}render_map(){var e=this;e.editableLayers=new L.FeatureGroup,e.data.forEach((function(t){e.gelocation_fields.forEach((function(n){var i=t[n],r=(new L.LayerGroup).addLayer(L.geoJson(JSON.parse(i),{pointToLayer:function(n,i){return"circle"==n.properties.point_type?L.circle(i,{radius:n.properties.radius}).bindPopup(e.get_popup(t)).bindTooltip(e.get_tooltip(t)):"circlemarker"==n.properties.point_type?L.circleMarker(i,{radius:n.properties.radius}).bindPopup(e.get_popup(t)).bindTooltip(e.get_tooltip(t)):L.marker(i).bindPopup(e.get_popup(t)).bindTooltip(e.get_tooltip(t))}}));e.add_non_group_layers(r,e.editableLayers)}))}));try{e.map.flyToBounds(e.editableLayers.getBounds(),{animate:!1,padding:[50,50]})}catch(e){}e.editableLayers.addTo(e.map),e.map._onResize()}add_non_group_layers(e,t){var n=this;e instanceof L.LayerGroup?e.eachLayer((function(e){n.add_non_group_layers(e,t)})):t.addLayer(e)}get_popup(e){var t=this;return Object.keys(this.list_fields).reduce((function(n,i){return n+"<p><b>"+__(t.list_fields[i])+"</b>: "+__(e[i])+"</p>"}),"<b>"+frappe.utils.get_form_link(this.doctype,e.name,!0)+"</b>")}get_tooltip(e){return"<b>"+e.name+"</b>"}},frappe.provide("frappe.treeview_settings"),frappe.provide("frappe.views.trees"),window.cur_tree=null,frappe.views.TreeFactory=class extends frappe.views.Factory{make(e){frappe.model.with_doctype(e[1],(function(){var t={doctype:e[1],meta:frappe.get_meta(e[1])};if(!frappe.treeview_settings[e[1]]&&!frappe.meta.get_docfield(e[1],"is_group"))return frappe.msgprint(__("Tree view is not available for {0}",[e[1]])),!1;$.extend(t,frappe.treeview_settings[e[1]]||{}),frappe.views.trees[t.doctype]=new frappe.views.TreeView(t)}))}},frappe.views.TreeView=Class.extend({init:function(e){var t=this;this.opts={},this.opts.get_tree_root=!0,this.opts.show_expand_all=!0,$.extend(this.opts,e),this.doctype=e.doctype,this.args={doctype:t.doctype},this.page_name=frappe.get_route_str(),this.get_tree_nodes=t.opts.get_tree_nodes||"frappe.desk.treeview.get_children",this.get_permissions(),this.make_page(),this.make_filters(),this.root_value=null,t.opts.get_tree_root&&this.get_root(),this.onload(),this.set_menu_item(),this.set_primary_action()},get_permissions:function(){this.can_read=frappe.model.can_read(this.doctype),this.can_create=-1!==frappe.boot.user.can_create.indexOf(this.doctype)||-1!==frappe.boot.user.in_create.indexOf(this.doctype),this.can_write=frappe.model.can_write(this.doctype),this.can_delete=frappe.model.can_delete(this.doctype)},make_page:function(){var e=this;if(this.parent=frappe.container.add_page(this.page_name),frappe.ui.make_app_page({parent:this.parent,single_column:!0}),this.page=this.parent.page,frappe.container.change_to(this.page_name),frappe.breadcrumbs.add(e.opts.breadcrumb||locals.DocType[e.doctype].module,e.doctype),this.set_title(),this.page.main.css({"min-height":"300px"}),this.page.main.addClass("frappe-card"),this.opts.show_expand_all&&this.page.add_inner_button(__("Expand All"),(function(){e.tree.load_children(e.tree.root_node,!0)})),this.opts.view_template){var t=$('<div class="row"><div>').appendTo(this.page.main);this.body=$('<div class="col-sm-6 col-xs-12"></div>').appendTo(t),this.node_view=$('<div class="col-sm-6 hidden-xs"></div>').appendTo(t)}else this.body=this.page.main},set_title:function(){this.page.set_title(this.opts.title||__("{0} Tree",[__(this.doctype)]))},onload:function(){this.opts.onload&&this.opts.onload(this)},make_filters:function(){var e=this;frappe.treeview_settings.filters=[],$.each(this.opts.filters||[],(function(t,n){frappe.route_options&&frappe.route_options[n.fieldname]&&(n.default=frappe.route_options[n.fieldname]),n.disable_onchange||(n.change=function(){n.onchange&&n.onchange();var t=this.get_value();e.args[n.fieldname]=t,e.root_label=t||e.opts.root_label,e.set_title(),e.make_tree()}),e.page.add_field(n),n.default&&$("[data-fieldname='"+n.fieldname+"']").trigger("change")}))},get_root:function(){var e=this;frappe.call({method:e.get_tree_nodes,args:e.args,callback:function(t){t.message&&(t.message.length>1?(e.root_label=e.doctype,e.root_value=""):(e.root_label=t.message[0].value,e.root_value=e.root_label),e.make_tree())}})},make_tree:function(){var e=this;$(this.parent).find(".tree").remove(),this.before_render();var t=this.args[this.opts.root_label]||this.root_label||this.opts.root_label,n=this.root_value;null==n&&(n=t),this.tree=new frappe.ui.Tree({parent:this.body,label:t,root_value:n,expandable:!0,args:this.args,method:this.get_tree_nodes,toolbar:this.get_toolbar(),get_label:this.opts.get_label,on_render:this.opts.onrender,on_click:function(t){e.select_node(t)}}),cur_tree=this.tree,this.post_render()},before_render:function(){frappe.model.user_settings.save(this.doctype,"last_view","Tree")},rebuild_tree:function(){var e=this;frappe.call({method:"frappe.utils.nestedset.rebuild_tree",args:{doctype:e.doctype,parent_field:"parent_"+e.doctype.toLowerCase().replace(/ /g,"_")},callback:function(t){t.exc||e.make_tree()}})},post_render:function(){var e=this;e.opts.post_render&&e.opts.post_render(e)},select_node:function(e){this.opts.click&&this.opts.click(e),this.opts.view_template&&(this.node_view.empty(),$(frappe.render_template(this.opts.view_template,{data:e.data,doctype:this.doctype})).appendTo(this.node_view))},get_toolbar:function(){var e=this,t=[{label:__(e.can_write?"Edit":"Details"),condition:function(t){return!t.is_root&&e.can_read},click:function(t){frappe.set_route("Form",e.doctype,t.label)}},{label:__("Add Child"),condition:function(t){return e.can_create&&t.expandable&&!t.hide_add},click:function(t){e.new_node()},btnClass:"hidden-xs"},{label:__("Rename"),condition:function(t){var n=!0;return e.doctype&&frappe.get_meta(e.doctype)&&(frappe.get_meta(e.doctype).allow_rename||(n=!1)),!t.is_root&&e.can_write&&n},click:function(t){frappe.model.rename_doc(e.doctype,t.label,(function(e){t.$tree_link.find("a").text(e),t.label=e}))},btnClass:"hidden-xs"},{label:__("Delete"),condition:function(t){return!t.is_root&&e.can_delete},click:function(t){frappe.model.delete_doc(e.doctype,t.label,(function(){t.parent.remove()}))},btnClass:"hidden-xs"}];return this.opts.toolbar&&this.opts.extend_toolbar?(t=t.filter((function(t){return!e.opts.toolbar.find((function(e){return e.label==t.label}))}))).concat(this.opts.toolbar):this.opts.toolbar&&!this.opts.extend_toolbar?this.opts.toolbar:t},new_node:function(){var e=this,t=e.tree.get_selected_node();if(t&&t.expandable){this.prepare_fields();var n=new frappe.ui.Dialog({title:__("New {0}",[__(e.doctype)]),fields:e.fields}),i=$.extend({},e.args);i["parent_"+e.doctype.toLowerCase().replace(/ /g,"_")]=e.args.parent,n.set_value("is_group",0),n.set_values(i),n.set_primary_action(__("Create New"),(function(){var r=n.get_values();if(r)return r.parent=t.label,r.doctype=e.doctype,t.is_root?r.is_root=t.is_root:r.is_root=!1,n.hide(),frappe.dom.freeze(__("Creating {0}",[e.doctype])),$.extend(i,r),frappe.call({method:e.opts.add_tree_node||"frappe.desk.treeview.add_node",args:i,callback:function(n){n.exc||(t.expanded&&e.tree.toggle_node(t),e.tree.load_children(t,!0))},always:function(){frappe.dom.unfreeze()}})})),n.show()}else frappe.msgprint(__("Select a group node first."))},prepare_fields:function(){var e=this;this.fields=[{fieldtype:"Check",fieldname:"is_group",label:__("Group Node"),description:__("Further nodes can be only created under 'Group' type nodes")}],this.opts.fields&&(this.fields=this.opts.fields),this.ignore_fields=this.opts.ignore_fields||[];var t=$.map(e.opts.meta.fields,(function(e){return e.reqd||e.bold&&!e.read_only?e:null})),n=this.fields.map((function(e){return e.fieldname}));t.map((function(t){-1===$.inArray(t.fieldname,e.ignore_fields)&&-1===$.inArray(t.fieldname,n)&&e.fields.push(t)}))},print_tree:function(){if(!frappe.model.can_print(this.doctype))return frappe.msgprint(__("You are not allowed to print this report")),!1;var e=$(".tree:visible").html(),t=this;frappe.ui.get_print_settings(!1,(function(n){var i=__(t.docname||t.doctype);frappe.render_tree({title:i,tree:e,print_settings:n}),frappe.call({method:"frappe.core.doctype.access_log.access_log.make_access_log",args:{doctype:t.doctype,report_name:t.page_name,page:e,method:"Print"}})}))},set_primary_action:function(){var e=this;!this.opts.disable_add_node&&this.can_create&&e.page.set_primary_action(__("New"),(function(){e.new_node()}),"add")},set_menu_item:function(){var me=this;this.menu_items=[{label:__("View List"),action:function(){frappe.set_route("List",me.doctype)}},{label:__("Print"),action:function(){me.print_tree()}},{label:__("Refresh"),action:function(){me.make_tree()}}],frappe.user.has_role("System Manager")&&this.menu_items.push({label:__("Rebuild Tree"),action:function(){me.rebuild_tree()}}),me.opts.menu_items&&me.menu_items.push.apply(me.menu_items,me.opts.menu_items),$.each(me.menu_items,(function(i,menu_item){var has_perm=!0;menu_item.condition&&(has_perm=eval(menu_item.condition)),has_perm&&me.page.add_menu_item(menu_item.label,menu_item.action)}))}}),frappe.provide("frappe.views"),frappe.provide("frappe.interaction_settings"),frappe.views.InteractionComposer=class{constructor(e){var t=this;$.extend(this,e),frappe.model.with_doctype("Event Participants",(function(){t.make()}))}make(){var e=this;e.dialog=new frappe.ui.Dialog({title:e.title||e.subject||__("New Activity"),no_submit_on_enter:!0,fields:e.get_fields(),primary_action_label:__("Create"),primary_action:function(){e.create_action()}}),$(document).on("upload_complete",(function(t,n){if(e.dialog.display){var i=$(e.dialog.fields_dict.select_attachments.wrapper),r=i.find("[data-file-name]:checked").map((function(){return $(this).attr("data-file-name")}));e.render_attach(),r.push(n.name),$.each(r,(function(e,t){i.find('[data-file-name="'+t+'"]').prop("checked",!0)}))}})),e.prepare(),e.dialog.show()}get_fields(){var e=this,t=Object.keys(get_doc_mappings());return[{label:__("Reference"),fieldtype:"Select",fieldname:"interaction_type",options:t,reqd:1,onchange:function(){var t=e.get_values();e.get_fields().forEach((function(t){"interaction_type"!=t.fieldname&&(e.dialog.set_df_property(t.fieldname,"reqd",0),e.dialog.set_df_property(t.fieldname,"hidden",0))})),e.set_reqd_hidden_fields(t),e.get_event_categories()}},{label:__("Category"),fieldtype:"Select",fieldname:"category",options:"",hidden:1},{label:__("Public"),fieldtype:"Check",fieldname:"public",default:"1"},{fieldtype:"Column Break"},{label:__("Date"),fieldtype:"Datetime",fieldname:"due_date"},{label:__("Assigned To"),fieldtype:"Link",fieldname:"assigned_to",options:"User"},{fieldtype:"Section Break"},{label:__("Participants"),fieldtype:"Table MultiSelect",fieldname:"participants",options:"Event Participants"},{fieldtype:"Section Break"},{label:__("Summary"),fieldtype:"Data",fieldname:"summary"},{fieldtype:"Section Break"},{fieldtype:"Text Editor",fieldname:"description"},{fieldtype:"Section Break"},{label:__("Select Attachments"),fieldtype:"HTML",fieldname:"select_attachments"}]}get_event_categories(){var e=this;frappe.model.with_doctype("Event",(function(){var t=frappe.meta.get_docfield("Event","event_category").options.split("\n");e.dialog.get_input("category").empty().add_options(t)}))}prepare(){this.setup_attach()}set_reqd_hidden_fields(e){var t=this;if(e&&"interaction_type"in e){var n=get_doc_mappings();n[e.interaction_type].reqd_fields.forEach((function(e){t.dialog.set_df_property(e,"reqd",1)})),n[e.interaction_type].hidden_fields.forEach((function(e){t.dialog.set_df_property(e,"hidden",1)}))}}setup_attach(){var e=this,t=this.dialog.fields_dict,n=$(t.select_attachments.wrapper);this.attachments||(this.attachments=[]);var i={folder:frappe.boot.attachments_folder,on_success:function(t){return e.attachments.push(t)}};this.frm&&(i={doctype:this.frm.doctype,docname:this.frm.docname,folder:frappe.boot.attachments_folder,on_success:function(t){e.frm.attachments.attachment_uploaded(t),e.render_attach()}}),$("<h6 class='text-muted add-attachment' style='margin-top: 12px; cursor:pointer;'>"+__("Select Attachments")+"</h6><div class='attach-list'></div>\t\t\t<p class='add-more-attachments'>\t\t\t<a class='text-muted small'><i class='octicon octicon-plus' style='font-size: 12px'></i> "+__("Add Attachment")+"</a></p>").appendTo(n.empty()),n.find(".add-more-attachments a").on("click",(function(){return new frappe.ui.FileUploader(i)})),this.render_attach()}render_attach(){var e=this.dialog.fields_dict,t=$(e.select_attachments.wrapper).find(".attach-list").empty(),n=[];this.attachments&&this.attachments.length&&(n=n.concat(this.attachments)),cur_frm&&(n=n.concat(cur_frm.get_files())),n.length&&$.each(n,(function(e,n){n.file_name&&(n.file_url=frappe.urllib.get_full_url(n.file_url),$(repl('<p class="checkbox"><label><span><input type="checkbox" data-file-name="%(name)s"></input></span><span class="small">%(file_name)s</span> <a href="%(file_url)s" target="_blank" class="text-muted small"><i class="uil uil-file-share-alt" style="vertical-align: middle; margin-left: 3px;"></i></label></p>',n)).appendTo(t))}))}create_action(){var e=this,t=e.dialog.get_primary_btn(),n=this.get_values();if(n){var i=$.map($(e.dialog.wrapper).find("[data-file-name]:checked"),(function(e){return $(e).attr("data-file-name")}));e.create_interaction(t,n,i)}}get_values(){var e=this.dialog.get_values(!0);return e&&(e.reference_doctype=this.frm.doc.doctype,e.reference_document=this.frm.doc.name),e}create_interaction(e,t,n){var i=this;i.dialog.hide();var r=get_doc_mappings(),a={};return Object.keys(t).forEach((function(e){a[r[t.interaction_type].field_map[e]]=t[e]})),"event_type"in a&&(a.event_type=1==t.public?"Public":"Private"),"Event"==a.doctype&&(a.event_participants=t.participants),"owner"in a||(a.owner=frappe.session.user),frappe.call({method:"frappe.client.insert",args:{doc:a},btn:e,callback:function(e){e.exc?frappe.msgprint(__("There were errors while creating the document. Please try again.")):(frappe.show_alert({message:__("{0} created successfully",[t.interaction_type]),indicator:"green"}),"assigned_to"in t&&i.assign_document(e.message,t.assigned_to),n&&i.add_attachments(e.message,n),cur_frm&&cur_frm.reload_doc())}})}assign_document(e,t){"ToDo"!=e.doctype&&frappe.call({method:"frappe.desk.form.assign_to.add",args:{doctype:e.doctype,name:e.name,assign_to:JSON.stringify([t])},callback:function(e){return e.exc?void frappe.show_alert({message:__("The document could not be correctly assigned"),indicator:"orange"}):void frappe.show_alert({message:__("The document has been assigned to {0}",[t]),indicator:"green"})}})}add_attachments(e,t){frappe.call({method:"frappe.utils.file_manager.add_attachments",args:{doctype:e.doctype,name:e.name,attachments:JSON.stringify(t)},callback:function(e){return e.exc?void frappe.show_alert({message:__("The attachments could not be correctly linked to the new document"),indicator:"orange"}):void 0}})}},frappe.templates.image_view_item_row='<div class="image-view-item has-checkbox ellipsis">  <div class="image-view-header doclist-row">   <div class="list-value">   {{ subject }}   </div>  </div>    <div class="image-view-body">   <a  data-name="{{ data.name }}"    title="{{ data.name }}"    href="/app/Form/{{ data.doctype }}/{{ data.name }}"   >    <div class="image-field"     data-name="{{ data.name }}"     style="     {% if (!data._image_url) { %}      background-color: {{ color }};     {% } %}     border: 0px;"    >     {% if (!data._image_url) { %}     <span class="placeholder-text">      {%= frappe.get_abbr(data._title) %}     </span>     {% } %}     {% if (data._image_url) { %}     <img data-name="{{ data.name }}" src="{{ data._image_url }}" alt="{{data.title}}">     {% } %}     <button class="btn btn-default zoom-view" data-name="{{data.name}}">      <i class="uil uil-search-plus"></i>     </button>    </div>   </a>  </div> </div> ',frappe.templates.photoswipe_dom='    <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">     <div class="pswp__bg"></div>     <div class="pswp__scroll-wrap">       <div class="pswp__container">    <div class="pswp__item"></div>    <div class="pswp__item"></div>    <div class="pswp__item"></div>   </div>    <div class="pswp__more-items">    </div>       <div class="pswp__ui pswp__ui--hidden">     <div class="pswp__top-bar">            <div class="pswp__counter"></div>      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>      <button class="pswp__button pswp__button--share" title="Share"></button>      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>                <div class="pswp__preloader">      <div class="pswp__preloader__icn">        <div class="pswp__preloader__cut">       <div class="pswp__preloader__donut"></div>        </div>      </div>     </div>    </div>     <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">     <div class="pswp__share-tooltip"></div>    </div>     <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">    </button>     <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">    </button>     <div class="pswp__caption">     <div class="pswp__caption__center"></div>    </div>    </div>   </div>  </div>',frappe.templates.kanban_board='<div class="kanban">  <div class="kanban-column add-new-column">   <div class="kanban-column-title compose-column">    <a> + {{ __("Add Column") }}</a>   </div>   <form class="compose-column-form kanban-column-title">    <input class="new-column-title" name="title" type="text" autocomplete="off">   </form>  </div>  <div class="kanban-empty-state text-muted text-center" style="display: none;">   {{ __("Loading...") }}  </div> </div>',frappe.templates.kanban_column='<div class="kanban-column" data-column-value="{{title}}">  <div class="kanban-column-header">   <span class="kanban-column-title">    <span class="indicator-pill {{indicator}}"></span>    <span class="kanban-title ellipsis" title="{{title}}">{{ __(title) }}</span>   </span>   <div class="column-options dropdown pull-right">    <a data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">     <svg class="icon icon-sm">      <use xlink:href="#icon-dot-horizontal"></use>     </svg>    </a>    <ul class="dropdown-menu" style="max-height: 300px; overflow-y: auto;">     <li><a class="dropdown-item" data-action="archive">{{ __("Archive") }}</a></li>    </ul>   </div>  </div>  <div class="add-card">   <div class="ellipsis">    + {{ __("Add {0}", [__(doctype)]) }}   </div>  </div>  <div class="kanban-card new-card-area">   <textarea name="title"></textarea>  </div>  <div class="kanban-cards">  </div> </div>',frappe.templates.kanban_card='<div class="kanban-card-wrapper {{ disable_click }}" data-name="{{escape(name)}}">  <a class="kanban-card-redirect" href="#">   <div class="kanban-card content">    {% if(image_url) { %}    <div class="kanban-image">     <img  src="{{image_url}}" alt="{{title}}">    </div>    {% } %}    <div class="kanban-card-body">     <div class="kanban-title-area">      <div class="kanban-card-title ellipsis" title="{{title}}">       {{ title }}      </div>      <div class="kanban-card-creation">       {{ creation }}      </div>     </div>     <div class="kanban-card-meta">     </div>    </div>   </div>  </a> </div>'})();
//# sourceMappingURL=list.min.js.map
